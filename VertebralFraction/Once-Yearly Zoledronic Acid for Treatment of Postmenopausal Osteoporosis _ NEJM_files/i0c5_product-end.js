/*! js-cookie v2.1.3 | MIT */
!function(a){var b=!1;if("function"==typeof define&&define.amd&&(define(a),b=!0),"object"==typeof exports&&(module.exports=a(),b=!0),!b){var c=window.Cookies,d=window.Cookies=a();d.noConflict=function(){return window.Cookies=c,d}}}(function(){function a(){for(var a=0,b={};a<arguments.length;a++){var c=arguments[a];for(var d in c)b[d]=c[d]}return b}function b(c){function d(b,e,f){var g;if("undefined"!=typeof document){if(arguments.length>1){if(f=a({path:"/"},d.defaults,f),"number"==typeof f.expires){var h=new Date;h.setMilliseconds(h.getMilliseconds()+864e5*f.expires),f.expires=h}try{g=JSON.stringify(e),/^[\{\[]/.test(g)&&(e=g)}catch(i){}return e=c.write?c.write(e,b):encodeURIComponent(e+"").replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),b=encodeURIComponent(b+""),b=b.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),b=b.replace(/[\(\)]/g,escape),document.cookie=b+"="+e+(f.expires?"; expires="+f.expires.toUTCString():"")+(f.path?"; path="+f.path:"")+(f.domain?"; domain="+f.domain:"")+(f.secure?"; secure":"")}b||(g={});for(var j=document.cookie?document.cookie.split("; "):[],k=/(%[0-9A-Z]{2})+/g,l=0;l<j.length;l++){var m=j[l].split("="),n=m.slice(1).join("=");'"'===n.charAt(0)&&(n=n.slice(1,-1));try{var o=m[0].replace(k,decodeURIComponent);if(n=c.read?c.read(n,o):c(n,o)||n.replace(k,decodeURIComponent),this.json)try{n=JSON.parse(n)}catch(i){}if(b===o){g=n;break}b||(g[o]=n)}catch(i){}}return g}}return d.set=d,d.get=function(a){return d.call(d,a)},d.getJSON=function(){return d.apply({json:!0},[].slice.call(arguments))},d.defaults={},d.remove=function(b,c){d(b,"",a(c,{expires:-1}))},d.withConverter=b,d}return b(function(){})});
(function($){$.fn.pbAjax=function(args){var widgetId=$(this).attr('widget-id');if(!widgetId){widgetId=$(this).data('widget-id');}
if(!widgetId){widgetId=$(this).attr('id');}
var pbContext=$("[name='pbContext']").attr('content');if((widgetId!==null)&&(widgetId!==undefined)){var data=args['data']?args['data']:{};data['pbContext']=pbContext;data['widgetId']=widgetId;var showJson=searchParams(window.location.href);if(showJson.hasOwnProperty("showJson"))
data["showJson"]=showJson["showJson"]||"";var targetUrl=args['url'];var requestMethod=args.hasOwnProperty('type')?args['type']:'GET';var requestDataType=args.hasOwnProperty('dataType')?args['dataType']:'html';var asyncRequest=args.hasOwnProperty('async')?args['async']:true;var successFunction=args['success'];var failFunction=args['error'];return $.ajax({type:requestMethod,dataType:requestDataType,async:asyncRequest,url:targetUrl,data:data,success:successFunction,error:failFunction});}else{console.log("widgetId not found");}
function searchParams(url){var objURL={};url.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function($0,$1,$2,$3){objURL[$1]=$3;});return objURL;}};})(jQuery);
if(window.PB&&window.PB.$){(function($){$.assetBrowser=function(field_name,url,type,win,options){var fileManagerURL='/resources/page-builder/widgets/file-browser/index.html?v4';var deferred=jQuery.Deferred();var opened=window.open(fileManagerURL,null,'width=1024, height=768');opened.deferred=deferred;opened.input=field_name;opened.options=options;jQuery(opened).bind("beforeunload",function(){deferred.reject();});return deferred.promise();};})(window.PB.$);};
$(document).ready(function(){$(".general-rss-feed-reader").each(function(){var $this=$(this);var $resultsTarget=$(this).find('.rss-body');var url=$(this).data('rss-url');var data={};if(url){data.url=url;}
$this.pbAjax({type:'GET',url:'/pb/widgets/rssWidget/loadWidget',data:data,dataType:'html',async:'false',success:function(data){$resultsTarget.html(data);}});});});
(function($){$.fn.Tabs=function(){TabsWidget.init();};var TabsWidget={init:function(){if($(".tabs-widget").length>0){$(".tabs").each(function(){var $tabs=$(this);if(!$tabs.data("tab")){TabsWidget.initTabs($(this));$tabs.data("tab",true);}});$("a[href^='#']:not(.tab-nav a):not(.coolBar a)").off("click.tabsWidget").on("click.tabsWidget",function(e){var href=$(this).attr("href");if($(href).closest(".tab-nav").length)return;var target=$(href);var pane=target.closest(".tab-pane");if(!pane.length)return;$(".tab-nav [href='#"+pane.attr("id")+"']").click();var anchor=target.offset().top;var layoutTabs=target.closest(".layout-tabs");if(layoutTabs.length){var tabTop=target.closest(".layout-tabs").offset().top;if(anchor-tabTop<window.innerHeight/2){$('html, body').scrollTop(tabTop);}else{$('html, body').scrollTop(anchor);}}else{if(target.is(':visible')===!target.is(':hidden'))
$('html, body').scrollTop(anchor);}
e.preventDefault();});$(document).on("click",".tab-nav .active > a",function(e){e.preventDefault();});$("li[role='tab']").each(function(){if($(this).hasClass('active')){$(this).attr("aria-selected","true");}else{$(this).attr("aria-selected","false");}});$(".accordion-heading").off("click");$(".accordion-heading").on("click",function(){if($(this).hasClass("active"))
$(this).removeClass("active");else{$(this).parent('.tab-pane').children(".accordion-heading.active").removeClass("active");$(this).addClass("active");}});var hashCode=location.href.split('#')[1];if(hashCode){try{var targetTag=$('a[href="#'+hashCode+'"]');if(targetTag.length>0){targetTag.click();}else{var nodeToShow=$("#"+hashCode);if(nodeToShow.length>0){var tabPane=nodeToShow.parents(".tab-pane");if(tabPane.length>0){var id=tabPane.attr("id");targetTag=$('a[href="#'+id+'"]');if(targetTag.length>0){targetTag.click();}}}}}catch(ex){}}}},initTabs:function($tabs){$tabs.find(".tab-nav li a").off("click.tabsWidget").on("click.tabsWidget",TabsWidget.tabClicked);if(!(window.PB&&window.PB.$)){$tabs.find(" .tab-content .tab-pane").each(function(){if($(this).text().trim().length>0)return;var id='#'+$(this).attr('id');$tabs.find(".listing-view .tab-nav li a[href=\'"+id+"\']").css("display","none");});}
var $menuTabs=$tabs.closest(".menu-tabs");if($menuTabs.length!==0){$(document).click(function(event){if($(event.target).parents().index($menuTabs)==-1){$menuTabs.children(".tab-nav").children().removeClass("active");$menuTabs.children(".tab-content").children(".tab-pane").removeClass("active");}})}else{var $activeTab=[];var $activePane=$tabs.find(".tab-content .activeWidget").closest('.tab-pane');if($activePane.length!=0){var tabId=$activePane.get(0).id;$activeTab=$tabs.find('.tab-nav li a[href="#'+tabId+'"]').closest('li');}
if($activeTab.length==0){$activeTab=$tabs.find(".tab-nav li.active");if($activeTab.length==0){$activeTab=$tabs.find(".tab-nav li").first();}}
$activeTab.children("a").click();}},tabClicked:function(event){var $tabModule=$(this).closest(".tabs");var href=$(this).attr("href")||"";if(href.indexOf("#")==0){var isEmpty=$(this).hasClass("tab-has-no-content");if(!isEmpty){$tabModule.children(".tab-nav").children().removeClass("active");$tabModule.children(".tab-content").children(".tab-pane").removeClass("active");$tabModule.children(".tab-nav").find("li[aria-selected='true']").attr({"aria-selected":"false"});$tabModule.children(".accordion-heading.active").removeClass("active");$(this).closest("li").attr({"aria-selected":"true"}).addClass("active");$(this).closest("li").siblings("li").find("a").not(".tab-ext-link").attr({"aria-selected":"false","aria-expanded":"false"});$(href).addClass("active");$(href).find(".accordion-heading").addClass("active");}
event.preventDefault();}
if($tabModule.hasClass("lazy-tabs-widget")){if($(this).closest("li").hasClass("loaded")||(event.originalEvent===undefined)){return;}
var selectedTabIndex=$(this).closest("li").prevAll().length;var $tab=$($tabModule.find(".tab-pane").get(selectedTabIndex));var $form=$tabModule.children(".tabContextData");var data={};$form.find(':input').each(function(){data[$(this).attr('name')]=$(this).val();});data['tabId']=$tab.attr('data-pb-dropzone');$tab.html('');$tab.addClass("loading");renderTabContent(data,$tab,$tabModule.closest(".layout-tabs"));$(this).parent().addClass("loaded");}
$.event.trigger("TabsWidgetChangedTab");}};$(document).ready(TabsWidget.init);$(document).on("reloadTabsWidget",function(){TabsWidget.init;});if(window.PB&&window.PB.$){window.PB.$(document.documentElement).on("WidgetReinit.layout-tabs",function(){try{TabsWidget.init()}catch(ex){if(console&&console.log){console.log("Error reinitializing tabs",ex);}}});}})(jQuery);function renderTabContent(data,$target,$widget){$widget.pbAjax({type:'GET',url:'/pb/widgets/lazyTabs/loadTab',dataType:'html',async:'false',data:data,success:function(data){renderDynamicContent(data,$target);}});}
function renderDynamicContent(data,$tab){$tab.removeClass("loading");$tab.html(data);$.event.trigger("reloadTabsWidget");};
if(window.PB&&window.PB.$){(function($,undefined){if($===undefined){return;}
var richTextWidgetAssetBrowser=function(callback,value,meta){var options={canSelectFile:true,canSelectFolder:false};var fileManagerPromise=$.assetBrowser(null,value,meta.filetype,window,options);fileManagerPromise.progress(function(aSelectedHierarchyItems,isFolder){if(aSelectedHierarchyItems.length>0&&!isFolder){var selectedResource=aSelectedHierarchyItems[0];callback(selectedResource.Href);if(window&&window.ImageDialog&&typeof(window.ImageDialog)!='undefined'){if(window.ImageDialog.getImageData){window.ImageDialog.getImageData();}
if(window.ImageDialog.showPreviewImage){window.ImageDialog.showPreviewImage(selectedResource.Href);}}}});return fileManagerPromise;};var HTML_CONTAINER='<div class="bs pb-tinymce-container">'+'<div class="pb-tinymce-target"/>'+'<div class="pb-tinymce-backdrop modal-backdrop"/>'+'</div>';var RichTextWidget={init:function(){if(window.tinyMCE===undefined){return;}
$("html").on("dblclick","[data-pb-widget-type='general-rich-text']:not(.pb-widget-locked)",{},function(){if($(".pb-tinymce-container").length===0)
if($("html").hasClass("pb-dropzone-mode")){var richChild=$(this).find(".pb-rich-text");RichTextWidget.activate.call(richChild[0]);}});},activate:function(){var el=this;var $el=$(this);var widget=$el.closest('.pb-widget').data('pb-view');if(!widget){return;}
function runEditor(el,widget){var tinyMCEConfig=$.extend({style_formats_merge:true,mode:'none',theme:'silver',selector:".pb-tinymce-container .pb-tinymce-target",plugins:['advlist autolink lists link image charmap print preview anchor','searchreplace visualblocks code fullscreen','insertdatetime media table paste code help wordcount hr template'],menu:{file:{title:'File',items:'newdocument customSaveMenuItem | preview | print '},},toolbar:'customSaveButton | undo redo | styleselect | template | bold italic backcolor forecolor| alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media| print preview  fullpage | emoticons | removeformat | help',autoresize_min_height:150,autoresize_on_init:false,autoresize_bottom_margin:30,extended_valid_elements:'i[class]',file_picker_callback:richTextWidgetAssetBrowser,convert_urls:false,setup:function(ed){ed.ui.registry.addButton('customSaveButton',{icon:"save",tooltip:"Save",onAction:function(){RichTextWidget.deactivate.call(tinyMCE.activeEditor)}});ed.ui.registry.addMenuItem('customSaveMenuItem',{icon:"save",text:"Save",onAction:function(){RichTextWidget.deactivate.call(tinyMCE.activeEditor)}});},init_instance_callback:function(editor){editor.setContent(el.innerHTML);$(".pb-tinymce-container .tox-tinymce").addClass("tiny-fullscreen");}},window.pbTinyMCEConfig||{});$(HTML_CONTAINER).appendTo(document.body).click(function(){RichTextWidget.deactivate.call(tinyMCE.activeEditor);});var $target=$('.pb-tinymce-container .pb-tinymce-target');$target.data('pb-widget',widget);tinyMCE.init(tinyMCEConfig);}
var contentUpdatedInScope=$el.closest('.pb-rich-text').data('content-updated-in-scope');if(contentUpdatedInScope){runEditor(el,widget);}else{$.pbOverridePropertyDialog({parent:el}).then(function(){runEditor(el,widget);});}},deactivate:function(){tinyMCE.execCommand("mceRemoveEditor",false,this.id);var $ee=$(this.getElement());var $target=$('.pb-tinymce-container .pb-tinymce-target');var widget=$target.data('pb-widget');var locale=$.pbLocale();var updates={content:{i18n:true}};updates.content[locale]=$ee.html();$('.pb-tinymce-container').remove();widget.el.trigger('UpdateWidget',[{widget:widget,updates:updates}]);}};$(document).ready(RichTextWidget.init);})(window.PB.$);};
(function($){function init(){$(".transplant-target").each(function(){var $transplantTarget=$(this);var cssSelector=$transplantTarget.data("cssSelector");if(cssSelector.length>0){var $transplantSource=$(cssSelector+":not(.transplant "+cssSelector+")");if($transplantSource.length>0){var newClass=$transplantTarget.data("newClassname");var removeOriginal=$transplantTarget.data("removeOriginal");var $transplantEl=$transplantSource.clone();$transplantEl.removeClass("hide");cleanup($transplantEl);$transplantTarget.html($transplantEl);if(removeOriginal&&!$transplantTarget.data("isPbedit")){$transplantSource.addClass("hide");}else{$transplantSource.removeClass("hide");}
if(typeof(newClass)!=="undefined"&&newClass.length>0)$transplantSource.addClass(newClass);}else{if($transplantTarget.data("isPbedit")){$transplantTarget.html("<div class='transplant-error'>CSS Selector not found in the DOM</div>");}}}else{if($transplantTarget.data("isPbedit")){$transplantTarget.html("<div class='transplant-error'>No CSS Selector Defined</div>");}}})}
function cleanup($transplantEl){findAndRemoveAttr($transplantEl,"id");findAndRemoveAttr($transplantEl,"data-pb-widget");}
function findAndRemoveAttr($element,attr){$element.find("["+attr+"]").each(function(){$(this).removeAttr(attr);});}
function findAndRemoveClass($element,className){$element.find("."+className).each(function(el){$(this).removeClass(className);})}
function findAndRemoveElement($element,selector){$element.find(selector).each(function(){$(this).remove();})}
$(document).ready(init);if(window.PB&&window.PB.$){window.PB.$(document.documentElement).on("WidgetReinit.transplant",init);}})(jQuery);/*! Hammer.JS - v2.0.8 - 2016-04-23
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
(function(window,document,exportName,undefined){'use strict';var VENDOR_PREFIXES=['','webkit','Moz','MS','ms','o'];var TEST_ELEMENT=document.createElement('div');var TYPE_FUNCTION='function';var round=Math.round;var abs=Math.abs;var now=Date.now;function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout);}
function invokeArrayArg(arg,fn,context){if(Array.isArray(arg)){each(arg,context[fn],context);return true;}
return false;}
function each(obj,iterator,context){var i;if(!obj){return;}
if(obj.forEach){obj.forEach(iterator,context);}else if(obj.length!==undefined){i=0;while(i<obj.length){iterator.call(context,obj[i],i,obj);i++;}}else{for(i in obj){obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj);}}}
function deprecate(method,name,message){var deprecationMessage='DEPRECATED METHOD: '+name+'\n'+message+' AT \n';return function(){var e=new Error('get-stack-trace');var stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,'').replace(/^\s+at\s+/gm,'').replace(/^Object.<anonymous>\s*\(/gm,'{anonymous}()@'):'Unknown Stack Trace';var log=window.console&&(window.console.warn||window.console.log);if(log){log.call(window.console,deprecationMessage,stack);}
return method.apply(this,arguments);};}
var assign;if(typeof Object.assign!=='function'){assign=function assign(target){if(target===undefined||target===null){throw new TypeError('Cannot convert undefined or null to object');}
var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey];}}}}
return output;};}else{assign=Object.assign;}
var extend=deprecate(function extend(dest,src,merge){var keys=Object.keys(src);var i=0;while(i<keys.length){if(!merge||(merge&&dest[keys[i]]===undefined)){dest[keys[i]]=src[keys[i]];}
i++;}
return dest;},'extend','Use `assign`.');var merge=deprecate(function merge(dest,src){return extend(dest,src,true);},'merge','Use `assign`.');function inherit(child,base,properties){var baseP=base.prototype,childP;childP=child.prototype=Object.create(baseP);childP.constructor=child;childP._super=baseP;if(properties){assign(childP,properties);}}
function bindFn(fn,context){return function boundFn(){return fn.apply(context,arguments);};}
function boolOrFn(val,args){if(typeof val==TYPE_FUNCTION){return val.apply(args?args[0]||undefined:undefined,args);}
return val;}
function ifUndefined(val1,val2){return(val1===undefined)?val2:val1;}
function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,false);});}
function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,false);});}
function hasParent(node,parent){while(node){if(node==parent){return true;}
node=node.parentNode;}
return false;}
function inStr(str,find){return str.indexOf(find)>-1;}
function splitStr(str){return str.trim().split(/\s+/g);}
function inArray(src,find,findByKey){if(src.indexOf&&!findByKey){return src.indexOf(find);}else{var i=0;while(i<src.length){if((findByKey&&src[i][findByKey]==find)||(!findByKey&&src[i]===find)){return i;}
i++;}
return-1;}}
function toArray(obj){return Array.prototype.slice.call(obj,0);}
function uniqueArray(src,key,sort){var results=[];var values=[];var i=0;while(i<src.length){var val=key?src[i][key]:src[i];if(inArray(values,val)<0){results.push(src[i]);}
values[i]=val;i++;}
if(sort){if(!key){results=results.sort();}else{results=results.sort(function sortUniqueArray(a,b){return a[key]>b[key];});}}
return results;}
function prefixed(obj,property){var prefix,prop;var camelProp=property[0].toUpperCase()+property.slice(1);var i=0;while(i<VENDOR_PREFIXES.length){prefix=VENDOR_PREFIXES[i];prop=(prefix)?prefix+camelProp:property;if(prop in obj){return prop;}
i++;}
return undefined;}
var _uniqueId=1;function uniqueId(){return _uniqueId++;}
function getWindowForElement(element){var doc=element.ownerDocument||element;return(doc.defaultView||doc.parentWindow||window);}
var MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;var SUPPORT_TOUCH=('ontouchstart'in window);var SUPPORT_POINTER_EVENTS=prefixed(window,'PointerEvent')!==undefined;var SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent);var INPUT_TYPE_TOUCH='touch';var INPUT_TYPE_PEN='pen';var INPUT_TYPE_MOUSE='mouse';var INPUT_TYPE_KINECT='kinect';var COMPUTE_INTERVAL=25;var INPUT_START=1;var INPUT_MOVE=2;var INPUT_END=4;var INPUT_CANCEL=8;var DIRECTION_NONE=1;var DIRECTION_LEFT=2;var DIRECTION_RIGHT=4;var DIRECTION_UP=8;var DIRECTION_DOWN=16;var DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT;var DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN;var DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL;var PROPS_XY=['x','y'];var PROPS_CLIENT_XY=['clientX','clientY'];function Input(manager,callback){var self=this;this.manager=manager;this.callback=callback;this.element=manager.element;this.target=manager.options.inputTarget;this.domHandler=function(ev){if(boolOrFn(manager.options.enable,[manager])){self.handler(ev);}};this.init();}
Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler);},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler);}};function createInputInstance(manager){var Type;var inputClass=manager.options.inputClass;if(inputClass){Type=inputClass;}else if(SUPPORT_POINTER_EVENTS){Type=PointerEventInput;}else if(SUPPORT_ONLY_TOUCH){Type=TouchInput;}else if(!SUPPORT_TOUCH){Type=MouseInput;}else{Type=TouchMouseInput;}
return new(Type)(manager,inputHandler);}
function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length;var changedPointersLen=input.changedPointers.length;var isFirst=(eventType&INPUT_START&&(pointersLen-changedPointersLen===0));var isFinal=(eventType&(INPUT_END|INPUT_CANCEL)&&(pointersLen-changedPointersLen===0));input.isFirst=!!isFirst;input.isFinal=!!isFinal;if(isFirst){manager.session={};}
input.eventType=eventType;computeInputData(manager,input);manager.emit('hammer.input',input);manager.recognize(input);manager.session.prevInput=input;}
function computeInputData(manager,input){var session=manager.session;var pointers=input.pointers;var pointersLength=pointers.length;if(!session.firstInput){session.firstInput=simpleCloneInputData(input);}
if(pointersLength>1&&!session.firstMultiple){session.firstMultiple=simpleCloneInputData(input);}else if(pointersLength===1){session.firstMultiple=false;}
var firstInput=session.firstInput;var firstMultiple=session.firstMultiple;var offsetCenter=firstMultiple?firstMultiple.center:firstInput.center;var center=input.center=getCenter(pointers);input.timeStamp=now();input.deltaTime=input.timeStamp-firstInput.timeStamp;input.angle=getAngle(offsetCenter,center);input.distance=getDistance(offsetCenter,center);computeDeltaXY(session,input);input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x;input.overallVelocityY=overallVelocity.y;input.overallVelocity=(abs(overallVelocity.x)>abs(overallVelocity.y))?overallVelocity.x:overallVelocity.y;input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1;input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):0;input.maxPointers=!session.prevInput?input.pointers.length:((input.pointers.length>session.prevInput.maxPointers)?input.pointers.length:session.prevInput.maxPointers);computeIntervalInputData(session,input);var target=manager.element;if(hasParent(input.srcEvent.target,target)){target=input.srcEvent.target;}
input.target=target;}
function computeDeltaXY(session,input){var center=input.center;var offset=session.offsetDelta||{};var prevDelta=session.prevDelta||{};var prevInput=session.prevInput||{};if(input.eventType===INPUT_START||prevInput.eventType===INPUT_END){prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0};offset=session.offsetDelta={x:center.x,y:center.y};}
input.deltaX=prevDelta.x+(center.x-offset.x);input.deltaY=prevDelta.y+(center.y-offset.y);}
function computeIntervalInputData(session,input){var last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp,velocity,velocityX,velocityY,direction;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===undefined)){var deltaX=input.deltaX-last.deltaX;var deltaY=input.deltaY-last.deltaY;var v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x;velocityY=v.y;velocity=(abs(v.x)>abs(v.y))?v.x:v.y;direction=getDirection(deltaX,deltaY);session.lastInterval=input;}else{velocity=last.velocity;velocityX=last.velocityX;velocityY=last.velocityY;direction=last.direction;}
input.velocity=velocity;input.velocityX=velocityX;input.velocityY=velocityY;input.direction=direction;}
function simpleCloneInputData(input){var pointers=[];var i=0;while(i<input.pointers.length){pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)};i++;}
return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY};}
function getCenter(pointers){var pointersLength=pointers.length;if(pointersLength===1){return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};}
var x=0,y=0,i=0;while(i<pointersLength){x+=pointers[i].clientX;y+=pointers[i].clientY;i++;}
return{x:round(x/pointersLength),y:round(y/pointersLength)};}
function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0};}
function getDirection(x,y){if(x===y){return DIRECTION_NONE;}
if(abs(x)>=abs(y)){return x<0?DIRECTION_LEFT:DIRECTION_RIGHT;}
return y<0?DIRECTION_UP:DIRECTION_DOWN;}
function getDistance(p1,p2,props){if(!props){props=PROPS_XY;}
var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt((x*x)+(y*y));}
function getAngle(p1,p2,props){if(!props){props=PROPS_XY;}
var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.atan2(y,x)*180/Math.PI;}
function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY);}
function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY);}
var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END};var MOUSE_ELEMENT_EVENTS='mousedown';var MOUSE_WINDOW_EVENTS='mousemove mouseup';function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS;this.evWin=MOUSE_WINDOW_EVENTS;this.pressed=false;Input.apply(this,arguments);}
inherit(MouseInput,Input,{handler:function MEhandler(ev){var eventType=MOUSE_INPUT_MAP[ev.type];if(eventType&INPUT_START&&ev.button===0){this.pressed=true;}
if(eventType&INPUT_MOVE&&ev.which!==1){eventType=INPUT_END;}
if(!this.pressed){return;}
if(eventType&INPUT_END){this.pressed=false;}
this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:INPUT_TYPE_MOUSE,srcEvent:ev});}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL};var IE10_POINTER_TYPE_ENUM={2:INPUT_TYPE_TOUCH,3:INPUT_TYPE_PEN,4:INPUT_TYPE_MOUSE,5:INPUT_TYPE_KINECT};var POINTER_ELEMENT_EVENTS='pointerdown';var POINTER_WINDOW_EVENTS='pointermove pointerup pointercancel';if(window.MSPointerEvent&&!window.PointerEvent){POINTER_ELEMENT_EVENTS='MSPointerDown';POINTER_WINDOW_EVENTS='MSPointerMove MSPointerUp MSPointerCancel';}
function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS;this.evWin=POINTER_WINDOW_EVENTS;Input.apply(this,arguments);this.store=(this.manager.session.pointerEvents=[]);}
inherit(PointerEventInput,Input,{handler:function PEhandler(ev){var store=this.store;var removePointer=false;var eventTypeNormalized=ev.type.toLowerCase().replace('ms','');var eventType=POINTER_INPUT_MAP[eventTypeNormalized];var pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType;var isTouch=(pointerType==INPUT_TYPE_TOUCH);var storeIndex=inArray(store,ev.pointerId,'pointerId');if(eventType&INPUT_START&&(ev.button===0||isTouch)){if(storeIndex<0){store.push(ev);storeIndex=store.length-1;}}else if(eventType&(INPUT_END|INPUT_CANCEL)){removePointer=true;}
if(storeIndex<0){return;}
store[storeIndex]=ev;this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev});if(removePointer){store.splice(storeIndex,1);}}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};var SINGLE_TOUCH_TARGET_EVENTS='touchstart';var SINGLE_TOUCH_WINDOW_EVENTS='touchstart touchmove touchend touchcancel';function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS;this.evWin=SINGLE_TOUCH_WINDOW_EVENTS;this.started=false;Input.apply(this,arguments);}
inherit(SingleTouchInput,Input,{handler:function TEhandler(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START){this.started=true;}
if(!this.started){return;}
var touches=normalizeSingleTouches.call(this,ev,type);if(type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length===0){this.started=false;}
this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev});}});function normalizeSingleTouches(ev,type){var all=toArray(ev.touches);var changed=toArray(ev.changedTouches);if(type&(INPUT_END|INPUT_CANCEL)){all=uniqueArray(all.concat(changed),'identifier',true);}
return[all,changed];}
var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};var TOUCH_TARGET_EVENTS='touchstart touchmove touchend touchcancel';function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS;this.targetIds={};Input.apply(this,arguments);}
inherit(TouchInput,Input,{handler:function MTEhandler(ev){var type=TOUCH_INPUT_MAP[ev.type];var touches=getTouches.call(this,ev,type);if(!touches){return;}
this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev});}});function getTouches(ev,type){var allTouches=toArray(ev.touches);var targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&allTouches.length===1){targetIds[allTouches[0].identifier]=true;return[allTouches,allTouches];}
var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target);});if(type===INPUT_START){i=0;while(i<targetTouches.length){targetIds[targetTouches[i].identifier]=true;i++;}}
i=0;while(i<changedTouches.length){if(targetIds[changedTouches[i].identifier]){changedTargetTouches.push(changedTouches[i]);}
if(type&(INPUT_END|INPUT_CANCEL)){delete targetIds[changedTouches[i].identifier];}
i++;}
if(!changedTargetTouches.length){return;}
return[uniqueArray(targetTouches.concat(changedTargetTouches),'identifier',true),changedTargetTouches];}
var DEDUP_TIMEOUT=2500;var DEDUP_DISTANCE=25;function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler);this.mouse=new MouseInput(this.manager,handler);this.primaryTouch=null;this.lastTouches=[];}
inherit(TouchMouseInput,Input,{handler:function TMEhandler(manager,inputEvent,inputData){var isTouch=(inputData.pointerType==INPUT_TYPE_TOUCH),isMouse=(inputData.pointerType==INPUT_TYPE_MOUSE);if(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents){return;}
if(isTouch){recordTouches.call(this,inputEvent,inputData);}else if(isMouse&&isSyntheticEvent.call(this,inputData)){return;}
this.callback(manager,inputEvent,inputData);},destroy:function destroy(){this.touch.destroy();this.mouse.destroy();}});function recordTouches(eventType,eventData){if(eventType&INPUT_START){this.primaryTouch=eventData.changedPointers[0].identifier;setLastTouch.call(this,eventData);}else if(eventType&(INPUT_END|INPUT_CANCEL)){setLastTouch.call(this,eventData);}}
function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches;var removeLastTouch=function(){var i=lts.indexOf(lastTouch);if(i>-1){lts.splice(i,1);}};setTimeout(removeLastTouch,DEDUP_TIMEOUT);}}
function isSyntheticEvent(eventData){var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY;for(var i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i];var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DISTANCE&&dy<=DEDUP_DISTANCE){return true;}}
return false;}
var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,'touchAction');var NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined;var TOUCH_ACTION_COMPUTE='compute';var TOUCH_ACTION_AUTO='auto';var TOUCH_ACTION_MANIPULATION='manipulation';var TOUCH_ACTION_NONE='none';var TOUCH_ACTION_PAN_X='pan-x';var TOUCH_ACTION_PAN_Y='pan-y';var TOUCH_ACTION_MAP=getTouchActionProps();function TouchAction(manager,value){this.manager=manager;this.set(value);}
TouchAction.prototype={set:function(value){if(value==TOUCH_ACTION_COMPUTE){value=this.compute();}
if(NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value]){this.manager.element.style[PREFIXED_TOUCH_ACTION]=value;}
this.actions=value.toLowerCase().trim();},update:function(){this.set(this.manager.options.touchAction);},compute:function(){var actions=[];each(this.manager.recognizers,function(recognizer){if(boolOrFn(recognizer.options.enable,[recognizer])){actions=actions.concat(recognizer.getTouchAction());}});return cleanTouchActions(actions.join(' '));},preventDefaults:function(input){var srcEvent=input.srcEvent;var direction=input.offsetDirection;if(this.manager.session.prevented){srcEvent.preventDefault();return;}
var actions=this.actions;var hasNone=inStr(actions,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(hasNone){var isTapPointer=input.pointers.length===1;var isTapMovement=input.distance<2;var isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime){return;}}
if(hasPanX&&hasPanY){return;}
if(hasNone||(hasPanY&&direction&DIRECTION_HORIZONTAL)||(hasPanX&&direction&DIRECTION_VERTICAL)){return this.preventSrc(srcEvent);}},preventSrc:function(srcEvent){this.manager.session.prevented=true;srcEvent.preventDefault();}};function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE)){return TOUCH_ACTION_NONE;}
var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X);var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);if(hasPanX&&hasPanY){return TOUCH_ACTION_NONE;}
if(hasPanX||hasPanY){return hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y;}
if(inStr(actions,TOUCH_ACTION_MANIPULATION)){return TOUCH_ACTION_MANIPULATION;}
return TOUCH_ACTION_AUTO;}
function getTouchActionProps(){if(!NATIVE_TOUCH_ACTION){return false;}
var touchMap={};var cssSupports=window.CSS&&window.CSS.supports;['auto','manipulation','pan-y','pan-x','pan-x pan-y','none'].forEach(function(val){touchMap[val]=cssSupports?window.CSS.supports('touch-action',val):true;});return touchMap;}
var STATE_POSSIBLE=1;var STATE_BEGAN=2;var STATE_CHANGED=4;var STATE_ENDED=8;var STATE_RECOGNIZED=STATE_ENDED;var STATE_CANCELLED=16;var STATE_FAILED=32;function Recognizer(options){this.options=assign({},this.defaults,options||{});this.id=uniqueId();this.manager=null;this.options.enable=ifUndefined(this.options.enable,true);this.state=STATE_POSSIBLE;this.simultaneous={};this.requireFail=[];}
Recognizer.prototype={defaults:{},set:function(options){assign(this.options,options);this.manager&&this.manager.touchAction.update();return this;},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'recognizeWith',this)){return this;}
var simultaneous=this.simultaneous;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(!simultaneous[otherRecognizer.id]){simultaneous[otherRecognizer.id]=otherRecognizer;otherRecognizer.recognizeWith(this);}
return this;},dropRecognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'dropRecognizeWith',this)){return this;}
otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);delete this.simultaneous[otherRecognizer.id];return this;},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'requireFailure',this)){return this;}
var requireFail=this.requireFail;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(inArray(requireFail,otherRecognizer)===-1){requireFail.push(otherRecognizer);otherRecognizer.requireFailure(this);}
return this;},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'dropRequireFailure',this)){return this;}
otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);if(index>-1){this.requireFail.splice(index,1);}
return this;},hasRequireFailures:function(){return this.requireFail.length>0;},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id];},emit:function(input){var self=this;var state=this.state;function emit(event){self.manager.emit(event,input);}
if(state<STATE_ENDED){emit(self.options.event+stateStr(state));}
emit(self.options.event);if(input.additionalEvent){emit(input.additionalEvent);}
if(state>=STATE_ENDED){emit(self.options.event+stateStr(state));}},tryEmit:function(input){if(this.canEmit()){return this.emit(input);}
this.state=STATE_FAILED;},canEmit:function(){var i=0;while(i<this.requireFail.length){if(!(this.requireFail[i].state&(STATE_FAILED|STATE_POSSIBLE))){return false;}
i++;}
return true;},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone])){this.reset();this.state=STATE_FAILED;return;}
if(this.state&(STATE_RECOGNIZED|STATE_CANCELLED|STATE_FAILED)){this.state=STATE_POSSIBLE;}
this.state=this.process(inputDataClone);if(this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED)){this.tryEmit(inputDataClone);}},process:function(inputData){},getTouchAction:function(){},reset:function(){}};function stateStr(state){if(state&STATE_CANCELLED){return'cancel';}else if(state&STATE_ENDED){return'end';}else if(state&STATE_CHANGED){return'move';}else if(state&STATE_BEGAN){return'start';}
return'';}
function directionStr(direction){if(direction==DIRECTION_DOWN){return'down';}else if(direction==DIRECTION_UP){return'up';}else if(direction==DIRECTION_LEFT){return'left';}else if(direction==DIRECTION_RIGHT){return'right';}
return'';}
function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;if(manager){return manager.get(otherRecognizer);}
return otherRecognizer;}
function AttrRecognizer(){Recognizer.apply(this,arguments);}
inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return optionPointers===0||input.pointers.length===optionPointers;},process:function(input){var state=this.state;var eventType=input.eventType;var isRecognized=state&(STATE_BEGAN|STATE_CHANGED);var isValid=this.attrTest(input);if(isRecognized&&(eventType&INPUT_CANCEL||!isValid)){return state|STATE_CANCELLED;}else if(isRecognized||isValid){if(eventType&INPUT_END){return state|STATE_ENDED;}else if(!(state&STATE_BEGAN)){return STATE_BEGAN;}
return state|STATE_CHANGED;}
return STATE_FAILED;}});function PanRecognizer(){AttrRecognizer.apply(this,arguments);this.pX=null;this.pY=null;}
inherit(PanRecognizer,AttrRecognizer,{defaults:{event:'pan',threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction;var actions=[];if(direction&DIRECTION_HORIZONTAL){actions.push(TOUCH_ACTION_PAN_Y);}
if(direction&DIRECTION_VERTICAL){actions.push(TOUCH_ACTION_PAN_X);}
return actions;},directionTest:function(input){var options=this.options;var hasMoved=true;var distance=input.distance;var direction=input.direction;var x=input.deltaX;var y=input.deltaY;if(!(direction&options.direction)){if(options.direction&DIRECTION_HORIZONTAL){direction=(x===0)?DIRECTION_NONE:(x<0)?DIRECTION_LEFT:DIRECTION_RIGHT;hasMoved=x!=this.pX;distance=Math.abs(input.deltaX);}else{direction=(y===0)?DIRECTION_NONE:(y<0)?DIRECTION_UP:DIRECTION_DOWN;hasMoved=y!=this.pY;distance=Math.abs(input.deltaY);}}
input.direction=direction;return hasMoved&&distance>options.threshold&&direction&options.direction;},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(this.state&STATE_BEGAN||(!(this.state&STATE_BEGAN)&&this.directionTest(input)));},emit:function(input){this.pX=input.deltaX;this.pY=input.deltaY;var direction=directionStr(input.direction);if(direction){input.additionalEvent=this.options.event+direction;}
this._super.emit.call(this,input);}});function PinchRecognizer(){AttrRecognizer.apply(this,arguments);}
inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:'pinch',threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE];},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN);},emit:function(input){if(input.scale!==1){var inOut=input.scale<1?'in':'out';input.additionalEvent=this.options.event+inOut;}
this._super.emit.call(this,input);}});function PressRecognizer(){Recognizer.apply(this,arguments);this._timer=null;this._input=null;}
inherit(PressRecognizer,Recognizer,{defaults:{event:'press',pointers:1,time:251,threshold:9},getTouchAction:function(){return[TOUCH_ACTION_AUTO];},process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTime=input.deltaTime>options.time;this._input=input;if(!validMovement||!validPointers||(input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)){this.reset();}else if(input.eventType&INPUT_START){this.reset();this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit();},options.time,this);}else if(input.eventType&INPUT_END){return STATE_RECOGNIZED;}
return STATE_FAILED;},reset:function(){clearTimeout(this._timer);},emit:function(input){if(this.state!==STATE_RECOGNIZED){return;}
if(input&&(input.eventType&INPUT_END)){this.manager.emit(this.options.event+'up',input);}else{this._input.timeStamp=now();this.manager.emit(this.options.event,this._input);}}});function RotateRecognizer(){AttrRecognizer.apply(this,arguments);}
inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:'rotate',threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE];},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN);}});function SwipeRecognizer(){AttrRecognizer.apply(this,arguments);}
inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:'swipe',threshold:10,velocity:0.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this);},attrTest:function(input){var direction=this.options.direction;var velocity;if(direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)){velocity=input.overallVelocity;}else if(direction&DIRECTION_HORIZONTAL){velocity=input.overallVelocityX;}else if(direction&DIRECTION_VERTICAL){velocity=input.overallVelocityY;}
return this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END;},emit:function(input){var direction=directionStr(input.offsetDirection);if(direction){this.manager.emit(this.options.event+direction,input);}
this.manager.emit(this.options.event,input);}});function TapRecognizer(){Recognizer.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0;}
inherit(TapRecognizer,Recognizer,{defaults:{event:'tap',pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION];},process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTouchTime=input.deltaTime<options.time;this.reset();if((input.eventType&INPUT_START)&&(this.count===0)){return this.failTimeout();}
if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END){return this.failTimeout();}
var validInterval=this.pTime?(input.timeStamp-this.pTime<options.interval):true;var validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;this.pTime=input.timeStamp;this.pCenter=input.center;if(!validMultiTap||!validInterval){this.count=1;}else{this.count+=1;}
this._input=input;var tapCount=this.count%options.taps;if(tapCount===0){if(!this.hasRequireFailures()){return STATE_RECOGNIZED;}else{this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit();},options.interval,this);return STATE_BEGAN;}}}
return STATE_FAILED;},failTimeout:function(){this._timer=setTimeoutContext(function(){this.state=STATE_FAILED;},this.options.interval,this);return STATE_FAILED;},reset:function(){clearTimeout(this._timer);},emit:function(){if(this.state==STATE_RECOGNIZED){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input);}}});function Hammer(element,options){options=options||{};options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset);return new Manager(element,options);}
Hammer.VERSION='2.0.8';Hammer.defaults={domEvents:false,touchAction:TOUCH_ACTION_COMPUTE,enable:true,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:false}],[PinchRecognizer,{enable:false},['rotate']],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},['swipe']],[TapRecognizer],[TapRecognizer,{event:'doubletap',taps:2},['tap']],[PressRecognizer]],cssProps:{userSelect:'none',touchSelect:'none',touchCallout:'none',contentZooming:'none',userDrag:'none',tapHighlightColor:'rgba(0,0,0,0)'}};var STOP=1;var FORCED_STOP=2;function Manager(element,options){this.options=assign({},Hammer.defaults,options||{});this.options.inputTarget=this.options.inputTarget||element;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=element;this.input=createInputInstance(this);this.touchAction=new TouchAction(this,this.options.touchAction);toggleCssProps(this,true);each(this.options.recognizers,function(item){var recognizer=this.add(new(item[0])(item[1]));item[2]&&recognizer.recognizeWith(item[2]);item[3]&&recognizer.requireFailure(item[3]);},this);}
Manager.prototype={set:function(options){assign(this.options,options);if(options.touchAction){this.touchAction.update();}
if(options.inputTarget){this.input.destroy();this.input.target=options.inputTarget;this.input.init();}
return this;},stop:function(force){this.session.stopped=force?FORCED_STOP:STOP;},recognize:function(inputData){var session=this.session;if(session.stopped){return;}
this.touchAction.preventDefaults(inputData);var recognizer;var recognizers=this.recognizers;var curRecognizer=session.curRecognizer;if(!curRecognizer||(curRecognizer&&curRecognizer.state&STATE_RECOGNIZED)){curRecognizer=session.curRecognizer=null;}
var i=0;while(i<recognizers.length){recognizer=recognizers[i];if(session.stopped!==FORCED_STOP&&(!curRecognizer||recognizer==curRecognizer||recognizer.canRecognizeWith(curRecognizer))){recognizer.recognize(inputData);}else{recognizer.reset();}
if(!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED)){curRecognizer=session.curRecognizer=recognizer;}
i++;}},get:function(recognizer){if(recognizer instanceof Recognizer){return recognizer;}
var recognizers=this.recognizers;for(var i=0;i<recognizers.length;i++){if(recognizers[i].options.event==recognizer){return recognizers[i];}}
return null;},add:function(recognizer){if(invokeArrayArg(recognizer,'add',this)){return this;}
var existing=this.get(recognizer.options.event);if(existing){this.remove(existing);}
this.recognizers.push(recognizer);recognizer.manager=this;this.touchAction.update();return recognizer;},remove:function(recognizer){if(invokeArrayArg(recognizer,'remove',this)){return this;}
recognizer=this.get(recognizer);if(recognizer){var recognizers=this.recognizers;var index=inArray(recognizers,recognizer);if(index!==-1){recognizers.splice(index,1);this.touchAction.update();}}
return this;},on:function(events,handler){if(events===undefined){return;}
if(handler===undefined){return;}
var handlers=this.handlers;each(splitStr(events),function(event){handlers[event]=handlers[event]||[];handlers[event].push(handler);});return this;},off:function(events,handler){if(events===undefined){return;}
var handlers=this.handlers;each(splitStr(events),function(event){if(!handler){delete handlers[event];}else{handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1);}});return this;},emit:function(event,data){if(this.options.domEvents){triggerDomEvent(event,data);}
var handlers=this.handlers[event]&&this.handlers[event].slice();if(!handlers||!handlers.length){return;}
data.type=event;data.preventDefault=function(){data.srcEvent.preventDefault();};var i=0;while(i<handlers.length){handlers[i](data);i++;}},destroy:function(){this.element&&toggleCssProps(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null;}};function toggleCssProps(manager,add){var element=manager.element;if(!element.style){return;}
var prop;each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name);if(add){manager.oldCssProps[prop]=element.style[prop];element.style[prop]=value;}else{element.style[prop]=manager.oldCssProps[prop]||'';}});if(!add){manager.oldCssProps={};}}
function triggerDomEvent(event,data){var gestureEvent=document.createEvent('Event');gestureEvent.initEvent(event,true,true);gestureEvent.gesture=data;data.target.dispatchEvent(gestureEvent);}
assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:STATE_FAILED,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed});var freeGlobal=(typeof window!=='undefined'?window:(typeof self!=='undefined'?self:{}));freeGlobal.Hammer=Hammer;if(typeof define==='function'&&define.amd){define(function(){return Hammer;});}else if(typeof module!='undefined'&&module.exports){module.exports=Hammer;}else{window[exportName]=Hammer;}})(window,document,'Hammer');/*!
 * jQuery Form Plugin
 * version: 3.51.0-2014.06.20
 * Requires jQuery v1.5 or later
 * Copyright (c) 2014 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */
(function(factory){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory((typeof(jQuery)!='undefined')?jQuery:window.Zepto);}}
(function($){"use strict";var feature={};feature.fileapi=$("<input type='file'/>").get(0).files!==undefined;feature.formdata=window.FormData!==undefined;var hasProp=!!$.fn.prop;$.fn.attr2=function(){if(!hasProp){return this.attr.apply(this,arguments);}
var val=this.prop.apply(this,arguments);if((val&&val.jquery)||typeof val==='string'){return val;}
return this.attr.apply(this,arguments);};$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this;}
var method,action,url,$form=this;if(typeof options=='function'){options={success:options};}
else if(options===undefined){options={};}
method=options.type||this.attr2('method');action=options.url||this.attr2('action');url=(typeof action==='string')?$.trim(action):'';url=url||window.location.href||'';if(url){url=(url.match(/^([^#]+)/)||[])[1];}
options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||$.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options);var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}
if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}
var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional;}
var elements=[];var qx,a=this.formToArray(options.semantic,elements);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional);}
if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}
this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}
var q=$.param(a,traditional);if(qx){q=(q?(q+'&'+qx):qx);}
if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null;}
else{options.data=q;}
var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm();});}
if(options.clearForm){callbacks.push(function(){$form.clearForm(options.includeHidden);});}
if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments);});}
else if(options.success){callbacks.push(options.success);}
options.success=function(data,status,xhr){var context=options.context||this;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form]);}};if(options.error){var oldError=options.error;options.error=function(xhr,status,error){var context=options.context||this;oldError.apply(context,[xhr,status,error,$form]);};}
if(options.complete){var oldComplete=options.complete;options.complete=function(xhr,status){var context=options.context||this;oldComplete.apply(context,[xhr,status,$form]);};}
var fileInputs=$('input[type=file]:enabled',this).filter(function(){return $(this).val()!=='';});var hasFileInputs=fileInputs.length>0;var mp='multipart/form-data';var multipart=($form.attr('enctype')==mp||$form.attr('encoding')==mp);var fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+fileAPI);var shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;var jqxhr;if(options.iframe!==false&&(options.iframe||shouldUseFrame)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){jqxhr=fileUploadIframe(a);});}
else{jqxhr=fileUploadIframe(a);}}
else if((hasFileInputs||multipart)&&fileAPI){jqxhr=fileUploadXhr(a);}
else{jqxhr=$.ajax(options);}
$form.removeData('jqxhr').data('jqxhr',jqxhr);for(var k=0;k<elements.length;k++){elements[k]=null;}
this.trigger('form-submit-notify',[this,options]);return this;function deepSerialize(extraData){var serialized=$.param(extraData,options.traditional).split('&');var len=serialized.length;var result=[];var i,part;for(i=0;i<len;i++){serialized[i]=serialized[i].replace(/\+/g,' ');part=serialized[i].split('=');result.push([decodeURIComponent(part[0]),decodeURIComponent(part[1])]);}
return result;}
function fileUploadXhr(a){var formdata=new FormData();for(var i=0;i<a.length;i++){formdata.append(a[i].name,a[i].value);}
if(options.extraData){var serializedData=deepSerialize(options.extraData);for(i=0;i<serializedData.length;i++){if(serializedData[i]){formdata.append(serializedData[i][0],serializedData[i][1]);}}}
options.data=null;var s=$.extend(true,{},$.ajaxSettings,options,{contentType:false,processData:false,cache:false,type:method||'POST'});if(options.uploadProgress){s.xhr=function(){var xhr=$.ajaxSettings.xhr();if(xhr.upload){xhr.upload.addEventListener('progress',function(event){var percent=0;var position=event.loaded||event.position;var total=event.total;if(event.lengthComputable){percent=Math.ceil(position/total*100);}
options.uploadProgress(event,position,total,percent);},false);}
return xhr;};}
s.data=null;var beforeSend=s.beforeSend;s.beforeSend=function(xhr,o){if(options.formData){o.data=options.formData;}
else{o.data=formdata;}
if(beforeSend){beforeSend.call(this,xhr,o);}};return $.ajax(s);}
function fileUploadIframe(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var deferred=$.Deferred();deferred.abort=function(status){xhr.abort(status);};if(a){for(i=0;i<elements.length;i++){el=$(elements[i]);if(hasProp){el.prop('disabled',false);}
else{el.removeAttr('disabled');}}}
s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id='jqFormIO'+(new Date().getTime());if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr2('name');if(!n){$io.attr2('name',id);}
else{id=n;}}
else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:'absolute',top:'-1000px',left:'-1000px'});}
io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=(status==='timeout'?'timeout':'aborted');log('aborting upload... '+e);this.aborted=1;try{if(io.contentWindow.document.execCommand){io.contentWindow.document.execCommand('Stop');}}
catch(ignore){}
$io.attr('src',s.iframeSrc);xhr.error=e;if(s.error){s.error.call(s.context,xhr,e,status);}
if(g){$.event.trigger("ajaxError",[xhr,s,e]);}
if(s.complete){s.complete.call(s.context,xhr,e);}}};g=s.global;if(g&&0===$.active++){$.event.trigger("ajaxStart");}
if(g){$.event.trigger("ajaxSend",[xhr,s]);}
if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--;}
deferred.reject();return deferred;}
if(xhr.aborted){deferred.reject();return deferred;}
sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+'.x']=form.clk_x;s.extraData[n+'.y']=form.clk_y;}}}
var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=null;try{if(frame.contentWindow){doc=frame.contentWindow.document;}}catch(err){log('cannot get iframe.contentWindow document: '+err);}
if(doc){return doc;}
try{doc=frame.contentDocument?frame.contentDocument:frame.document;}catch(err){log('cannot get iframe.contentDocument: '+err);doc=frame.document;}
return doc;}
var csrf_token=$('meta[name=csrf-token]').attr('content');var csrf_param=$('meta[name=csrf-param]').attr('content');if(csrf_param&&csrf_token){s.extraData=s.extraData||{};s.extraData[csrf_param]=csrf_token;}
function doSubmit(){var t=$form.attr2('target'),a=$form.attr2('action'),mp='multipart/form-data',et=$form.attr('enctype')||$form.attr('encoding')||mp;form.setAttribute('target',id);if(!method||/post/i.test(method)){form.setAttribute('method','POST');}
if(a!=s.url){form.setAttribute('action',s.url);}
if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});}
if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT);},s.timeout);}
function checkState(){try{var state=getDoc(io).readyState;log('state = '+state);if(state&&state.toLowerCase()=='uninitialized'){setTimeout(checkState,50);}}
catch(e){log('Server abort: ',e,' (',e.name,')');cb(SERVER_ABORT);if(timeoutHandle){clearTimeout(timeoutHandle);}
timeoutHandle=undefined;}}
var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){if(s.extraData.hasOwnProperty(n)){if($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty('name')&&s.extraData[n].hasOwnProperty('value')){extraInputs.push($('<input type="hidden" name="'+s.extraData[n].name+'">').val(s.extraData[n].value).appendTo(form)[0]);}else{extraInputs.push($('<input type="hidden" name="'+n+'">').val(s.extraData[n]).appendTo(form)[0]);}}}}
if(!s.iframeTarget){$io.appendTo('body');}
if(io.attachEvent){io.attachEvent('onload',cb);}
else{io.addEventListener('load',cb,false);}
setTimeout(checkState,15);try{form.submit();}catch(err){var submitFn=document.createElement('form').submit;submitFn.apply(form);}}
finally{form.setAttribute('action',a);form.setAttribute('enctype',et);if(t){form.setAttribute('target',t);}else{$form.removeAttr('target');}
$(extraInputs).remove();}}
if(s.forceSync){doSubmit();}
else{setTimeout(doSubmit,10);}
var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return;}
doc=getDoc(io);if(!doc){log('cannot access response document');e=SERVER_ABORT;}
if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort('timeout');deferred.reject(xhr,'timeout');return;}
else if(e==SERVER_ABORT&&xhr){xhr.abort('server abort');deferred.reject(xhr,'error','server abort');return;}
if(!doc||doc.location.href==s.iframeSrc){if(!timedOut){return;}}
if(io.detachEvent){io.detachEvent('onload',cb);}
else{io.removeEventListener('load',cb,false);}
var status='success',errMsg;try{if(timedOut){throw'timeout';}
var isXml=s.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&window.opera&&(doc.body===null||!doc.body.innerHTML)){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return;}}
var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml){s.dataType='xml';}
xhr.getResponseHeader=function(header){var headers={'content-type':s.dataType};return headers[header.toLowerCase()];};if(docRoot){xhr.status=Number(docRoot.getAttribute('status'))||xhr.status;xhr.statusText=docRoot.getAttribute('statusText')||xhr.statusText;}
var dt=(s.dataType||'').toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute('status'))||xhr.status;xhr.statusText=ta.getAttribute('statusText')||xhr.statusText;}
else if(scr){var pre=doc.getElementsByTagName('pre')[0];var b=doc.getElementsByTagName('body')[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText;}
else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText;}}}
else if(dt=='xml'&&!xhr.responseXML&&xhr.responseText){xhr.responseXML=toXml(xhr.responseText);}
try{data=httpData(xhr,dt,s);}
catch(err){status='parsererror';xhr.error=errMsg=(err||status);}}
catch(err){log('error caught: ',err);status='error';xhr.error=errMsg=(err||status);}
if(xhr.aborted){log('upload aborted');status=null;}
if(xhr.status){status=(xhr.status>=200&&xhr.status<300||xhr.status===304)?'success':'error';}
if(status==='success'){if(s.success){s.success.call(s.context,data,'success',xhr);}
deferred.resolve(xhr.responseText,'success',xhr);if(g){$.event.trigger("ajaxSuccess",[xhr,s]);}}
else if(status){if(errMsg===undefined){errMsg=xhr.statusText;}
if(s.error){s.error.call(s.context,xhr,status,errMsg);}
deferred.reject(xhr,'error',errMsg);if(g){$.event.trigger("ajaxError",[xhr,s,errMsg]);}}
if(g){$.event.trigger("ajaxComplete",[xhr,s]);}
if(g&&!--$.active){$.event.trigger("ajaxStop");}
if(s.complete){s.complete.call(s.context,xhr,status);}
callbackProcessed=true;if(s.timeout){clearTimeout(timeoutHandle);}
setTimeout(function(){if(!s.iframeTarget){$io.remove();}
else{$io.attr('src',s.iframeSrc);}
xhr.responseXML=null;},100);}
var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s);}
else{doc=(new DOMParser()).parseFromString(s,'text/xml');}
return(doc&&doc.documentElement&&doc.documentElement.nodeName!='parsererror')?doc:null;};var parseJSON=$.parseJSON||function(s){return window['eval']('('+s+')');};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader('content-type')||'',xml=type==='xml'||!type&&ct.indexOf('xml')>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){if($.error){$.error('parsererror');}}
if(s&&s.dataFilter){data=s.dataFilter(data,type);}
if(typeof data==='string'){if(type==='json'||!type&&ct.indexOf('json')>=0){data=parseJSON(data);}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data);}}
return data;};return deferred;}};$.fn.ajaxForm=function(options){options=options||{};options.delegation=options.delegation&&$.isFunction($.fn.on);if(!options.delegation&&this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log('DOM not ready, queuing ajaxForm');$(function(){$(o.s,o.c).ajaxForm(options);});return this;}
log('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this;}
if(options.delegation){$(document).off('submit.form-plugin',this.selector,doAjaxSubmit).off('click.form-plugin',this.selector,captureSubmittingElement).on('submit.form-plugin',this.selector,options,doAjaxSubmit).on('click.form-plugin',this.selector,options,captureSubmittingElement);return this;}
return this.ajaxFormUnbind().bind('submit.form-plugin',options,doAjaxSubmit).bind('click.form-plugin',options,captureSubmittingElement);};function doAjaxSubmit(e){var options=e.data;if(!e.isDefaultPrevented()){e.preventDefault();$(e.target).ajaxSubmit(options);}}
function captureSubmittingElement(e){var target=e.target;var $el=$(target);if(!($el.is("[type=submit],[type=image]"))){var t=$el.closest('[type=submit]');if(t.length===0){return;}
target=t[0];}
var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!==undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top;}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop;}}
setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);}
$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(semantic,elements){var a=[];if(this.length===0){return a;}
var form=this[0];var formId=this.attr('id');var els=semantic?form.getElementsByTagName('*'):form.elements;var els2;if(els&&!/MSIE [678]/.test(navigator.userAgent)){els=$(els).get();}
if(formId){els2=$(':input[form="'+formId+'"]').get();if(els2.length){els=(els||[]).concat(els2);}}
if(!els||!els.length){return a;}
var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n||el.disabled){continue;}
if(semantic&&form.clk&&el.type=="image"){if(form.clk==el){a.push({name:n,value:$(el).val(),type:el.type});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}
continue;}
v=$.fieldValue(el,true);if(v&&v.constructor==Array){if(elements){elements.push(el);}
for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}
else if(feature.fileapi&&el.type=='file'){if(elements){elements.push(el);}
var files=el.files;if(files.length){for(j=0;j<files.length;j++){a.push({name:n,value:files[j],type:el.type});}}
else{a.push({name:n,value:'',type:el.type});}}
else if(v!==null&&typeof v!='undefined'){if(elements){elements.push(el);}
a.push({name:n,value:v,type:el.type,required:el.required});}}
if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}}
return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return;}
var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}
else if(v!==null&&typeof v!='undefined'){a.push({name:this.name,value:v});}});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length)){continue;}
if(v.constructor==Array){$.merge(val,v);}
else{val.push(v);}}
return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true;}
if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1)){return null;}
if(tag=='select'){var index=el.selectedIndex;if(index<0){return null;}
var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes.value&&!(op.attributes.value.specified))?op.text:op.value;}
if(one){return v;}
a.push(v);}}
return a;}
return $(el).val();};$.fn.clearForm=function(includeHidden){return this.each(function(){$('input,select,textarea',this).clearFields(includeHidden);});};$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=='textarea'){this.value='';}
else if(t=='checkbox'||t=='radio'){this.checked=false;}
else if(tag=='select'){this.selectedIndex=-1;}
else if(t=="file"){if(/MSIE/.test(navigator.userAgent)){$(this).replaceWith($(this).clone(true));}else{$(this).val('');}}
else if(includeHidden){if((includeHidden===true&&/hidden/.test(t))||(typeof includeHidden=='string'&&$(this).is(includeHidden))){this.value='';}}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType)){this.reset();}});};$.fn.enable=function(b){if(b===undefined){b=true;}
return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select===undefined){select=true;}
return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select;}
else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false);}
this.selected=select;}});};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug){return;}
var msg='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log){window.console.log(msg);}
else if(window.opera&&window.opera.postError){window.opera.postError(msg);}}}));
(function(global,factory){if(typeof define==='function'&&define.amd){define(['jquery'],function(jQuery){return factory(global,jQuery);});}else if(typeof exports==='object'){factory(global,require('jquery'));}else{factory(global,global.jQuery);}}(typeof window!=='undefined'?window:this,function(window,$){'use strict';var document=window.document;var datakey='__pz__';var slice=Array.prototype.slice;var rIE11=/trident\/7./i;var supportsInputEvent=(function(){if(rIE11.test(navigator.userAgent)){return false;}
var input=document.createElement('input');input.setAttribute('oninput','return');return typeof input.oninput==='function';})();var rupper=/([A-Z])/g;var rsvg=/^http:[\w\.\/]+svg$/;var floating='(\\-?\\d[\\d\\.e-]*)';var commaSpace='\\,?\\s*';var rmatrix=new RegExp('^matrix\\('+
floating+commaSpace+
floating+commaSpace+
floating+commaSpace+
floating+commaSpace+
floating+commaSpace+
floating+'\\)$');function matrixEquals(first,second){var i=first.length;while(--i){if(Math.round(+first[i])!==Math.round(+second[i])){return false;}}
return true;}
function createResetOptions(opts){var options={range:true,animate:true};if(typeof opts==='boolean'){options.animate=opts;}else{$.extend(options,opts);}
return options;}
function Matrix(a,b,c,d,e,f,g,h,i){if($.type(a)==='array'){this.elements=[+a[0],+a[2],+a[4],+a[1],+a[3],+a[5],0,0,1];}else{this.elements=[a,b,c,d,e,f,g||0,h||0,i||1];}}
Matrix.prototype={x:function(matrix){var isVector=matrix instanceof Vector;var a=this.elements,b=matrix.elements;if(isVector&&b.length===3){return new Vector(a[0]*b[0]+a[1]*b[1]+a[2]*b[2],a[3]*b[0]+a[4]*b[1]+a[5]*b[2],a[6]*b[0]+a[7]*b[1]+a[8]*b[2]);}else if(b.length===a.length){return new Matrix(a[0]*b[0]+a[1]*b[3]+a[2]*b[6],a[0]*b[1]+a[1]*b[4]+a[2]*b[7],a[0]*b[2]+a[1]*b[5]+a[2]*b[8],a[3]*b[0]+a[4]*b[3]+a[5]*b[6],a[3]*b[1]+a[4]*b[4]+a[5]*b[7],a[3]*b[2]+a[4]*b[5]+a[5]*b[8],a[6]*b[0]+a[7]*b[3]+a[8]*b[6],a[6]*b[1]+a[7]*b[4]+a[8]*b[7],a[6]*b[2]+a[7]*b[5]+a[8]*b[8]);}
return false;},inverse:function(){var d=1/this.determinant(),a=this.elements;return new Matrix(d*(a[8]*a[4]-a[7]*a[5]),d*(-(a[8]*a[1]-a[7]*a[2])),d*(a[5]*a[1]-a[4]*a[2]),d*(-(a[8]*a[3]-a[6]*a[5])),d*(a[8]*a[0]-a[6]*a[2]),d*(-(a[5]*a[0]-a[3]*a[2])),d*(a[7]*a[3]-a[6]*a[4]),d*(-(a[7]*a[0]-a[6]*a[1])),d*(a[4]*a[0]-a[3]*a[1]));},determinant:function(){var a=this.elements;return a[0]*(a[8]*a[4]-a[7]*a[5])-a[3]*(a[8]*a[1]-a[7]*a[2])+a[6]*(a[5]*a[1]-a[4]*a[2]);}};function Vector(x,y,z){this.elements=[x,y,z];}
Vector.prototype.e=Matrix.prototype.e=function(i){return this.elements[i];};function Panzoom(elem,options){if(!(this instanceof Panzoom)){return new Panzoom(elem,options);}
if(elem.nodeType!==1){$.error('Panzoom called on non-Element node');}
if(!$.contains(document,elem)){$.error('Panzoom element must be attached to the document');}
var d=$.data(elem,datakey);if(d){return d;}
this.options=options=$.extend({},Panzoom.defaults,options);this.elem=elem;var $elem=this.$elem=$(elem);this.$set=options.$set&&options.$set.length?options.$set:$elem;this.$doc=$(elem.ownerDocument||document);this.$parent=$elem.parent();this.parent=this.$parent[0];this.isSVG=rsvg.test(elem.namespaceURI)&&elem.nodeName.toLowerCase()!=='svg';this.panning=false;this._buildTransform();this._transform=$.cssProps.transform.replace(rupper,'-$1').toLowerCase();this._buildTransition();this.resetDimensions();var $empty=$();var self=this;$.each(['$zoomIn','$zoomOut','$zoomRange','$reset'],function(i,name){self[name]=options[name]||$empty;});this.enable();this.scale=this.getMatrix()[0];this._checkPanWhenZoomed();$.data(elem,datakey,this);}
Panzoom.rmatrix=rmatrix;Panzoom.defaults={eventNamespace:'.panzoom',transition:true,cursor:'move',disablePan:false,disableZoom:false,disableXAxis:false,disableYAxis:false,which:1,increment:0.3,exponential:true,panOnlyWhenZoomed:false,minScale:0.3,maxScale:6,rangeStep:0.05,duration:200,easing:'ease-in-out',contain:false};Panzoom.prototype={constructor:Panzoom,instance:function(){return this;},enable:function(){this._initStyle();this._bind();this.disabled=false;},disable:function(){this.disabled=true;this._resetStyle();this._unbind();},isDisabled:function(){return this.disabled;},destroy:function(){this.disable();$.removeData(this.elem,datakey);},resetDimensions:function(){this.container=this.parent.getBoundingClientRect();var elem=this.elem;var dims=elem.getBoundingClientRect();var absScale=Math.abs(this.scale);this.dimensions={width:dims.width,height:dims.height,left:$.css(elem,'left',true)||0,top:$.css(elem,'top',true)||0,border:{top:$.css(elem,'borderTopWidth',true)*absScale||0,bottom:$.css(elem,'borderBottomWidth',true)*absScale||0,left:$.css(elem,'borderLeftWidth',true)*absScale||0,right:$.css(elem,'borderRightWidth',true)*absScale||0},margin:{top:$.css(elem,'marginTop',true)*absScale||0,left:$.css(elem,'marginLeft',true)*absScale||0}};},reset:function(options){options=createResetOptions(options);var matrix=this.setMatrix(this._origTransform,options);if(!options.silent){this._trigger('reset',matrix);}},resetZoom:function(options){options=createResetOptions(options);var origMatrix=this.getMatrix(this._origTransform);options.dValue=origMatrix[3];this.zoom(origMatrix[0],options);},resetPan:function(options){var origMatrix=this.getMatrix(this._origTransform);this.pan(origMatrix[4],origMatrix[5],createResetOptions(options));},setTransform:function(transform){var $set=this.$set;var i=$set.length;while(i--){$.style($set[i],'transform',transform);if(this.isSVG){$set[i].setAttribute('transform',transform);}}},getTransform:function(transform){var $set=this.$set;var transformElem=$set[0];if(transform){this.setTransform(transform);}else{transform=$.style(transformElem,'transform');if(this.isSVG&&(!transform||transform==='none')){transform=$.attr(transformElem,'transform')||'none';}}
if(transform!=='none'&&!rmatrix.test(transform)){this.setTransform(transform=$.css(transformElem,'transform'));}
return transform||'none';},getMatrix:function(transform){var matrix=rmatrix.exec(transform||this.getTransform());if(matrix){matrix.shift();}
return matrix||[1,0,0,1,0,0];},setMatrix:function(matrix,options){if(this.disabled){return;}
if(!options){options={};}
if(typeof matrix==='string'){matrix=this.getMatrix(matrix);}
var scale=+matrix[0];var contain=typeof options.contain!=='undefined'?options.contain:this.options.contain;if(contain){var dims=options.dims;if(!dims){this.resetDimensions();dims=this.dimensions;}
var spaceWLeft,spaceWRight,scaleDiff;var container=this.container;var width=dims.width;var height=dims.height;var conWidth=container.width;var conHeight=container.height;var zoomAspectW=conWidth/width;var zoomAspectH=conHeight/height;if(this.$parent.css('textAlign')!=='center'||$.css(this.elem,'display')!=='inline'){scaleDiff=(width-this.elem.offsetWidth)/2;spaceWLeft=scaleDiff-dims.border.left;spaceWRight=width-conWidth-scaleDiff+dims.border.right;}else{spaceWLeft=spaceWRight=((width-conWidth)/2);}
var spaceHTop=((height-conHeight)/2)+dims.border.top;var spaceHBottom=((height-conHeight)/2)-dims.border.top-dims.border.bottom;if(contain==='invert'||contain==='automatic'&&zoomAspectW<1.01){matrix[4]=Math.max(Math.min(matrix[4],spaceWLeft-dims.border.left),-spaceWRight);}else{matrix[4]=Math.min(Math.max(matrix[4],spaceWLeft),-spaceWRight);}
if(contain==='invert'||(contain==='automatic'&&zoomAspectH<1.01)){matrix[5]=Math.max(Math.min(matrix[5],spaceHTop-dims.border.top),-spaceHBottom);}else{matrix[5]=Math.min(Math.max(matrix[5],spaceHTop),-spaceHBottom);}}
if(options.animate!=='skip'){this.transition(!options.animate);}
if(options.range){this.$zoomRange.val(scale);}
if(this.options.disableXAxis||this.options.disableYAxis){var originalMatrix=this.getMatrix();if(this.options.disableXAxis){matrix[4]=originalMatrix[4];}
if(this.options.disableYAxis){matrix[5]=originalMatrix[5];}}
this.setTransform('matrix('+matrix.join(',')+')');this.scale=scale;this._checkPanWhenZoomed(scale);if(!options.silent){this._trigger('change',matrix);}
return matrix;},isPanning:function(){return this.panning;},transition:function(off){if(!this._transition){return;}
var transition=off||!this.options.transition?'none':this._transition;var $set=this.$set;var i=$set.length;while(i--){if($.style($set[i],'transition')!==transition){$.style($set[i],'transition',transition);}}},pan:function(x,y,options){if(this.options.disablePan){return;}
if(!options){options={};}
var matrix=options.matrix;if(!matrix){matrix=this.getMatrix();}
if(options.relative){x+=+matrix[4];y+=+matrix[5];}
matrix[4]=x;matrix[5]=y;this.setMatrix(matrix,options);if(!options.silent){this._trigger('pan',matrix[4],matrix[5]);}},zoom:function(scale,opts){if(typeof scale==='object'){opts=scale;scale=null;}else if(!opts){opts={};}
var options=$.extend({},this.options,opts);if(options.disableZoom){return;}
var animate=false;var matrix=options.matrix||this.getMatrix();var startScale=+matrix[0];if(typeof scale!=='number'){if(options.exponential&&startScale-options.increment>=1){scale=Math[scale?'sqrt':'pow'](startScale,2);}else{scale=startScale+(options.increment*(scale?-1:1));}
animate=true;}
if(scale>options.maxScale){scale=options.maxScale;}else if(scale<options.minScale){scale=options.minScale;}
var focal=options.focal;if(focal&&!options.disablePan){this.resetDimensions();var dims=options.dims=this.dimensions;var clientX=focal.clientX;var clientY=focal.clientY;if(!this.isSVG){clientX-=(dims.width/startScale)/2;clientY-=(dims.height/startScale)/2;}
var clientV=new Vector(clientX,clientY,1);var surfaceM=new Matrix(matrix);var o=this.parentOffset||this.$parent.offset();var offsetM=new Matrix(1,0,o.left-this.$doc.scrollLeft(),0,1,o.top-this.$doc.scrollTop());var surfaceV=surfaceM.inverse().x(offsetM.inverse().x(clientV));var scaleBy=scale/matrix[0];surfaceM=surfaceM.x(new Matrix([scaleBy,0,0,scaleBy,0,0]));clientV=offsetM.x(surfaceM.x(surfaceV));matrix[4]=+matrix[4]+(clientX-clientV.e(0));matrix[5]=+matrix[5]+(clientY-clientV.e(1));}
matrix[0]=scale;matrix[3]=typeof options.dValue==='number'?options.dValue:scale;this.setMatrix(matrix,{animate:typeof options.animate!=='undefined'?options.animate:animate,range:!options.noSetRange});if(!options.silent){this._trigger('zoom',matrix[0],options);}},option:function(key,value){var options;if(!key){return $.extend({},this.options);}
if(typeof key==='string'){if(arguments.length===1){return this.options[key]!==undefined?this.options[key]:null;}
options={};options[key]=value;}else{options=key;}
this._setOptions(options);},_setOptions:function(options){$.each(options,$.proxy(function(key,value){switch(key){case'disablePan':this._resetStyle();case'$zoomIn':case'$zoomOut':case'$zoomRange':case'$reset':case'disableZoom':case'onStart':case'onChange':case'onZoom':case'onPan':case'onEnd':case'onReset':case'eventNamespace':this._unbind();}
this.options[key]=value;switch(key){case'disablePan':this._initStyle();case'$zoomIn':case'$zoomOut':case'$zoomRange':case'$reset':this[key]=value;case'disableZoom':case'onStart':case'onChange':case'onZoom':case'onPan':case'onEnd':case'onReset':case'eventNamespace':this._bind();break;case'cursor':$.style(this.elem,'cursor',value);break;case'minScale':this.$zoomRange.attr('min',value);break;case'maxScale':this.$zoomRange.attr('max',value);break;case'rangeStep':this.$zoomRange.attr('step',value);break;case'startTransform':this._buildTransform();break;case'duration':case'easing':this._buildTransition();case'transition':this.transition();break;case'panOnlyWhenZoomed':this._checkPanWhenZoomed();break;case'$set':if(value instanceof $&&value.length){this.$set=value;this._initStyle();this._buildTransform();}}},this));},_checkPanWhenZoomed:function(scale){var options=this.options;if(options.panOnlyWhenZoomed){if(!scale){scale=this.getMatrix()[0];}
var toDisable=scale<=options.minScale;if(options.disablePan!==toDisable){this.option('disablePan',toDisable);}}},_initStyle:function(){var styles={'transform-origin':this.isSVG?'0 0':'50% 50%'};if(!this.options.disablePan){styles.cursor=this.options.cursor;}
this.$set.css(styles);var $parent=this.$parent;if($parent.length&&!$.nodeName(this.parent,'body')){styles={overflow:'hidden'};if($parent.css('position')==='static'){styles.position='relative';}
$parent.css(styles);}},_resetStyle:function(){this.$elem.css({'cursor':'','transition':''});this.$parent.css({'overflow':'','position':''});},_bind:function(){var self=this;var options=this.options;var ns=options.eventNamespace;var str_down='mousedown'+ns+' pointerdown'+ns+' MSPointerDown'+ns;var str_start='touchstart'+ns+' '+str_down;var str_click='touchend'+ns+' click'+ns+' pointerup'+ns+' MSPointerUp'+ns;var events={};var $reset=this.$reset;var $zoomRange=this.$zoomRange;$.each(['Start','Change','Zoom','Pan','End','Reset'],function(){var m=options['on'+this];if($.isFunction(m)){events['panzoom'+this.toLowerCase()+ns]=m;}});if(!options.disablePan||!options.disableZoom){events[str_start]=function(e){var touches;if(e.type==='touchstart'?(touches=e.touches||e.originalEvent.touches)&&((touches.length===1&&!options.disablePan)||touches.length===2):!options.disablePan&&(e.which||e.originalEvent.which)===options.which){e.preventDefault();e.stopPropagation();self._startMove(e,touches);}};if(options.which===3){events.contextmenu=false;}}
this.$elem.on(events);if($reset.length){$reset.on(str_click,function(e){e.preventDefault();self.reset();});}
if($zoomRange.length){$zoomRange.attr({step:options.rangeStep===Panzoom.defaults.rangeStep&&$zoomRange.attr('step')||options.rangeStep,min:options.minScale,max:options.maxScale}).prop({value:this.getMatrix()[0]});}
if(options.disableZoom){return;}
var $zoomIn=this.$zoomIn;var $zoomOut=this.$zoomOut;if($zoomIn.length&&$zoomOut.length){$zoomIn.on(str_click,function(e){e.preventDefault();self.zoom();});$zoomOut.on(str_click,function(e){e.preventDefault();self.zoom(true);});}
if($zoomRange.length){events={};events[str_down]=function(){self.transition(true);};events[(supportsInputEvent?'input':'change')+ns]=function(){self.zoom(+this.value,{noSetRange:true});};$zoomRange.on(events);}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace);},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform);},_buildTransition:function(){if(this._transform){var options=this.options;this._transition=this._transform+' '+options.duration+'ms '+options.easing;}},_getDistance:function(touches){var touch1=touches[0];var touch2=touches[1];return Math.sqrt(Math.pow(Math.abs(touch2.clientX-touch1.clientX),2)+Math.pow(Math.abs(touch2.clientY-touch1.clientY),2));},_getMiddle:function(touches){var touch1=touches[0];var touch2=touches[1];return{clientX:((touch2.clientX-touch1.clientX)/2)+touch1.clientX,clientY:((touch2.clientY-touch1.clientY)/2)+touch1.clientY};},_trigger:function(event){if(typeof event==='string'){event='panzoom'+event;}
this.$elem.triggerHandler(event,[this].concat(slice.call(arguments,1)));},_startMove:function(event,touches){if(this.panning){return;}
var moveEvent,endEvent,startDistance,startScale,startMiddle,startPageX,startPageY,touch;var self=this;var options=this.options;var ns=options.eventNamespace;var matrix=this.getMatrix();var original=matrix.slice(0);var origPageX=+original[4];var origPageY=+original[5];var panOptions={matrix:matrix,animate:'skip'};var type=event.type;if(type==='pointerdown'){moveEvent='pointermove';endEvent='pointerup';}else if(type==='touchstart'){moveEvent='touchmove';endEvent='touchend';}else if(type==='MSPointerDown'){moveEvent='MSPointerMove';endEvent='MSPointerUp';}else{moveEvent='mousemove';endEvent='mouseup';}
moveEvent+=ns;endEvent+=ns;this.transition(true);this.panning=true;this._trigger('start',event,touches);var setStart=function(event,touches){if(touches){if(touches.length===2){if(startDistance!=null){return;}
startDistance=self._getDistance(touches);startScale=+matrix[0];startMiddle=self._getMiddle(touches);return;}
if(startPageX!=null){return;}
if((touch=touches[0])){startPageX=touch.pageX;startPageY=touch.pageY;}}
if(startPageX!=null){return;}
startPageX=event.pageX;startPageY=event.pageY;};setStart(event,touches);var move=function(e){var coords;e.preventDefault();touches=e.touches||e.originalEvent.touches;setStart(e,touches);if(touches){if(touches.length===2){var middle=self._getMiddle(touches);var diff=self._getDistance(touches)-startDistance;self.zoom(diff*(options.increment/100)+startScale,{focal:middle,matrix:matrix,animate:'skip'});self.pan(+matrix[4]+middle.clientX-startMiddle.clientX,+matrix[5]+middle.clientY-startMiddle.clientY,panOptions);startMiddle=middle;return;}
coords=touches[0]||{pageX:0,pageY:0};}
if(!coords){coords=e;}
self.pan(origPageX+coords.pageX-startPageX,origPageY+coords.pageY-startPageY,panOptions);};$(document).off(ns).on(moveEvent,move).on(endEvent,function(e){e.preventDefault();$(this).off(ns);self.panning=false;e.type='panzoomend';self._trigger(e,matrix,!matrixEquals(matrix,original));});}};$.Panzoom=Panzoom;$.fn.panzoom=function(options){var instance,args,m,ret;if(typeof options==='string'){ret=[];args=slice.call(arguments,1);this.each(function(){instance=$.data(this,datakey);if(!instance){ret.push(undefined);}else if(options.charAt(0)!=='_'&&typeof(m=instance[options])==='function'&&(m=m.apply(instance,args))!==undefined){ret.push(m);}});return ret.length?(ret.length===1?ret[0]:ret):this;}
return this.each(function(){new Panzoom(this,options);});};return Panzoom;}));/*!
 * @fileOverview TouchSwipe - jQuery Plugin
 * @version 1.6.18
 *
 * @author Matt Bryson http://www.github.com/mattbryson
 * @see https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
 * @see http://labs.rampinteractive.co.uk/touchSwipe/
 * @see http://plugins.jquery.com/project/touchSwipe
 * @license
 * Copyright (c) 2010-2015 Matt Bryson
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */
(function(factory){if(typeof module!=='undefined'&&module.exports){factory(require("jquery"));}else{factory(jQuery);}}(function($){"use strict";var VERSION="1.6.18",LEFT="left",RIGHT="right",UP="up",DOWN="down",IN="in",OUT="out",NONE="none",AUTO="auto",SWIPE="swipe",PINCH="pinch",TAP="tap",DOUBLE_TAP="doubletap",LONG_TAP="longtap",HOLD="hold",HORIZONTAL="horizontal",VERTICAL="vertical",ALL_FINGERS="all",DOUBLE_TAP_THRESHOLD=10,PHASE_START="start",PHASE_MOVE="move",PHASE_END="end",PHASE_CANCEL="cancel",SUPPORTS_TOUCH='ontouchstart'in window,SUPPORTS_POINTER_IE10=window.navigator.msPointerEnabled&&!window.navigator.pointerEnabled&&!SUPPORTS_TOUCH,SUPPORTS_POINTER=(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&!SUPPORTS_TOUCH,PLUGIN_NS='TouchSwipe';var defaults={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:true,triggerOnTouchLeave:false,allowPageScroll:"auto",fallbackToMouseEvents:true,excludedElements:".noSwipe",preventDefaultEvents:true};$.fn.swipe=function(method){var $this=$(this),plugin=$this.data(PLUGIN_NS);if(plugin&&typeof method==='string'){if(plugin[method]){return plugin[method].apply(plugin,Array.prototype.slice.call(arguments,1));}else{$.error('Method '+method+' does not exist on jQuery.swipe');}}
else if(plugin&&typeof method==='object'){plugin['option'].apply(plugin,arguments);}
else if(!plugin&&(typeof method==='object'||!method)){return init.apply(this,arguments);}
return $this;};$.fn.swipe.version=VERSION;$.fn.swipe.defaults=defaults;$.fn.swipe.phases={PHASE_START:PHASE_START,PHASE_MOVE:PHASE_MOVE,PHASE_END:PHASE_END,PHASE_CANCEL:PHASE_CANCEL};$.fn.swipe.directions={LEFT:LEFT,RIGHT:RIGHT,UP:UP,DOWN:DOWN,IN:IN,OUT:OUT};$.fn.swipe.pageScroll={NONE:NONE,HORIZONTAL:HORIZONTAL,VERTICAL:VERTICAL,AUTO:AUTO};$.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,ALL:ALL_FINGERS};function init(options){if(options&&(options.allowPageScroll===undefined&&(options.swipe!==undefined||options.swipeStatus!==undefined))){options.allowPageScroll=NONE;}
if(options.click!==undefined&&options.tap===undefined){options.tap=options.click;}
if(!options){options={};}
options=$.extend({},$.fn.swipe.defaults,options);return this.each(function(){var $this=$(this);var plugin=$this.data(PLUGIN_NS);if(!plugin){plugin=new TouchSwipe(this,options);$this.data(PLUGIN_NS,plugin);}});}
function TouchSwipe(element,options){var options=$.extend({},options);var useTouchEvents=(SUPPORTS_TOUCH||SUPPORTS_POINTER||!options.fallbackToMouseEvents),START_EV=useTouchEvents?(SUPPORTS_POINTER?(SUPPORTS_POINTER_IE10?'MSPointerDown':'pointerdown'):'touchstart'):'mousedown',MOVE_EV=useTouchEvents?(SUPPORTS_POINTER?(SUPPORTS_POINTER_IE10?'MSPointerMove':'pointermove'):'touchmove'):'mousemove',END_EV=useTouchEvents?(SUPPORTS_POINTER?(SUPPORTS_POINTER_IE10?'MSPointerUp':'pointerup'):'touchend'):'mouseup',LEAVE_EV=useTouchEvents?(SUPPORTS_POINTER?'mouseleave':null):'mouseleave',CANCEL_EV=(SUPPORTS_POINTER?(SUPPORTS_POINTER_IE10?'MSPointerCancel':'pointercancel'):'touchcancel');var distance=0,direction=null,currentDirection=null,duration=0,startTouchesDistance=0,endTouchesDistance=0,pinchZoom=1,pinchDistance=0,pinchDirection=0,maximumsMap=null;var $element=$(element);var phase="start";var fingerCount=0;var fingerData={};var startTime=0,endTime=0,previousTouchEndTime=0,fingerCountAtRelease=0,doubleTapStartTime=0;var singleTapTimeout=null,holdTimeout=null;try{$element.bind(START_EV,touchStart);$element.bind(CANCEL_EV,touchCancel);}catch(e){$.error('events not supported '+START_EV+','+CANCEL_EV+' on jQuery.swipe');}
this.enable=function(){this.disable();$element.bind(START_EV,touchStart);$element.bind(CANCEL_EV,touchCancel);return $element;};this.disable=function(){removeListeners();return $element;};this.destroy=function(){removeListeners();$element.data(PLUGIN_NS,null);$element=null;};this.option=function(property,value){if(typeof property==='object'){options=$.extend(options,property);}else if(options[property]!==undefined){if(value===undefined){return options[property];}else{options[property]=value;}}else if(!property){return options;}else{$.error('Option '+property+' does not exist on jQuery.swipe.options');}
return null;}
function touchStart(jqEvent){if(getTouchInProgress()){return;}
if($(jqEvent.target).closest(options.excludedElements,$element).length>0){return;}
var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent;if(event.pointerType&&event.pointerType=="mouse"&&options.fallbackToMouseEvents==false){return;};var ret,touches=event.touches,evt=touches?touches[0]:event;phase=PHASE_START;if(touches){fingerCount=touches.length;}
else if(options.preventDefaultEvents!==false){jqEvent.preventDefault();}
distance=0;direction=null;currentDirection=null;pinchDirection=null;duration=0;startTouchesDistance=0;endTouchesDistance=0;pinchZoom=1;pinchDistance=0;maximumsMap=createMaximumsData();cancelMultiFingerRelease();createFingerData(0,evt);if(!touches||(fingerCount===options.fingers||options.fingers===ALL_FINGERS)||hasPinches()){startTime=getTimeStamp();if(fingerCount==2){createFingerData(1,touches[1]);startTouchesDistance=endTouchesDistance=calculateTouchesDistance(fingerData[0].start,fingerData[1].start);}
if(options.swipeStatus||options.pinchStatus){ret=triggerHandler(event,phase);}}else{ret=false;}
if(ret===false){phase=PHASE_CANCEL;triggerHandler(event,phase);return ret;}else{if(options.hold){holdTimeout=setTimeout($.proxy(function(){$element.trigger('hold',[event.target]);if(options.hold){ret=options.hold.call($element,event,event.target);}},this),options.longTapThreshold);}
setTouchInProgress(true);}
return null;};function touchMove(jqEvent){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent;if(phase===PHASE_END||phase===PHASE_CANCEL||inMultiFingerRelease())
return;var ret,touches=event.touches,evt=touches?touches[0]:event;var currentFinger=updateFingerData(evt);endTime=getTimeStamp();if(touches){fingerCount=touches.length;}
if(options.hold){clearTimeout(holdTimeout);}
phase=PHASE_MOVE;if(fingerCount==2){if(startTouchesDistance==0){createFingerData(1,touches[1]);startTouchesDistance=endTouchesDistance=calculateTouchesDistance(fingerData[0].start,fingerData[1].start);}else{updateFingerData(touches[1]);endTouchesDistance=calculateTouchesDistance(fingerData[0].end,fingerData[1].end);pinchDirection=calculatePinchDirection(fingerData[0].end,fingerData[1].end);}
pinchZoom=calculatePinchZoom(startTouchesDistance,endTouchesDistance);pinchDistance=Math.abs(startTouchesDistance-endTouchesDistance);}
if((fingerCount===options.fingers||options.fingers===ALL_FINGERS)||!touches||hasPinches()){direction=calculateDirection(currentFinger.start,currentFinger.end);currentDirection=calculateDirection(currentFinger.last,currentFinger.end);validateDefaultEvent(jqEvent,currentDirection);distance=calculateDistance(currentFinger.start,currentFinger.end);duration=calculateDuration();setMaxDistance(direction,distance);ret=triggerHandler(event,phase);if(!options.triggerOnTouchEnd||options.triggerOnTouchLeave){var inBounds=true;if(options.triggerOnTouchLeave){var bounds=getbounds(this);inBounds=isInBounds(currentFinger.end,bounds);}
if(!options.triggerOnTouchEnd&&inBounds){phase=getNextPhase(PHASE_MOVE);}
else if(options.triggerOnTouchLeave&&!inBounds){phase=getNextPhase(PHASE_END);}
if(phase==PHASE_CANCEL||phase==PHASE_END){triggerHandler(event,phase);}}}else{phase=PHASE_CANCEL;triggerHandler(event,phase);}
if(ret===false){phase=PHASE_CANCEL;triggerHandler(event,phase);}}
function touchEnd(jqEvent){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent,touches=event.touches;if(touches){if(touches.length&&!inMultiFingerRelease()){startMultiFingerRelease(event);return true;}else if(touches.length&&inMultiFingerRelease()){return true;}}
if(inMultiFingerRelease()){fingerCount=fingerCountAtRelease;}
endTime=getTimeStamp();duration=calculateDuration();if(didSwipeBackToCancel()||!validateSwipeDistance()){phase=PHASE_CANCEL;triggerHandler(event,phase);}else if(options.triggerOnTouchEnd||(options.triggerOnTouchEnd===false&&phase===PHASE_MOVE)){if(options.preventDefaultEvents!==false){jqEvent.preventDefault();}
phase=PHASE_END;triggerHandler(event,phase);}
else if(!options.triggerOnTouchEnd&&hasTap()){phase=PHASE_END;triggerHandlerForGesture(event,phase,TAP);}else if(phase===PHASE_MOVE){phase=PHASE_CANCEL;triggerHandler(event,phase);}
setTouchInProgress(false);return null;}
function touchCancel(){fingerCount=0;endTime=0;startTime=0;startTouchesDistance=0;endTouchesDistance=0;pinchZoom=1;cancelMultiFingerRelease();setTouchInProgress(false);}
function touchLeave(jqEvent){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent;if(options.triggerOnTouchLeave){phase=getNextPhase(PHASE_END);triggerHandler(event,phase);}}
function removeListeners(){$element.unbind(START_EV,touchStart);$element.unbind(CANCEL_EV,touchCancel);$element.unbind(MOVE_EV,touchMove);$element.unbind(END_EV,touchEnd);if(LEAVE_EV){$element.unbind(LEAVE_EV,touchLeave);}
setTouchInProgress(false);}
function getNextPhase(currentPhase){var nextPhase=currentPhase;var validTime=validateSwipeTime();var validDistance=validateSwipeDistance();var didCancel=didSwipeBackToCancel();if(!validTime||didCancel){nextPhase=PHASE_CANCEL;}
else if(validDistance&&currentPhase==PHASE_MOVE&&(!options.triggerOnTouchEnd||options.triggerOnTouchLeave)){nextPhase=PHASE_END;}
else if(!validDistance&&currentPhase==PHASE_END&&options.triggerOnTouchLeave){nextPhase=PHASE_CANCEL;}
return nextPhase;}
function triggerHandler(event,phase){var ret,touches=event.touches;if(didSwipe()||hasSwipes()){ret=triggerHandlerForGesture(event,phase,SWIPE);}
if((didPinch()||hasPinches())&&ret!==false){ret=triggerHandlerForGesture(event,phase,PINCH);}
if(didDoubleTap()&&ret!==false){ret=triggerHandlerForGesture(event,phase,DOUBLE_TAP);}
else if(didLongTap()&&ret!==false){ret=triggerHandlerForGesture(event,phase,LONG_TAP);}
else if(didTap()&&ret!==false){ret=triggerHandlerForGesture(event,phase,TAP);}
if(phase===PHASE_CANCEL){touchCancel(event);}
if(phase===PHASE_END){if(touches){if(!touches.length){touchCancel(event);}}else{touchCancel(event);}}
return ret;}
function triggerHandlerForGesture(event,phase,gesture){var ret;if(gesture==SWIPE){$element.trigger('swipeStatus',[phase,direction||null,distance||0,duration||0,fingerCount,fingerData,currentDirection]);if(options.swipeStatus){ret=options.swipeStatus.call($element,event,phase,direction||null,distance||0,duration||0,fingerCount,fingerData,currentDirection);if(ret===false)return false;}
if(phase==PHASE_END&&validateSwipe()){clearTimeout(singleTapTimeout);clearTimeout(holdTimeout);$element.trigger('swipe',[direction,distance,duration,fingerCount,fingerData,currentDirection]);if(options.swipe){ret=options.swipe.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection);if(ret===false)return false;}
switch(direction){case LEFT:$element.trigger('swipeLeft',[direction,distance,duration,fingerCount,fingerData,currentDirection]);if(options.swipeLeft){ret=options.swipeLeft.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection);}
break;case RIGHT:$element.trigger('swipeRight',[direction,distance,duration,fingerCount,fingerData,currentDirection]);if(options.swipeRight){ret=options.swipeRight.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection);}
break;case UP:$element.trigger('swipeUp',[direction,distance,duration,fingerCount,fingerData,currentDirection]);if(options.swipeUp){ret=options.swipeUp.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection);}
break;case DOWN:$element.trigger('swipeDown',[direction,distance,duration,fingerCount,fingerData,currentDirection]);if(options.swipeDown){ret=options.swipeDown.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection);}
break;}}}
if(gesture==PINCH){$element.trigger('pinchStatus',[phase,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData]);if(options.pinchStatus){ret=options.pinchStatus.call($element,event,phase,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData);if(ret===false)return false;}
if(phase==PHASE_END&&validatePinch()){switch(pinchDirection){case IN:$element.trigger('pinchIn',[pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData]);if(options.pinchIn){ret=options.pinchIn.call($element,event,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData);}
break;case OUT:$element.trigger('pinchOut',[pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData]);if(options.pinchOut){ret=options.pinchOut.call($element,event,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData);}
break;}}}
if(gesture==TAP){if(phase===PHASE_CANCEL||phase===PHASE_END){clearTimeout(singleTapTimeout);clearTimeout(holdTimeout);if(hasDoubleTap()&&!inDoubleTap()){doubleTapStartTime=getTimeStamp();singleTapTimeout=setTimeout($.proxy(function(){doubleTapStartTime=null;$element.trigger('tap',[event.target]);if(options.tap){ret=options.tap.call($element,event,event.target);}},this),options.doubleTapThreshold);}else{doubleTapStartTime=null;$element.trigger('tap',[event.target]);if(options.tap){ret=options.tap.call($element,event,event.target);}}}}else if(gesture==DOUBLE_TAP){if(phase===PHASE_CANCEL||phase===PHASE_END){clearTimeout(singleTapTimeout);clearTimeout(holdTimeout);doubleTapStartTime=null;$element.trigger('doubletap',[event.target]);if(options.doubleTap){ret=options.doubleTap.call($element,event,event.target);}}}else if(gesture==LONG_TAP){if(phase===PHASE_CANCEL||phase===PHASE_END){clearTimeout(singleTapTimeout);doubleTapStartTime=null;$element.trigger('longtap',[event.target]);if(options.longTap){ret=options.longTap.call($element,event,event.target);}}}
return ret;}
function validateSwipeDistance(){var valid=true;if(options.threshold!==null){valid=distance>=options.threshold;}
return valid;}
function didSwipeBackToCancel(){var cancelled=false;if(options.cancelThreshold!==null&&direction!==null){cancelled=(getMaxDistance(direction)-distance)>=options.cancelThreshold;}
return cancelled;}
function validatePinchDistance(){if(options.pinchThreshold!==null){return pinchDistance>=options.pinchThreshold;}
return true;}
function validateSwipeTime(){var result;if(options.maxTimeThreshold){if(duration>=options.maxTimeThreshold){result=false;}else{result=true;}}else{result=true;}
return result;}
function validateDefaultEvent(jqEvent,direction){if(options.preventDefaultEvents===false){return;}
if(options.allowPageScroll===NONE){jqEvent.preventDefault();}else{var auto=options.allowPageScroll===AUTO;switch(direction){case LEFT:if((options.swipeLeft&&auto)||(!auto&&options.allowPageScroll!=HORIZONTAL)){jqEvent.preventDefault();}
break;case RIGHT:if((options.swipeRight&&auto)||(!auto&&options.allowPageScroll!=HORIZONTAL)){jqEvent.preventDefault();}
break;case UP:if((options.swipeUp&&auto)||(!auto&&options.allowPageScroll!=VERTICAL)){jqEvent.preventDefault();}
break;case DOWN:if((options.swipeDown&&auto)||(!auto&&options.allowPageScroll!=VERTICAL)){jqEvent.preventDefault();}
break;case NONE:break;}}}
function validatePinch(){var hasCorrectFingerCount=validateFingers();var hasEndPoint=validateEndPoint();var hasCorrectDistance=validatePinchDistance();return hasCorrectFingerCount&&hasEndPoint&&hasCorrectDistance;}
function hasPinches(){return!!(options.pinchStatus||options.pinchIn||options.pinchOut);}
function didPinch(){return!!(validatePinch()&&hasPinches());}
function validateSwipe(){var hasValidTime=validateSwipeTime();var hasValidDistance=validateSwipeDistance();var hasCorrectFingerCount=validateFingers();var hasEndPoint=validateEndPoint();var didCancel=didSwipeBackToCancel();var valid=!didCancel&&hasEndPoint&&hasCorrectFingerCount&&hasValidDistance&&hasValidTime;return valid;}
function hasSwipes(){return!!(options.swipe||options.swipeStatus||options.swipeLeft||options.swipeRight||options.swipeUp||options.swipeDown);}
function didSwipe(){return!!(validateSwipe()&&hasSwipes());}
function validateFingers(){return((fingerCount===options.fingers||options.fingers===ALL_FINGERS)||!SUPPORTS_TOUCH);}
function validateEndPoint(){return fingerData[0].end.x!==0;}
function hasTap(){return!!(options.tap);}
function hasDoubleTap(){return!!(options.doubleTap);}
function hasLongTap(){return!!(options.longTap);}
function validateDoubleTap(){if(doubleTapStartTime==null){return false;}
var now=getTimeStamp();return(hasDoubleTap()&&((now-doubleTapStartTime)<=options.doubleTapThreshold));}
function inDoubleTap(){return validateDoubleTap();}
function validateTap(){return((fingerCount===1||!SUPPORTS_TOUCH)&&(isNaN(distance)||distance<options.threshold));}
function validateLongTap(){return((duration>options.longTapThreshold)&&(distance<DOUBLE_TAP_THRESHOLD));}
function didTap(){return!!(validateTap()&&hasTap());}
function didDoubleTap(){return!!(validateDoubleTap()&&hasDoubleTap());}
function didLongTap(){return!!(validateLongTap()&&hasLongTap());}
function startMultiFingerRelease(event){previousTouchEndTime=getTimeStamp();fingerCountAtRelease=event.touches.length+1;}
function cancelMultiFingerRelease(){previousTouchEndTime=0;fingerCountAtRelease=0;}
function inMultiFingerRelease(){var withinThreshold=false;if(previousTouchEndTime){var diff=getTimeStamp()-previousTouchEndTime
if(diff<=options.fingerReleaseThreshold){withinThreshold=true;}}
return withinThreshold;}
function getTouchInProgress(){return!!($element.data(PLUGIN_NS+'_intouch')===true);}
function setTouchInProgress(val){if(!$element){return;}
if(val===true){$element.bind(MOVE_EV,touchMove);$element.bind(END_EV,touchEnd);if(LEAVE_EV){$element.bind(LEAVE_EV,touchLeave);}}else{$element.unbind(MOVE_EV,touchMove,false);$element.unbind(END_EV,touchEnd,false);if(LEAVE_EV){$element.unbind(LEAVE_EV,touchLeave,false);}}
$element.data(PLUGIN_NS+'_intouch',val===true);}
function createFingerData(id,evt){var f={start:{x:0,y:0},last:{x:0,y:0},end:{x:0,y:0}};f.start.x=f.last.x=f.end.x=evt.pageX||evt.clientX;f.start.y=f.last.y=f.end.y=evt.pageY||evt.clientY;fingerData[id]=f;return f;}
function updateFingerData(evt){var id=evt.identifier!==undefined?evt.identifier:0;var f=getFingerData(id);if(f===null){f=createFingerData(id,evt);}
f.last.x=f.end.x;f.last.y=f.end.y;f.end.x=evt.pageX||evt.clientX;f.end.y=evt.pageY||evt.clientY;return f;}
function getFingerData(id){return fingerData[id]||null;}
function setMaxDistance(direction,distance){if(direction==NONE)return;distance=Math.max(distance,getMaxDistance(direction));maximumsMap[direction].distance=distance;}
function getMaxDistance(direction){if(maximumsMap[direction])return maximumsMap[direction].distance;return undefined;}
function createMaximumsData(){var maxData={};maxData[LEFT]=createMaximumVO(LEFT);maxData[RIGHT]=createMaximumVO(RIGHT);maxData[UP]=createMaximumVO(UP);maxData[DOWN]=createMaximumVO(DOWN);return maxData;}
function createMaximumVO(dir){return{direction:dir,distance:0}}
function calculateDuration(){return endTime-startTime;}
function calculateTouchesDistance(startPoint,endPoint){var diffX=Math.abs(startPoint.x-endPoint.x);var diffY=Math.abs(startPoint.y-endPoint.y);return Math.round(Math.sqrt(diffX*diffX+diffY*diffY));}
function calculatePinchZoom(startDistance,endDistance){var percent=(endDistance/startDistance)*1;return percent.toFixed(2);}
function calculatePinchDirection(){if(pinchZoom<1){return OUT;}else{return IN;}}
function calculateDistance(startPoint,endPoint){return Math.round(Math.sqrt(Math.pow(endPoint.x-startPoint.x,2)+Math.pow(endPoint.y-startPoint.y,2)));}
function calculateAngle(startPoint,endPoint){var x=startPoint.x-endPoint.x;var y=endPoint.y-startPoint.y;var r=Math.atan2(y,x);var angle=Math.round(r*180/Math.PI);if(angle<0){angle=360-Math.abs(angle);}
return angle;}
function calculateDirection(startPoint,endPoint){if(comparePoints(startPoint,endPoint)){return NONE;}
var angle=calculateAngle(startPoint,endPoint);if((angle<=45)&&(angle>=0)){return LEFT;}else if((angle<=360)&&(angle>=315)){return LEFT;}else if((angle>=135)&&(angle<=225)){return RIGHT;}else if((angle>45)&&(angle<135)){return DOWN;}else{return UP;}}
function getTimeStamp(){var now=new Date();return now.getTime();}
function getbounds(el){el=$(el);var offset=el.offset();var bounds={left:offset.left,right:offset.left+el.outerWidth(),top:offset.top,bottom:offset.top+el.outerHeight()}
return bounds;}
function isInBounds(point,bounds){return(point.x>bounds.left&&point.x<bounds.right&&point.y>bounds.top&&point.y<bounds.bottom);};function comparePoints(pointA,pointB){return(pointA.x==pointB.x&&pointA.y==pointB.y);}}}));
$.mmsViews={};$.mmsViews.showView=function(url,viewType,viewClass,viewPosition,linkRef,callback,callOnError){if(viewType=='Panel'){var pattern=/[?&]showServiceUrl/;var URL=location.search;var data;if(pattern.test(URL))
{data={viewType:viewType,viewClass:viewClass,showServiceUrl:'true'};}else{data={viewType:viewType,viewClass:viewClass};}
$.ajax({url:url,data:data,success:function(html){callback(html);if($('#totalResultsPart').length&&$('#totalResultsForAjax').length){$('#totalResultsPart').html($('#totalResultsForAjax').val());$('.js__searchResultKey').show();}else if($('#totalResultsPart').length&&$('#js__hideTotalResultsPart').length){$('#totalResultsPart').html("");$('.js__searchResultKey').hide();}},error:function(data){callOnError(data.responseText);console.log(data);}});}else{window.location.href=url;}};
(function(){$(document).ready(function(){$(".categoryArticleListWidget, .videoListCommentary, .mostRecentImageChallengeWidget, .mostRecentWeeklyAudioSummaries, .articleTopicWidget, .showSearchCarouselWidget, .travelingHomepageWidget, .recentImageChallengesWidget").each(function(){var $resultsTarget=$(this);var $class="."+$(this).attr('class').split(' ')[1];$(this).pbAjax({type:'GET',url:'/pb/widgets/'+$(this).attr('class').split(' ')[1],dataType:'html',async:'false',success:function(data){if($(data).html()==undefined)
return;if($(data).html().trim()==''){$resultsTarget.remove();}else{var imageChallengeDropzone='<div data-pb-dropzone="imageChallengeDropzone">';if($resultsTarget.hasClass("mostRecentImageChallengeWidget")&&data.indexOf(imageChallengeDropzone)!=-1){var ImageChallengeWidget=data.indexOf('<div class="widget mostRecentImageChallengeWidget');data=data.substring(ImageChallengeWidget,data.indexOf(imageChallengeDropzone));}
$resultsTarget.replaceWith(data);$(".js__imageChallengeQuestionWidget").on("change","input[type='radio']",function(){$(this).closest("form").find("button[type='submit']").removeClass("a-btn--disabled");});lazyLoad("[data-src]",$($class)[0]);}}});});});})();
mmsMoc={};mmsMoc.refreshMocMsg=function(){var divMocMsgBox=$('div.msgBox.moc');if(divMocMsgBox.length!=0){var doi=$('meta[name=evt-doiPage]').attr('content');if(doi){var url='/action/showMocMessageModule?doi='+doi;$.ajax({url:url,success:function(html){var newHtml=$.trim(html);if(newHtml){divMocMsgBox.replaceWith(newHtml);$('li.getCME.moc').removeClass('hidden');}},data:{}});}}}
mmsMoc.refreshMocActivity=function(){var divMocActivityBox=$('div.rightGreyBox.moc');if(divMocActivityBox.length!=0){var url='/action/showMocActivityModule';$.ajax({url:url,success:function(html){var newHtml=$.trim(html);if(newHtml){divMocActivityBox.replaceWith(newHtml);}},data:{}});}}
$(document).ready(function($){mmsMoc.refreshMocMsg();mmsMoc.refreshMocActivity();});
function validateTranLink(serverURL){var tagged=$('#chineseTagValue').val();var href=$('#chineseTrans').val();if(typeof href!=="undefined"&&href!=''&&tagged=='false'){$.ajax({url:serverURL+href,type:'GET',dataType:"json",success:function(data){var url=data['url'];url=url.replace("\\","");if(url){viewLink(url);tagArticle($('#doi').val(),url);}}});}else if(href){viewLink($('#chineseTranslationLink').val());}}
function tagArticle(doi,url){$.ajax({data:{doi:doi,ct_url:url},url:'/action/TagPublicationCT',type:'GET'});}
function viewLink(url){$(document).find(".translationLinks").append('<a  href="'+url+'" id="chineseLink" target=_blank">Chinese Translation &#x4E2D;&#25991;&#x7FFB;&#x8BD1</a>');}
$(document).ready(function(){if($("#check_url").length)
validateTranLink($("#check_url").val());});
var curated_utility={populateFromData:function(map,self,_){self.$ul.empty();var tempMap=new Object();_.each(map,function(value,key){if(key.indexOf('menu')>=0&&value!=''){var index=key.replace(/[^\d.]/g,'');if(tempMap[index]==null){tempMap[index]=new Object();}
tempMap[index][key]=value;}});$.each(tempMap,function(index,value){self.createEntry(value);});}};
$.mmsClassData={};$.mmsClassData.separator='-';$.mmsClassData.pattern=function(key){return new RegExp('(^|[ ]+)'+key+$.mmsClassData.separator+'([^ ]*)[ ]*');};$.mmsClassData.getData=function(el,key){var matches=el.className.match($.mmsClassData.pattern(key));if(matches&&matches.length==3)
return matches[2];};$.fn.mmsClassData=function(key,value){if(value){this.each(function(){this.className=this.className.replace($.mmsClassData.pattern(key),' ');$(this).addClass(key+$.mmsClassData.separator+value);});return this;}
else
return $.mmsClassData.getData(this.get(0),key);};$.extend($.expr[':'],{mmsClassData:function(a,i,m){var parts=m[3].split('=');var value=$.mmsClassData.getData(a,parts[0]);if(parts.length==2)
return value==parts[1];else
return value!=null;}});
jQuery.browser={};(function(){jQuery.browser.msie=false;jQuery.browser.version=0;if(navigator.userAgent.match(/MSIE ([0-9]+)\./)){jQuery.browser.msie=true;jQuery.browser.version=RegExp.$1;}})();(function($,p){var i,m=Array.prototype.slice,r=decodeURIComponent,a=$.param,c,l,v,b=$.bbq=$.bbq||{},q,u,j,e=$.event.special,d="hashchange",A="querystring",D="fragment",y="elemUrlAttr",g="location",k="href",t="src",x=/^.*\?|#.*$/g,w=/^.*\#/,h,C={};function E(F){return typeof F==="string"}function B(G){var F=m.call(arguments,1);return function(){return G.apply(this,F.concat(m.call(arguments)))}}function n(F){return F.replace(/^[^#]*#?(.*)$/,"$1")}function o(F){return F.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function f(H,M,F,I,G){var O,L,K,N,J;if(I!==i){K=F.match(H?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);J=K[3]||"";if(G===2&&E(I)){L=I.replace(H?w:x,"")}else{N=l(K[2]);I=E(I)?l[H?D:A](I):I;L=G===2?I:G===1?$.extend({},I,N):$.extend({},N,I);L=a(L);if(H){L=L.replace(h,r)}}O=K[1]+(H?"#":L||!K[1]?"?":"")+L+J}else{O=M(F!==i?F:p[g][k])}return O}a[A]=B(f,0,o);a[D]=c=B(f,1,n);c.noEscape=function(G){G=G||"";var F=$.map(G.split(""),encodeURIComponent);h=new RegExp(F.join("|"),"g")};c.noEscape(",/");$.deparam=l=function(I,F){var H={},G={"true":!0,"false":!1,"null":null};$.each(I.replace(/\+/g," ").split("&"),function(L,Q){var K=Q.split("="),P=r(K[0]),J,O=H,M=0,R=P.split("]["),N=R.length-1;if(/\[/.test(R[0])&&/\]$/.test(R[N])){R[N]=R[N].replace(/\]$/,"");R=R.shift().split("[").concat(R);N=R.length-1}else{N=0}if(K.length===2){J=r(K[1]);if(F){J=J&&!isNaN(J)?+J:J==="undefined"?i:G[J]!==i?G[J]:J}if(N){for(;M<=N;M++){P=R[M]===""?O.length:R[M];O=O[P]=M<N?O[P]||(R[M+1]&&isNaN(R[M+1])?{}:[]):J}}else{if($.isArray(H[P])){H[P].push(J)}else{if(H[P]!==i){H[P]=[H[P],J]}else{H[P]=J}}}}else{if(P){H[P]=F?i:""}}});return H};function z(H,F,G){if(F===i||typeof F==="boolean"){G=F;F=a[H?D:A]()}else{F=E(F)?F.replace(H?w:x,""):F}return l(F,G)}l[A]=B(z,0);l[D]=v=B(z,1);$[y]||($[y]=function(F){return $.extend(C,F)})({a:k,base:k,iframe:t,img:t,input:t,form:"action",link:k,script:t});j=$[y];function s(I,G,H,F){if(!E(H)&&typeof H!=="object"){F=H;H=G;G=i}return this.each(function(){var L=$(this),J=G||j()[(this.nodeName||"").toLowerCase()]||"",K=J&&L.attr(J)||"";L.attr(J,a[I](K,H,F))})}$.fn[A]=B(s,A);$.fn[D]=B(s,D);b.pushState=q=function(I,F){if(E(I)&&/^#/.test(I)&&F===i){F=2}var H=I!==i,G=c(p[g][k],H?I:{},H?F:2);p[g][k]=G+(/#/.test(G)?"":"#")};b.getState=u=function(F,G){return F===i||typeof F==="boolean"?v(F):v(G)[F]};b.removeState=function(F){var G={};if(F!==i){G=u();$.each($.isArray(F)?F:arguments,function(I,H){delete G[H]})}q(G,2)};e[d]=$.extend(e[d],{add:function(F){var H;function G(J){var I=J[D]=c();J.getState=function(K,L){return K===i||typeof K==="boolean"?l(I,K):l(I,L)[K]};H.apply(this,arguments)}if($.isFunction(F)){H=F;return G}else{H=F.handler;F.handler=G}}})})(jQuery,this);(function($,i,b){var j,k=$.event.special,c="location",d="hashchange",l="href",f=$.browser,g=document.documentMode,h=f.msie&&(g===b||g<8),e="on"+d in i&&!h;function a(m){m=m||i[c][l];return m.replace(/^[^#]*#?(.*)$/,"$1")}$[d+"Delay"]=100;k[d]=$.extend(k[d],{setup:function(){if(e){return false}$(j.start)},teardown:function(){if(e){return false}$(j.stop)}});j=(function(){var m={},r,n,o,q;function p(){o=q=function(s){return s};if(h){n=$('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;q=function(){return a(n.document[c][l])};o=function(u,s){if(u!==s){var t=n.document;t.open().close();t[c].hash="#"+u}};o(a())}}m.start=function(){if(r){return}var t=a();o||p();(function s(){var v=a(),u=q(t);if(v!==t){o(t=v,u);$(i).trigger(d)}else{if(u!==t){i[c][l]=i[c][l].replace(/#.*/,"")+"#"+u}}r=setTimeout(s,$[d+"Delay"])})()};m.stop=function(){if(!n){r&&clearTimeout(r);r=0}};return m})()})(jQuery,this);
$.mmsFilterBanks={};var PB_Edit=false;var SELECTED_FILTER_MENU='';$(function(){if(!detectIE()&&$('#adminUserInput').length>0&&$('#isInstitutionAdmin').val()=='false'){PB_Edit=true;}
if($('#searchFilterContent').length>0){$(window).bind('hashchange',function(e){$.mmsFilterBanks.linkAction();});var qs=$.bbq.getState('qs');if(qs)$.mmsFilterBanks.linkAction();}});function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf('.',msie)),10);}
var trident=ua.indexOf('Trident/');if(trident>0){var rv=ua.indexOf('rv:');return parseInt(ua.substring(rv+3,ua.indexOf('.',rv)),10);}
var edge=ua.indexOf('Edge/');if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf('.',edge)),10);}
return false;}
$.mmsFilterBanks.linkClick=function(){if(PB_Edit)return true;var el=$(this);var url=el.attr('href');if(url.indexOf("date")){if(url.indexOf("manualFilterParam")!=-1){var oldManualFilterParam=url.substring(url.indexOf("manualFilterParam")+18,url.indexOf("_firstDelimiter")+15);url=url.replace(oldManualFilterParam,"");url=url.replace("&manualFilterParam=","");url+="&manualFilterParam=contentAge_delimiter_"+oldManualFilterParam;}else{url+="&manualFilterParam=contentAge_firstDelimiter";}}
$.bbq.pushState({qs:url});var filterName='';if(el.parent().is('dd')){filterName=el.closest('dl').find('dt').text();}else if(el.closest('ul').hasClass('paginationLinks')){filterName="paginate";}else if(el.closest('div').hasClass('sortTypes')){filterName="sort";}else if(el.closest('div').hasClass('searchTypes')){filterName="type";}else{filterName=el.text();}
$.mmsFilterBanks.setActivityStep(filterName);if(el.hasClass('js__scrollTop')){$('html,body').animate({scrollTop:$(".js__scrollTopPagination").offset().top});}
min$(document).trigger('page:updated');return false;};$.mmsFilterBanks.inputClick=function(event){$(this).toggleClass("checked");$(this).toggleClass("s-checked");min$(document).trigger('body:unlock',{breakpoints:'xsmall small'});event.stopPropagation();event.preventDefault();var el=$(this);var filterBy;var query=el.attr('data-query');var paramName=el.attr('data-paramName');var filterValues=[];$.each(el.closest('.filterGroup').find('input.filterOption:checked, a.filterOption.checked'),function(j,v){filterValues.push($(v).attr('data-href'));});if(filterValues!='')filterBy=filterValues.join();var temp=el.find(':selected').attr('data-href');if(temp)filterBy=temp;var url=query;if(filterBy){url+="&"+paramName+"="+filterBy;if(url.indexOf("manualFilterParam")!=-1){var oldManualFilterParam=url.substring(url.indexOf("manualFilterParam")+18,url.indexOf("_firstDelimiter")+15);url=url.replace(oldManualFilterParam,"");url=url.replace("manualFilterParam=","");url+="&manualFilterParam="+paramName+"_delimiter_"+oldManualFilterParam;}else{url+="&manualFilterParam="+paramName+"_firstDelimiter";}
if($('#advancedSearchFilterParam').length){url+="&advancedSearchFilterParam=advancedSearchFilterParam"}}
if(PB_Edit){window.location.href=url;return true;}
$.bbq.pushState({qs:url});$.mmsFilterBanks.setActivityStep(paramName);SELECTED_FILTER_MENU=$(this).closest('ul').attr('id');$('html,body').animate({scrollTop:$("#searchResultContent").offset().top},500,"linear",function(){min$(document).trigger('body:lock',{breakpoints:'xsmall small'});});min$(document).trigger('page:updated');};$.mmsFilterBanks.linkAction=function(){var qs=$.bbq.getState('qs');if(!qs)qs=$(location).attr('href');if(qs){min$(document).trigger('loader:start');loading.start();var index=qs.indexOf('#');var url=qs;if(index>0){url=qs.substring(0,index)+"&requestType=ajax"+qs.substring(index,qs.length);}else{url=url+((url.indexOf('?')>-1)?'&':'?')+"requestType=ajax";}
$.mmsViews.showView(url,'Panel','','',null,$.mmsFilterBanks.updateAll,$.mmsFilterBanks.errorUpdate);}};$.mmsFilterBanks.formSubmit=function(){if($(this).find('input[name=q]').length>0&&!$(this).find('input[name=q]').val())return false;if(PB_Edit)return true;var form=$(this);var qs="?";var formFields=$(this).find('input');formFields.each(function(){if(this.value!="Search"&&this.name!='pageType')
qs+=this.name+"="+this.value+"&";});if(qs.indexOf("manualFilterParam")!=-1){var oldManualFilterParam=qs.substring(qs.indexOf("manualFilterParam")+18,qs.indexOf("_firstDelimiter")+15);qs=qs.replace(oldManualFilterParam,"");qs=qs.replace("manualFilterParam=","");qs+="manualFilterParam=dateRange_delimiter_"+oldManualFilterParam+"&";}else{form.append('<input type="hidden" name="manualFilterParam" value="dateRange_firstDelimiter"/>');qs+="manualFilterParam=dateRange_firstDelimiter&";}
if(form.parents('.dateFilter').length>0||form.parents('#dateFilter').length>0){var dateFields=$('#showWhenSelected select');dateFields.each(function(){if(this.value!="Search"&&this.name!='pageType'){qs+=this.name+"="+this.value+"&";}});}
$.bbq.pushState({qs:qs.substring(0,qs.length-1)});form.append('<input type="hidden" name="viewType" value="Panel"/>');form.ajaxSubmit();$.mmsFilterBanks.setActivityStep('search within');min$(document).trigger('page:updated');return false;};$.mmsFilterBanks.errorUpdate=function(data){$('#searchResultContent').replaceWith($(data).attr('id','searchResultContent'));if($('.m-no-results').length>0){$('.js__searchFeedBackWidget').hide()}
reloadTriggerPage();mmsTriggerActions();min$(document).trigger('page:updated');loading.stop();min$(document).trigger('loader:complete');};$.mmsFilterBanks.updateAll=function(html){$('#searchResultContent').replaceWith($(html).attr('id','searchResultContent'));mmsRegisterEvents($('#searchResultContent'));$.mmsFilterBanks.updateWebDataLayer();addSaveRedirect();if($('.m-no-results').length>0){$('.js__searchFeedBackWidget').hide()}
reloadTriggerPage();mmsTriggerActions();$('.event-hoverSavePage').bind("click",function(event){var browserURL=decodeURIComponent($(location).attr('href'));if(browserURL.indexOf("#qs=?")!=-1){var stateVal=jQuery.bbq.getState();if(stateVal!=""||stateVal!=null){var newlocation=$(location).attr('href').replace(/\?.*/,'');var newlocation=$(location).attr('href').replace(/\#.*/,'');browserURL=newlocation+stateVal.qs;}else{browserURL=browserURL.replace("#qs=?","?");}}
var elemId=$(this).attr('id');var autoSignIn=Cookies.get('AUTO_SIGNIN');if(autoSignIn==""||autoSignIn==null){Cookies.set('TRIGGER_BROWSER_URL',browserURL,{path:'/'});Cookies.set('TRIGGER_SAVE_ID',elemId,{path:'/'});}
return false;});min$(document).trigger('page:updated');if(SELECTED_FILTER_MENU!=""&&'topicFilter|mediaFilter|category|subtopic|ptopic|articletype'.indexOf(SELECTED_FILTER_MENU)>-1){var container=$('#'+SELECTED_FILTER_MENU).closest('div')[0];min$(container).trigger('dropdown:open');SELECTED_FILTER_MENU='';}
loading.stop();min$(document).trigger('loader:complete');window.setTimeout(function(){min$(document).trigger('searchFilters:filterButton:show')},1000);};$.mmsFilterBanks.updateWebDataLayer=function(){if(typeof mmsData!='undefined'&&mmsData.search&&searchContext){var asug=mmsData.search.queryTyped;var presetFilter=mmsData.search.presetFilter;mmsData.search=searchContext.search;mmsData.search.presetFilter=presetFilter;if(mmsData.search.manualFilter.specialty==mmsData.search.presetFilter.specialty||(mmsData.search.presetFilter.topic=='Health Policy'&&mmsData.search.manualFilter.specialty=='Health Policy')){mmsData.search.manualFilter.specialty=null;}
mmsData.search.queryTyped=asug;mmsData.page.activityType=searchContext.page.activityType;if(mmsData.search.manualFilter.CMEcheckbox=='figureOrArticle'){mmsData.search.manualFilter.CMEcheckbox=null;$('#enableCmeCheckboxFilter').val('false');}
if(typeof _satellite!='undefined'){_satellite.track("Filter")};}}
$.mmsFilterBanks.setActivityStep=function(actionName){var activityStep=actionName;switch(actionName){case'By Topic':activityStep='subtopic';break;case'By Specialty':activityStep='specialty';break;case'By Date':activityStep='contentAge';break;case'By Media Type':activityStep='mediaType';break;case'By Article Category':activityStep='category';break;case'By Article Type':activityStep='articleType';break;default:activityStep=actionName;break;}
if(typeof mmsData!='undefined'&&mmsData.page){mmsData.page.activityStep=activityStep;}};function isMobileDevice(){return((navigator.platform.indexOf("iPhone")!=-1)||(navigator.platform.indexOf("iPod")!=-1)||(navigator.platform.indexOf("Android")!=-1)||(navigator.platform.indexOf("webOS")!=-1));}
function addSaveRedirect(){var autoSignIn=Cookies.get('AUTO_SIGNIN');if(autoSignIn==null||autoSignIn==""){$('.event-hoverSavePage').each(function(){var pageUrl=decodeURIComponent($(location).attr('href'));if(pageUrl.indexOf("#qs=?")!=-1){pageUrl=pageUrl.replace("#qs=?","?");}
if(pageUrl.indexOf("?")==-1){pageUrl=pageUrl+'?';}
this.href+='&saveRedirect='+encodeURIComponent(pageUrl);});}}
function reloadTriggerPage(){var autoSignIn=Cookies.get('AUTO_SIGNIN');if(autoSignIn==null||autoSignIn==""){autoSignIn=Cookies.get('isIndividual');}
if(autoSignIn!=null&&autoSignIn!=""){var triggerBrowserURL=Cookies.get('TRIGGER_BROWSER_URL');var triggerSaveId=Cookies.get('TRIGGER_SAVE_ID');var createNewAccountCookie=Cookies.get('TRIGGER_CREATE_ACCOUNT');var createNewAccountParam=$(document).getUrlParam('createNewAccount');var trigger=0;if(createNewAccountCookie!=null&&createNewAccountCookie!=""){if(createNewAccountParam==null||createNewAccountParam==""){return;}}
if(window.location.href.indexOf("nejm-alerts")!=-1){return;}
if(triggerBrowserURL!=null&&triggerBrowserURL!=""){Cookies.set('TRIGGER_CREATE_ACCOUNT',null,{path:'/'});Cookies.set('TRIGGER_BROWSER_URL',null,{path:'/'});document.location=triggerBrowserURL;return;}
if(triggerSaveId!=null&&triggerSaveId!=""){var triggerSaveId=Cookies.get('TRIGGER_SAVE_ID');Cookies.set('TRIGGER_SAVE_ID',null,{path:'/'});var str='a[id^="'+triggerSaveId+'"]';$(str).click();}}}
$.fn.extend({getUrlParam:function(strParamName){strParamName=escape(unescape(strParamName));var returnVal=new Array();var qString=null;if($(this).attr("nodeName")=="#document"){if(window.location.search.search(strParamName)>-1){qString=window.location.search.substr(1,window.location.search.length).split("&");}}else if($(this).attr("src")!="undefined"){var strHref=$(this).attr("src")
if(strHref.indexOf("?")>-1){var strQueryString=strHref.substr(strHref.indexOf("?")+1);qString=strQueryString.split("&");}}else if($(this).attr("href")!="undefined"){var strHref=$(this).attr("href")
if(strHref.indexOf("?")>-1){var strQueryString=strHref.substr(strHref.indexOf("?")+1);qString=strQueryString.split("&");}}else{return null;}
if(qString==null)return null;for(var i=0;i<qString.length;i++){if(escape(unescape(qString[i].split("=")[0]))==strParamName){returnVal.push(qString[i].split("=")[1]);}}
if(returnVal.length==0)return null;else if(returnVal.length==1)return returnVal[0];else return returnVal;}});
var Track={};(function(undefined){var jquery=typeof jQuery!='undefined';var elements={};var userAgent=navigator.userAgent.toLowerCase();var defaultAjaxSettings={async:!/webkit/.test(userAgent),asynchronous:!/webkit/.test(userAgent),cache:false,timeout:/msie/.test(userAgent)?0:100,requestTimeout:/msie/.test(userAgent)?0:100,contentType:'application/x-www-form-urlencoded',url:'/action/clickThrough'};var extend=function(dst,src){if(jquery){extend=jQuery.extend;}else{extend=Object.extend;}
return extend(dst,src);};var each=function(o,iterator){if(jquery){each=jQuery.each;}else{each=function(object,callback){var name,i=0,length=object.length,isObj=length===undefined||typeof object==="function";if(isObj){for(name in object){if(callback.call(object[name],name,object[name])===false){break;}}}else{for(var value=object[0];i<length&&callback.call(value,i,value)!==false;value=object[++i]){}}
return object;};}
return each(o,iterator);};var bind=function(selector,options,callback){var jQueryBind=function(selector,options,callback){if(options.selector){jQuery(selector).on(options.on,options.selector,options,callback);}else{jQuery(selector).on(options.on,options,callback);}};var oldJQueryBind=function(selector,options,callback){var callbackToUse=callback;if(options.selector){callbackToUse=function(event){var $target=$(event.currentTarget);while(!$target.is(options.selector)&&$target.children().length){$target.children().each(function(){$target=$(this);if($target.is(options.selector)){return false;}});}
if($target.is(options.selector)){callback.call(event.target,event,options);}};jQuery(selector).data('TrackCallback',callbackToUse);}
jQuery(selector).bind(options.on,options,callbackToUse);};var prototypeBind=function(selector,options,callback){$$(selector).each(function(el){Event.observe(el,options.on,callback.bindAsEventListener(this,options));});};if(jquery){if(jQuery.fn.on){bind=jQueryBind;}else{bind=oldJQueryBind;}}else{bind=prototypeBind;}
return bind(selector,options,callback);};var unbind=function(selector,options,callback){var jQueryUnbind=function(selector,options,callback){if(options.selector){jQuery(selector).off(options.on,options.selector,options,callback);}else{jQuery(selector).off(options.on,options,callback);}};var oldJQueryUnbind=function(selector,options,callback){if(options.selector){callback=jQuery(selector).data('TrackCallback');}
if(callback){jQuery(selector).unbind(options.on,callback);}else{jQuery(selector).unbind(options.on);}};var prototypeUnbind=function(selector,options,callback){$$(selector).each(function(el){Event.stopObserving(el,options.on);});};if(jquery){if(jQuery.fn.on){unbind=jQueryUnbind;}else{unbind=oldJQueryUnbind;}}else{unbind=prototypeUnbind;}
return unbind(selector,options,callback);};var sendBeacon=function(options){var formData=new FormData();for(var key in options.data){if(options.data.hasOwnProperty(key)){formData.append(key,options.data[key]);}}
navigator.sendBeacon(options.url,formData);};var ajax=function(ajaxOptions){if(ajaxOptions.useBeacon&&navigator.sendBeacon){ajax=sendBeacon;}else if(jquery){ajax=jQuery.ajax;}else{ajax=function(options){options.parameters=options.data;new Ajax.Request(options.url,options);}}
ajax(ajaxOptions);};var defaultFire=function(options,data){var ajaxSettings=extend(extend({},defaultAjaxSettings),options.ajaxSettings);ajaxSettings.data=extend(extend({},ajaxSettings.data),data);ajax(ajaxSettings);};var defaultOptions={on:'mouseup',fire:defaultFire,acceptEvent:function(e){return e.which===1||e.which===2;},data:{}};var methods={setup:function(options){if(options.fire!==undefined){defaultFire=options.fire;}
if(options.options!==undefined){defaultOptions=extend(extend({},defaultOptions),options.options);}
if(options.ajax!==undefined){defaultAjaxSettings=extend(extend({},defaultAjaxSettings),options.ajax);}},init:function(el){each(elements=el,function(selector,options){if(Object.prototype.toString.call(options)==='[object Array]'){var array=options;for(var i=0;i<array.length;++i){options=array[i];options=extend(extend({},defaultOptions),options);if(options.fire!==undefined){bind(selector,options,methods.onEvent);}}}else{options=extend(extend({},defaultOptions),options);if(options.fire!==undefined){bind(selector,options,methods.onEvent);}}});return this;},destroy:function(){elements.each(function(selector,options){unbind(selector,options.on,options.fire);});return this;},onEvent:function(event,options){if(options==undefined){options=event.data;}
var data=options.data;if(typeof options.acceptEvent=='function'&&!options.acceptEvent(event)){return true;}
var addData=options.addData;if(typeof addData=='function'){try{extend(data,addData.call(event.target,options,event));}catch(ex){if(console&&console.log){console.log('Failed to extract data:'+ex);return;}}}
options.fire(options,data);return true;}};Track=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}};})();
(function(){window.TrackPageTransitions=function(Track,$,o){o=o||{};var $elements=$('*[data-track]');if(!$elements.length){return;}
Track('setup',{ajax:{url:o.url||'/action/analytics',method:'POST',useBeacon:true}});var captureAllPageTransitions=$('html[data-track]').length!=0;Track({body:[{on:'mousedown keydown',selector:captureAllPageTransitions?'a[href]':'*[data-track] a[href], a[href][data-track]',addData:extractData,acceptEvent:function(e){return e.which==1||e.keyCode==13;},data:{EventType:'PageTransition'}},{on:'submit',selector:captureAllPageTransitions?'form':'*[data-track] form, form[data-track]',addData:extractData,data:{EventType:'PageTransition'}}]});};if(typeof Track!='undefined'){if(typeof jQuery!='undefined'){jQuery(document).ready(function(){TrackPageTransitions(Track,jQuery);});}else if(typeof window.Prototype!='undefined'){document.observe('dom:loaded',function(){TrackPageTransitions(Track,$$);});}}
function collectData(el){var d={};$.each(el.attributes,function(i,attrib){var name=attrib.name;if(name.indexOf('data-')==0){name=name.substring("data-".length);name=name.replace(/-([a-z])/g,function(g){return g[1].toUpperCase();});d[name]=attrib.value;}});return d;}
function extractData(options,event){var data={};var $html=$(document.documentElement);var requestId=$html.data('requestId');if(requestId){data.OriginRequestId=requestId;data.OriginUrl=window.location.href;var date=new Date();date.setTime(date.getTime()+60*1000);var expires=date.toGMTString();document.cookie='OriginRequestId='+requestId+'; expires='+expires+"; path=/";}
var $this=$(this);var href;if($this.is("a")){data.LinkText=$this.text();href=$this.attr('href');}else if($this.is("form")){href=$this.attr('action');}
if(href){data.LinkHref=href;if(href.indexOf('/doi/')!=-1){data.doi=href.split("/doi/")[1];}}
var innerFound=false;$.each($this.add($this.parents()),function(){var $ancestor=$(this);var d=null;try{d=$ancestor.data();}catch(ex){d=false;}
if(d===false){d=collectData($ancestor.get(0));}
for(var property in d){if(d.hasOwnProperty(property)&&property.indexOf("track")==0){var name=property.substring("track".length);if(name=="Func"&&d[property]){var func=window[d[property]];if($.isFunction(func)){try{var extra=func.call($ancestor);if(extra){$.extend(data,extra);}}catch(ex){}}
continue;}
if(name.length){data['Track'+name]=d[property];}
if(!innerFound){innerFound=true;if($this.is('a')){var linkIndex=$('a[href*="/doi"], a[href*="/loi"], a[href*="/toc"]',$ancestor).index($this);if(linkIndex>-1){data.LinkIndex=linkIndex+1;}}}}}});if(event.which==1){data.ClickPageX=event.pageX;data.ClickPageY=event.pageY;}
return data;}})();
(function(){var TrackSearchResults=function(Track,$,undefined){var $searchResults=$('.searchResultContainer, #frmSearchResults, #frmSearch, #searchResultsAll, #searchResults, .searchResult, .search-result, #searchResultContent');if(!$searchResults.length){return;}
Track('setup',{ajax:{url:'/action/analytics',useBeacon:true}});var resultSelectorAction={selector:'a[href^="/doi"], a[href^="/article"]',addData:extractDataSearchResult,data:{EventType:'SearchResultClicked'}};Track({'.searchResultContainer .articleLinks, #frmSearch .articleEntry td, .searchResultsListing li':resultSelectorAction,'#searchResultsAll .articleEntry td, #searchResults .searchResultItem .articleInfo':resultSelectorAction,'#frmSearchResults .articleEntry td, #frmSearchResults .articleEntry div, #frmSearchResults .searchResultItem span':resultSelectorAction,'#frmSearchResults .searchResultItem .atcl-item, #frmSearchResults .searchResultItem div':resultSelectorAction,'#frmSearchResults .searchEntry .searchEntryTools, .searchResult .result-list li':resultSelectorAction,'.contentContainer .searchResult td, .search-result .items-results li span':resultSelectorAction,'#frmSearch .article-details, #frmSearchResults .search-results .search-result-item':resultSelectorAction,'#searchResultContent .o-results .m-result, #frmSearchResults .search-results .articleBox, .search-result .items-results .issue-item_metadata':resultSelectorAction});};if(typeof Track!='undefined'){if(typeof jQuery!='undefined'){jQuery(document).ready(function(){TrackSearchResults(Track,jQuery);});}else if(typeof window.Prototype!='undefined'){document.observe('dom:loaded',function(){TrackSearchResults(Track,$$);});}}
function extractCommonData(data,options,event){var $this=$(this);var searchResultRows;var clickedRow;var $searchResultRow=$this.closest('#searchResultItems, .search-results, .searchEntry, .contentContainer, #frmSearch, #frmSearchResults, #searchResultContent .o-results, .search-result');if($searchResultRow.length){searchResultRows=$searchResultRow.find('.articleEntry, .searchResultItem, .searchEntry, .article-details, .search-result-item, .m-result, .articleBox, .issue-item');clickedRow=$this.closest('.articleEntry, .searchResultItem, .searchEntry, .article-details, .search-result-item, .m-result, .articleBox, .issue-item');}else{$searchResultRow=$this.closest('.searchResultsListing, .result-list, .items-results');if($searchResultRow.length){searchResultRows=$searchResultRow.children('li');clickedRow=$this.closest('li');}}
if(searchResultRows.length&&clickedRow.length){data.searchPageRank=searchResultRows.index(clickedRow)+1;}
var $container=$this.closest('.searchResultContainer, .type-search-results, .searchNav, .searchResult, .search-result, #searchResultContent');if(!$container.length){$container=$('.searchResults_paging, .searchResultsCont, .searchResults');}
if($container.length){var $selectedPage=$container.find('.pages .selected:first, .pages .activeLink:first, .pages .current:first, .searchPages .activeLink:first, .pagination .activeLink:first, .pagination .active:first, .pageLinks .selected:first, .paginationLinks .s-active:first');if($selectedPage.length){data.resultPageNum=parseInt($selectedPage.text());}else{var $paginationElements=$container.find('.paginationControls, .paginationLinks').first().find('li:not(:has(a))');if($paginationElements.length){$paginationElements.each(function(){var $innerMostChildOfPagination=$(this).children();while($innerMostChildOfPagination.length){$innerMostChildOfPagination=$innerMostChildOfPagination.children();}
$selectedPage=$.trim($innerMostChildOfPagination.end().text());if($selectedPage.length&&isInt($selectedPage)){data.resultPageNum=parseInt($selectedPage);return false;}});}}}
if(!data.resultPageNum){var startPageFromSearchForm=$('#searchResultsAll, #frmSearch, #frmSearchResults').find('input[name=startPage]');if(startPageFromSearchForm.length){data.resultPageNum=parseInt(startPageFromSearchForm.val())+1;}}}
function isInt(n){return parseInt(n)+0===parseInt(n);}
function extractDataSearchResult(options,event){var data={};var $this=$(this);var $articleEntry=$this.closest('.articleEntry, .searchResultItem, .articleCitation, .m-result');if($articleEntry.length){data.doi=$articleEntry.find(':input[name="doi"]').val();if(!data.doi){data.pii=$articleEntry.find(':input[name="pii"]').val();}}
if(!data.doi&&!data.pii){var href=$this.attr('href');if(typeof href=='undefined'){var link=$this.closest('a');href=link.attr('href');}
if(href.includes("doi")){var doi=href.split("/doi/")[1];var doiPattern=new RegExp('^10\\.\\d\\d\\d\\d(\\d*)/(.+)');if(doiPattern.test(doi)){data.doi=doi;}else{data.doi=doi.substring(doi.indexOf('/')+1);}}else if(href.includes("article/")){var pii=href.split("/article/")[1];data.pii=pii.substring(0,pii.indexOf("/"));}}
extractCommonData.call(this,data,options,event);return data;}
function extractDataForPagination(options,event){var data={};var $this=$(this);var page=$this.text();if(page){data.SearchResultsPageClicked=page;}
extractCommonData(data,options,event);return data;}})();/*!
     * minjs
     * v2.0.6
     * https://github.com/13twelve/min.js
     * http://www.thirteentwelve.com/minjs/test/test.html (tests)
     *
     * Released under the MIT license
     *
     * Date: 2015-12-02
     *//*! npm.im/object-fit-images 3.2.3 */
(function(){window.UX={};(function(){var controller={$body:$('body'),active:null,escape:27,enabled:false,$activeComponent:null,$container:null,$target:null,init:function init(){controller.control();controller.extra();controller.check();controller.extra();},control:function control(){$(document).on('keydown',function(e){if((e.keyCode||e.which)===controller.escape){controller.check(e);}});},check:function check(e){controller.active=controller.$body.attr('data-active');if(controller.active!=null){controller.disable(e);}},disable:function disable(e){if(typeof UX[controller.active].$controller!=='undefined'){UX[controller.active].$controller.focus();}
UX[controller.active].on.hide(e);},extra:function extra(){controller.$body.on("click focusout",function(e){if(e.type==='focusout'&&e.target!==e.relatedTarget){if(e.relatedTarget!==null){e.target=e.relatedTarget;}}
controller.active=controller.$body.attr('data-active');controller.$activeComponent=typeof UX[controller.active]!=="undefined"?UX[controller.active]:"undefined";if(typeof controller.$activeComponent!=="undefined"&&typeof controller.$activeComponent.$section!=="undefined"&&typeof controller.$activeComponent.$controller!=="undefined"){controller.$container=controller.$activeComponent.$section;controller.$target=controller.$activeComponent.$controller;controller.checkToHide(e);}});},checkToHide:function checkToHide(e){if(!controller.$container.is(e.target)&&controller.$container.has(e.target).length===0&&!controller.$target.is(e.target)&&controller.$target.has(e.target).length===0&&!$(e.target).closest(".ui-autocomplete").length){controller.$activeComponent.on.hide(e);}}};UX.controller=controller;})();(function(){var $section=$('.figure-viewer'),$window=$(window),$document=$(document),$body=$('body');var figureViewer={options:{filter:false,filterClass:'article__tabFigure'},$topRegHeight:$('.figure-viewer__reg__top').innerHeight(),vPort:"screen-md",$figures:null,$figuresToShow:null,$figureWidth:null,$currentIndex:null,$focusedElementBeforeOpened:null,$section:$section,$holder:$section.find('.figure-viewer__hold__fig'),$holderElement:$section.find('.figure-viewer__hold__fig').find('figure'),$captionHolder:$section.find('.figure-viewer__hold__figcap'),$lister:$section.find('.figure-viewer__hold__list'),$captionRegion:$section.find('.figure-viewer__cent__right'),$contentRegion:$section.find('.figure-viewer__cent__left'),$figureNav:$section.find('.figure-viewer__ctrl__next, .figure-viewer__ctrl__prev'),$zoominbtn:$section.find('.zoom-in'),$zoomoutbtn:$section.find('.zoom-out'),$zoomrange:$section.find('.zoom-range'),$zoomreset:$section.find('.reset'),$image:$section.find('figure'),$browsebtn:$('.figure-viewer__ctrl__browse'),$returnbtn:$('.figure-viewer__ctrl__return'),isMobile:false,islocked:false,offsetY:window.pageYOffset,$hideList:$('.zoomSlider, .figure-viewer__label__zoom'),$browseContainer:$('.figure-viewer__hold__list'),expand:function expand(){if(figureViewer.options.filter){figureViewer.$figures=$document.find(':not(.figure-viewer__hold__list) > figure:not(.holder), :not(.figure-viewer__hold__list) > .figure:not(.holder)');}else{figureViewer.$figures=$document.find('figure:not(.holder), .figure:not(.holder)');}
figureViewer.$figures.each(function(index){var $this=$(this);$this.data('index',index);if(figureViewer.options.filter){$this.addClass('figure');if(figureViewer.options.filter==='dataRel'){var dataRelElement=$this.find('[data-rel]');if(dataRelElement.length>0&&dataRelElement.data().rel){$this.attr('data-rel',dataRelElement.data().rel);}}}});},filter:function filter($this){if(figureViewer.options.filter==='classCombination'){var className=$this.attr('class');figureViewer.$figuresToShow=figureViewer.$figures.filter('[class="'+className+'"]');}else if(figureViewer.options.filter==='className'){figureViewer.$figuresToShow=figureViewer.$figures.filter('.'+figureViewer.options.filterClass);}else if(figureViewer.options.filter==='dataRel'){var dataRel=$this.data('rel');if(dataRel){figureViewer.$figuresToShow=figureViewer.$figures.filter('[data-rel="'+dataRel+'"]');}else{figureViewer.$figuresToShow=figureViewer.$figures;}}else{figureViewer.$figuresToShow=figureViewer.$figures;}
figureViewer.$currentIndex=figureViewer.$figuresToShow.index($this);},control:function control(){$(document).on(figureViewer.vPort+'-on',function(){figureViewer.isMobile=true;});$(document).on(figureViewer.vPort+'-off',function(){figureViewer.isMobile=false;});figureViewer.clickHandler();var $figureViewer=$body.find('.figure-viewer');var $controllerElement=$figureViewer.find('a, button');$controllerElement.each(function(){var $this=$(this);$this.on({click:function click(event){event.preventDefault();event.stopPropagation();if($this.hasClass('figure-viewer__ctrl__close')){figureViewer.on.hide();}else if($this.hasClass('figure-viewer__ctrl__next')){figureViewer.next();}else if($this.hasClass('figure-viewer__ctrl__prev')){figureViewer.prev();}else if($this.hasClass('figure-viewer__ctrl__caption')){figureViewer.captionToggle($this);}else if($this.hasClass('figure-viewer__ctrl__browse')){figureViewer.browse($(this));}else if($this.hasClass('figure-viewer__ctrl__return')){figureViewer.return($(this));}}});});if(figureViewer.options.filter){$(".figure a:not(.open-figure-link)").click(function(e){var $img=$(this).find("img");shouldDefault=$(this).hasClass('linkBehavior');if(!shouldDefault||$img.length!==0){e.preventDefault();$img.trigger("click");}});$(".figure a:not(.open-figure-link) img").click(function(e){e.stopPropagation();});}else{$(".figure a:not('.ppt-figure-link')").click(function(e){var $img=$(this).find("img");shouldDefault=$(this).hasClass('linkBehavior');if(!shouldDefault||$img.length!==0){$img.trigger("click");}});}
$('body').keydown(function(event){if($body.attr('data-active')!=='figureViewer'){return;}
if(event.keyCode===37){figureViewer.prev();}else if(event.keyCode===39){figureViewer.next();}});figureViewer.supplementary.control();figureViewer.hideOnClickOutside();figureViewer.resize();$(window).on('resized',function(){figureViewer.resize();});if(figureViewer.$figures.length==1){figureViewer.$figureNav.hide();}
$(".figure-viewer__ctrl__caption").focusout(function(){$('.figure-viewer__ctrl__close').focus();});},hideOnClickOutside:function hideOnClickOutside(){figureViewer.$image.on('click',function(e){var img_clicked=$(e.target).is("img");if(!img_clicked){figureViewer.on.hide();}});},clickHandler:function clickHandler(){$(document).on("click",'.figure__image, .open-figure-link',function(event){event.preventDefault();var $this=$(this).closest('figure, .figure, .imageTable');if(!$this.hasClass('ui-disabled')&&!$this.closest('.figure-viewer__hold__fig').length){figureViewer.on.show($this,$this.data('index'));}});},captionToggle:function captionToggle($elem){figureViewer.toggle($elem.closest('.figure-viewer__cent__right'));figureViewer.toggle($('.figure-viewer__cent__left'));$elem.toggleClass('js-open');},next:function next(){if(!figureViewer.options.filter){figureViewer.$figuresToShow=figureViewer.$figures;}
if(figureViewer.$currentIndex<figureViewer.$figuresToShow.length-1){if(!figureViewer.$figuresToShow.eq(figureViewer.$currentIndex+1).closest('.figure-viewer').length){figureViewer.$currentIndex++;var $next=figureViewer.$figuresToShow.eq(figureViewer.$currentIndex);figureViewer.replace($next);figureViewer.zoom.reset();}}else{figureViewer.$currentIndex=0;var $next=figureViewer.$figuresToShow.eq(figureViewer.$currentIndex);figureViewer.replace($next);figureViewer.zoom.reset();}},prev:function prev(){if(!figureViewer.options.filter){figureViewer.$figuresToShow=figureViewer.$figures;}
if(figureViewer.$currentIndex>=1){if(!figureViewer.$figuresToShow.eq(figureViewer.$currentIndex-1).closest('.figure-viewer').length){figureViewer.$currentIndex--;var $prev=figureViewer.$figuresToShow.eq(figureViewer.$currentIndex);figureViewer.replace($prev);figureViewer.zoom.reset();}}else{figureViewer.$currentIndex=figureViewer.$figuresToShow.length-1;var $prev=figureViewer.$figuresToShow.eq(figureViewer.$currentIndex);figureViewer.replace($prev);figureViewer.zoom.reset();}},replace:function replace(element){var $figure=element.find('.figure__image').clone();$figure.each(function(){var $this=$(this);$this.attr('src',$this.attr('data-lg-src'));});if($figure.length>1){$figure=figureViewer.supplementary.show(element,$figure);}else{figureViewer.supplementary.hide();}
var $caption=element.find('figcaption, .figcaption').clone();var $title=$caption.find('strong').remove();$('.figure-viewer__title__text').text($title.text());figureViewer.$holder.find('img').remove();figureViewer.$holder.find('figure').append($figure);figureViewer.$captionHolder.empty();$caption=figureViewer.additionalBehaviorOnShow(element);figureViewer.$captionHolder.append($caption);figureViewer.$captionHolder.find('.figure__title').remove();figureViewer.$figureWidth=figureViewer.$holder.find('img').width();figureViewer.zoom.check();},supplementary:{nav:null,show:function show(element,$figure){var index=this.check(element);var $thumbnails=$figure.clone();var self=this;if(!this.nav){this.nav=$('<ul class="figure-viewer__hold__supplementary-nav"></ul>');this.nav.appendTo(figureViewer.$section);}
this.nav.empty();$thumbnails.each(function(index){var $thumb=$('<li><a href="#" title="Go to figure image '+(index+1)+'. of current figure."></a></li>');$thumb.find('a').append(this);$thumb.find('a').on('click',function(event){event.preventDefault();self.toIndex(element,index);});self.nav.append($thumb);});this.nav.find('li').eq(index).addClass('active');return $figure.eq(index);},hide:function hide(){if(this.nav){this.nav.empty();}},save:function save(element,index){element.data('figure-viewer-display',index);},check:function check(element){return element.data('figure-viewer-display')||0;},toIndex:function toIndex(element,index){var $images=element.find('img');if($images.length===1){return;}
if(index>=$images.length){index=0;}
if(index<0){index=$images.length-1;}
figureViewer.$holder.find('img').remove();figureViewer.$holderElement.append($images.eq(index).clone());this.nav.find('li').removeClass('active');this.nav.find('li').eq(index).addClass('active');this.save(element,index);},next:function next(element){var index=this.check(element)+1;this.toIndex(element,index);},prev:function prev(element){var index=this.check(element)-1;this.toIndex(element,index);},control:function control(){$('body').keydown(function(event){if($body.attr('data-active')!=='figureViewer'){return;}
if(!figureViewer.options.filter){figureViewer.$figuresToShow=figureViewer.$figures;}
if(figureViewer.$figuresToShow&&figureViewer.$figuresToShow.length<1){return;}
var element=figureViewer.$figuresToShow.eq(figureViewer.$currentIndex);if(event.keyCode===38){figureViewer.supplementary.prev(element);}else if(event.keyCode===40){figureViewer.supplementary.next(element);}});}},browse:function browse(element){figureViewer.$holder.addClass('is-hidden');figureViewer.$figureNav.addClass('is-hidden');figureViewer.$browsebtn.addClass('is-hidden');figureViewer.$returnbtn.removeClass('is-hidden');figureViewer.$captionRegion.removeClass('js-open');figureViewer.$contentRegion.removeClass('js-open');figureViewer.$captionRegion.addClass('is-hidden');figureViewer.$hideList.each(function(){$(this).addClass('is-hidden');});figureViewer.$lister.removeClass('is-hidden');figureViewer.supplementary.hide();figureViewer.$browseContainer.empty();if(figureViewer.options.filter){figureViewer.$figuresToShow.each(function(){var $fig=$(this).clone(true);var $figureExtra=$fig.find(".figure-extra");if($figureExtra.length){$figureExtra.remove();}
figureViewer.$browseContainer.append($fig);});}else{figureViewer.$figures.each(function(){if($(this).hasClass('article__tabFigure')){var $fig=$(this).clone(true);var $figureLinks=$fig.find(".figure-links");if($figureLinks.length){$figureLinks.remove();}
figureViewer.$browseContainer.append($fig);}});}
figureViewer.additionalBrowse();},additionalBrowse:function additionalBrowse(){},return:function _return(){figureViewer.$holder.removeClass('is-hidden');figureViewer.$figureNav.removeClass('is-hidden');figureViewer.$browsebtn.removeClass('is-hidden');figureViewer.$returnbtn.addClass('is-hidden');figureViewer.$captionRegion.removeClass('is-hidden');figureViewer.$hideList.each(function(){$(this).removeClass('is-hidden');});figureViewer.$lister.addClass('is-hidden');$('.figure-viewer__title__text').removeClass("figure-viewer__title__text__allfigures");$('.figure-viewer__title__text').parent(".figure-viewer__ctrl").removeClass("allfigures__is__displayed");$('.figure-viewer__ctrl__caption').parent(".figure-viewer__ctrl").show();figureViewer.$browseContainer.empty();figureViewer.additionalReturn();},additionalReturn:function additionalReturn(){},height:function height(element){var $windowsHeight=$(window).innerHeight();figureViewer.$topRegHeight=$('.figure-viewer__reg__top').innerHeight();var $height=$windowsHeight-figureViewer.$topRegHeight-$('.figure-viewer__caption__label').innerHeight();$('.figure-viewer__cent__left').find('figure').height($height);},toggle:function toggle(element){element.toggleClass('js-open');figureViewer.figcaptionSize();},displayViewer:function displayViewer(){$('.figure-viewer').show();},additionalShow:function additionalShow(){},on:{show:function show($this,index){figureViewer.offsetY=$body.data('yoffset')||window.pageYOffset;$body.data('yoffset',figureViewer.offsetY);if(typeof UX.controller!=='undefined'){if($body.attr('data-active')!=='slide'){UX.controller.check();}}
$body.attr('data-active','figureViewer');figureViewer.islocked=true;figureViewer.$currentIndex=index;figureViewer.replace($this);figureViewer.$focusedElementBeforeOpened=document.activeElement;figureViewer.displayViewer();$body.css('overflow','hidden');figureViewer.height();figureViewer.zoom.check();figureViewer.$holder.removeClass('is-hidden');figureViewer.$captionRegion.removeClass('is-hidden');figureViewer.$browsebtn.removeClass('is-hidden');figureViewer.$returnbtn.addClass('is-hidden');figureViewer.$figureNav.removeClass('is-hidden');figureViewer.$hideList.each(function(){$(this).removeClass('is-hidden');});figureViewer.$lister.addClass('is-hidden');$('.figure-viewer__ctrl__close').focus();if(figureViewer.options.filter){figureViewer.filter($this);}
figureViewer.additionalShow();},hide:function hide(){if(figureViewer.islocked){$body.removeAttr('data-active');}else{$body.removeClass('lock-screen').removeAttr('data-active');}
figureViewer.zoom.reset();$('.figure-viewer').hide();figureViewer.$focusedElementBeforeOpened.focus();$body.css('overflow','');$(window).scrollTop(figureViewer.offsetY);$body.removeData('yoffset');}},additionalBehaviorOnShow:function additionalBehaviorOnShow($el){return $el.find('figcaption, .figcaption').clone();},zoom:{reset:function reset(){$elem=$('.figure-viewer').find('figure');$elem.panzoom('reset');},check:function check(){figureViewer.zoom.panzoom.init();if($window.width()<992){figureViewer.zoom.swap();}},panzoom:{init:function init(){if(typeof $.fn.panzoom!='undefined'){figureViewer.$image.panzoom({$zoomIn:figureViewer.$zoominbtn,$zoomOut:figureViewer.$zoomoutbtn,$zoomRange:figureViewer.$zoomrange,$reset:figureViewer.$zoomreset,panOnlyWhenZoomed:true,minScale:1});figureViewer.$image.on('panzoomchange',function(e){if(figureViewer.$zoomrange.val()==='1'){figureViewer.$image.css('transform','matrix(1, 0, 0, 1, 0, 0)');$(this).removeClass('zoomed');}else{$(this).addClass('zoomed');}});}}},swap:function swap(){figureViewer.$section.find('img').swipe({swipe:function swipe(event,direction,distance,duration,fingerCount,fingerData){if(direction==='left'&&!figureViewer.$section.find('figure').hasClass('zoomed')){figureViewer.next();}else if(direction==='right'&&!figureViewer.$section.find('figure').hasClass('zoomed')){figureViewer.prev();}}});}},slide:function slide(){var $target=$body.find('div.ux3-in-slide');$body.removeAttr('data-ux3-show');setTimeout(function(){$target.append($slide.children('div'));$target.removeClass('ux3-in-slide');},250);},resize:function resize(){var wHeight=$window.innerHeight();if(figureViewer.isMobile){$('.figure-viewer__reg__center').css('height',wHeight);}else{$('.figure-viewer__reg__center').css('height','100%');}},figcaptionSize:function figcaptionSize(){var $figcaption=$('.figure-viewer__hold__figcap').find('figcaption'),figure_area_height=$('.figure-viewer__reg__center').height(),figure_title_height=$('.figure-viewer__title').height()+30,padding=30;$figcaption.css('max-height',figure_area_height-2*padding-figure_title_height);},doubleTap:function doubleTap(){(function($){$.fn.nodoubletapzoom=function(){$(this).bind('touchstart',function preventZoom(e){var t2=e.timeStamp;var t1=$(this).data('lastTouch')||t2;var dt=t2-t1;var fingers=e.originalEvent.touches.length;$(this).data('lastTouch',t2);if(!dt||dt>500||fingers>1){return;}
e.preventDefault();$(e.target).trigger('click');});};})(jQuery);},init:function init(){figureViewer.expand();figureViewer.control();figureViewer.doubleTap();$('body').nodoubletapzoom();}};UX.figureViewer=figureViewer;})();(function(){if(UX.figureViewer){UX.figureViewer.options.filter='dataRel';}})();function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj;};}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}
return _typeof(obj);}
(function(d){var A17=window.A17||{},de=d.documentElement,w=window,h=d.getElementsByTagName('head')[0],s;A17.browserSpec=_typeof(d.querySelectorAll)&&'addEventListener'in w&&w.history.pushState&&d.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure','1.1')?'html5':'html4';A17.touch='ontouchstart'in w||w.documentTouch&&d instanceof DocumentTouch?true:false;function isIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf('.',msie)),10);}
var trident=ua.indexOf('Trident/');if(trident>0){var rv=ua.indexOf('rv:');return parseInt(ua.substring(rv+3,ua.indexOf('.',rv)),10);}
var edge=ua.indexOf('Edge/');if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf('.',edge)),10);}
return false;}
window.A17=A17;de.className=de.className.replace(/\bno-js\b/,' js '+A17.browserSpec+(A17.touch?' touch':' no-touch')+(isIE()?' isIE ie'+isIE():''));function disableSS(){if(/in/.test(d.readyState)){setTimeout(disableSS,9);}else{for(var i=0;i<d.styleSheets.length;i++){var ss=d.styleSheets[i];if(ss.title!=='html4css'){ss.disabled=true;}}}}
function disableSSff3(){if(!d.readyState&&d.addEventListener){if(d.body){setTimeout(function(){d.readyState='complete';},500);}else{setTimeout(disableSSff3,9);}}}
if(A17.browserSpec==='html4'){s=d.createElement('link');s.rel='stylesheet';s.title='html4css';s.href='/pb-assets/styles/html4css.css';h.appendChild(s);s=d.createElement('script');s.src='//legacypicturefill.s3.amazonaws.com/legacypicturefill.min.js';h.appendChild(s);disableSSff3();disableSS();}else{s=d.createElement('script');s.src='//cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js';h.appendChild(s);}})(document);var A17$1=window.A17||{};if(!A17$1.browserSpec||A17$1.browserSpec==='html4'){throw new Error('HTML4');}
A17$1.Behaviors={};A17$1.Helpers={};A17$1.Functions={};A17$1.currentMediaQuery='large';A17$1.activeBehaviors={};A17$1.previousAjaxPageLoadType=null;A17$1.windowHash=window.location.hash?window.location.hash.replace('#',''):null;A17$1.onReady=function(){A17$1.currentMediaQuery=A17$1.Helpers.getCurrentMediaQuery();A17$1.Helpers.resized();A17$1.Functions.windowHashOnLoad();A17$1.Functions.navPrimaryToggle();A17$1.Functions.searchToggle();A17$1.Functions.searchFiltersToggle();A17$1.Functions.lockBody();A17$1.Functions.history();A17$1.Functions.ajaxPageLoad();A17$1.Functions.loadProgressBar();A17$1.Functions.ajaxPageLoadMaskToggle();A17$1.Functions.modal();A17$1.Functions.leaderBoard();objectFitImages();A17$1.Helpers.manageBehaviors();};document.addEventListener('DOMContentLoaded',function(){A17$1.onReady();});if(typeof console==='undefined'){window.console={log:function log(){return;}};}
A17.Behaviors.AddRemoveDefListItem=function(container){var items_container=container.querySelector("[data-items]");var items=container.querySelectorAll("[data-item]");var remove_btns=container.querySelectorAll("[data-remove]");var add_item=container.querySelector("[data-add]");var template=document.getElementById("template__IPAdress");var name_placeholder=container.getAttribute("data-placeholder-name");function _addItem(e){e.preventDefault();var data=template.innerHTML;items_container.insertAdjacentHTML('beforeend',data);_callbackUpdate();}
function _removeItem(e){e.preventDefault();var btn=e.currentTarget;var id=btn.getAttribute("data-remove");_forEach(items,function(item,i){var item_id=item.getAttribute('data-item');if(item_id===id)items_container.removeChild(item);});_callbackUpdate();}
function _callbackUpdate(){items=container.querySelectorAll("[data-item]");_forEach(items,function(item,i){item.setAttribute('data-item',i);var remove_btn=item.querySelector("[data-remove]");if(remove_btn){remove_btn.setAttribute('data-remove',i);remove_btn.removeEventListener('click',_removeItem);remove_btn.addEventListener('click',_removeItem,false);}
var fields=item.querySelectorAll("[data-type]");if(fields.length){_forEach(fields,function(field,j){var type=field.getAttribute('data-type');field.setAttribute('name',name_placeholder.replace(/{{id}}/g,i).replace(/{{type}}/g,type));});}});}
function _forEach(array,callback,scope){for(var i=0;i<array.length;i++){callback.call(scope,array[i],i);}}
function _init(){if(add_item)add_item.addEventListener('click',_addItem,false);_forEach(remove_btns,function(remove_btn,i){remove_btn.addEventListener('click',_removeItem,false);});}
this.destroy=function(){if(add_item)add_item.removeEventListener('click',_addItem);_forEach(remove_btns,function(remove_btn,i){remove_btn.removeEventListener('click',_removeItem);});A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.AdvancedSearchToggle=function(container){function _handleClicks(event){event.preventDefault();container.blur();min$(document).trigger('search:advanced:toggle');}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.AjaxFormSubmit=function(container){var action=container.action;var ajaxing=false;function _removeErrors(){min$('.a-error-msg',container).each(function(){this.parentNode.removeChild(this);});min$('.s-error',container).removeClass('s-error');ajaxing=false;}
function _success(msg){min$('.a-btn',container).removeClass('a-loader');ajaxing=false;var legend=container.querySelector('legend');if(legend)legend.textContent=msg;container.classList.add('s-success');setTimeout(function(){min$(document).trigger('modal:hide');},5000);min$(document).trigger('ajaxFormSubmit:success');}
function _error(){min$('.a-btn',container).removeClass('a-loader');ajaxing=false;container.classList.add('s-error');setTimeout(function(){min$(document).trigger('modal:hide');},5000);}
function _submit(event){event.preventDefault();if(ajaxing){return;}
ajaxing=true;min$('.a-btn[type=submit]',container).addClass('a-loader');_removeErrors();A17.Helpers.ajaxRequest({url:action,type:'POST',requestHeaders:[{header:'X-CSRF-Token',value:min$('meta[name=\'csrf-token\']').attr('content')}],data:A17.Helpers.objectifyForm(container),onSuccess:function onSuccess(data){try{data=JSON.parse(data);_success(data.successMessage);}catch(err){}},onError:function onError(data){_error();}});}
function _init(){container.addEventListener('submit',_submit,false);}
this.destroy=function(){container.removeEventListener('submit',_submit);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.AnchorBannerHide=function(container){function _init(){document.documentElement.classList.add('s-anchor-banner-visible');window.setTimeout(function(){document.documentElement.classList.remove('s-anchor-banner-visible');setTimeout(function(){container.parentNode.removeChild(container);},251);},parseInt(container.getAttribute('data-anchorBannerHide-time')*1000)||6000);}
this.destroy=function(){A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ArticleTools=function(container){var isASubNavOpen=false;function _closeSubnav(){min$('.m-article-tools__nav-item.s-active',container).removeClass('s-active');isASubNavOpen=false;min$(document).trigger('articleTools:subnav:closed');}
function _openSubnav(el){min$('.m-article-tools__nav-item.s-active',container).removeClass('s-active');el.parentNode.classList.add('s-active');isASubNavOpen=true;min$(document).trigger('tooltip:hide');min$(document).trigger('articleTools:subnav:opened');}
function _toggleSubnav(event){event.preventDefault();event.stopPropagation();this.blur();if(this.parentNode.classList.contains('s-active')){_closeSubnav();}else{_openSubnav(this);}}
function _keyPress(event){event.preventDefault();if(event.keyCode===13){_toggleSubnav();}}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(isASubNavOpen&&event.keyCode===27&&!isInput){_closeSubnav();}}
function _clicksOutside(event){if(isASubNavOpen&&document.activeElement!==container&&!container.contains(document.activeElement)){event.preventDefault();event.stopPropagation();_closeSubnav();}}
function _clicksInside(event){event.stopPropagation();}
function _init(){min$(document).on('click',_clicksOutside);min$(document).on('touchstart',_clicksOutside);min$(document).on('articleTools:subnav:close',_closeSubnav);min$('[data-article-tool-subnav-toggle]',container).on('click',_toggleSubnav);min$('[data-article-tool-subnav-toggle]',container).on('click',_keyPress);min$('[data-article-tool-subnav-toggle]',container).on('touchstart',_toggleSubnav);min$('[data-article-tool-subnav-toggle]',container).on('touchstart',_keyPress);min$('.m-article-tools__subnav a',container).on('click',_clicksInside);min$('.m-article-tools__subnav a',container).on('touchstart',_clicksInside);min$(window).on('keyup',_escape);}
this.destroy=function(){min$(document).off('click',_clicksOutside);min$(document).off('touchstart',_clicksOutside);min$(document).off('articleTools:subnav:close',_closeSubnav);min$('[data-article-tool-subnav-toggle]',container).off('click',_toggleSubnav);min$('[data-article-tool-subnav-toggle]',container).off('click',_keyPress);min$('[data-article-tool-subnav-toggle]',container).off('touchstart',_toggleSubnav);min$('[data-article-tool-subnav-toggle]',container).off('touchstart',_keyPress);min$('.m-article-tools__subnav a',container).off('click',_clicksInside);min$('.m-article-tools__subnav a',container).off('touchstart',_clicksInside);min$(window).off('keyup',_escape);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ArticleToolsContents=function(container){var articleSections={};var linksHtml='\n';var budge=0;var fixedBoundingClientRect={};var throttle=0;var scrollTop=0;var lastScrollTop=-1;var checkInViewport=false;function _updateBudge(){budge=A17.currentMediaQuery.indexOf('large')>-1?79:10;}
function _generateLinks(){for(var item in articleSections){if(articleSections.hasOwnProperty(item)){linksHtml+='  <li><a href="#'+item+'" data-target-id="'+item+'" ';if(articleSections[item].interaction)linksHtml+=' data-interactionType="'+articleSections[item].interaction+'"';if(articleSections[item].tabName)linksHtml+=' data-tabName="'+articleSections[item].tabName+'"';linksHtml+='>'+articleSections[item].titleText+'</a></li>\n';}}}
function _insertLinks(){container.innerHTML=linksHtml;}
function _gather(){min$('[data-article-section-title]').each(function(el){fixedBoundingClientRect=A17.Helpers.getOffset(el);articleSections[el.id]={};articleSections[el.id].el=el;articleSections[el.id].titleText=el.getAttribute('data-article-section-title');articleSections[el.id].top=fixedBoundingClientRect.top;articleSections[el.id].bottom=fixedBoundingClientRect.bottom;articleSections[el.id].inViewport=false;if(min$('h2',el)&&min$('h2',el)[0]){articleSections[el.id].interaction=min$('h2',el)[0].getAttribute('data-interactionType');articleSections[el.id].tabName=min$('h2',el)[0].getAttribute('data-tabName');}});}
function _updateTopBottomValues(){_updateBudge();for(var item in articleSections){if(articleSections.hasOwnProperty(item)){fixedBoundingClientRect=A17.Helpers.getOffset(articleSections[item].el);articleSections[item].top=fixedBoundingClientRect.top;articleSections[item].bottom=fixedBoundingClientRect.bottom;}}}
function _handleClicks(event){if(event){event.preventDefault();event.stopPropagation();}
var targetID=this.getAttribute('data-target-id');var $target=document.getElementById(targetID);min$(document).trigger('history:replacestate',{url:'#'+targetID});var offsetTarget=A17.Helpers.getOffset($target).top-budge;A17.Helpers.scrollToY({el:document,offset:offsetTarget,duration:1000,easing:'easeInOut',onComplete:function onComplete(){A17.Functions.setFocusOnTarget($target);window.scrollTo(0,offsetTarget);min$(document).trigger('page:updated');}});min$(document).trigger('articleTools:subnav:close');min$($target).trigger('collapsible:open');}
function _startCheckingInViewport(){lastScrollTop--;checkInViewport=true;}
function _findVisible(){for(var item in articleSections){if(articleSections.hasOwnProperty(item)){var eleBounding=articleSections[item].el.getBoundingClientRect();var topMargin=/(xsmall|small|medium)/.test(A17.getCurrentMediaQuery)?10:85;if(eleBounding.top<topMargin&&eleBounding.bottom>80){if(!articleSections[item].inViewport){if(eleBounding.height<70){return;}
articleSections[item].inViewport=true;articleSections[item].el.classList.add('section-in-viewport');container.querySelector('[data-target-id='+item+']').classList.add('s-in-viewport');}}else{if(articleSections[item].inViewport){articleSections[item].inViewport=false;articleSections[item].el.classList.remove('section-in-viewport');container.querySelector('[data-target-id='+item+']').classList.remove('s-in-viewport');}}}}}
function _onScroll(){if(checkInViewport&&throttle===0){scrollTop=window.pageYOffset;if(scrollTop!==lastScrollTop){_findVisible();lastScrollTop=scrollTop;}}
throttle=throttle>4?0:throttle+1;window.requestAnimationFrame(_onScroll);}
function _init(){_gather();_generateLinks();_insertLinks();min$('a',container).on('click',_handleClicks);min$('a',container).on('touchstart',_handleClicks);min$('a',container).on('touchstend',_handleClicks);min$(document).on('page:updated',_updateTopBottomValues);min$(window).on('load',_updateTopBottomValues);min$(window).on('resized',_updateTopBottomValues);min$(document).on('page:updated',_updateTopBottomValues);min$(window).on('load',_startCheckingInViewport);min$('img').on('load',_updateTopBottomValues).each(function(){try{if(this.complete){this.load();}}catch(err){}});_updateTopBottomValues();window.requestAnimationFrame(_onScroll);}
this.destroy=function(){articleSections=[];linksHtml='';min$('a',container).off('click',_handleClicks);min$('a',container).off('touchstart',_handleClicks);min$('a',container).off('touchend',_handleClicks);min$(document).off('page:updated',_updateTopBottomValues);min$(window).off('load',_updateTopBottomValues);min$(window).off('resized',_updateTopBottomValues);min$(document).off('page:updated',_updateTopBottomValues);min$('img').off('load',_updateTopBottomValues);min$(window).off('load',_startCheckingInViewport);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.AudioPlayer=function(playerContainer){var klassActive='s-play--active';var klassMute='s-volume--mute';var player=playerContainer.querySelector('audio');var playBtn=playerContainer.querySelector('[data-audio-player-play]');var volumeBtn=playerContainer.querySelector('[data-audio-player-volume]');var currentTime=playerContainer.querySelector('[data-audio-player-current]');var endTime=playerContainer.querySelector('[data-audio-player-duration]');var progressbar=playerContainer.querySelector('[data-audio-player-progress] input');var progressbarDone=playerContainer.querySelector('[data-audio-player-done]');var volumeBar=playerContainer.querySelector('[data-audio-player-volume-slider] input');var duration=0;var progressMax=10000;var volume=localStorage.getItem('AudioPlayerVolume')||100;var isDragging=false;function _play(){if(player.paused){player.play();}
playBtn.classList.add(klassActive);}
function _pause(){if(!player.paused){player.pause();}
playBtn.classList.remove(klassActive);}
function _togglePlay(event){if(event){event.preventDefault();this.blur();}
if(!player.paused){_pause();}else{_play();}}
function _muted(){player.muted=true;volumeBtn.classList.add(klassMute);volumeBar.value=0;player.volume=0;}
function _unmute(){if(volume===0){volume=100;}
player.muted=false;volumeBtn.classList.remove(klassMute);volumeBar.value=volume;player.volume=volume/100;}
function _updateVolume(){volume=parseInt(volumeBar.value);if(volume===0){_muted();}else{_unmute();try{localStorage.setItem('AudioPlayerVolume',volume);}catch(err){}}}
function _toggleMute(event){if(event){event.preventDefault();this.blur();}
if(!player.muted){_muted();}else{_unmute();}}
function _resizeProgress(percent){progressbarDone.style.width=percent/(progressMax/100)+'%';}
function calculateTotalValue(tot){var minutes=Math.floor(tot/60);var secondsInt=tot-minutes*60;var seconds=secondsInt.toFixed();var time=(minutes<10?'0'+minutes:minutes)+':'+(seconds<10?'0'+seconds:seconds);return time;}
function calculateCurrentValue(currentTime){var currentMinute=parseInt(currentTime/60)%60;var currentSecondsLong=currentTime%60;var currentSeconds=currentSecondsLong.toFixed();currentTime=(currentMinute<10?'0'+currentMinute:currentMinute)+':'+(currentSeconds<10?'0'+currentSeconds:currentSeconds);return currentTime;}
function _isNaN(n){return typeof n==='number'&&isNaN(n);}
function _progress(){var isReady=_isNaN(Number(player.duration))?false:true;if(duration!==player.duration){duration=player.duration;if(isReady){endTime.innerHTML=calculateTotalValue(player.duration);}}
if(isDragging){return false;}
if(isReady){var percent=Math.round(player.currentTime/player.duration*progressMax);currentTime.innerHTML=calculateCurrentValue(player.currentTime);if(percent!==progressbar.value){progressbar.value=percent;_resizeProgress(percent);}
if(player.currentTime===player.duration){_pause();}}}
function _autoPlayPlaying(){player.removeEventListener('playing',_autoPlayPlaying);_play();_progress();}
function _playAndProgress(){player.removeEventListener('canplay',_playAndProgress);player.addEventListener('playing',_autoPlayPlaying,false);playBtn.classList.remove(klassActive);player.play();}
function _drag(event){isDragging=true;}
function _updateProgress(){_resizeProgress(progressbar.value);}
function _seek(event){isDragging=false;var percent=progressbar.value/progressMax;player.currentTime=percent*player.duration;_progress();}
function _init(){playBtn.addEventListener('click',_togglePlay);player.addEventListener('timeupdate',_progress);progressbar.addEventListener('change',_updateProgress);progressbar.addEventListener('input',_updateProgress);progressbar.addEventListener('mousedown',_drag);progressbar.addEventListener('mouseup',_seek);volumeBtn.addEventListener('click',_toggleMute);volumeBar.addEventListener('input',_updateVolume);player.addEventListener('playing',_autoPlayPlaying,false);player.removeEventListener('playing',_autoPlayPlaying);progressbar.setAttribute('max',progressMax);_unmute();{player.addEventListener('canplay',_playAndProgress,false);player.load();}}
this.destroy=function(){playBtn.removeEventListener('click',_togglePlay);player.removeEventListener('timeupdate',_progress);progressbar.removeEventListener('change',_updateProgress);progressbar.removeEventListener('input',_updateProgress);progressbar.removeEventListener('mousedown',_drag);progressbar.removeEventListener('mouseup',_seek);volumeBtn.removeEventListener('click',_toggleMute);volumeBar.removeEventListener('input',_updateVolume);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.BrowseTabs=function(container){function _handleKeyPress(e){if(e.keyCode==32){e.preventDefault();container.click();}}
function _init(){container.addEventListener("keydown",_handleKeyPress);console.log('keydown');}
this.destroy=function(){container.removeEventListener("keydown",_handleKeyPress);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.CheckFileUpload=function(container){var file_field=container.querySelector("input");var file_label=file_field.nextElementSibling;var default_file_label_text="";function _checkFile(e){if(!file_field.files)return;var files=file_field.files;if(files.length>0){if(files[0].size>5000*1024){file_field.setCustomValidity("The selected file must not be larger than 5 Mo");return;}
label_text=e.target.value.split('\\').pop();}else{label_text=default_file_label_text;}
file_label.innerHTML=label_text;file_field.setCustomValidity("");}
function _init(){min$(file_field).on('change',_checkFile);}
this.destroy=function(){min$(file_field).off('change',_checkFile);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.CloseModal=function(container){function _handleClicks(event){event.preventDefault();container.blur();closePopup();min$(document).trigger('modal:hide');min$(document).trigger('trigger:decide');}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);min$(document).trigger('trigger:decide');A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.CollapseInPlace=function(container){var manuallyOpened=false;function _update(){if(A17.currentMediaQuery.indexOf('xsmall')>-1){if(manuallyOpened){_open();}else{_close();}}else{_open();}}
function _open(){container.classList.add('s-open');}
function _close(){container.classList.remove('s-open');}
function _onClick(){manuallyOpened=true;_update();}
this.destroy=function(){container.querySelector('[data-collapse-in-place-button]').removeEventListener('click',_onClick);window.removeEventListener('resized',_update);A17.Helpers.purgeProperties(this);};this.init=function(){_update();container.querySelector('[data-collapse-in-place-button]').addEventListener('click',_onClick);window.addEventListener('resized',_update);};};A17.Behaviors.CollapsibleArea=function(container){var $target,$trigger,targetHeight;var collapsed=true;var budge=0;var uniqueId='collapsible-'+Math.floor((1+Math.random())*0x1000000).toString(16).substring(1);function _updateBudge(){budge=A17.currentMediaQuery.indexOf('large')>-1?79:10;}
function _checkIfOperable(){var smallScreen=A17.currentMediaQuery.indexOf('small')>-1;var mediumPlusOpen=container.classList.contains('m-collapsible--open@medium+')||container.classList.contains('o-article-body__section--collapsible-open@medium+');return smallScreen||!smallScreen&&!mediumPlusOpen;}
function _getHeightAndSet(){targetHeight=$target.firstElementChild.offsetHeight;$target.style.height=targetHeight+'px';}
function _unsetAfterAnimation(){$target.removeAttribute('style');min$(document).trigger('page:updated');}
function _scrollToContainer(time){_updateBudge();var offsetTarget=A17.Helpers.getOffset(container).top-budge;A17.Helpers.scrollToY({el:document,offset:offsetTarget,duration:time?time:1000,easing:'easeInOut',onComplete:function onComplete(){A17.Functions.setFocusOnTarget(container);window.location.hash='#'+container.id;window.scrollTo(0,offsetTarget);min$(document).trigger('page:updated');}});}
function _open(event){if(event){event.stopPropagation();}
if(collapsed&&_checkIfOperable()){_getHeightAndSet();container.classList.add('s-open');$trigger.setAttribute('aria-expanded','true');$target.setAttribute('aria-hidden','false');_unsetAfterAnimation();collapsed=false;}}
function _close(event){if(event){event.stopPropagation();}
if(!collapsed&&_checkIfOperable()){if(event.type.toLowerCase()==='click'){_scrollToContainer(250);}
_getHeightAndSet();container.classList.remove('s-open');$trigger.setAttribute('aria-expanded','false');$target.setAttribute('aria-hidden','true');targetHeight=$target.offsetHeight;$target.style.height=0;_unsetAfterAnimation();collapsed=true;}}
function _toggle(){$trigger.blur();if(collapsed){min$(container).trigger('collapsible:open');}else{min$(container).trigger('collapsible:close');}}
function _handleKeyPress(event){event.preventDefault();if(event.keyCode===13){_toggle();}}
function _handleClicks(event){event.preventDefault();_toggle();}
function _checkIfWindowHash(){if(window.location.hash==='#'+container.id||A17.windowHash===container.id){min$(container).trigger('collapsible:open');setTimeout(function(){_scrollToContainer(0);},16);}}
function _collapsibleContentUniqueId(){return $target.id||uniqueId;}
function _init(){if(container.classList.contains('s-open'))collapsed=false;$trigger=container.querySelector('[data-collapsible-trigger]');$target=container.querySelector('[data-collapsible-block]');$trigger.addEventListener('click',_handleClicks,false);$trigger.addEventListener('keyup',_handleKeyPress,false);container.addEventListener('collapsible:open',_open,false);container.addEventListener('collapsible:close',_close,false);if(collapsed&&_checkIfOperable()){$target.setAttribute('id',_collapsibleContentUniqueId());$target.setAttribute('aria-hidden','true');$trigger.setAttribute('aria-controls',_collapsibleContentUniqueId());$trigger.setAttribute('aria-expanded','false');}
min$('[data-collapsible-close]',container).on('click',_close);_checkIfWindowHash();}
this.destroy=function(){$trigger.removeEventListener('click',_handleClicks);$trigger.removeEventListener('keyup',_handleKeyPress);container.removeEventListener('collapsible:open',_open);container.removeEventListener('collapsible:close',_close);min$('[data-collapsible-close]',container).off('click',_close);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ColumnNav=function(container){function _toggle(event){event.preventDefault();this.blur();if(container.classList.contains('s-show-column-nav')){container.classList.remove('s-show-column-nav');}else{container.classList.add('s-show-column-nav');}}
function _mediaQueryUpdated(){container.classList.remove('s-show-column-nav');}
function _init(){container.querySelector('[data-column-nav-reveal-trigger]').addEventListener('click',_toggle,false);document.addEventListener('mediaQueryUpdated',_mediaQueryUpdated);}
this.destroy=function(){container.querySelector('[data-column-nav-reveal-trigger]').removeEventListener('click',_toggle);document.removeEventListener('mediaQueryUpdated',_mediaQueryUpdated);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.CommentFormShowHide=function(container){var active=false;var dE=document.documentElement;function _show(){if(!active){active=true;min$(document).trigger('body:lock',{breakpoints:'xsmall small'});dE.classList.add('s-comments-form-open');dE.classList.add('s-disable-touchmove');min$(document).trigger('page:updated');}}
function _hide(){if(active){active=false;dE.classList.remove('s-comments-form-open');dE.classList.remove('s-disable-touchmove');min$(document).trigger('body:unlock');min$(document).trigger('page:updated');}}
function _mediaQueryUpdated(){_hide();}
function _init(){container.querySelector('[data-comment-form-show]').addEventListener('click',_show,false);container.querySelector('[data-comment-form-hide]').addEventListener('click',_hide,false);document.addEventListener('mediaQueryUpdated',_mediaQueryUpdated);}
this.destroy=function(){container.querySelector('[data-comment-form-show]').removeEventListener('click',_show);container.querySelector('[data-comment-form-hide]').removeEventListener('click',_hide);document.removeEventListener('mediaQueryUpdated',_mediaQueryUpdated);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.CopyUrl=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();min$(document).trigger('articleTools:subnav:close');min$("[data-behavior='Dropdown ToolTip']").trigger("dropdown:close");var $this=$(this),urlToCopy=$this.data('url')?$this.data('url'):window.location.href;A17.Functions.copyTextToClipboard(urlToCopy,'URL copied to your clipboard');}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.DisableExactPhrase=function(container){function _change(){if(container.options[container.selectedIndex].text!=='Full text'){min$('[data-input-exact-phrase]').each(function(){this.disabled='true';this.parentNode.style.display='none';});}else{min$('[data-input-exact-phrase]').each(function(){this.removeAttribute('disabled');this.parentNode.style.display='';});}}
function _init(){container.addEventListener('change',_change,false);_change();}
this.destroy=function(){container.removeEventListener('change',_change);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.Dropdown=function(container){var active=false;var allow=true;var hoverable=container.getAttribute('data-dropdown-hoverable')!==null;var hovered=false;var hoverIntentTime=250;var hoverTimer;function _ignore(el){var ignore=false;while(container.contains(el)&&el!==container){if(el.getAttribute('data-dropdown-ignore')!==null){ignore=true;}
el=el.parentNode;}
return ignore;}
function _open(event){if(!allow){return;}
if(event){event.stopPropagation();}
container.classList.add('s-active');container.setAttribute('aria-expanded','true');A17.Functions.setFocusOnTarget(container.querySelector('ul'));min$(document).trigger('dropdown:closed',{el:container});min$(document).trigger('tooltip:hide');min$(document).trigger('tooltip:disallow',{el:container});active=true;}
function _close(event){if(!active){return;}
if(event){var activeElement=null;if(event.type==='focus'&&document.activeElement.tagName==='INPUT'){activeElement=document.activeElement;activeElement.blur();}
event.stopPropagation();if(activeElement){window.requestAnimationFrame(function(){activeElement.focus();});}}
container.classList.remove('s-active');container.setAttribute('aria-expanded','false');min$(document).trigger('dropdown:closed',{el:container});min$(document).trigger('tooltip:allow',{el:container});active=false;}
function _focus(event){if(document.activeElement===container||container.contains(document.activeElement)){event.stopPropagation();if(!active){if(document.activeElement.getAttribute('data-dropdown-ignore')===null){_open(event);}}else if(document.activeElement===container||document.activeElement===container.firstElementChild){_close(event);A17.Functions.setFocusOnTarget(container.parentNode);}}else{_close(event);}}
function _clicks(event){if(document.activeElement!==container&&!container.contains(document.activeElement)&&active){_close(event);}}
function _touchstart(event){if(event.target!==container&&!container.contains(event.target)&&active){_close(event);}}
function _touchend(event){if((event.target===container||container.contains(event.target))&&!active){if(_ignore(event.target)){allow=false;setTimeout(function(){allow=true;},100);}else{event.preventDefault();container.focus();}}}
function _mouseEnter(){if(hovered){_open();}else{if(hoverTimer){clearTimeout(hoverTimer);}
hoverTimer=setTimeout(function(){hovered=true;_open();},hoverIntentTime);}}
function _mouseLeave(){if(hoverTimer){clearTimeout(hoverTimer);}
hoverTimer=setTimeout(function(){hovered=false;_close();},hoverIntentTime);}
function _keyUp(event){if(event.key==='Escape'||event.keyCode===27)_close(event);}
function _init(){container.setAttribute('tabindex','0');active=container.classList.contains('s-active');document.addEventListener('focus',_focus,true);document.addEventListener('click',_clicks,false);document.addEventListener('keyup',_keyUp,false);document.addEventListener('touchstart',_touchstart,false);document.addEventListener('touchend',_touchend,false);container.addEventListener('dropdown:open',_open,false);container.addEventListener('dropdown:close',_close,false);if(hoverable){container.addEventListener('mouseenter',_mouseEnter,false);container.addEventListener('mouseleave',_mouseLeave,false);}}
this.destroy=function(){document.removeEventListener('focus',_focus);document.removeEventListener('click',_clicks);document.removeEventListener('keyup',_keyUp);document.removeEventListener('touchstart',_touchstart);document.removeEventListener('touchend',_touchend);container.removeEventListener('dropdown:open',_open);container.removeEventListener('dropdown:close',_close);if(hoverable){container.removeEventListener('mouseenter',_mouseEnter);container.removeEventListener('mouseleave',_mouseLeave);}
A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.DummyBehavior=function(container){function _handleClicks(){}
function _handleResized(){}
function _init(){container.addEventListener('click',_handleClicks,false);document.addEventListener('resized',_handleResized);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);document.removeEventListener('resized',_handleResized);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.FiguresModal=function(container){var active=false;var dE=document.documentElement;var currentObj;var currentIndex;var menuHtml='';var btnZoomIn,btnZoomOut,img;var currentZoomLevel=0;var zoomFactor=1;var containerDims=[];var imgDims=[];var leftDragPos=-50;var topDragPos=-50;var xDown,yDown,xDiff,yDiff,leftDragPosInit,topDragPosInit;var dragging=false;var opener;function _position(){img.style['-webkit-transform']='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';img.style['-moz-transform']='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';img.style['-ms-transform']='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';img.style.transform='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';}
function _onDraggingStart(){if(!dragging&&currentZoomLevel>0){dragging=true;leftDragPosInit=leftDragPos;topDragPosInit=topDragPos;img.classList.add('s-dragging');}}
function _onDragging(event,xNow,yNow){if(dragging&&currentZoomLevel>0){if(!xDown||!yDown){return;}
xDiff=xDown-xNow;yDiff=yDown-yNow;leftDragPos=leftDragPosInit-xDiff/imgDims[0]*100;topDragPos=topDragPosInit-yDiff/imgDims[1]*100;var maxDropTop=50;var minDragTop=-150;var maxDropLeft=50;var minDragLeft=-150;leftDragPos=leftDragPos>maxDropLeft?maxDropLeft:leftDragPos;topDragPos=topDragPos>maxDropTop?maxDropTop:topDragPos;leftDragPos=leftDragPos<minDragLeft?minDragLeft:leftDragPos;topDragPos=topDragPos<minDragTop?minDragTop:topDragPos;_position();}}
function _onDraggingEnd(){if(dragging){dragging=false;img.classList.remove('s-dragging');xDown=undefined;yDown=undefined;xDiff=undefined;yDiff=undefined;}}
function _setUpDragging(){img.addEventListener('mousedown',function(event){event.preventDefault();if(event.which===1){xDown=event.pageX;yDown=event.pageY;_onDraggingStart();}},false);img.addEventListener('mousemove',function(event){_onDragging(event,event.pageX,event.pageY);},false);img.addEventListener('mouseup',_onDraggingEnd,false);img.addEventListener('touchstart',function(event){event.preventDefault();event.stopPropagation();xDown=event.touches[0].clientX;yDown=event.touches[0].clientY;_onDraggingStart();},false);img.addEventListener('touchmove',function(event){event.preventDefault();event.stopPropagation();_onDragging(event,event.changedTouches[0].clientX,event.changedTouches[0].clientY);},false);img.addEventListener('touchend',_onDraggingEnd,false);}
function _bestFit(){containerDims=[];containerDims.push(img.parentNode.offsetWidth);containerDims.push(img.parentNode.offsetHeight);containerDims.push(containerDims[1]/containerDims[0]);imgDims=[];imgDims.push(currentObj.width);imgDims.push(currentObj.height);imgDims.push(imgDims[1]/imgDims[0]);if(imgDims[2]===containerDims[2]){imgDims[0]=Math.min.apply(null,containerDims);imgDims[1]=Math.min.apply(null,containerDims);}else if(imgDims[2]>containerDims[2]){imgDims[0]=Math.round(imgDims[0]/imgDims[1]*containerDims[1]);imgDims[1]=containerDims[1];}else{imgDims[1]=Math.round(imgDims[1]/imgDims[0]*containerDims[0]);imgDims[0]=containerDims[0];}
img.style.width=imgDims[0]+'px';img.style.height=imgDims[1]+'px';_position();}
function _showNewImg(){img.width=currentObj.width;img.height=currentObj.height;_bestFit();img.style.opacity=1;}
function _newImgLoaded(){currentObj.width=img.width;currentObj.height=img.height;_showNewImg();img.removeEventListener('load',_newImgLoaded);}
function _populate(){currentZoomLevel=0;zoomFactor=1;leftDragPos=-50;topDragPos=-50;btnZoomIn.disabled=false;btnZoomOut.disabled=true;img.classList.remove('s-draggable');img.srcset='';img.style='';img.style.opacity=0;img.srcset=currentObj.srcset;if(currentObj.width&&currentObj.height){_showNewImg();}else{img.addEventListener('load',_newImgLoaded,false);}
if(currentObj.title||currentObj.intro||currentObj.description){container.querySelector('[data-figures-modal-caption]').innerHTML='<strong class="f-h11">'+currentObj.title+' '+currentObj.intro+'</strong> '+currentObj.description;container.classList.remove('s-figcaption-empty');}else{container.classList.add('s-figcaption-empty');}
if(window.figureViewer.length>1){container.querySelector('.s-active').classList.remove('s-active');container.querySelector('[data-figures-modal-menu-item="'+currentIndex+'"]').classList.add('s-active');}}
function _setCurrentObjAndCurrentIndexByKey(key){for(var i=0;i<window.figureViewer.length;i++){if(window.figureViewer[i].id===key){currentIndex=i;currentObj=window.figureViewer[i];}}}
function _setCurrentObjAndCurrentIndexByIndex(index){currentIndex=index;currentObj=window.figureViewer[index];}
function _next(event){event.preventDefault();this.blur();var newIndex=currentIndex+1<window.figureViewer.length?currentIndex+1:0;_setCurrentObjAndCurrentIndexByIndex(newIndex);_populate();}
function _prev(event){event.preventDefault();this.blur();var newIndex=currentIndex>0?currentIndex-1:window.figureViewer.length-1;_setCurrentObjAndCurrentIndexByIndex(newIndex);_populate();}
function _showMenu(event){event.preventDefault();this.blur();container.classList.add('s-menu-open');min$(document).trigger('tooltip:hide');}
function _hideMenu(event){event.preventDefault();this.blur();container.classList.remove('s-menu-open');}
function _download(event){event.preventDefault();this.blur();var win=window.open(currentObj.downloadUrl,'_blank');win.focus();min$(document).trigger('tooltip:hide');}
function _setupMenuClicks(){min$('[data-figures-modal-menu-item]',container).on('click',function(event){event.preventDefault();var newIndex=parseInt(this.getAttribute('data-figures-modal-menu-item'));_setCurrentObjAndCurrentIndexByIndex(newIndex);_populate();container.classList.remove('s-menu-open');});}
function _generateMenu(){if(menuHtml===''){var item='<li class="o-figures-modal__menu-item{{current}}" data-figures-modal-menu-item="{{index}}"><span class="o-figures-modal__menu-img-container"><span class="o-figures-modal__menu-img"><img srcset="{{srcset}}" sizes="100vw" alt="{{intro}}"></span></span><strong class="o-figures-modal__menu-title f-ui">{{title}}</strong></a></li>';for(var i=0;i<window.figureViewer.length;i++){menuHtml+=item.replace(/{{index}}/igm,i).replace(/{{srcset}}/igm,window.figureViewer[i].thumbSrcset).replace(/{{width}}/igm,window.figureViewer[i].width).replace(/{{height}}/igm,window.figureViewer[i].height).replace(/{{intro}}/igm,window.figureViewer[i].intro).replace(/{{title}}/igm,window.figureViewer[i].title).replace(/{{current}}/igm,currentIndex===i?' s-active':'');}
container.querySelector('[data-figures-modal-menu-list]').innerHTML=menuHtml;_setupMenuClicks();}}
function _showFigcaption(){container.querySelector('[data-figures-modal-figcaption-toggle]').setAttribute('data-tooltip','Hide info');min$(document).trigger('tooltip:hide');container.classList.remove('s-figcaption-collapsed');}
function _hideFigcaption(){container.querySelector('[data-figures-modal-figcaption-toggle]').setAttribute('data-tooltip','Show info');min$(document).trigger('tooltip:hide');container.classList.add('s-figcaption-collapsed');}
function _toggleFigcaption(event){event.preventDefault();this.blur();if(container.classList.contains('s-figcaption-collapsed')){_showFigcaption();}else{_hideFigcaption();}
setTimeout(function(){_bestFit();},250);}
function _focusTrap(){if(!container.contains(document.activeElement)){A17.Functions.setFocusOnTarget(container);}}
function _show(event){_setCurrentObjAndCurrentIndexByKey(event.data.id);opener=event.data.opener;if(currentObj&&!active){active=true;min$(document).trigger('body:lock',{breakpoints:'xsmall small medium large xlarge xxlarge'});dE.classList.add('s-figures-modal-open');dE.classList.add('s-disable-touchmove');if(currentObj.title||currentObj.intro||currentObj.description){container.classList.remove('s-figcaption-empty');}else{container.classList.add('s-figcaption-empty');}
_showFigcaption();if(window.figureViewer.length>1){_generateMenu();}
_populate();A17.Functions.setFocusOnTarget(container);min$(document).trigger('page:updated');document.addEventListener('focus',_focusTrap,true);}}
function _hide(event){try{event.preventDefault();}catch(err){}
if(active){active=false;dE.classList.remove('s-figures-modal-open');dE.classList.remove('s-disable-touchmove');min$(document).trigger('body:unlock');min$(document).trigger('page:updated');container.blur();if(opener){A17.Functions.setFocusOnTarget(opener);}
opener=null;document.removeEventListener('focus',_focusTrap);}}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(active&&event.keyCode===27&&!isInput){min$(document).trigger('figuresModal:hide');}}
function _zoomIn(event){event.preventDefault();btnZoomIn.blur();currentZoomLevel=currentZoomLevel+1;if(currentZoomLevel===2){btnZoomIn.disabled=true;btnZoomOut.disabled=false;}else{btnZoomIn.disabled=false;btnZoomOut.disabled=false;}
zoomFactor=currentZoomLevel<1?1:currentZoomLevel*0.75+1;zoomFactor=1+currentZoomLevel;img.classList.add('s-draggable');_bestFit();}
function _zoomOut(event){event.preventDefault();btnZoomOut.blur();currentZoomLevel=currentZoomLevel-1;if(currentZoomLevel===0){btnZoomIn.disabled=false;btnZoomOut.disabled=true;img.classList.remove('s-draggable');}else{btnZoomIn.disabled=false;btnZoomOut.disabled=false;}
zoomFactor=currentZoomLevel<1?1:currentZoomLevel*0.75+1;leftDragPos=-50;topDragPos=-50;_bestFit();}
function _handleResized(){if(active){_bestFit();}}
function _init(){if(_typeof(window.figureViewer)===undefined||!window.figureViewer||window.figureViewer.length===0){return;}
if(window.figureViewer.length===1){container.classList.add('s-no-figures-modal-menu');}
img=container.querySelector('[data-figures-modal-image]');btnZoomIn=container.querySelector('[data-figures-modal-zoom-in]');btnZoomOut=container.querySelector('[data-figures-modal-zoom-out]');container.querySelector('[data-figures-modal-close]').addEventListener('click',_hide,false);container.querySelector('[data-figures-modal-next]').addEventListener('click',_next,false);container.querySelector('[data-figures-modal-prev]').addEventListener('click',_prev,false);container.querySelector('[data-figures-modal-menu]').addEventListener('click',_showMenu,false);container.querySelector('[data-figures-modal-menu-close]').addEventListener('click',_hideMenu,false);container.querySelector('[data-figures-modal-download]').addEventListener('click',_download,false);container.querySelector('[data-figures-modal-figcaption-toggle]').addEventListener('click',_toggleFigcaption,false);btnZoomIn.addEventListener('click',_zoomIn,false);btnZoomOut.addEventListener('click',_zoomOut,false);document.addEventListener('figuresModal:show',_show,false);document.addEventListener('figuresModal:hide',_hide,false);document.addEventListener('resized',_handleResized);window.addEventListener('keyup',_escape,false);_setUpDragging();}
this.destroy=function(){container.querySelector('[data-figures-modal-close]').removeEventListener('click',_hide);container.querySelector('[data-figures-modal-next]').removeEventListener('click',_next);container.querySelector('[data-figures-modal-prev]').removeEventListener('click',_prev);container.querySelector('[data-figures-modal-menu]').removeEventListener('click',_showMenu);container.querySelector('[data-figures-modal-menu-close]').removeEventListener('click',_hideMenu);container.querySelector('[data-figures-modal-download]').removeEventListener('click',_download);container.querySelector('[data-figures-modal-figcaption-toggle]').removeEventListener('click',_toggleFigcaption);btnZoomIn.removeEventListener('click',_zoomIn);btnZoomOut.removeEventListener('click',_zoomOut);document.removeEventListener('figuresModal:show',_show);document.removeEventListener('figuresModal:hide',_hide);document.removeEventListener('resized',_handleResized);window.removeEventListener('keyup',_escape);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.FiltersClicks=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();if(this.href.indexOf('#')===-1){min$(document).trigger('ajax:getPage',{url:this.href,type:'tab'});}
this.blur();}
function _handleFormsWithinFilters(event){event.preventDefault();event.stopPropagation();var actionObj=A17.Helpers.turnQueryStringToObject(this.action);var formObj=A17.Helpers.objectifyForm(this);var combinedObj=A17.Helpers.extend(actionObj,formObj);var actionSearchHref=this.action.split('?')[0];var newSearchHref=actionSearchHref+A17.Helpers.turnObjectToQueryString(combinedObj);min$(document).trigger('ajax:getPage',{url:newSearchHref,type:'tab'});this.blur();}
function _init(){min$('a',container).on('click',_handleClicks);min$('form',container).on('submit',_handleFormsWithinFilters);}
this.destroy=function(){min$('a',container).off('click',_handleClicks);min$('form',container).off('submit',_handleFormsWithinFilters);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.FormBySteps=function(form){var previousBtn=form.querySelector("[data-prev-step]");var nextBtn=form.querySelector("[data-next-step]");var currentStep=document.querySelector("[data-form-currentStep]");var current=form.getAttribute("data-form-steps");function _previousStep(){current--;_updateStep();}
function _nextStep(){current++;_updateStep();}
function _updateStep(){form.setAttribute("data-form-steps",current);if(currentStep)currentStep.textContent=current+1;}
function _init(){previousBtn.addEventListener('click',_previousStep);nextBtn.addEventListener('click',_nextStep);}
this.destroy=function(){nextBtn.removeEventListener('click',_handleResized);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.FormSelectFocus=function(container){function _focus(){container.classList.add('s-focus');}
function _blur(){container.classList.remove('s-focus');}
function _init(){container.querySelector('select').addEventListener('focus',_focus,false);container.querySelector('select').addEventListener('blur',_blur,false);}
this.destroy=function(){container.querySelector('select').removeEventListener('focus',_focus);container.querySelector('select').removeEventListener('blur',_blur);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.GoogleCharts=function(container){var mapElements=document.querySelectorAll("[data-google-charts-map]");var lineElements=document.querySelectorAll("[data-google-charts-line]");function _forEach(array,callback,scope){for(var i=0;i<array.length;i++){callback.call(scope,array[i],i);}}
function _drawChart(){if(mapElements.length){_forEach(mapElements,function(mapElement,i){var options={colorAxis:{colors:['#EFE3D8','#FF3000']},tooltip:{isHtml:true}};var dataVar=mapElement.getAttribute("data-google-charts-map");var data=window[dataVar];if(data){var dataTable=google.visualization.arrayToDataTable(data);var chart=new google.visualization.GeoChart(mapElement);chart.draw(dataTable,options);}});}
if(lineElements.length){_forEach(lineElements,function(lineElement,i){var chartwidth=lineElement.offsetWidth;var options={width:chartwidth,legend:'none',colors:['#FF3000'],hAxis:{title:'Days'},tooltip:{isHtml:true},chartArea:{right:0,left:50}};var dataVar=lineElement.getAttribute("data-google-charts-line");var data=window[dataVar];if(data){var dataTable=google.visualization.arrayToDataTable(data);var chart=new google.visualization.LineChart(lineElement);chart.draw(dataTable,options);}});}}
function _init(){if(google.charts){google.charts.load('current',{packages:['corechart']});google.charts.setOnLoadCallback(_drawChart);document.addEventListener('resized',_drawChart);document.addEventListener('googlecharts:draw',_drawChart);}}
this.destroy=function(){document.removeEventListener('resized',_drawChart);document.removeEventListener('googlecharts:draw',_drawChart);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.HandleAnchorLinks=function(container){var budge=0;var offsetTarget;function _updateBudge(){budge=A17.currentMediaQuery.indexOf('large')>-1?79:10;}
function _handleClicks(event){event.preventDefault();var targetID=this.href.split('#')[1];if(targetID&&targetID!=='#'&&!this.getAttribute('data-behavior')){_updateBudge();var $target=document.getElementById(targetID);if($target){if(this.getAttribute('data-inline-tabs-link')!==''){min$(document).trigger('history:replacestate',{url:'#'+targetID});offsetTarget=A17.Helpers.getOffset($target).top-budge;}else{offsetTarget=A17.Helpers.getOffset(this).top-budge;}
A17.Helpers.scrollToY({el:document,offset:offsetTarget,duration:1000,easing:'easeInOut',onComplete:function onComplete(){A17.Functions.setFocusOnTarget($target);window.scrollTo(0,offsetTarget);min$(document).trigger('page:updated');}});min$(document).trigger('articleTools:subnav:close');min$($target).trigger('collapsible:open');}}}
function _init(){min$('a[href^="#"]',container).on('click',_handleClicks);}
this.destroy=function(){min$('a[href^="#"]',container).off('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ImageZoomArea=function(container){var btnZoomIn,btnZoomOut,img;var currentZoomLevel=0;var zoomFactor=1;var containerDims=[];var imgDims=[];var leftDragPos=-50;var topDragPos=-50;var xDown,yDown,xDiff,yDiff,leftDragPosInit,topDragPosInit;var dragging=false;function _position(){img.style['-webkit-transform']='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';img.style['-moz-transform']='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';img.style['-ms-transform']='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';img.style.transform='translate('+leftDragPos+'%, '+topDragPos+'%) scale('+zoomFactor+')';}
function _onDraggingStart(){if(!dragging&&currentZoomLevel>0){dragging=true;leftDragPosInit=leftDragPos;topDragPosInit=topDragPos;img.classList.add('s-dragging');}}
function _onDragging(event,xNow,yNow){if(dragging&&currentZoomLevel>0){if(!xDown||!yDown){return;}
xDiff=xDown-xNow;yDiff=yDown-yNow;leftDragPos=leftDragPosInit-xDiff/imgDims[0]*100;topDragPos=topDragPosInit-yDiff/imgDims[1]*100;var maxDropTop=50;var minDragTop=-150;var maxDropLeft=50;var minDragLeft=-150;leftDragPos=leftDragPos>maxDropLeft?maxDropLeft:leftDragPos;topDragPos=topDragPos>maxDropTop?maxDropTop:topDragPos;leftDragPos=leftDragPos<minDragLeft?minDragLeft:leftDragPos;topDragPos=topDragPos<minDragTop?minDragTop:topDragPos;_position();}}
function _onDraggingEnd(){if(dragging){dragging=false;img.classList.remove('s-dragging');xDown=undefined;yDown=undefined;xDiff=undefined;yDiff=undefined;}}
function _setUpDragging(){img.addEventListener('mousedown',function(event){event.preventDefault();if(event.which===1&&currentZoomLevel>0){xDown=event.pageX;yDown=event.pageY;_onDraggingStart();}},false);img.addEventListener('mousemove',function(event){if(currentZoomLevel>0){_onDragging(event,event.pageX,event.pageY);}},false);img.addEventListener('mouseup',function(event){if(currentZoomLevel>0){_onDraggingEnd(event);}},false);img.addEventListener('touchstart',function(event){if(currentZoomLevel>0){event.preventDefault();event.stopPropagation();xDown=event.touches[0].clientX;yDown=event.touches[0].clientY;_onDraggingStart();}},false);img.addEventListener('touchmove',function(event){if(currentZoomLevel>0){event.preventDefault();event.stopPropagation();_onDragging(event,event.changedTouches[0].clientX,event.changedTouches[0].clientY);}},false);img.addEventListener('touchend',function(event){if(currentZoomLevel>0){_onDraggingEnd(event);}},false);}
function _bestFit(){container.removeAttribute('style');containerDims=[];containerDims.push(container.offsetWidth);containerDims.push(container.offsetHeight);containerDims.push(containerDims[1]/containerDims[0]);imgDims=[];imgDims.push(parseInt(img.naturalWidth));imgDims.push(parseInt(img.naturalHeight));imgDims.push(imgDims[1]/imgDims[0]);if(imgDims[0]>=imgDims[1]){imgDims[0]=containerDims[0];imgDims[1]=Math.round(imgDims[2]*containerDims[0]);}
img.style.width=imgDims[0]+'px';img.style.height=imgDims[1]+'px';_position();}
function _zoomIn(event){event.preventDefault();btnZoomIn.blur();currentZoomLevel=currentZoomLevel+1;if(currentZoomLevel===2){btnZoomIn.disabled=true;btnZoomOut.disabled=false;}else{btnZoomIn.disabled=false;btnZoomOut.disabled=false;}
zoomFactor=currentZoomLevel<1?1:currentZoomLevel*0.75+1;zoomFactor=1+currentZoomLevel;img.classList.add('s-draggable');_bestFit();}
function _zoomOut(event){event.preventDefault();btnZoomOut.blur();currentZoomLevel=currentZoomLevel-1;if(currentZoomLevel===0){btnZoomIn.disabled=false;btnZoomOut.disabled=true;img.classList.remove('s-draggable');}else{btnZoomIn.disabled=false;btnZoomOut.disabled=false;}
zoomFactor=currentZoomLevel<1?1:currentZoomLevel*0.75+1;leftDragPos=-50;topDragPos=-50;_bestFit();}
function _handleResized(){if(A17.currentMediaQuery.indexOf('large')<0){currentZoomLevel=currentZoomLevel-1;btnZoomIn.disabled=false;btnZoomOut.disabled=true;img.classList.remove('s-draggable');zoomFactor=1;leftDragPos=-50;topDragPos=-50;}
_bestFit();}
function _launchFigureViewer(event){if(A17.currentMediaQuery.indexOf('large')<0){event.preventDefault();min$(document).trigger('figuresModal:show',{id:container.getAttribute('data-figure-id'),opener:container});}}
function _init(){img=container.querySelector('img');btnZoomIn=container.querySelector('[data-image-zoom-area-zoom-in]');btnZoomOut=container.querySelector('[data-image-zoom-area-zoom-out]');container.addEventListener('click',_launchFigureViewer,false);btnZoomIn.addEventListener('click',_zoomIn,false);btnZoomOut.addEventListener('click',_zoomOut,false);document.addEventListener('resized',_handleResized);_bestFit();_setUpDragging();}
this.destroy=function(){container.removeEventListener('click',_launchFigureViewer);btnZoomIn.removeEventListener('click',_zoomIn);btnZoomOut.removeEventListener('click',_zoomOut);document.removeEventListener('resized',_handleResized);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.InlineTabs=function(container){var budge=0;function _updateBudge(){budge=A17.currentMediaQuery.indexOf('large')>-1?150:80;}
function _handleClicks(event){event.preventDefault();event.stopPropagation();var parentList=$(this).closest('ul');$(parentList).find('li').each(function(){var contentId=$(this).find('a').attr('href');$(contentId).attr('aria-hidden',true);});var id=this.href.split('#')[1];$('#'+id).attr('aria-hidden',false);if(id&&!this.parentNode.classList.contains('s-active')){_updateBudge();var target=document.getElementById(id);if(target&&$("> #"+id,container).length>0){min$('[data-inline-tabs-links] li',container).each(function(){this.classList.remove('s-active');this.setAttribute('aria-expanded','false');});min$('[data-inline-tabs-tab]',container).each(function(){this.classList.remove('s-active');this.classList.add('s-inactive');target.setAttribute('aria-hidden','true');});min$('li > a[href="#'+id+'"]').each(function(){this.parentNode.classList.add('s-active');});this.setAttribute('aria-expanded','true');target.classList.remove('s-inactive');target.classList.add('s-active');target.setAttribute('aria-hidden','false');min$(target).trigger('collapsible:open');var offsetTarget=A17.Helpers.getOffset(target).top-budge;A17.Helpers.scrollToY({el:document,offset:offsetTarget,duration:500,easing:'easeInOut'});}}}
function _checkIfWindowHash(){if(min$('[data-inline-tabs-link][href="'+window.location.hash+'"]',container)||min$('[data-inline-tabs-link][href="'+A17.windowHash+'"]',container)){min$('[data-inline-tabs-link][href="'+window.location.hash+'"]',container).trigger("click");min$('[data-inline-tabs-link][href="'+A17.windowHash+'"]',container).trigger("click");}}
function _init(){min$('[data-inline-tabs-link]',container).off('click',_handleClicks);min$('[data-inline-tabs-link]',container).on('click',_handleClicks);_checkIfWindowHash();}
this.destroy=function(){min$('[data-inline-tabs-link]',container).off('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.InteractiveModalSlides=function(container){var $slides;var $pager;var $stepperPrev;var $stepperNext;var $reset;var currentIndex=0;var maxSlides;function _enableDisable(){if(currentIndex<1){currentIndex=0;$stepperPrev[0].setAttribute('disabled','disabled');}else{$stepperPrev[0].removeAttribute('disabled');}
if(currentIndex>maxSlides-2){currentIndex=maxSlides-1;$stepperNext[0].setAttribute('disabled','disabled');}else{$stepperNext[0].removeAttribute('disabled');}}
function _update(to){var oldIndex=currentIndex;if(typeof to==='number'){currentIndex=to;}else if(to==='next'){currentIndex=currentIndex+1;}else{currentIndex=currentIndex-1;}
if($pager[currentIndex].parentNode.classList.contains('s-locked')){currentIndex=oldIndex;}else{_enableDisable();min$('.s-active',container).removeClass('s-active');$slides[currentIndex].classList.add('s-active');$pager[currentIndex].parentNode.classList.remove('s-locked');$pager[currentIndex].parentNode.classList.add('s-active');}}
function _reset(event){event.preventDefault();this.blur();_update(0);}
function _pagerClick(event){event.preventDefault();this.blur();_update($pager.index(this));this.parentNode.classList.remove('s-hover');}
function _prev(event){event.preventDefault();this.blur();_update('prev');}
function _next(event){event.preventDefault();this.blur();_update('next');}
function _pagerMouseover(){if(!this.parentNode.classList.contains('s-locked')){this.parentNode.classList.add('s-hover');}}
function _pagerMouseout(){this.parentNode.classList.remove('s-hover');}
function _init(){$slides=min$('[data-slides] li',container);$pager=min$('[data-stepper-pager] a',container);$stepperPrev=min$('[data-stepper-prev]',container);$stepperNext=min$('[data-stepper-next]',container);$reset=min$('[data-reset]',container);maxSlides=$slides.length;currentIndex=$slides.index(container.querySelector('[data-slides] li.s-active'));_enableDisable();$pager.on('mouseover',_pagerMouseover);$pager.on('mouseout',_pagerMouseout);$pager.on('click',_pagerClick);$stepperPrev.on('click',_prev);$stepperNext.on('click',_next);$reset.on('click',_reset);}
this.destroy=function(){$pager.off('mouseover',_pagerMouseover);$pager.off('mouseout',_pagerMouseout);$pager.off('click',_pagerClick);$stepperPrev.off('click',_prev);$stepperNext.off('click',_next);$reset.off('click',_reset);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.Mask=function(container){function _handleClicks(){min$(document).trigger('navPrimary:hide');min$(document).trigger('search:hide');min$(document).trigger('modal:hide');min$(document).trigger('NEJMGroupDDToggle:hide');}
function _init(){container.addEventListener('touchend',_handleClicks,false);container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('touchend',_handleClicks);container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.MoreFromThisIssueSlider=function(container){var slider=false;var itemsInViewport=3;var slideAmount=0;var sliderInner;var paginator;function _initSlider(){paginator=container.querySelector('.o-listing-full-width__pager');sliderInner=container.querySelector('.o-listing-full-width__carousel > ul');switch(A17.currentMediaQuery){case'xsmall':itemsInViewport=1;slideAmount=container.offsetWidth+16;break;case'small':itemsInViewport=2;slideAmount=container.offsetWidth+20;break;case'medium':itemsInViewport=2;slideAmount=container.offsetWidth+30;break;case'large':itemsInViewport=3;slideAmount=container.offsetWidth+30;break;case'xlarge':case'xxlarge':itemsInViewport=3;slideAmount=container.offsetWidth+40;break;default:itemsInViewport=3;slideAmount=container.offsetWidth+40;}
slider=new A17Slider({sliderContainer:container,sliderInner:sliderInner,paginator:paginator,looping:true,quickLinks:false,keyControls:false,swipable:false,scrollBySet:true,itemsVisible:itemsInViewport,slideAmount:slideAmount,budge:0,speed:500});}
function _handleResized(){if(slider){slider.destroy();}
_initSlider();}
function _init(){_initSlider();document.addEventListener('resized',_handleResized);}
this.destroy=function(){document.removeEventListener('resized',_handleResized);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NEJMGroupCarousel=function(container){var slider=false;var itemsInViewport=1;var slideAmount=0;var sliderInner;var paginator;var items;var itemWidth=280+12;var doSetup=false;function _initSlider(){paginator=container.querySelector('ul.g-nejm-group-dd__pager');sliderInner=container.querySelector('ul.o-colset-2-4-6');items=sliderInner.querySelectorAll('li');container.classList.add('s-no-paginator');switch(A17.currentMediaQuery){case'xsmall':case'small':case'medium':doSetup=false;break;case'large':doSetup=true;itemsInViewport=6;slideAmount=container.offsetWidth-30;break;case'xlarge':doSetup=true;itemsInViewport=6;slideAmount=container.offsetWidth-40;break;case'xxlarge':doSetup=true;itemsInViewport=Math.floor(container.offsetWidth/itemWidth);slideAmount=(items[0].offsetWidth+40)*itemsInViewport;break;default:doSetup=true;itemsInViewport=6;slideAmount=container.offsetWidth-40;}
if(doSetup&&items.length>6){slider=new A17Slider({sliderContainer:container,sliderInner:sliderInner,paginator:paginator,looping:true,quickLinks:false,keyControls:false,swipable:false,scrollBySet:true,itemsVisible:itemsInViewport,slideAmount:slideAmount,budge:0,blankClass:false,speed:600});container.classList.remove('s-no-paginator');}}
function _handleShow(){if(slider){slider.destroy();slider=false;}
_initSlider();}
function _handleResized(){if(slider){slider.destroy();_initSlider();}}
function _init(){_initSlider();document.addEventListener('resized',_handleResized);document.addEventListener('NEJMGroupDDToggle:show',_handleShow);}
this.destroy=function(){document.removeEventListener('resized',_handleResized);document.removeEventListener('NEJMGroupDDToggle:show',_handleShow);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NEJMGroupDDToggle=function(container){var active=false;var dE=document.documentElement;var triggerHovered=false;var targetHovered=false;var hoverIntentTime=250;var hoverTimer;var $container;var $target;function _show(){if(!active){active=true;dE.classList.add('s-nejm-group-dd');}}
function _hide(){if(active){active=false;dE.classList.remove('s-nejm-group-dd');}}
function _triggerMouseEnter(){if(hoverTimer){clearTimeout(hoverTimer);}
if(triggerHovered){min$(document).trigger('NEJMGroupDDToggle:show');}else{hoverTimer=setTimeout(function(){triggerHovered=true;min$(document).trigger('NEJMGroupDDToggle:show');},hoverIntentTime);}}
function _triggerMouseLeave(){triggerHovered=false;if(hoverTimer){clearTimeout(hoverTimer);}
hoverTimer=setTimeout(function(){if(!targetHovered){min$(document).trigger('NEJMGroupDDToggle:hide');}},hoverIntentTime);}
function _targetMouseEnter(){targetHovered=true;if(hoverTimer){clearTimeout(hoverTimer);}}
function _targetMouseLeave(){targetHovered=false;if(hoverTimer){clearTimeout(hoverTimer);}
hoverTimer=setTimeout(function(){if(!triggerHovered){min$(document).trigger('NEJMGroupDDToggle:hide');}},hoverIntentTime);}
function _triggerTouches(event){event.preventDefault();if(active){min$(document).trigger('NEJMGroupDDToggle:hide');}else{min$(document).trigger('NEJMGroupDDToggle:show');}}
function _targetMouseClick(event){event.preventDefault();if(active){_hide();}else{_show();triggerHovered=true;if(hoverTimer){clearTimeout(hoverTimer);}}}
function _init(){$container=min$(container);$target=min$('#NEJMGroup');$container.on('mouseenter',_triggerMouseEnter);$container.on('click',_targetMouseClick);$container.on('mouseleave',_triggerMouseLeave);$container.on('touchend',_triggerTouches);$target.on('mouseenter',_targetMouseEnter);$target.on('mouseleave',_targetMouseLeave);min$(document).on('NEJMGroupDDToggle:show',_show);min$(document).on('NEJMGroupDDToggle:hide',_hide);min$(document).on('NEJMGroupDDToggle:toggle',_toggle);}
this.destroy=function(){$container.off('mouseenter',_triggerMouseEnter);$container.off('click',_targetMouseClick);$container.off('mouseleave',_triggerMouseLeave);$container.off('touchend',_triggerTouches);$target.off('mouseenter',_targetMouseEnter);$target.off('mouseleave',_targetMouseLeave);min$(document).off('NEJMGroupDDToggle:show',_show);min$(document).off('NEJMGroupDDToggle:hide',_hide);min$(document).off('NEJMGroupDDToggle:toggle',_toggle);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NavAlphabet=function(container){var position='default';var lockTop=0;var lockBottom=0;var isSetUp=false;var dE=document.documentElement;function _shouldCheck(){return A17.currentMediaQuery.indexOf('large')<0;}
function _posDefault(){dE.classList.remove('s-alphabet-nav-visible');position='default';}
function _posFixed(){dE.classList.add('s-alphabet-nav-visible');position='fixed';}
function _posBottom(){dE.classList.remove('s-alphabet-nav-visible');position='bottom';}
function _decidePos(){var sT=document.documentElement.scrollTop||document.body.scrollTop;if(sT>=lockBottom&&position!=='bottom'){_posBottom();}else if(sT>=lockTop&&sT<lockBottom&&position!=='fixed'){_posFixed();}else if(sT<lockTop&&position!=='default'){_posDefault();}
if(_shouldCheck()){window.requestAnimationFrame(_decidePos);}}
function _resetPos(){_posDefault();_decidePos();}
function _calcLockPositions(){var fixedBoundingClientRect=A17.Helpers.getOffset(container);var windowH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;lockTop=Math.round(fixedBoundingClientRect.top)-windowH/2;lockBottom=lockTop+Math.round(fixedBoundingClientRect.height)-windowH/4;_resetPos();}
function _destroyShowHide(){if(isSetUp){isSetUp=false;_posDefault();min$(window).off('load',_calcLockPositions);min$(window).off('resized',_calcLockPositions);min$(document).off('fonts:loaded',_calcLockPositions);min$(document).off('page:updated',_calcLockPositions);min$('img').off('load',_calcLockPositions);}}
function _setupShowHide(){if(!isSetUp){isSetUp=true;min$(window).on('load',_calcLockPositions);min$(window).on('resized',_calcLockPositions);min$(document).on('fonts:loaded',_calcLockPositions);min$(document).on('page:updated',_calcLockPositions);min$('img').on('load',_calcLockPositions).each(function(){try{if(this.complete){this.load();}}catch(err){}});_calcLockPositions();_decidePos();}}
function _decideShowHide(){_destroyShowHide();if(_shouldCheck()){_setupShowHide();}}
function _handleTouchEnter(e){event.preventDefault();var el=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);if(el&&container.contains(el)&&el.href){window.location.hash=el.href.split('#')[1];}}
function _init(){_decideShowHide();min$(document).on('mediaQueryUpdated',_decideShowHide);min$(container).on('touchmove',_handleTouchEnter);}
this.destroy=function(){A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NavPrimary=function(container){var $container;var $hoverTriggers;var $touchTriggers;var $closeTriggers;var hoverTimer;var hoverable=false;var hoverIntentTime=250;var compactMenu=false;var doubleTap=null;function _hideActive(){$(container).find('.s-active').find('a').attr("aria-expanded",false);min$('.s-active',container).removeClass('s-active');}
function _hoverIntent(){if(!compactMenu&&A17.currentMediaQuery.indexOf('large')>-1){hoverTimer=setTimeout(function(){hoverable=true;},hoverIntentTime);}}
function _noHoverIntent(){if(!compactMenu&&A17.currentMediaQuery.indexOf('large')>-1){try{clearTimeout(hoverTimer);hoverable=false;_hideActive();document.documentElement.classList.remove('s-menu-active');}catch(err){}}}
function _mouseover(){if(!compactMenu&&A17.currentMediaQuery.indexOf('large')>-1){if(hoverable){_hideActive();$(this).find('a').attr("aria-expanded",true);this.classList.add('s-active');document.documentElement.classList.add('s-menu-active');min$(document).trigger('search:hide');}else{var el=this;setTimeout(function(){if(hoverable){_hideActive();el.querySelector('a').setAttribute("aria-expanded",true);el.classList.add('s-active');document.documentElement.classList.add('s-menu-active');min$(document).trigger('search:hide');}},251);}}}
function _mouseout(){if(!compactMenu&&A17.currentMediaQuery.indexOf('large')>-1){_hideActive();}}
function _togglePrimaryClicks(event){if(this.parentNode.classList.contains('s-active')){this.parentNode.classList.remove('s-active');this.setAttribute('aria-expanded',false);}else{event.preventDefault();_hideActive();this.setAttribute('aria-expanded',true);this.parentNode.classList.add('s-active');}}
function _togglePrimaryTouches(event){event.preventDefault();if(doubleTap===null){if(!this.parentNode.classList.contains('s-active')){_hideActive();this.setAttribute('aria-expanded',true);this.parentNode.classList.add('s-active');}else{_hideActive();}
doubleTap=setTimeout(function(){doubleTap=null;},300);}else{_hideActive();clearTimeout(doubleTap);doubleTap=null;window.location.href=this.href;}}
function _closeSecondary(event){event.preventDefault();_hideActive();}
function _hide(){_hideActive();document.documentElement.classList.remove('s-menu-active');}
function _menuHidden(){setTimeout(function(){_hideActive();},250);}
function _keyUp(event){if(event.key==='Escape'||event.keyCode===27)_hide();}
function _init(){compactMenu=document.documentElement.classList.contains('s-compact-menu');$container=min$(container);$hoverTriggers=min$('[data-navprimary-hover-trigger]',container);$touchTriggers=min$('[data-navprimary-touch-trigger]',container);$closeTriggers=min$('[data-navprimary-close-trigger]',container);min$(document).on('mediaQueryUpdated',_hide);min$(document).on('navPrimary:closeActive',_hideActive);min$(document).on('navPrimary:hide',_menuHidden);min$(document).on('keyup',_keyUp);$container.on('mouseenter',_hoverIntent);$container.on('mouseleave',_noHoverIntent);$hoverTriggers.on('mouseenter',_mouseover);$hoverTriggers.on('mouseleave',_mouseout);$touchTriggers.on('click',_togglePrimaryClicks);$touchTriggers.on('touchend',_togglePrimaryTouches);$closeTriggers.on('click',_closeSecondary);}
this.destroy=function(){min$(document).off('mediaQueryUpdated',_hide);min$(document).off('navPrimary:closeActive',_hideActive);min$(document).off('navPrimary:hide',_menuHidden);min$(document).off('keyup',_keyUp);$container.off('mouseenter',_hoverIntent);$container.off('mouseleave',_noHoverIntent);$hoverTriggers.off('mouseenter',_mouseover);$hoverTriggers.off('mouseleave',_mouseout);$touchTriggers.off('click',_togglePrimaryClicks);$touchTriggers.off('touchend',_togglePrimaryTouches);$closeTriggers.off('click',_closeSecondary);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NavPrimarySticky=function(container){var position='default';var lockTop=0;var topBudge=0;var isSetUp=false;var dE=document.documentElement;var timer;function _posDefault(){dE.classList.remove('s-nav-sticky');position='default';}
function _posFixed(){dE.classList.add('s-nav-sticky');position='fixed';}
function _decidePos(){var sT=document.documentElement.scrollTop||document.body.scrollTop;if(sT>=lockTop&&position!=='fixed'){_posFixed();}else if(sT<lockTop&&position!=='default'){_posDefault();}
timer=window.requestAnimationFrame(_decidePos);}
function _resetPos(){_posDefault();_decidePos();}
function _calcLockPositions(e){var fixedBoundingClientRect=A17.Helpers.getOffset(container);lockTop=Math.round(fixedBoundingClientRect.top)-topBudge;_resetPos();}
function _destroy(){if(isSetUp){min$(window).off('load',_calcLockPositions);min$(window).off('resized',_calcLockPositions);min$(document).off('fonts:loaded',_calcLockPositions);min$(document).off('page:updated',_calcLockPositions);isSetUp=false;cancelAnimationFrame(timer);}}
function _setup(){if(!isSetUp){min$(window).on('load',_calcLockPositions);min$(window).on('resized',_calcLockPositions);min$(document).on('fonts:loaded',_calcLockPositions);min$(document).on('page:updated',_calcLockPositions);_calcLockPositions();_decidePos();isSetUp=true;}}
function _decide(){_destroy();if(A17.currentMediaQuery.indexOf('large')>-1){_setup();}else{_posDefault();}}
function _init(){_decide();min$(document).on('mediaQueryUpdated',_decide);}
this.destroy=function(){_destroy();A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NavPrimaryToggle=function(container){function _handleClicks(event){event.preventDefault();container.blur();min$(document).trigger('navPrimary:toggle');}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.NavUserTools=function(container){A17.Behaviors.NejmGroupDropdowns(container);};A17.Behaviors.OpenInModal=function(container){var onLoad=false;var href=false;var modalClass='g-modal--generic';function _launchModal(){if(href&&href.length>1){min$(document).trigger('ajax:getPage',{url:href,type:'modal',modalClass:modalClass,opener:container});min$(document).trigger('articleTools:subnav:close');}}
function _handleClicks(event){event.preventDefault();_launchModal();}
function _init(){onLoad=container.getAttribute('data-modal-on-load')==='true';if(container.getAttribute('data-modal-class')){var modalClasses=container.getAttribute('data-modal-class').split(',');modalClass='';for(var i=0;i<modalClasses.length;i++){modalClass+=' g-modal--'+modalClasses[i];}}
if(onLoad){href=container.getAttribute('data-modal-href');_launchModal();}else{href=container.getAttribute('data-modal-href')||container.href;container.addEventListener('click',_handleClicks,false);}}
this.destroy=function(){if(!onLoad){container.removeEventListener('click',_handleClicks);}
A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.PaginatorClicks=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();if(this.href.indexOf('#')===-1){min$(document).trigger('ajax:getPage',{url:this.href,type:'tab'});}
this.blur();}
function _init(){min$('a',container).on('click',_handleClicks);}
this.destroy=function(){min$('a',container).off('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.PieChart=function(container){var svgEl=container.querySelector('svg');var slices=[];var alpha=1;var cumulativeValue=0;var cumulativePercent=0;var svgPath='M {{startX}} {{startY}} A 1 1 0 {{largeArcFlag}} 1 {{endX}} {{endY}} L 0 0';function _getColour(index){if(index>0){alpha=alpha*0.8;}
return'rgba(11,79,130,'+alpha+')';}
function _gatherData(){min$('[data-piechart-item]',container).each(function(item,index){var data={};data.value=parseInt(item.querySelector('[data-piechart-value]').textContent);cumulativeValue+=data.value;data.label=item.querySelector('[data-piechart-label]').textContent;item.setAttribute('data-piechart-item',index);data.item=item;slices.push(data);});for(var i=0;i<slices.length;i++){var slice=slices[i];slice.percent=slice.value/cumulativeValue;slice.color=_getColour(i);}}
function _getCoordinatesForPercent(percent){var x=Math.cos(2*Math.PI*percent);var y=Math.sin(2*Math.PI*percent);return[x,y];}
function _drawSegments(){for(var i=0;i<slices.length;i++){var slice=slices[i];slice.start=_getCoordinatesForPercent(cumulativePercent);cumulativePercent+=slice.percent;slice.end=_getCoordinatesForPercent(cumulativePercent);var largeArcFlag=slice.percent>0.5?1:0;slice.svgPath=svgPath.replace(/{{startX}}/igm,slice.start[0]).replace(/{{startY}}/igm,slice.start[1]).replace(/{{largeArcFlag}}/igm,largeArcFlag).replace(/{{endX}}/igm,slice.end[0]).replace(/{{endY}}/igm,slice.end[1]);var pathEl=document.createElementNS('http://www.w3.org/2000/svg','path');pathEl.setAttribute('d',slice.svgPath);pathEl.setAttribute('fill',slice.color);pathEl.setAttribute('data-piechart-item',i);slice.slice=pathEl;svgEl.appendChild(pathEl);}}
function _sliceMouseOver(){var index=this.getAttribute('data-piechart-item');var hovered=container.querySelector('[data-piechart-key] [data-piechart-item="'+index+'"]');if(hovered){hovered.classList.add('s-hover');}}
function _sliceMouseOut(){var hovered=container.querySelector('[data-piechart-key] .s-hover');if(hovered){hovered.classList.remove('s-hover');}}
function _itemMouseOver(){var index=parseInt(this.getAttribute('data-piechart-item'));var hovered=container.querySelector('[data-piechart-chart] [data-piechart-item="'+index+'"]');if(hovered){hovered.classList.add('s-hover');}}
function _itemMouseOut(){var hovered=container.querySelector('[data-piechart-chart] .s-hover');if(hovered){hovered.classList.remove('s-hover');}}
function _setUpInteractions(){for(var i=0;i<slices.length;i++){var slice=slices[i];slice.slice.addEventListener('mouseover',_sliceMouseOver,false);slice.slice.addEventListener('mouseout',_sliceMouseOut,false);slice.item.addEventListener('mouseover',_itemMouseOver,false);slice.item.addEventListener('mouseout',_itemMouseOut,false);}}
function _init(){_gatherData();_drawSegments();_setUpInteractions();}
this.destroy=function(){for(var i=0;i<slices.length;i++){var slice=slices[i];slice.slice.removeEventListener('mouseover',_sliceMouseOver);slice.slice.removeEventListener('mouseout',_sliceMouseOut);slice.item.removeEventListener('mouseover',_itemMouseOver);slice.item.removeEventListener('mouseout',_itemMouseOut);}
A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.Poll=function(container){var action=container.action;var classSubmitted='s-submitted';var classResults='s-results';var classCorrect='s-correct';var classIncorrect='s-incorrect';var multiTry=container.getAttribute('data-poll-multi-try')==='true'?true:false;var submitted=container.classList.contains(classSubmitted);var results=container.classList.contains(classResults);var correct=container.classList.contains(classCorrect);var pollID=container.querySelector('[name=pollID]').value;var key;function _enableRadios(){min$('input[type=radio]',container).each(function(){this.removeAttribute('disabled');});}
function _disableRadios(){min$('input[type=radio]',container).each(function(){this.setAttribute('disabled','disabled');});}
function _updateAriaHidden(item,value){try{min$(item,container).attr('aria-hidden',value);}catch(err){}}
function _updatePercentage(id,data){var $label=container.querySelector('label[for="poll_'+pollID+'_'+id+'"]');if($label){try{$label.querySelector('[data-poll-percentage]').textContent=data.percentage+'%';}catch(err){}
try{$label.querySelector('[data-poll-bar]').style.width=data.percentage+'%';}catch(err){}}}
function _loopData(data){for(key in data){if(!data.hasOwnProperty(key)){continue;}
if(key==='submitted'&&data[key]===true){submitted=true;container.classList.add(classSubmitted);}
if(key==='correct'&&multiTry){if(data[key]===true){correct=true;container.classList.remove(classIncorrect);container.classList.add(classCorrect);}else{correct=false;container.classList.add(classIncorrect);}}
if(key==='responses'){min$('[data-poll-responses]',container).each(function(){this.textContent=data[key]+' Total Responses';});}}
for(key in data){if(!data.hasOwnProperty(key)){continue;}
if(data[key].percentage!==undefined){_updatePercentage(key,data[key]);}}
container.classList.add(classResults);_disableRadios();_updateAriaHidden('[data-poll-init]','false');if(submitted){_updateAriaHidden('[data-poll-question]','false');if(correct){_updateAriaHidden('[data-poll-correct]','false');}else{_updateAriaHidden('[data-poll-incorrect]','false');}}else{_updateAriaHidden('[data-poll-how-others-chose]','false');}}
function _submit(event){event.preventDefault();}
function _getResults(event){if(event){event.preventDefault();}
if(submitted&&correct){return;}
var submitClick=this.getAttribute('data-poll-submit')!==null?true:false;var viewClick=this.getAttribute('data-poll-view')!==null?true:false;var dataObj=A17.Helpers.objectifyForm(container);dataObj.initialSubmit=submitted?false:true;container.style.minHeight=container.offsetHeight+'px';A17.Helpers.ajaxRequest({url:action,type:'POST',requestHeaders:[{header:'X-CSRF-Token',value:min$('meta[name=\'csrf-token\']').attr('content')}],data:submitClick?dataObj:{},onSuccess:function onSuccess(data){try{data=JSON.parse(data);_loopData(data);}catch(err){}},onError:function onError(data){try{data=JSON.parse(data);console.log(data);}catch(err){}}});}
function _backToPoll(event){event.preventDefault();container.classList.remove(classResults);container.classList.remove(classSubmitted);container.classList.remove(classCorrect);container.classList.remove(classIncorrect);_enableRadios();_updateAriaHidden('[data-poll-question]','false');_updateAriaHidden('[data-poll-init]','false');_updateAriaHidden('[data-poll-how-others-chose]','true');_updateAriaHidden('[data-poll-correct]','true');_updateAriaHidden('[data-poll-incorrect]','true');}
function _handleResized(){container.style.minHeight='0px';}
function _init(){_updateAriaHidden('[data-poll-question]','false');_updateAriaHidden('[data-poll-init]','false');_updateAriaHidden('[data-poll-how-others-chose]','true');_updateAriaHidden('[data-poll-correct]','true');_updateAriaHidden('[data-poll-incorrect]','true');if(submitted){_disableRadios();}
document.addEventListener('resized',_handleResized);container.removeEventListener('submit',_submit,false);container.querySelector('[data-poll-submit]').addEventListener('click',_getResults,false);container.querySelector('[data-poll-view]').addEventListener('click',_getResults,false);container.querySelector('[data-poll-back]').addEventListener('click',_backToPoll,false);container.querySelector('[data-try-again]').addEventListener('click',_backToPoll,false);if(results){container.querySelector('[data-poll-view]').click();}}
this.destroy=function(){document.removeEventListener('resized',_handleResized);container.removeEventListener('submit',_submit);container.querySelector('[data-poll-submit]').removeEventListener('click',_getResults);container.querySelector('[data-poll-view]').removeEventListener('click',_getResults);container.querySelector('[data-poll-back]').removeEventListener('click',_backToPoll);container.querySelector('[data-try-again]').removeEventListener('click',_backToPoll);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.PopUpTip=function(container){var open=false;var opener;var popupHTML='';var budge=12;var left=0;var top=0;function _grabContentAndPopulate(){var ids=opener.getAttribute('data-popup-content-ids');popupHTML='';if(!ids){ids=opener.href.split('#')[1];ids=document.getElementById(ids)?ids:null;}
if(ids){ids=ids.split(',');for(var i=0;i<ids.length;i++){if(document.getElementById(ids[i])){popupHTML+=document.getElementById(ids[i]).innerHTML;}}
popupHTML=popupHTML.replace(/f-body/igm,'f-body--xs');popupHTML=popupHTML.replace(/f-body--xs--sm/igm,'f-body--xs');popupHTML=popupHTML.replace(/f-body--xs--xs/igm,'f-body--xs');container.querySelector('[data-popup-tip-content]').innerHTML=popupHTML;}}
function _position(){container.style.opacity=0;container.style.display='block';var openerBoundingClientRect=opener.getBoundingClientRect();var containerBoundingClientRect=container.getBoundingClientRect();var sT=document.documentElement.scrollTop||document.body.scrollTop;left=Math.round(openerBoundingClientRect.left+openerBoundingClientRect.width/2-containerBoundingClientRect.width/2);top=Math.round(openerBoundingClientRect.top-containerBoundingClientRect.height-budge+sT);if(sT>top){console.log('fixing top');top=Math.round(openerBoundingClientRect.top+openerBoundingClientRect.height+budge+sT);}
if(left+containerBoundingClientRect.width+budge>window.innerWidth){left=window.innerWidth-containerBoundingClientRect.width-budge;}else if(left<budge){left=budge;}
container.style.left=left+'px';container.style.top=top+'px';container.style.opacity=1;}
function _handleClicks(event){event.stopPropagation();}
function _open(event){if(event){opener=event.data.opener;if(opener){_grabContentAndPopulate();if(popupHTML!==''){_position();A17.Functions.setFocusOnTarget(container);open=true;}}}}
function _close(event){if(event){event.preventDefault();event.stopPropagation();}
if(open&&opener){container.style.opacity=0;container.querySelector('[data-popup-tip-content]').scrollTop=0;container.style.display='none';open=false;}}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(open&&event.keyCode===27&&!isInput){_close();}}
function _clicksOutside(event){if(open){event.stopPropagation();if(!$(event.target).closest('.m-popup-tip').length&&event.which===1){_close();}}}
function _toggle(event){if(open){_close(event);_open(event);}else{_open(event);}}
function _init(){window.addEventListener('keyup',_escape,false);document.addEventListener('click',_clicksOutside,false);document.addEventListener('resized',_close);document.addEventListener('page:updated',_close);container.addEventListener('click',_handleClicks,false);container.querySelector('[data-popup-close]').addEventListener('click',_close,false);document.addEventListener('popuptip:open',_open,false);document.addEventListener('popuptip:close',_close,false);document.addEventListener('popuptip:toggle',_toggle,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);window.removeEventListener('keyup',_escape);container.removeEventListener('click',_handleClicks,false);container.querySelector('[data-popup-close]').removeEventListener('click',_close,false);document.removeEventListener('resized',_close);document.removeEventListener('page:updated',_close);document.removeEventListener('popuptip:open',_open);document.removeEventListener('popuptip:close',_close);document.removeEventListener('popuptip:toggle',_toggle);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.PopUpWindow=function(bt){var height=500;var width=500;var scrollbars='no';function _pop(href){var x=0;var y=0;if(screen){height=Math.max(screen.availHeight-screen.availHeight/2,500);width=Math.max(screen.availWidth-screen.availWidth/2,500);x=(screen.availWidth-width)/2;y=(screen.availHeight-height)/2-100;if(screen.availWidth<500){x=0;y=0;height=screen.availHeight;width=screen.availWidth;}}
var popped=window.open(href,'popup','width='+width+',height='+height+',status=no,location=0,menubar=no,scrollbars='+scrollbars+',resizable=yes,screenX='+x+',screenY='+y+',left='+x+',top='+y);if(!popped.opener){popped.opener=window;}
popped.focus();}
function _openPopup(e){e.preventDefault();var btn=e.currentTarget;var href=btn.getAttribute('href');_pop(href);}
function _init(){bt.addEventListener('click',_openPopup);}
this.destroy=function(){bt.removeEventListener('click',_openPopup);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.PrevKeywords=function(container){var $targetInput;function _handleClicks(){if($targetInput){var newVal=this.textContent;var $targetInputVal=$targetInput.value;if($targetInputVal.search(newVal)<0){if($targetInputVal===''){$targetInput.value=newVal;}else{$targetInput.value+='; '+newVal;}}}}
function _init(){$targetInput=container.parentNode.querySelector('[data-input-keywords]');min$('em',container).on('click',_handleClicks);}
this.destroy=function(){min$('em',container).on('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.PromptPopup=function(container){function _mouseEnter(){min$(document).trigger('promptPopup:mouseenter',{el:container});}
function _mouseLeave(){min$(document).trigger('promptPopup:mouseleave',{el:container});}
function _init(){container.addEventListener('mouseenter',_mouseEnter,false);container.addEventListener('mouseleave',_mouseLeave,false);}
this.destroy=function(){container.removeEventListener('mouseenter',_mouseEnter);container.removeEventListener('mouseleave',_mouseLeave);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.RedirectToSelectValue=function(select){function _redirect(e){var newUrl=e.target.value;if(newUrl!="")window.location.href=newUrl;}
function _init(){select.addEventListener('change',_redirect,false);}
this.destroy=function(){select.removeEventListener('click',_redirect);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.RefreshGoogleCharts=function(container){function _redrawChart(){A17.Helpers.triggerCustomEvent(document,"googlecharts:draw");}
function _init(){if(google.charts)min$(container).on('collapsible:open',_redrawChart);}
this.destroy=function(){if(google.charts)min$(container).off('collapsible:open',_redrawChart);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ResponsiveDataTable=function(container){var i,table,tablesContainer,tableDupe,dupeDiv,tableHTML,tableRows,dupeTableRows;function _duplicateTable(){tableHTML=table.outerHTML;dupeDiv=document.createElement('div');dupeDiv.innerHTML=tableHTML;dupeDiv.className+='m-data-table__dupe-container';tableDupe=dupeDiv.querySelector('table');tableDupe.setAttribute('aria-hidden',true);tableDupe.className+=' m-data-table__table--dupe';table.className+=' m-data-table__table--original';tablesContainer.append(dupeDiv);tableDupe=container.querySelector('.m-data-table__table--dupe');tableRows=table.rows;dupeTableRows=tableDupe.rows;}
function _handleResized(){container.classList.remove('s-scrolly');for(i=0;i<tableRows.length;i++){tableRows[i].style.height='auto';dupeTableRows[i].style.height='auto';}
if(table.offsetWidth>container.offsetWidth){container.classList.add('s-scrolly');for(i=0;i<tableRows.length;i++){var largest=Math.max(tableRows[i].offsetHeight,dupeTableRows[i].offsetHeight);tableRows[i].style.height=largest+'px';dupeTableRows[i].style.height=largest+'px';}}}
function _init(){table=container.querySelector('table');tablesContainer=container.querySelector('[data-tables-container]');if(table&&tablesContainer){_duplicateTable();window.requestAnimationFrame(_handleResized);document.addEventListener('resized',_handleResized);}}
this.destroy=function(){if(table){table.classList.remove('m-data-table__table--original');container.removeChild(dupeDiv);table=null;dupeDiv=null;tableDupe=null;tableHTML=null;document.removeEventListener('resized',_handleResized);}
A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.SaveSearch=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();min$(document).trigger('tooltip:hide');min$(document).trigger('ajax:getPage',{url:this.getAttribute('data-href'),type:'modal',modalClass:'g-modal--narrow',opener:container});this.blur();}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.SearchFiltersClicks=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();if(this.href.indexOf('#')===-1){min$(document).trigger('ajax:getPage',{url:this.href,type:'tab'});}
this.blur();}
function _handleLabelClicks(event){event.stopPropagation();this.blur();}
function _handleFormsWithinFilters(event){event.preventDefault();event.stopPropagation();var actionObj=A17.Helpers.turnQueryStringToObject(this.action);var formObj=A17.Helpers.objectifyForm(this);var combinedObj=A17.Helpers.extend(actionObj,formObj);var actionSearchHref=this.action.split('?')[0];var newSearchHref=actionSearchHref+A17.Helpers.turnObjectToQueryString(combinedObj);min$(document).trigger('ajax:getPage',{url:newSearchHref,type:'tab'});this.blur();}
function _dropdownClosed(event){if(container.contains(event.data.el)){min$(document).trigger('history:replacestate',{url:A17.Functions.updateQueryStringParameter(window.location.href,'openFilterDropdown','')});}}
function _init(){min$('[data-filter-link]',container).on('click',_handleClicks);min$('[data-filter-links] a',container).on('click',_handleClicks);min$('[data-dateRange-custom]',container).on('click',_handleLabelClicks);min$('[data-dateRange-dateList]',container).on('click',_handleLabelClicks);min$('[data-dateRange-custom] form',container).on('submit',_handleFormsWithinFilters);min$('[data-search-within] form',container).on('submit',_handleFormsWithinFilters);min$(document).on('dropdown:closed',_dropdownClosed);min$('[data-filter-link]',container).on('focus',_handleFocus);}
this.destroy=function(){min$('[data-filter-link]',container).off('click',_handleClicks);min$('[data-filter-links] a',container).off('click',_handleClicks);min$('[data-dateRange-custom]',container).off('click',_handleLabelClicks);min$('[data-dateRange-dateList]',container).off('click',_handleLabelClicks);min$('[data-dateRange-custom] form',container).off('submit',_handleFormsWithinFilters);min$('[data-search-within] form',container).off('submit',_handleFormsWithinFilters);min$(document).off('dropdown:closed',_dropdownClosed);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.SearchSuggestions=function(form){var $form;var $input;var $button;var $searchSuggestions;var timer;var lastSearchTime;var action;var allow=true;function _hideSuggestions(){document.documentElement.classList.remove('s-search-suggestions-active');if($searchSuggestions){$searchSuggestions.parentNode.removeChild($searchSuggestions);$searchSuggestions=null;}}
function _doAjax(){if($input[0].value.length===0&&$searchSuggestions){_hideSuggestions();}else if(allow){lastSearchTime=Date.now();var thisSearchTime=lastSearchTime;$button.addClass('s--loading');clearTimeout(timer);timer=setTimeout(function(){A17.Helpers.ajaxRequest({url:action,type:'GET',data:A17.Helpers.objectifyForm(form),onSuccess:function onSuccess(data){try{_hideSuggestions();if(thisSearchTime===lastSearchTime){if(data.length>0){$searchSuggestions=document.createElement('ul');$searchSuggestions.className='m-search-suggestions';$searchSuggestions.innerHTML=data;$input[0].parentNode.appendChild($searchSuggestions);document.documentElement.classList.add('s-search-suggestions-active');}
$button.removeClass('js--loading');}}catch(err){console.log(err);}},onError:function onError(data){console.log(data);}});},250);}}
function _searchHide(){_hideSuggestions();$input[0].blur();allow=true;}
function _searchShow(){setTimeout(function(){$input[0].focus();},250);}
function _inputFocus(){min$(document).trigger('navPrimary:closeActive');}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(event.keyCode===27&&!isInput){_hideSuggestions();}}
function _init(){action=form.getAttribute('data-searchsuggestions-action');$form=min$(form);$input=min$('[data-gsearch-keyword-input]',form);$button=min$('[data-gsearch-submit]',form);if(action){$input.on('input',_doAjax);$input.on('propertychange',_doAjax);}
$input.on('focus',_inputFocus);min$(document).on('search:hide',_searchHide);min$(document).on('search:show',_searchShow);window.addEventListener('keyup',_escape,false);}
this.destroy=function(){_hideSuggestions();$input.off('input',_doAjax);$input.off('propertychange',_doAjax);$input.off('focus',_inputFocus);min$(document).off('search:hide',_searchHide);min$(document).off('search:show',_searchShow);window.removeEventListener('keyup',_escape);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.SearchTabClicks=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();min$(document).trigger('ajax:getPage',{url:this.href,type:'tab'});this.blur();}
function _init(){min$('a',container).on('click',_handleClicks);}
this.destroy=function(){min$('a',container).off('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.SearchToggle=function(container){function _handleClicks(event){event.preventDefault();container.blur();min$(document).trigger('search:toggle');}
function _keyUp(event){if(event.key==='Escape'||event.keyCode===27){min$(document).trigger('search:hide');}}
function _init(){container.addEventListener('click',_handleClicks,false);document.addEventListener('keyup',_keyUp,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);document.removeEventListener('keyup',_keyUp,false);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.SelectAllCheckboxes=function(checkbox){var name_checkboxes=checkbox.getAttribute("data-checkboxes");var connected_checkboxes=document.querySelectorAll('input[name="'+name_checkboxes+'"]');function _checkUncheck(){_forEach(connected_checkboxes,function(connected_checkbox,i){connected_checkbox.checked=checkbox.checked;});}
function _forEach(array,callback,scope){for(var i=0;i<array.length;i++){callback.call(scope,array[i],i);}}
function _init(){checkbox.addEventListener('click',_checkUncheck,false);}
this.destroy=function(){checkbox.removeEventListener('click',_checkUncheck);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ShowAllAuthors=function(container){function _handleClicks(event){event.preventDefault();container.blur();container.parentNode.parentNode.classList.add('s-show-all');min$(document).trigger('page:updated');}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ShowFiguresModal=function(container){function _handleClicks(event){event.preventDefault();min$(document).trigger('figuresModal:show',{id:container.getAttribute('data-figure-id'),opener:container});}
function _init(){container.setAttribute('tabindex','-1');container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ShowHideConnectSelector=function(select){var selectors=document.querySelectorAll("[data-select-id]");var klassHidden="s-hidden";function _showHide(e){var currentValue=e.target.value;for(var i=0;i<selectors.length;i++){var selector=selectors[i];selector.querySelector('select').value="";if(selector.getAttribute("data-select-id")===currentValue)selector.classList.remove(klassHidden);else{selector.classList.add(klassHidden);}}}
function _init(){select.value="";select.addEventListener('change',_showHide,false);}
this.destroy=function(){select.removeEventListener('click',_showHide);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ShowPopupTip=function(container){function _handleClicks(event){event.preventDefault();event.stopPropagation();min$(document).trigger('popuptip:toggle',{opener:container});}
function _handleKeyPress(event){event.preventDefault();if(event.keyCode===13){min$(document).trigger('popuptip:toggle',{opener:container});}}
function _init(){container.addEventListener('click',_handleClicks,false);container.addEventListener('keyup',_handleKeyPress,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);container.removeEventListener('keyup',_handleKeyPress);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ShowPromptPopUp=function(container){var $target=false;var timer;var budge=12;function _mouseEnter(){min$(document).trigger('promptPopup:hide');clearTimeout(timer);$target=document.querySelector('[data-prompt-popup="'+container.getAttribute('data-prompt-popup-target')+'"]');if($target&&$target.innerHTML.replace(/<!--[\s\S]+-->/g,'').trim()!=''){$target.classList.add('s-active');$target.style.visibility='hidden';var openerBoundingClientRect=container.getBoundingClientRect();var targetBoundingClientRect=$target.getBoundingClientRect();var top=Math.round(openerBoundingClientRect.top+openerBoundingClientRect.height+budge);var left=Math.round(openerBoundingClientRect.left+openerBoundingClientRect.width-targetBoundingClientRect.width);$target.style.left=left+'px';$target.style.top=top+'px';$target.style.visibility='visible';}}
function _hide(){if($target){clearTimeout(timer);$target.classList.remove('s-active');$target=null;}}
function _mouseLeave(){clearTimeout(timer);timer=window.setTimeout(_hide,333);}
function _promptMouseEnter(event){if(event.data.el===$target){clearTimeout(timer);}}
function _promptMouseLeave(){_hide();}
function _init(){container.addEventListener('mouseenter',_mouseEnter,false);container.addEventListener('mouseleave',_mouseLeave,false);document.addEventListener('promptPopup:hide',_hide,false);document.addEventListener('promptPopup:mouseenter',_promptMouseEnter,false);document.addEventListener('promptPopup:mouseleave',_promptMouseLeave,false);}
this.destroy=function(){container.removeEventListener('mouseenter',_mouseEnter);container.removeEventListener('mouseleave',_mouseLeave);document.removeEventListener('promptPopup:hide',_hide);document.removeEventListener('promptPopup:mouseenter',_promptMouseEnter);document.removeEventListener('promptPopup:mouseleave',_promptMouseLeave);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.StickyArticleComponents=function(container){var position='default';var lockTop=0;var lockBottom=0;var topBudge=80;var $articleTools=container.querySelector('[data-article-tools]');var isSetUp=false;var lastScrollTop=0;var scrollDirection=false;var dE=document.documentElement;var tallEnough=false;function _updateTopBudge(){topBudge=A17.currentMediaQuery.indexOf('large')>-1?80:100;}
function _posDefault(){dE.classList.remove('s-article-sticky-bottom');dE.classList.remove('s-article-sticky-fixed');position='default';}
function _posFixed(){dE.classList.remove('s-article-sticky-bottom');dE.classList.add('s-article-sticky-fixed');position='fixed';}
function _posBottom(){dE.classList.add('s-article-sticky-bottom');dE.classList.remove('s-article-sticky-fixed');position='bottom';}
function _decidePos(){var sT=document.documentElement.scrollTop||document.body.scrollTop;if(tallEnough){if(sT>=lockBottom&&position!=='bottom'){_posBottom();}else if(sT>=lockTop&&sT<lockBottom&&position!=='fixed'){_posFixed();}else if(sT<lockTop&&position!=='default'){_posDefault();}}
if(sT!==lastScrollTop){if(sT>lastScrollTop&&scrollDirection!=='down'){scrollDirection='down';dE.classList.remove('s-scroll-direction-up');dE.classList.add('s-scroll-direction-down');}else if(sT<lastScrollTop&&scrollDirection!=='up'){scrollDirection='up';dE.classList.remove('s-scroll-direction-down');dE.classList.add('s-scroll-direction-up');}}
lastScrollTop=sT;window.requestAnimationFrame(_decidePos);}
function _resetPos(){_posDefault();_decidePos();}
function _calcLockPositions(){container.style.minHeight=0;_updateTopBudge();var fixedBoundingClientRect=A17.Helpers.getOffset(container);var articleToolsH=$articleTools.offsetHeight;if(fixedBoundingClientRect.height>articleToolsH){lockTop=Math.round(fixedBoundingClientRect.top)-topBudge;lockBottom=lockTop+Math.round(fixedBoundingClientRect.height)-articleToolsH;tallEnough=true;}else{container.style.minHeight=articleToolsH+'px';tallEnough=false;}
_resetPos();}
function _destroy(){if(isSetUp){min$(window).off('load',_calcLockPositions);min$(window).off('resized',_calcLockPositions);min$(document).off('fonts:loaded',_calcLockPositions);min$(document).off('page:updated',_calcLockPositions);min$('img').off('load',_calcLockPositions);isSetUp=false;}}
function _setup(){if(!isSetUp){min$(window).on('load',_calcLockPositions);min$(window).on('resized',_calcLockPositions);min$(document).on('fonts:loaded',_calcLockPositions);min$(document).on('page:updated',_calcLockPositions);_calcLockPositions();_decidePos();isSetUp=true;}}
function _decide(){_destroy();_setup();}
function _init(){_decide();min$(document).on('resized',_decide);min$(document).on('trigger:decide',_decide);}
this.destroy=function(){_destroy();A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.StickyRightRailBlock=function(container){var position='default';var lockTop=0;var lockBottom=0;var topBudge=80;var isSetUp=false;var tallEnough=false;function _posDefault(){container.classList.remove('s-sticky-bottom');container.classList.remove('s-sticky-fixed');position='default';}
function _posFixed(){container.classList.remove('s-sticky-bottom');container.classList.add('s-sticky-fixed');position='fixed';}
function _posBottom(){container.classList.add('s-sticky-bottom');container.classList.remove('s-sticky-fixed');position='bottom';}
function _decidePos(){if(tallEnough){var sT=document.documentElement.scrollTop||document.body.scrollTop;if(sT>=lockBottom&&position!=='bottom'){_posBottom();}else if(sT>=lockTop&&sT<lockBottom&&position!=='fixed'){_posFixed();}else if(sT<lockTop&&position!=='default'){_posDefault();}}
window.requestAnimationFrame(_decidePos);}
function _resetPos(){_posDefault();_decidePos();}
function _calcLockPositions(){var fixedBoundingClientRect=A17.Helpers.getOffset(container);if(container.firstElementChild){if(fixedBoundingClientRect.height>container.firstElementChild.offsetHeight){lockTop=Math.round(fixedBoundingClientRect.top)-topBudge;lockBottom=lockTop+Math.round(fixedBoundingClientRect.height)-container.firstElementChild.offsetHeight;tallEnough=true;}else{tallEnough=false;}
_resetPos();}}
function _destroy(){if(isSetUp){min$(window).off('load',_calcLockPositions);min$(window).off('resized',_calcLockPositions);min$(document).off('fonts:loaded',_calcLockPositions);min$(document).off('page:updated',_calcLockPositions);min$('img').off('load',_calcLockPositions);isSetUp=false;}}
function _setup(){if(!isSetUp){min$(window).on('load',_calcLockPositions);min$(window).on('resized',_calcLockPositions);min$(document).on('fonts:loaded',_calcLockPositions);min$(document).on('page:updated',_calcLockPositions);min$('img').on('load',_calcLockPositions).each(function(){try{if(this.complete){this.load();}}catch(err){}});_calcLockPositions();_decidePos();isSetUp=true;}}
function _decide(){_destroy();if(A17.currentMediaQuery.indexOf('large')>-1){_setup();}}
function _init(){_decide();min$(document).on('mediaQueryUpdated',_decide);min$(document).on('trigger:decide',_decide);}
this.destroy=function(){_destroy();A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.StickyTabs=function(container){var position='default';var lockTop=0;var lockBottom=0;var topBudge=0;var dE=document.documentElement;function _posDefault(){dE.classList.remove('s-m-tabs-sticky');position='default';}
function _posFixed(){dE.classList.add('s-m-tabs-sticky');position='fixed';}
function _posBottom(){dE.classList.remove('s-m-tabs-sticky');position='bottom';}
function _decidePos(){var sT=document.documentElement.scrollTop||document.body.scrollTop;if(sT>=lockBottom&&position!=='bottom'){_posBottom();}else if(sT>=lockTop&&sT<lockBottom&&position!=='fixed'){_posFixed();}else if(sT<lockTop&&position!=='default'){_posDefault();}
window.requestAnimationFrame(_decidePos);}
function _resetPos(){_posDefault();_decidePos();}
function _calcLockPositions(){var fixedBoundingClientRect=A17.Helpers.getOffset(container);lockTop=Math.round(fixedBoundingClientRect.top)-topBudge;lockBottom=lockTop+Math.round(fixedBoundingClientRect.height);_resetPos();}
function _destroy(){min$(window).off('load',_calcLockPositions);min$(window).off('resized',_calcLockPositions);min$(document).off('fonts:loaded',_calcLockPositions);min$(document).off('page:updated',_calcLockPositions);min$('img').off('load',_calcLockPositions);}
function _setup(){min$(window).on('load',_calcLockPositions);min$(window).on('resized',_calcLockPositions);min$(document).on('fonts:loaded',_calcLockPositions);min$(document).on('page:updated',_calcLockPositions);min$('img').on('load',_calcLockPositions).each(function(){try{if(this.complete){this.load();}}catch(err){}});_calcLockPositions();_decidePos();}
function _init(){_setup();}
this.destroy=function(){_destroy();A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.TeaserReveal=function(container){var $btn;var $hidden;var revealed=container.classList.contains('s-reveal');function _handleClicks(event){event.stopPropagation();event.preventDefault();this.blur();if(!revealed){container.classList.add('s-reveal');$hidden.setAttribute('aria-hidden','false');revealed=true;}else{container.classList.remove('s-reveal');$hidden.setAttribute('aria-hidden','true');revealed=false;}}
function _init(){$btn=container.querySelector('[data-teaser-reveal]');$hidden=container.querySelector('[data-teaser-hidden]');if($btn){$btn.addEventListener('click',_handleClicks,false);$btn.addEventListener('touchend',_handleClicks,false);}}
this.destroy=function(){if($btn){$btn.removeEventListener('click',_handleClicks);$btn.removeEventListener('touchend',_handleClicks);}
A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.TextLimit=function(container){var target=container.getAttribute('data-characters-remaining-target-id')||false;var limit=parseInt(container.getAttribute('maxlength'))||1200;function _update(){var str=container.value;var length=str.length;var remaining=limit-length;if(length>=limit){target.classList.add('s-limit-reached');if(!('maxLength'in container)){return false;}}else{target.classList.remove('s-limit-reached');}
target.textContent=remaining+' characters remaining';}
function _init(){if(target&&(container.tagName==='TEXTAREA'||container.getAttribute('type').toLowerCase()==='text')&&limit>0){target=document.querySelector('[data-characters-remaining-display-id="'+target+'"]');if(target){_update();container.addEventListener('input',_update,false);container.addEventListener('propertychange',_update,false);}}}
this.destroy=function(){if(target){container.removeEventListener('input',_update);container.removeEventListener('propertychange',_update);}
A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.TogglePlayerAside=function(btn){var klassActive="s-aside-active";var aside=document.querySelector("[data-popup-aside]");var closeBtn=document.querySelector("[data-popup-aside-close]");function _handleClicks(e){e.currentTarget.blur();if(aside.classList.contains(klassActive))_hide();else aside.classList.add(klassActive);}
function _hide(){aside.classList.remove(klassActive);}
function _init(){btn.addEventListener('click',_handleClicks,false);closeBtn.addEventListener('click',_hide,false);}
this.destroy=function(){btn.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ToggleSaveArticle=function(container){var labels={saved:{tooltip:'Remove',ariaLabel:'Save to account toggle - click to remove'},unsaved:{tooltip:'Save to account',ariaLabel:'Save to account toggle - click to add'}};var ajaxing=false;var saved=container.classList.contains('s-saved');var saveHref=container.getAttribute('data-save-href');var deleteHref=container.getAttribute('data-delete-href');function _updateLabels(){if(saved){container.setAttribute('data-tooltip',labels.saved.tooltip);container.setAttribute('aria-label',labels.saved.ariaLabel);container.classList.add('s-saved');}else{container.setAttribute('data-tooltip',labels.unsaved.tooltip);container.setAttribute('aria-label',labels.unsaved.ariaLabel);container.classList.remove('s-saved');}}
function _doDeleteRequest(){A17.Helpers.ajaxRequest({url:deleteHref,type:'PUT',onSuccess:function onSuccess(data){container.classList.remove('s-loading');ajaxing=false;},onError:function onError(data){console.log(data);container.classList.remove('s-loading');ajaxing=false;saved=true;_updateLabels();window.alert('Unable to update article save settings, please reload the page and try again.');}});}
function _handleClicks(event){event.preventDefault();event.stopPropagation();container.blur();min$(document).trigger('tooltip:hide');if(!ajaxing){ajaxing=true;container.classList.add('s-loading');saved=false;if(!saved){min$(document).off('ajaxFormSubmit:success');min$(document).off('ajaxFormSubmit:aborted');min$(document).on('ajaxFormSubmit:aborted',function(){min$(document).off('ajaxFormSubmit:success');min$(document).off('ajaxFormSubmit:aborted');ajaxing=false;container.classList.remove('s-loading');});min$(document).on('ajaxFormSubmit:success',function(){min$(document).off('ajaxFormSubmit:success');min$(document).off('ajaxFormSubmit:aborted');saved=true;saved=false;_updateLabels();ajaxing=false;container.classList.remove('s-loading');});min$(document).trigger('ajax:getPage',{url:saveHref,type:'modal',modalClass:'g-modal--narrow',opener:container});}else{saved=false;_updateLabels();_doDeleteRequest();}}}
function _init(){_updateLabels();container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ToggleSearchFilters=function(container){function _handleClicks(event){event.preventDefault();this.blur();min$(document).trigger('searchFilters:toggle');}
var position='default';var lockTop=0;var lockBottom=0;var isSetUp=false;var dE=document.documentElement;function _posDefault(){min$(document).trigger('searchFilters:filterButton:hide');position='default';}
function _posFixed(){min$(document).trigger('searchFilters:filterButton:show');position='fixed';}
function _posBottom(){min$(document).trigger('searchFilters:filterButton:hide');position='bottom';}
function _decidePos(){var sT=document.documentElement.scrollTop||document.body.scrollTop;if(sT>=lockBottom&&position!=='bottom'){_posBottom();}else if(sT>=lockTop&&sT<lockBottom&&position!=='fixed'){_posFixed();}else if(sT<lockTop&&position!=='default'){_posDefault();}
window.requestAnimationFrame(_decidePos);}
function _resetPos(){_posDefault();_decidePos();}
function _calcLockPositions(){var fixedBoundingClientRect=A17.Helpers.getOffset(container.parentNode);var windowH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;lockTop=Math.round(fixedBoundingClientRect.top)-windowH/2;lockBottom=lockTop+Math.round(fixedBoundingClientRect.height);_resetPos();}
function _destroy(){if(isSetUp){min$(window).off('load',_calcLockPositions);min$(window).off('resized',_calcLockPositions);min$(document).off('fonts:loaded',_calcLockPositions);min$(document).off('page:updated',_calcLockPositions);min$('img').off('load',_calcLockPositions);isSetUp=false;}}
function _setup(){if(!isSetUp){min$(window).on('load',_calcLockPositions);min$(window).on('resized',_calcLockPositions);min$(document).on('fonts:loaded',_calcLockPositions);min$(document).on('page:updated',_calcLockPositions);min$('img').on('load',_calcLockPositions).each(function(){try{if(this.complete){this.load();}}catch(err){}});_calcLockPositions();_decidePos();isSetUp=true;}}
function _decideIfSmall(){_destroy();if(A17.currentMediaQuery.indexOf('small')>-1){_setup();}}
function _init(){_decideIfSmall();min$(document).on('mediaQueryUpdated',_decideIfSmall);min$('[data-search-filters-toggle]',container).on('click',_handleClicks);}
this.destroy=function(){min$('[data-search-filters-toggle]',container).off('click',_handleClicks);_destroy();A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.ToolTip=function(container){var tooltip;var budge=12;var left,top;var allow=true;function _showtip(){if(!allow){return;}
var el=this;var breakpoints=el.getAttribute('data-tooltip-breakpoints')||'medium large xlarge xxlarge';var direction=el.getAttribute('data-tooltip-direction')||'top';var type=el.getAttribute('data-tooltip-type')||null;if(breakpoints.indexOf(A17.currentMediaQuery)>-1&&!el.parentNode.classList.contains('s-active')){var boundingClientRect=el.getBoundingClientRect();tooltip=document.createElement('span');tooltip.className='a-tooltip';tooltip.textContent=el.getAttribute('data-tooltip');tooltip.style.opacity=0;document.body.appendChild(tooltip);if(type){tooltip.className+=' a-tooltip--'+type;}
if(direction==='top'){left=Math.round(boundingClientRect.left+boundingClientRect.width/2-tooltip.offsetWidth/2);top=Math.round(boundingClientRect.top-tooltip.offsetHeight-budge);if(left<10){left=10;}
if(top<0){top=Math.round(boundingClientRect.top+boundingClientRect.height+budge);tooltip.className+=' a-tooltip--bottom';}}
if(direction==='top-right'){left=Math.round(boundingClientRect.left);top=Math.round(boundingClientRect.top-tooltip.offsetHeight-budge);if(top<0){top=Math.round(boundingClientRect.top+boundingClientRect.height+budge);tooltip.className+=' a-tooltip--bottom';}}
if(direction==='bottom'){left=Math.round(boundingClientRect.left+boundingClientRect.width/2-tooltip.offsetWidth/2);top=Math.round(boundingClientRect.top+boundingClientRect.height+budge);tooltip.className+=' a-tooltip--bottom';}
if(direction==='right'){left=Math.round(boundingClientRect.left+boundingClientRect.width+budge);top=Math.round(boundingClientRect.top+boundingClientRect.height/2-tooltip.offsetHeight/2);tooltip.className+=' a-tooltip--right';}
if(direction==='left'){left=Math.round(boundingClientRect.left-tooltip.offsetWidth-budge);top=Math.round(boundingClientRect.top+boundingClientRect.height/2-tooltip.offsetHeight/2);if(left<0){left=Math.round(boundingClientRect.left+boundingClientRect.width+budge);tooltip.className+=' a-tooltip--right';}else{tooltip.className+=' a-tooltip--left';}}
tooltip.style.left=left+'px';tooltip.style.top=top+'px';tooltip.style.opacity=1;}}
function _hidetip(){if(tooltip){tooltip.parentNode.removeChild(tooltip);tooltip=null;}}
function _disallow(event){if(event&&event.data.el===container){allow=false;}}
function _allow(event){if(event&&event.data.el===container){allow=true;}}
function _touchstart(event){allow=false;}
function _touchend(event){setTimeout(function(){allow=true;},300);}
function _init(){container.addEventListener('mouseenter',_showtip,false);container.addEventListener('mouseleave',_hidetip,false);container.addEventListener('touchstart',_touchstart,false);container.addEventListener('touchend',_touchend,false);document.addEventListener('tooltip:hide',_hidetip,false);document.addEventListener('tooltip:allow',_allow,false);document.addEventListener('tooltip:disallow',_disallow,false);}
this.destroy=function(){_hidetip();container.removeEventListener('mouseenter',_showtip);container.removeEventListener('mouseleave',_hidetip);document.removeEventListener('tooltip:hide',_hidetip);document.removeEventListener('tooltip:allow',_allow);document.removeEventListener('tooltip:disallow',_disallow);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.TopLink=function(container){function _handleClicks(event){event.preventDefault();container.blur();A17.Helpers.scrollToY({el:document,offset:0,duration:250,easing:'easeInOut',onComplete:function onComplete(){A17.Functions.setFocusOnTarget(document.getElementById('pb-page-content'));}});}
function _init(){container.addEventListener('click',_handleClicks,false);}
this.destroy=function(){container.removeEventListener('click',_handleClicks);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.TravelingHome=function(container){var slider=false;var itemsInViewport=1;var slideAmount=0;var sliderInner;var paginator;var items;var itemWidth=280+12;function _initSlider(){paginator=container.querySelector('ul.o-traveling-home__pager');sliderInner=container.querySelector('ul.o-traveling-home__items');items=sliderInner.querySelectorAll('li');if(items.length*itemWidth>container.offsetWidth){itemsInViewport=Math.floor(container.offsetWidth/itemWidth);slideAmount=itemsInViewport*itemWidth;slider=new A17Slider({sliderContainer:container,sliderInner:sliderInner,paginator:paginator,looping:true,quickLinks:false,keyControls:false,swipable:false,scrollBySet:true,itemsVisible:itemsInViewport,slideAmount:slideAmount,budge:-5,blankClass:false,speed:500});container.classList.remove('s-no-paginator');}else{container.classList.add('s-no-paginator');}}
function _handleResized(){if(slider&&slider.destroy){slider.destroy();}
_initSlider();}
function _init(){_initSlider();document.addEventListener('resized',_handleResized);}
this.destroy=function(){document.removeEventListener('resized',_handleResized);A17.Helpers.purgeProperties(this);};this.init=function(){_init();};};A17.Behaviors.trackDownloadEvent=function(container){function _handleClick(event){event.preventDefault();var elem=$(this);var data={"doi":$(this).attr('doi'),"downloadType":$(elem).attr('data-download-filetype')&&!$(elem).attr('data-download-type').includes('Supplementary')?$(elem).attr('data-download-filetype'):$(elem).attr('data-download-type')};$.ajax({url:"/pb/widget/article/trackDownloadEventDetails",type:'POST',data:data,success:function success(data){try{if(data){if(!data.error&&data.hasAccess){publishTrackEvent(data,elem);}}}catch(err){console.log(err);}},error:function error(data){console.log(data);},complete:function complete(){continueWorkFlow(elem);}});}
function continueWorkFlow(elem){var url=$(elem).attr('href').toString();if($(elem).attr('target')==='_blank'){window.open(url);}else{window.location=url;}}
function publishTrackEvent(jsonData,element){var downloadEvent=new CustomEvent("trackDownload",{detail:{type:$(element).attr('data-download-type'),fileName:$(element).attr('href'),fileFormat:$(element).attr('data-download-format'),fileType:$(element).attr('data-download-filetype'),contentId:$(element).attr('doi'),freeDownload:jsonData.free,toolDownload:$(element).closest('.m-article-tools').length>0}});document.querySelector("body").dispatchEvent(downloadEvent);if(window.console&&window.console.log){console.log(downloadEvent);if(window.console.table){console.log("The Event details: ");console.table(downloadEvent.detail);}}}
function eventPollyFill(){(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:null};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent;})();}
function includesPollyFill(){if(!String.prototype.includes){Object.defineProperty(String.prototype,'includes',{value:function value(search,start){if(typeof start!=='number'){start=0;}
if(start+search.length>this.length){return false;}else{return this.indexOf(search,start)!==-1;}}});}}
function _init(){includesPollyFill();eventPollyFill();min$(container).off('click');min$(container).on('click',_handleClick);}
this.init=function(){_init();};};A17.Functions.ajaxPageLoad=function(){var docTitle;function defaultComplete(options,doc){document.querySelector('[data-content]').innerHTML=doc.querySelector('[data-content]').innerHTML;docTitle=doc.title;document.title=docTitle;document.documentElement.scrollTop=0;document.body.scrollTop=0;if(!options.popstate){min$(document).trigger('history:pushstate',{url:options.href,type:options.type,title:docTitle});}
A17.previousAjaxPageLoadType=options.type;}
function tabComplete(options,doc){document.querySelector('[data-tab-content]').innerHTML=doc.querySelector('[data-tab-content]').innerHTML;docTitle=doc.title;document.title=docTitle;if(!options.popstate){min$(document).trigger('history:pushstate',{url:options.href,type:options.type,title:docTitle});}
A17.previousAjaxPageLoadType=options.type;}
function modalComplete(options,doc){document.querySelector('[data-modal-content]').innerHTML=doc.querySelector('body').innerHTML;min$(document).trigger('modal:show');}
function loadDocument(options){min$(document).trigger('modal:hide');min$(document).trigger('navPrimary:hide');docTitle=null;min$(document).trigger('ajaxPageLoadMask:show');min$(document).trigger('loader:start');A17.Helpers.ajaxRequest({url:options.href,type:'GET',requestHeaders:[{header:'X-CSRF-Token',value:min$('meta[name="csrf-token"]').attr('content')}],onSuccess:function onSuccess(data){try{var parser=new DOMParser();var doc=parser.parseFromString(data,'text/html');switch(options.type){case'tab':tabComplete(options,doc);break;case'modal':modalComplete(options,doc);break;default:defaultComplete(options,doc);}
picturefill();min$(document).trigger('page:updated');min$(document).trigger('loader:complete');min$(document).trigger('ajaxPageLoadMask:hide');}catch(err){min$(document).trigger('loader:error');min$(document).trigger('ajaxPageLoadMask:hide');{console.log(err);}}},onError:function onError(data){min$(document).trigger('loader:error');min$(document).trigger('ajaxPageLoadMask:hide');{console.log(data);}}});}
function popstate(event){loadDocument({href:event.data.url,type:event.data.type,title:event.data.title,popstate:event});}
function getPage(event){if(event.data.url){if(!history.state&&(!event.data.type||event.data.type&&event.data.type!=='modal')){min$(document).trigger('history:replacestate',{url:location.href,type:event.data.type||'page'});A17.previousAjaxPageLoadType=event.data.type||'page';}
loadDocument({href:event.data.url,type:event.data.type||'page',popstate:false});}}
document.addEventListener('ajax:getPage',getPage);document.addEventListener('ajax:pageload:popstate',popstate);};A17.Functions.ajaxPageLoadMaskToggle=function(){var active=false;var dE=document.documentElement;function _show(){if(!active){active=true;dE.classList.add('s-ajaxPageLoadMask');}}
function _hide(){if(active){active=false;dE.classList.remove('s-ajaxPageLoadMask');}}
min$(document).on('ajaxPageLoadMask:show',_show);min$(document).on('ajaxPageLoadMask:hide',_hide);};A17.Functions.disableTouchMove=function(){document.ontouchmove=function(event){var isTouchMoveAllowed=true;var target=event.target;while(target!==null){if(document.documentElement.classList.contains('s-disable-touchmove')&&target.id==='content'){isTouchMoveAllowed=false;break;}
target=target.parentNode;}
if(!isTouchMoveAllowed){event.preventDefault();}};};A17.Functions.history=function(){if(!window.history.pushState){return;}
min$(document).on('history:replacestate',function(event){history.replaceState(event.data,'',event.data.url);});min$(document).on('history:pushstate',function(event){history.pushState(event.data,'',event.data.url);});min$(window).on('popstate',function(event){if(event&&event.state&&event.state.type){min$(document).trigger('ajax:pageload:popstate',event.state);}});};A17.Functions.loadProgressBar=function(){var $bar=null;var $progress=null;var currentPercent=0;var timeout;function randomTime(){return Math.random()*2000;}
function progress(){currentPercent+=(90-currentPercent)*0.2;$progress.style.width=currentPercent+'%';timeout=setTimeout(progress,randomTime());}
function removeProgressBar(){document.getElementById('pb-page-content').removeChild($bar);$bar=null;$progress=null;currentPercent=0;}
function showLoader(){if($bar){removeProgressBar();}
$bar=document.createElement('span');$bar.className='a-progress-bar';$progress=document.createElement('span');$progress.style.opacity=0;$bar.appendChild($progress);document.getElementById('pb-page-content').appendChild($bar);setTimeout(function(){$progress.style.opacity=1;});timeout=setTimeout(function(){currentPercent+=(90-currentPercent)*0.4;$progress.style.width=currentPercent+'%';progress();},250);}
function loadComplete(){try{clearTimeout(timeout);}catch(err){}
$progress.style.width='100%';setTimeout(removeProgressBar,250);}
document.addEventListener('loader:start',showLoader);document.addEventListener('loader:complete',loadComplete);document.addEventListener('loader:error',loadComplete);};A17.Functions.modal=function(){var active=false;var dE=document.documentElement;var modalNode=document.querySelector('[data-modal]');var modalNodeScrollArea=document.querySelector('[data-modal-scroll-area]');var modalContentNode=document.querySelector('[data-modal-content]');var focusedElBeforeOpen=document.activeElement||document.body;var focusableEls=[];var firstFocusableEl=null;var lastFocusableEl=null;function _show(){if(!active){focusableEls=modalNode.querySelectorAll('a[href], area[href], input:not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');focusableEls=Array.prototype.slice.call(focusableEls);firstFocusableEl=focusableEls[0];lastFocusableEl=focusableEls[focusableEls.length-1];focusedElBeforeOpen=document.activeElement;firstFocusableEl.focus();modalNode.addEventListener('keydown',function(e){_handleTabKeyDown(e);});active=true;min$(document).trigger('body:lock',{breakpoints:'xsmall small medium large xlarge xxlarge'});dE.classList.add('s-modal-open');dE.classList.add('s-disable-touchmove');modalNodeScrollArea.scrollTop=0;A17.Functions.setFocusOnTarget(modalContentNode);min$(document).trigger('page:updated');}}
function _hide(){if(active){active=false;dE.classList.remove('s-modal-open');dE.classList.remove('s-disable-touchmove');if(focusedElBeforeOpen.tagName==='svg'){focusedElBeforeOpen.parentNode.focus();}else{focusedElBeforeOpen.focus();}
min$(document).trigger('body:unlock',{breakpoints:'xsmall small medium large xlarge xxlarge'});modalContentNode.innerHTML='';min$(document).trigger('ajaxFormSubmit:aborted');min$(document).trigger('page:updated');}}
function _handleTabKeyDown(e){var KEY_TAB=9;function handleBackwardTab(){if(document.activeElement===firstFocusableEl){e.preventDefault();lastFocusableEl.focus();}}
function handleForwardTab(){if(document.activeElement===lastFocusableEl){e.preventDefault();firstFocusableEl.focus();}}
switch(e.keyCode){case KEY_TAB:if(focusableEls.length===1){e.preventDefault();break;}
e.shiftKey?handleBackwardTab():handleForwardTab();break;default:break;}}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(active&&event.keyCode===27&&!isInput){min$(document).trigger('modal:hide');}}
document.addEventListener('modal:show',_show,false);document.addEventListener('modal:hide',_hide,false);window.addEventListener('keyup',_escape,false);};A17.Functions.navPrimaryToggle=function(){var active=false;var dE=document.documentElement;var isCompactMenu;function _show(){if(!active){active=true;if(A17.currentMediaQuery.indexOf('small')>-1){window.scrollTo(0,0);}
min$(document).trigger('search:hide');min$(document).trigger('NEJMGroupDDToggle:hide');dE.classList.add('s-menu-active');dE.classList.add('s-disable-touchmove');isCompactMenu=dE.classList.contains('s-compact-menu');min$(document).trigger('body:lock',{breakpoints:['xsmall','small','medium',isCompactMenu?'large':'',isCompactMenu?'xlarge':'',isCompactMenu?'xxlarge':''].join(' ')});if(!A17.currentMediaQuery.match(/(xsmall|small|medium)/)){A17.Functions.setFocusOnTarget(document.getElementById('nav'));}}}
function _hide(){if(active){active=false;dE.classList.remove('s-menu-active');dE.classList.remove('s-disable-touchmove');isCompactMenu=dE.classList.contains('s-compact-menu');min$(document).trigger('body:unlock',{breakpoints:['xsmall','small','medium',isCompactMenu?'large':'',isCompactMenu?'xlarge':'',isCompactMenu?'xxlarge':''].join(' ')});if(!A17.currentMediaQuery.match(/(xsmall|small|medium)/)){A17.Functions.setFocusOnTarget(document.getElementById('nav'));}}}
function _toggle(){if(active){min$(document).trigger('navPrimary:hide');}else{min$(document).trigger('navPrimary:show');}}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(active&&event.keyCode===27&&!isInput){min$(document).trigger('navPrimary:hide');}}
min$(document).on('mediaQueryUpdated',_hide);min$(document).on('navPrimary:show',_show);min$(document).on('navPrimary:hide',_hide);min$(document).on('navPrimary:toggle',_toggle);min$(window).on('keyup',_escape);};A17.Functions.searchFiltersToggle=function(){var active=false;var dE=document.documentElement;function _show(){if(!active){active=true;min$(document).trigger('body:lock',{breakpoints:'xsmall small'});dE.classList.add('s-search-filters-active');dE.classList.add('s-disable-touchmove');}}
function _hide(){if(active){active=false;dE.classList.remove('s-search-filters-active');dE.classList.remove('s-disable-touchmove');min$(document).trigger('body:unlock',{breakpoints:'xsmall small'});}}
function _toggle(){if(active){min$(document).trigger('searchFilters:hide');}else{min$(document).trigger('searchFilters:show');}}
function _escape(event){var isInput=event.target.tagName==='INPUT';if(active&&event.keyCode===27&&!isInput){min$(document).on('searchFilters:hide',_hide);}}
function _showButton(){dE.classList.add('s-search-filters-button-show');}
function _hideButton(){dE.classList.remove('s-search-filters-button-show');}
min$(document).on('searchFilters:show',_show);min$(document).on('searchFilters:hide',_hide);min$(document).on('searchFilters:toggle',_toggle);min$(document).on('searchFilters:filterButton:show',_showButton);min$(document).on('searchFilters:filterButton:hide',_hideButton);min$(window).on('keyup',_escape);};A17.Functions.searchToggle=function(){var active=false;var dE=document.documentElement;function _mediaQueryUpdated(){if(A17.currentMediaQuery.indexOf('large')<0){min$(document).trigger('search:hide');}}
function _show(){if(!active){active=true;min$(document).trigger('navPrimary:hide');min$(document).trigger('NEJMGroupDDToggle:hide');min$(document).trigger('search:shown');dE.classList.add('s-search-active');}}
function _hide(){if(active){active=false;min$(document).trigger('search:hidden');dE.classList.remove('s-search-active');dE.classList.remove('s-search-advanced-active');dE.classList.remove('s-search-active-init');}}
function _toggle(){if(active){min$(document).trigger('search:hide');}else{min$(document).trigger('search:show');}}
if(dE.classList.contains('s-search-active-init')){active=true;dE.classList.add('s-search-active');}
min$(document).on('mediaQueryUpdated',_mediaQueryUpdated);min$(document).on('search:show',_show);min$(document).on('search:hide',_hide);min$(document).on('search:toggle',_toggle);};A17.Functions.lockBody=function(){var lockBodyScrollTop=0;function _lock(event){if(event.data.breakpoints&&event.data.breakpoints.indexOf(A17.currentMediaQuery)>-1||typeof event.data.breakpoints=="undefined"){lockBodyScrollTop=window.pageYOffset;document.getElementById('pb-page-content').style.top=lockBodyScrollTop*-1+'px';document.documentElement.style.height='100%';document.body.style.height='100%';}}
function _unlock(event){if(event.data.breakpoints&&event.data.breakpoints.indexOf(A17.currentMediaQuery)>-1||typeof event.data.breakpoints=="undefined"){document.getElementById('pb-page-content').style.top='';document.documentElement.style.height='';document.body.style.height='';window.scrollTo(0,lockBodyScrollTop);setTimeout(function(){window.scrollTo(0,lockBodyScrollTop);lockBodyScrollTop=0;},1);}}
document.addEventListener('body:lock',_lock,false);document.addEventListener('body:unlock',_unlock,false);};A17.Functions.setFocusOnTarget=function(node){node.focus();if(node!==document.activeElement){node.setAttribute('tabindex','-1');node.focus();}};A17.Functions.updateQueryStringParameter=function(uri,key,value){var re=new RegExp('([?&])'+key+'=.*?(&|#|$)','i');if(uri.match(re)){return uri.replace(re,'$1'+key+'='+value+'$2');}else{var hash='';if(uri.indexOf('#')!==-1){hash=uri.replace(/.*#/,'#');uri=uri.replace(/#.*/,'');}
var separator=uri.indexOf('?')!==-1?'&':'?';return uri+separator+key+'='+value+hash;}};A17.Functions.copyTextToClipboard=function(textToCopy,successMsg){var Clipboard=function(window,document,navigator){var textArea,copy;function isIOS(){return navigator.userAgent.match(/ipad|ipod|iphone/i);}
function createTextArea(textToCopy){textArea=document.createElement('textArea');textArea.value=textToCopy;textArea.style.position='fixed';textArea.style.top=0;textArea.style.left=0;textArea.style.width='2em';textArea.style.height='2em';textArea.style.padding=0;textArea.style.border='none';textArea.style.outline='none';textArea.style.boxShadow='none';textArea.style.background='transparent';textArea.style.opacity='0';textArea.setAttribute('readonly',true);document.body.appendChild(textArea);}
function selectText(){var range,selection;if(isIOS()){textArea.contentEditable=true;range=document.createRange();range.selectNodeContents(textArea);selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);textArea.setSelectionRange(0,999999);}else{textArea.select();}}
function copyToClipboard(){var success=document.execCommand('copy');document.body.removeChild(textArea);return success;}
copy=function copy(text){createTextArea(text);selectText();return copyToClipboard();};return{copy:copy};}(window,document,navigator);try{var successful=Clipboard.copy(textToCopy);if(successful){if(window.alert){window.alert(successMsg);}}}catch(err){}};A17.Functions.windowHashOnLoad=function(){if(A17.windowHash){var $target=document.getElementById(A17.windowHash);if($target){if($target.tagName.toLowerCase()==='mark'){A17.Functions.setFocusOnTarget($target);min$(document).trigger('history:replacestate',{url:'#'+A17.windowHash});var budge=A17.currentMediaQuery.indexOf('large')>-1?79:10;var offsetTarget=A17.Helpers.getOffset($target).top-budge;window.scrollTo(0,offsetTarget);setTimeout(function(){window.scrollTo(0,offsetTarget);},16);}}}};A17.Functions.leaderBoard=function(){var dE=document.documentElement,timeout;function _handleLeaderBoardVisibility(){var isLeaderBoardVisible=min$('.o-popups-modal__leaderboard .ad').css('display')==="none"?false:true;if(isLeaderBoardVisible){dE.classList.add('s-has-leaderboard');}else{dE.classList.remove('s-has-leaderboard');}}
function _handleLeaderBoardVisibilityTimeout(){clearTimeout(timeout);timeout=setTimeout(function(){_handleLeaderBoardVisibility();},501);}
_handleLeaderBoardVisibility();_handleLeaderBoardVisibilityTimeout();min$(document).on('mediaQueryUpdated',_handleLeaderBoardVisibility);min$(document).on('DOMContentLoaded',_handleLeaderBoardVisibility);min$(document).on('load',_handleLeaderBoardVisibility);min$(document).on('readystatechange',_handleLeaderBoardVisibility);min$(document).on('resized',_handleLeaderBoardVisibilityTimeout);};A17.Helpers.ajaxRequest=function(settings){var options=settings;var request=new XMLHttpRequest();var requestUrl=options.url;options.queryString='';if(options.data!==undefined){if(A17.Helpers.turnObjectToQueryString){options.queryString=A17.Helpers.turnObjectToQueryString(options.data);}else{throw new ReferenceError('Missing: A17.Helpers.turnObjectToQueryString');}}
if(options.type!=='POST'){requestUrl+=requestUrl.indexOf('?')>0?options.queryString.replace('?','&'):options.queryString;}
request.open(options.type,requestUrl,true);request.setRequestHeader('X-Requested-With','XMLHttpRequest');if(options.type==='POST'){request.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');}
if(options.requestHeaders!==undefined&&options.requestHeaders.length>0){for(var i=0;i<options.requestHeaders.length;i++){var header=options.requestHeaders[i].header;var value=options.requestHeaders[i].value;if(header!==undefined&&value!==undefined){request.setRequestHeader(header,value);}}}
request.onload=function(){if(request.status>=200&&request.status<400){if(_typeof(options.onSuccess).toLowerCase()==='function'){options.onSuccess.call(this,request.responseText,request.status);}}else{if(_typeof(options.onError).toLowerCase()==='function'){options.onError.call(this,request.responseText,request.status);}
console.log('We reached our target server, but it returned an error: '+request.statusText);}};request.onerror=function(){console.log('There was a connection error of some sort');if(_typeof(options.onError).toLowerCase()==='function'){options.onError.call(this,request.responseText,request.status);}};request.send(options.type==='POST'?options.queryString.replace('?',''):'');};A17.Helpers.extend=function(){var obj={};var i=0;var argumentsLength=arguments.length;var key;for(;i<argumentsLength;i++){for(key in arguments[i]){if(arguments[i].hasOwnProperty(key)){obj[key]=arguments[i][key];}}}
return obj;};A17.Helpers.getCurrentMediaQuery=function(){function parse(str){return str.replace(/'/gi,'').replace(/"/gi,'');}
if(window.opera){return parse(window.getComputedStyle(document.body,':after').getPropertyValue('content'))||'large';}else if(window.getComputedStyle){return parse(window.getComputedStyle(document.head,null).getPropertyValue('font-family'))||'large';}else{return'large';}};A17.Helpers.getOffset=function(node){if(node){var rect=node.getBoundingClientRect();return{top:rect.top+(document.documentElement.scrollTop||document.body.scrollTop),left:rect.left+(document.documentElement.scrollLeft||document.body.scrollLeft),bottom:rect.bottom+(document.documentElement.scrollTop||document.body.scrollTop),right:rect.right+(document.documentElement.scrollLeft||document.body.scrollLeft),width:rect.width,height:rect.height};}else{return null;}};A17.Helpers.manageBehaviors=function(options){var idCounter=0;var pageUpdatedEventName=options&&options.pageUpdatedEventName?options.pageUpdatedEventName:'page:updated';function searchDomAndInitBehaviors(context){if(context===undefined){context=document;}
var all=context.querySelectorAll('[data-behavior]');var i=-1;while(all[++i]){var currentElement=all[i];if(!currentElement._A17BehaviorsActive){var behaviors=currentElement.getAttribute('data-behavior');var splittedBehaviors=behaviors.split(' ');for(var j=0,k=splittedBehaviors.length;j<k;j++){var ThisBehavior=A17.Behaviors[splittedBehaviors[j]];if(typeof ThisBehavior!=='undefined'){try{currentElement._A17BehaviorsActive=true;A17.activeBehaviors[idCounter]={el:currentElement,behavior:new ThisBehavior(currentElement),name:splittedBehaviors[j]};try{A17.activeBehaviors[idCounter].behavior.init();}catch(err){}
idCounter++;}catch(err){}}}}}}
function pageUpdated(){for(var activeBehaviorObj in A17.activeBehaviors){if(A17.activeBehaviors.hasOwnProperty(activeBehaviorObj)){var thisBehaviorObj=A17.activeBehaviors[activeBehaviorObj];if(!document.body.contains(thisBehaviorObj.el)){try{thisBehaviorObj.behavior.destroy();delete A17.activeBehaviors[activeBehaviorObj];}catch(err){}}}}
searchDomAndInitBehaviors();}
searchDomAndInitBehaviors();document.addEventListener(pageUpdatedEventName,pageUpdated);document.addEventListener('content:updated',function(){searchDomAndInitBehaviors(event.data.el?event.data.el:'');});};A17.Helpers.objectifyForm=function(form){var field;var obj={};function fixedEncodeURIComponent(str){return encodeURIComponent(str).replace(/[!'()*]/g,function(c){return'%'+c.charCodeAt(0).toString(16);});}
if(_typeof(form)==='object'&&form.nodeName==='FORM'){var len=form.elements.length;for(var i=0;i<len;i++){field=form.elements[i];if(field.name&&!field.disabled&&field.type!=='file'&&field.type!=='reset'&&field.type!=='submit'&&field.type!=='button'){if(field.type==='select-multiple'){for(var j=form.elements[i].options.length-1;j>=0;j--){if(field.options[j].selected){obj[field.name]=field.options[j].value;}}}else if(field.type!=='checkbox'&&field.type!=='radio'||field.checked){obj[field.name]=fixedEncodeURIComponent(field.value);}}}}
return obj;};A17.Helpers.purgeProperties=function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){delete obj[prop];}}};A17.Helpers.resized=function(){var resizeTimer;var mediaQueryUpdated=false;window.addEventListener('resize',function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){var newMediaQuery=A17.Helpers.getCurrentMediaQuery();if(A17.currentMediaQuery!==newMediaQuery){A17.currentMediaQuery=newMediaQuery;mediaQueryUpdated=true;}
A17.Helpers.triggerCustomEvent(document,'resized');if(mediaQueryUpdated){A17.Helpers.triggerCustomEvent(document,'mediaQueryUpdated');mediaQueryUpdated=false;}},250);});};A17.Helpers.scrollToY=function(options){var settings={el:document,offset:0,duration:250,easing:'linear'};var start=Date.now();var from=0;var isDocument=false;var easingEquations={linear:function linear(t){return t;},easeIn:function easeIn(t){return t*t*t;},easeOut:function easeOut(t){return--t*t*t+1;},easeInOut:function easeInOut(t){return t<0.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1;}};var useRequestAnimationFrame=window.requestAnimationFrame;var scrollInterval;for(var def in options){if(typeof options[def]!=='undefined'){settings[def]=options[def];}}
if(settings.el===document){isDocument=true;settings.el=document.documentElement.scrollTop?document.documentElement:document.body;}
from=settings.el.scrollTop;if(from===settings.offset){return;}
function min(a,b){return a<b?a:b;}
function cancelInterval(){if(useRequestAnimationFrame){try{cancelAnimationFrame(scrollInterval);}catch(err){}}else{clearTimeout(scrollInterval);}}
function scroll(){if(isDocument&&from===0){document.documentElement.scrollTop=1;document.body.scrollTop=1;from=1;settings.el=document.documentElement.scrollTop?document.documentElement:document.body;requestAnimationFrame(scroll);}else{var currentTime=Date.now();var time=min(1,(currentTime-start)/settings.duration);var easedT=easingEquations[settings.easing](time);settings.el.scrollTop=easedT*(settings.offset-from)+from;if(time<1){doScroll();}else{cancelInterval();if(_typeof(settings.onComplete).toLowerCase()==='function'){settings.onComplete.call(this);}}}}
function doScroll(){if(useRequestAnimationFrame){scrollInterval=requestAnimationFrame(scroll);}else{scrollInterval=setTimeout(function(){scroll();},1000/60);}}
doScroll();};A17.Helpers.triggerCustomEvent=function(el,type,data){var event=document.createEvent('HTMLEvents');event.initEvent(type,true,true);event.data=data||{};event.eventName=type;event.target=el;el.dispatchEvent(event);};A17.Helpers.turnObjectToQueryString=function(obj){var queryString='';var count=0;if(Object.getOwnPropertyNames(obj).length>0){queryString='?';for(var key in obj){if(!obj.hasOwnProperty(key)){continue;}
queryString+=(count>0?'&':'')+key+'='+encodeURIComponent(obj[key]).replace(/[!'()]/g,'').replace(/\*/g,'%2A').replace(/%2B/ig,'+');count++;}}
return queryString;};A17.Helpers.turnQueryStringToObject=function(url){if(typeof url!=='string'){return{};}
var qsObj={};var search=url&&url.indexOf('?')>-1?url.split('?')[1]:location.search;search.replace(new RegExp('([^?=&]+)(=([^&]*))?','g'),function($0,$1,$2,$3){qsObj[$1]=$3;});return qsObj;};window.lazyLoad=function(selector,parentElement,ioptions,datasetAttr,callback){ioptions=ioptions||{root:null,rootMargin:"10%",threshold:0.3};var datasetItem;if(!datasetAttr){var regex=/data-(\w+[\-\w+]*)/g;var found=selector.match(regex)[0];datasetItem=found.substring(found.indexOf("data-")+5).replace(/(-\S)*/g,function(t){return t.toUpperCase();}).replace(/\-*/g,function(t){return t.replace("-","");});}else{datasetItem=datasetAttr;}
var baseElement;if(!parentElement){baseElement=document;}else if(_typeof(parentElement)=="object"){baseElement=parentElement;}else{baseElement=document.querySelector(parentElement);}
var lazyImages=[].slice.call(baseElement.querySelectorAll(selector));if("IntersectionObserver"in window){var lazyImageObserver=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting){var lazyImage=entry.target;observer.unobserve(lazyImage);lazyLoadLogic(lazyImage,datasetItem);}});},ioptions);lazyImages.forEach(function(lazyImage){lazyImageObserver.observe(lazyImage);});}else{var active=false;var lazyLoad=function lazyLoad(){if(active===false){active=true;setTimeout(function(){lazyImages.forEach(function(lazyImage){if(lazyImage.getBoundingClientRect().top<=window.innerHeight+window.innerHeight*parseInt(ioptions["rootMargin"])/100&&lazyImage.getBoundingClientRect().bottom>=0&&getComputedStyle(lazyImage).display!=="none"){lazyLoadLogic(lazyImage,datasetItem);lazyImages=lazyImages.filter(function(image){return image!==lazyImage;});if(lazyImages.length===0){document.removeEventListener("scroll",lazyLoad);window.removeEventListener("resize",lazyLoad);window.removeEventListener("orientationchange",lazyLoad);}}});active=false;},200);}};if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',lazyLoad);}else{lazyLoad();}
document.addEventListener("scroll",lazyLoad);window.addEventListener("resize",lazyLoad);window.addEventListener("orientationchange",lazyLoad);}};function lazyLoadLogic(lazyImage,dataAttrbiute){var data=parseJson(lazyImage.dataset[dataAttrbiute]);if(data.type==="image"){if(data.src.length>0){lazyImage.src=data.src;lazyImage.removeAttribute("data-"+dataAttrbiute);}
var srcset=lazyImage.dataset["srcset"];if(typeof srcset!=="undefined"){lazyImage.srcset=srcset;lazyImage.removeAttribute("data-srcset");}
var sizes=lazyImage.dataset["sizes"];if(typeof sizes!=="undefined"){lazyImage.sizes=sizes;lazyImage.removeAttribute("data-sizes");}}}
function parseJson(str){var jsonObject;try{jsonObject=JSON.parse(str);}catch(e){jsonObject=JSON.parse("{\"type\":\"image\" , \"src\":\""+str+"\"}");}
return jsonObject;}
(function(){window.A17Slider=function(options){var defaults={sliderContainer:undefined,sliderInner:undefined,slideAmount:undefined,paginator:undefined,itemsVisible:1,scrollBySet:false,cloneAll:false,currentSet:1,budge:0,centered:false,looping:true,automate:false,interval:5000,quickLinks:true,speed:250,quickLinksChar:"bull",keyControls:true,swipable:true,swipeThreshold:20,cursor:false};var this_instance=this;var reset=false;var hovering=false;var sliderMoving=false;var dragging=false;var preventClicks=false;var rtl=a17S("html[dir=rtl]",document).length==0?false:true;var dataAttr="data-A17Slider-position";var dupeAttr="data-A17Slider-dupe";var allowFocus=true;var missing_lis=0;var this_instance_params,original_node,currentSliderPos,nextBtn,prevBtn,totalLi,maxSet,timer,slides,slidesWidths,totalWidth,xDown,yDown,xDiff,yDiff,animationFrame;function init(){this_instance_params=defaults;options=options||{};for(var def in this_instance_params){if(typeof options[def]!=='undefined'){this_instance_params[def]=options[def];}}
if(this_instance_params.sliderContainer==undefined||this_instance_params.sliderInner==undefined||this_instance_params.paginator==undefined){if((typeof console==="undefined"?"undefined":_typeof(console))==="object"){console.warn("A17Slider: no sliderContainer, sliderInner or paginator specified");}
return;}
original_node=this_instance_params.sliderContainer.innerHTML;currentSliderPos=0;nextBtn=a17S("li.next a",this_instance_params.paginator);prevBtn=a17S("li.prev a",this_instance_params.paginator);totalLi=nodeCount(this_instance_params.sliderInner);maxSet=Math.ceil(totalLi/this_instance_params.itemsVisible);slides=children(this_instance_params.sliderInner);slidesWidths=[];totalWidth=0;if(this_instance_params.slideAmount===undefined){this_instance_params.slideAmount=this_instance_params.sliderContainer.offsetWidth;}
if(this_instance_params.automate){this_instance_params.looping=true;}
if(this_instance_params.slideAmount=="mixed"){this_instance_params.looping=true;this_instance_params.cloneAll=true;this_instance_params.itemsVisible=1;this_instance_params.scrollBySet=false;}else if(this_instance_params.slideAmount<this_instance_params.sliderContainer.offsetWidth){this_instance_params.cloneAll=true;this_instance_params.looping=true;}
if(this_instance_params.currentSet>maxSet||this_instance_params.currentSet===0){this_instance_params.currentSet=1;}
if(this_instance_params.scrollBySet&&this_instance_params.itemsVisible===1){this_instance_params.scrollBySet=false;}
if(this_instance_params.scrollBySet||this_instance_params.itemsVisible>1){this_instance_params.centered=false;}
if(!window.requestAnimationFrame){this_instance_params.swipable=false;}
this_instance_params.interval=this_instance_params.interval*1000;if(this_instance_params.slideAmount=="mixed"){Array.prototype.forEach.call(slides,function(slide,i){var width=attr(slide,"width")*1||slide.offsetWidth;slidesWidths.push(width);totalWidth+=width;});}else{Array.prototype.forEach.call(slides,function(slide,i){slidesWidths.push(this_instance_params.slideAmount);});totalWidth=this_instance_params.scrollBySet?this_instance_params.slideAmount*maxSet:this_instance_params.slideAmount*totalLi;}
Array.prototype.forEach.call(slides,function(node,i){attr(node,dataAttr,i);});if(this_instance_params.looping&&this_instance_params.itemsVisible==1&&totalLi>this_instance_params.itemsVisible&&!this_instance_params.centered&&!this_instance_params.cloneAll){var first_child=this_instance_params.sliderInner.firstElementChild.cloneNode(true);var last_child=this_instance_params.sliderInner.lastElementChild.cloneNode(true);attr(first_child,dupeAttr,"");attr(last_child,dupeAttr,"");tabIndexMinus1(first_child);tabIndexMinus1(last_child);this_instance_params.sliderInner.appendChild(first_child);this_instance_params.sliderInner.insertBefore(last_child,this_instance_params.sliderInner.firstChild);slides=children(this_instance_params.sliderInner);this_instance_params.budge=this_instance_params.budge-slidesWidths[0];}else if(this_instance_params.looping&&totalLi>this_instance_params.itemsVisible||this_instance_params.centered||this_instance_params.cloneAll){calculateMissingLi();var firstSet=[];var lastSet=[];Array.prototype.forEach.call(slides,function(node,i){var node_dupe=node.cloneNode(true);if(i<this_instance_params.itemsVisible&&!this_instance_params.cloneAll){attr(node_dupe,dupeAttr,"");tabIndexMinus1(node_dupe);firstSet.push(node_dupe);}
if(i>=totalLi-this_instance_params.itemsVisible&&!this_instance_params.cloneAll){attr(node_dupe,dupeAttr,"");tabIndexMinus1(node_dupe);lastSet.push(node_dupe);}
if(this_instance_params.cloneAll){attr(node,dupeAttr,"");tabIndexMinus1(node_dupe);firstSet.push(node_dupe);lastSet.push(node_dupe);}});slides=lastSet.concat(slides,firstSet);var new_slide_html="";Array.prototype.forEach.call(slides,function(node,i){new_slide_html+=node.outerHTML;});this_instance_params.sliderInner.innerHTML=new_slide_html;slides=children(this_instance_params.sliderInner);if(this_instance_params.cloneAll){this_instance_params.budge=this_instance_params.budge-totalWidth;if(missing_lis>0){this_instance_params.budge+=Math.round(this_instance_params.slideAmount/(this_instance_params.itemsVisible/missing_lis));}}else{this_instance_params.budge=this_instance_params.budge-slidesWidths[0];}}else if(!this_instance_params.looping&&totalLi>this_instance_params.itemsVisible&&this_instance_params.itemsVisible>1){calculateMissingLi();}
loadImages();currentSliderPos=calcCurrentSliderPos();updatePosition();toggleTransitionClass("add");if(this_instance_params.swipable&&this_instance_params.cursor){css(this_instance_params.sliderInner,"cursor","ew-resize");css(this_instance_params.sliderInner,"cursor","-webkit-grab");css(this_instance_params.sliderInner,"cursor","-moz-grab");css(this_instance_params.sliderInner,"cursor","grab");}
setUpPaginator();setUpInteractions();setTimeout(function(){trigger("slider_setup_complete");},10);}
function a17S(s,c){var r=(c||this_instance_params.sliderContainer).querySelectorAll(s||'☺');return r.length==1?r[0]:r;}
function css(el,p,v){if(_typeof(p)==="object"){for(var n in p){el.style[n]=p[n];}
return this;}else{if(v===undefined){return document.defaultView.getComputedStyle(el,null).getPropertyValue(p);}else{el.style[p]=v;return el;}}}
function attr(el,a,v){if(v===undefined){return el.getAttribute(a);}else{el.setAttribute(a,v);return el;}}
function addClass(el,c){if(el.classList){el.classList.add(c);}else{el.className+=' '+c;}}
function removeClass(el,c){if(el.classList){el.classList.remove(c);}else{el.className=el.className.replace(new RegExp('(^|\\b)'+c.split(' ').join('|')+'(\\b|$)','gi'),' ');}}
function hasClass(el,c){if(el.classList){return el.classList.contains(c);}else{return new RegExp('(^| )'+c+'( |$)','gi').test(el.className);}}
function children(el){var nodes=el.childNodes;var nodes_arr=[];Array.prototype.forEach.call(nodes,function(node,i){if(node.nodeType===1){nodes_arr.push(node);}});return nodes_arr;}
function nodeCount(el){return children(el).length;}
function trigger(type){var event=document.createEvent('HTMLEvents');event.initEvent(type,true,true);event.data={container:this_instance_params.sliderContainer,currentSet:this_instance_params.currentSet};event.eventName=type;this_instance_params.sliderContainer.dispatchEvent(event);}
function calculateMissingLi(){for(var i=1;i<=this_instance_params.itemsVisible;i++){var isEvenTest=totalLi%this_instance_params.itemsVisible;if(isEvenTest*1>0){missing_lis++;totalLi++;}}}
function loadImages(){var elements=a17S("img[data-src]",this_instance_params.sliderInner);Array.prototype.forEach.call(elements,function(el,i){var newImage=new Image();var $this=el;newImage.onload=function(){if($this.getAttribute("opacity")==0){el.css("opacity","1");}};if($this.getAttribute("src")==="//:0"){el.src=$this.getAttribute("data-src")||$this.getAttribute("src");}});}
function updatePosition(pos){try{window.cancelAnimationFrame(animationFrame);}catch(err){}
if(pos){var to=rtl?pos*-1:pos;animationFrame=window.requestAnimationFrame(function(){writeLeftPos(to);});}else{writeLeftPos(currentSliderPos);}}
function writeLeftPos(pos){css(this_instance_params.sliderInner,{"-webkit-transform":"translateX("+pos+"px)","-moz-transform":"translateX("+pos+"px)","-ms-transform":"translateX("+pos+"px)","transform":"translateX("+pos+"px)"});}
function moveSlider(direction){if(!sliderMoving){this_instance_params.sliderInner.style.willChange='transform';calculateNextPosition(direction);sliderMoving=true;updatePosition();setTimeout(function(){this_instance_params.sliderInner.style.willChange='auto';if(reset){currentSliderPos=calcCurrentSliderPos();toggleTransitionClass("remove");updatePosition();toggleTransitionClass("add");}
sliderMoving=false;trigger("slider_moved");if(!hovering){auto();}},this_instance_params.speed);trigger("slider_moving");updatePaginator();}}
function calculateNextPosition(direction){reset=false;if(direction=='right'){if(this_instance_params.centered){currentSliderPos-=(this_instance_params.sliderContainer.offsetWidth-slidesWidths[this_instance_params.currentSet-1])/2;}
if(this_instance_params.slideAmount=="mixed"){currentSliderPos-=slidesWidths[this_instance_params.currentSet-1];}else{currentSliderPos-=this_instance_params.slideAmount;}
if(this_instance_params.looping&&this_instance_params.currentSet==maxSet){reset=true;this_instance_params.currentSet=1;}else{this_instance_params.currentSet++;if(this_instance_params.currentSet==maxSet&&missing_lis>0){currentSliderPos+=Math.round(this_instance_params.slideAmount/(this_instance_params.itemsVisible/missing_lis));}}
if(this_instance_params.centered){currentSliderPos+=(this_instance_params.sliderContainer.offsetWidth-slidesWidths[this_instance_params.currentSet-1])/2;}}else if(direction=='left'){if(this_instance_params.centered){currentSliderPos-=(this_instance_params.sliderContainer.offsetWidth-slidesWidths[this_instance_params.currentSet-1])/2;}
if(this_instance_params.looping&&this_instance_params.currentSet==1){reset=true;this_instance_params.currentSet=maxSet;if(missing_lis>0){currentSliderPos-=Math.round(this_instance_params.slideAmount/(this_instance_params.itemsVisible/missing_lis));}}else{this_instance_params.currentSet--;if(this_instance_params.currentSet==1&&missing_lis>0);}
if(this_instance_params.centered){currentSliderPos+=(this_instance_params.sliderContainer.offsetWidth-slidesWidths[this_instance_params.currentSet-1])/2;}
if(this_instance_params.slideAmount=="mixed"){currentSliderPos+=slidesWidths[this_instance_params.currentSet-1];}else{currentSliderPos+=this_instance_params.slideAmount;}}else{this_instance_params.currentSet=direction;currentSliderPos=calcCurrentSliderPos();}}
function calcCurrentSliderPos(){var init_pos=0;for(var i=0;i<this_instance_params.currentSet-1;i++){init_pos+=slidesWidths[i];}
if(this_instance_params.centered){init_pos-=(this_instance_params.sliderContainer.offsetWidth-slidesWidths[this_instance_params.currentSet-1])/2;}
return this_instance_params.budge+init_pos*-1;}
function updatePaginator(){if(!this_instance_params.looping){addClass(prevBtn,"disabled");addClass(nextBtn,"disabled");if(this_instance_params.currentSet>1){removeClass(prevBtn,"disabled");}
if(this_instance_params.scrollBySet){if(this_instance_params.currentSet<maxSet){removeClass(nextBtn,"disabled");}}else{if(this_instance_params.currentSet+this_instance_params.itemsVisible<totalLi+1){removeClass(nextBtn,"disabled");}}}
if(this_instance_params.quickLinks){try{removeClass(a17S("li.current",this_instance_params.paginator),"current");}catch(err){}
addClass(a17S("li:nth-child("+this_instance_params.currentSet+")",this_instance_params.paginator),"current");}
Array.prototype.forEach.call(children(this_instance_params.sliderInner),function(slide,i){removeClass(slide,"a17s_visible");});var active_slides_search="";for(var i=0;i<this_instance_params.itemsVisible;i++){if(i>0){active_slides_search+=",";}
active_slides_search+="li["+dataAttr+"=\""+((this_instance_params.currentSet-1)*this_instance_params.itemsVisible+i)+"\"]";}
var active_slides=a17S(active_slides_search,this_instance_params.sliderInner);if(typeof active_slides.length==='undefined'){active_slides=[active_slides];}
Array.prototype.forEach.call(active_slides,function(slide,i){addClass(slide,"a17s_visible");});}
function auto(){if(this_instance_params.automate){clearTimeout(timer);timer=setTimeout(openNext,this_instance_params.interval);}}
function halt_auto(){clearTimeout(timer);hovering=true;}
function openNext(){moveSlider('right');}
function setUpPaginator(){if(this_instance_params.currentSet==1&&maxSet==1){nextBtn.style.display="none";prevBtn.style.display="none";this_instance_params.paginator.style.display="none";addClass(a17S("li",this_instance_params.sliderInner),"a17s_visible");}else{if(this_instance_params.quickLinks){var pages="";var loopUntil=this_instance_params.scrollBySet?maxSet:totalLi;for(var i=0;i<loopUntil;i++){if(this_instance_params.quickLinksChar=="bull"){pages=pages+'<li><a href="#">&bull;</a></li>';}else{pages=pages+'<li><a href="#">'+(i+1)+'</a></li>';}}
this_instance_params.paginator.innerHTML=pages+this_instance_params.paginator.innerHTML;nextBtn=a17S("li.next a",this_instance_params.paginator);prevBtn=a17S("li.prev a",this_instance_params.paginator);}
updatePaginator();timer=setTimeout(auto,50);}}
function setUpInteractions(){if(this_instance_params.currentSet==1&&maxSet==1){return;}
prevBtn.addEventListener("click",function(event){event.preventDefault();if(this_instance_params.looping){moveSlider('left');}else{if(!hasClass(this,"disabled")){moveSlider('left');}}},false);nextBtn.addEventListener("click",function(event){event.preventDefault();if(this_instance_params.looping){moveSlider('right');}else{if(!hasClass(this,"disabled")){moveSlider('right');}}},false);if(this_instance_params.quickLinks){var paginator_btns=a17S("li:not(.next):not(.prev) a",this_instance_params.paginator);Array.prototype.forEach.call(paginator_btns,function(a,i){a.addEventListener("click",function(event){event.preventDefault();if(i<maxSet&&!hasClass(this.parentNode,"current")){moveSlider(i+1);}});});}
this_instance_params.sliderContainer.addEventListener("mouseenter",function(){clearTimeout(timer);hovering=true;},false);this_instance_params.sliderContainer.addEventListener("mouseleave",function(){auto();hovering=false;},false);if(this_instance_params.keyControls){document.addEventListener("keydown",function(event){switch(event.keyCode){case 37:addClass(prevBtn,"active");break;case 39:addClass(nextBtn,"active");break;}},false);document.addEventListener("keyup",function(event){switch(event.keyCode){case 37:removeClass(prevBtn,"active");if(this_instance_params.looping){moveSlider('left');}else{if(!hasClass(prevBtn,"disabled")){moveSlider('left');}}
break;case 39:removeClass(nextBtn,"active");if(this_instance_params.looping){moveSlider('right');}else{if(!hasClass(nextBtn,"disabled")){moveSlider('right');}}
break;}});}
if(this_instance_params.swipable){this_instance_params.sliderInner.addEventListener("mousedown",function(event){event.preventDefault();xDown=document.all?window.event.clientX:event.pageX;yDown=document.all?window.event.clientY:event.pageY;onDraggingStart();},false);document.addEventListener("mousemove",function(event){onDragging(event,document.all?window.event.clientX:event.pageX,document.all?window.event.clientY:event.pageY);},false);document.addEventListener("mouseup",function(event){onDraggingEnd();},false);this_instance_params.sliderInner.addEventListener("click",function(event){if(preventClicks){event.preventDefault();event.stopPropagation();}},false);this_instance_params.sliderInner.addEventListener("touchstart",function(event){xDown=event.touches[0].clientX;yDown=event.touches[0].clientY;onDraggingStart();},false);this_instance_params.sliderInner.addEventListener("touchmove",function(event){onDragging(event,event.changedTouches[0].clientX,event.changedTouches[0].clientY);});this_instance_params.sliderInner.addEventListener("touchend",function(event){onDraggingEnd();},false);}
Array.prototype.forEach.call(slides,function(slide,i){var slide_links=slide.querySelectorAll("a");Array.prototype.forEach.call(slide_links,function(link,i){link.addEventListener("mousedown",function(event){allowFocus=false;setTimeout(function(){allowFocus=true;},100);});link.addEventListener("focus",function(event){if(allowFocus){this_instance_params.sliderContainer.scrollLeft=0;setTimeout(function(){this_instance_params.sliderContainer.scrollLeft=0;},0);clearTimeout(timer);var position_focussed=parseInt(attr(slide,dataAttr))||-1;if(position_focussed){if(this_instance_params.itemsVisible>1){position_focussed=Math.floor(position_focussed/this_instance_params.itemsVisible);}
moveSlider(position_focussed+1);}}else{event.preventDefault();}});});});}
function toggleTransitionClass(action){var redraw=this_instance_params.sliderInner.offsetHeight;if(action==="add"){setTimeout(function(){addClass(this_instance_params.sliderInner,"a17s_transition");},this_instance_params.speed);}else{removeClass(this_instance_params.sliderInner,"a17s_transition");}
var redraw=this_instance_params.sliderInner.offsetHeight;}
function onDraggingStart(){toggleTransitionClass("remove");dragging=true;halt_auto();if(this_instance_params.cursor){css(this_instance_params.sliderInner,"cursor","ew-resize");css(this_instance_params.sliderInner,"cursor","-webkit-grabbing");css(this_instance_params.sliderInner,"cursor","-moz-grabbing");css(this_instance_params.sliderInner,"cursor","grabbing");}}
function onDragging(event,xUp,yUp){if(dragging){if(!xDown||!yDown){return;}
xDiff=xDown-xUp;yDiff=yDown-yUp;if(Math.abs(xDiff)>Math.abs(yDiff)){event.preventDefault();preventClicks=true;if(xDiff>0){if(hasClass(nextBtn,"disabled")){xDiff=rubberBand(xDiff);}
updatePosition(currentSliderPos-xDiff);}else if(xDiff<0){if(hasClass(prevBtn,"disabled")){xDiff=rubberBand(xDiff);}
updatePosition(currentSliderPos-xDiff);}}else{return;}}}
function onDraggingEnd(){if(dragging){dragging=false;setTimeout(function(){preventClicks=false;},10);toggleTransitionClass("add");if(this_instance_params.cursor){css(this_instance_params.sliderInner,"cursor","ew-resize");css(this_instance_params.sliderInner,"cursor","-webkit-grab");css(this_instance_params.sliderInner,"cursor","-moz-grab");css(this_instance_params.sliderInner,"cursor","grab");}
if(!xDown||!yDown||xDiff===undefined||yDiff===undefined){return;}
if(Math.abs(xDiff)>Math.abs(yDiff)){if(Math.abs(xDiff)<=this_instance_params.swipeThreshold){updatePosition();auto();}else{if(xDiff>this_instance_params.swipeThreshold&&!hasClass(nextBtn,"disabled")){moveSlider('right');}else if(xDiff<this_instance_params.swipeThreshold*-1&&!hasClass(prevBtn,"disabled")){moveSlider('left');}else{updatePosition();auto();}}}
resetDragVars();}}
function resetDragVars(){xDown=undefined;yDown=undefined;xDiff=undefined;yDiff=undefined;}
function tabIndexMinus1(node){Array.prototype.forEach.call(node.querySelectorAll("a"),function(node,i){node.tabIndex=-1;});}
function rubberBand(diff){var ratio=Math.abs(diff)/75;var factor=1/(ratio+1);return diff*factor;}
this_instance.move=function(direction){moveSlider(direction);};this_instance.currentSet=function(){return defaults.currentSet;};this_instance.maxSet=function(){return maxSet;};this_instance.destroy=function(){this_instance_params.sliderContainer.innerHTML=original_node;delete this_instance["move"];delete this_instance["currentSet"];delete this_instance["destroy"];trigger("slider_destroyed");this_instance=null;};init();return this_instance;};})();min$=function(window,document,undefined){if(_typeof(document.querySelectorAll)===undefined||!('addEventListener'in window)||!window.getComputedStyle||!Object.keys){return;}
function $(elements){if(elements){this.length=elements.length;for(var i=0;i<this.length;i++){this[i]=elements[i];}}}
var event_uuid=0;var events_cache={};var _each=function each(arr,func){var arr_length=arr.length;for(var i=0;i<arr_length;i++){var value=func.call(arr[i],arr[i],i);if(value===false){break;}}
return arr;};function valid(node){return[1,9].indexOf(node.nodeType)>-1;}
$.prototype={each:function each(func){return _each(this,func);},on:function on(type,fn){_each(this,function(el){event_uuid++;if(!el.handlers){el.handlers={};}
var type_arr=type.split(".");el.handlers[event_uuid]=type;events_cache[event_uuid]={type:type_arr[0],namespace:type_arr[1]||"",fn:fn};el.addEventListener(type_arr[0],fn,false);});return this;},off:function off(type){_each(this,function(el){var node=el;var node_handlers=node.handlers||[];var type_arr=typeof type==="undefined"?[]:type.split(".");var event_type,event_namespace;if(type_arr.length>0){event_type=type_arr[0]||"";event_namespace=type_arr[1]||"";}
Object.keys(node_handlers).forEach(function(key){if(type_arr.length===0||event_type===events_cache[key].type&&event_namespace===events_cache[key].namespace||event_type===events_cache[key].type&&event_namespace===""||event_namespace===events_cache[key].namespace&&event_type===""){node.removeEventListener(events_cache[key].type,events_cache[key].fn,false);delete node.handlers[key];delete events_cache[key];}});});return this;},trigger:function trigger(type,data){var event=document.createEvent('HTMLEvents');event.initEvent(type,true,true);event.data=data||{};event.eventName=type;_each(this,function(el){event.target=el;el.dispatchEvent(event);});return this;},addClass:function addClass(className){_each(this,function(el){if(el.classList){el.classList.add(className);}else if(!min$(el).hasClass(className)){el.className+=' '+className;}});return this;},removeClass:function removeClass(className){_each(this,function(el){if(el.classList){el.classList.remove(className);}else{el.className=el.className.replace(new RegExp('(^|\\b)'+className.split(' ').join('|')+'(\\b|$)','gi'),' ');}});return this;},hasClass:function hasClass(className){var el=this.length>0?this[0]:this;if(!valid(el)){return this;}
if(el.classList){return el.classList.contains(className);}else{return new RegExp('(^| )'+className+'( |$)','gi').test(el.className);}},attr:function attr(a,v){if(v===undefined){var el=this.length>0?this[0]:this;if(!valid(el)){return this;}
return el.getAttribute(a);}else{_each(this,function(el){el.setAttribute(a,v);});return this;}},css:function css(p,v){if(_typeof(p)==="object"){_each(this,function(el){for(var n in p){if(p.hasOwnProperty(n)){el.style[n]=p[n];}}});return this;}else{if(v===undefined){var el=this.length>0?this[0]:this;if(!valid(el)){return this;}
return window.getComputedStyle(el,null).getPropertyValue(p);}else{_each(this,function(el){el.style[p]=v;});return this;}}},index:function index(item){var n=-1;if(item){item=item.length>0||item.addClass?item[0]:item;if(item===undefined||!valid(item)){return n;}}else{item=this[0]||this;}
_each(this,function(el,i){if(el===item){n=i;return false;}});return n;}};function min$(selector,context){var nodes=[];if(selector&&typeof selector!=="string"){nodes=selector.addClass?selector:[selector];}else if(selector){nodes=(context||document).querySelectorAll(selector||'☺');}
return new $(nodes);}
min$.each=_each;min$.prototype=$.prototype;return min$;}(window,document);window.objectFitImages=function(){function t(t,e){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+t+"' height='"+e+"'%3E%3C/svg%3E";}
function e(t){if(t.srcset&&!m&&window.picturefill){var e=window.picturefill._;t[e.ns]&&t[e.ns].evaled||e.fillImg(t,{reselect:!0}),t[e.ns].curSrc||(t[e.ns].supported=!1,e.fillImg(t,{reselect:!0})),t.currentSrc=t[e.ns].curSrc||t.src;}}
function i(t){for(var e,i=getComputedStyle(t).fontFamily,r={};null!==(e=l.exec(i));){r[e[1]]=e[2];}
return r;}
function r(e,i,r){var n=t(i||1,r||0);p.call(e,"src")!==n&&b.call(e,"src",n);}
function n(t,e){t.naturalWidth?e(t):setTimeout(n,100,t,e);}
function c(t){var c=i(t),o=t[a];if(c["object-fit"]=c["object-fit"]||"fill",!o.img){if("fill"===c["object-fit"])return;if(!o.skipTest&&g&&!c["object-position"])return;}
if(!o.img){o.img=new Image(t.width,t.height),o.img.srcset=p.call(t,"data-ofi-srcset")||t.srcset,o.img.src=p.call(t,"data-ofi-src")||t.src,b.call(t,"data-ofi-src",t.src),t.srcset&&b.call(t,"data-ofi-srcset",t.srcset),r(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{s(t);}catch(t){window.console&&console.warn("https://bit.ly/ofi-old-browser");}}
e(o.img),t.style.backgroundImage='url("'+(o.img.currentSrc||o.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=c["object-position"]||"center",t.style.backgroundRepeat="no-repeat",t.style.backgroundOrigin="content-box",/scale-down/.test(c["object-fit"])?n(o.img,function(){o.img.naturalWidth>t.width||o.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto";}):t.style.backgroundSize=c["object-fit"].replace("none","auto").replace("fill","100% 100%"),n(o.img,function(e){r(t,e.naturalWidth,e.naturalHeight);});}
function s(t){var e={get:function get(e){return t[a].img[e||"src"];},set:function set(e,i){return t[a].img[i||"src"]=e,b.call(t,"data-ofi-"+i,e),c(t),e;}};Object.defineProperty(t,"src",e),Object.defineProperty(t,"currentSrc",{get:function get(){return e.get("currentSrc");}}),Object.defineProperty(t,"srcset",{get:function get(){return e.get("srcset");},set:function set(t){return e.set(t,"srcset");}});}
function o(t,e){var i=!h&&!t;if(e=e||{},t=t||"img",f&&!e.skipTest||!d)return!1;"img"===t?t=document.getElementsByTagName("img"):"string"==typeof t?t=document.querySelectorAll(t):"length"in t||(t=[t]);for(var r=0;r<t.length;r++){t[r][a]=t[r][a]||{skipTest:e.skipTest},c(t[r]);}
i&&(document.body.addEventListener("load",function(t){"IMG"===t.target.tagName&&o(t.target,{skipTest:e.skipTest});},!0),h=!0,t="img"),e.watchMQ&&window.addEventListener("resize",o.bind(null,t,{skipTest:e.skipTest}));}
var a="bfred-it:object-fit-images",l=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,u="undefined"==typeof Image?{style:{"object-position":1}}:new Image(),g="object-fit"in u.style,f="object-position"in u.style,d="background-size"in u.style,m="string"==typeof u.currentSrc,p=u.getAttribute,b=u.setAttribute,h=!1;return o.supportsObjectFit=g,o.supportsObjectPosition=f,function(){function t(t,e){return t[a]&&t[a].img&&("src"===e||"srcset"===e)?t[a].img:t;}
f||(HTMLImageElement.prototype.getAttribute=function(e){return p.call(t(this,e),e);},HTMLImageElement.prototype.setAttribute=function(e,i){return b.call(t(this,e),e,String(i));});}(),o;}();}());;
$(window).bind("pageshow",function(event){if(event.originalEvent.persisted){window.location.reload()}});function closeTooltip(){$(".js__tooltipContainer").fadeOut("fast");}
function openTooltip($elem,htmlcontent){$(".js__tooltipContainer").remove();var $tooltip_container=$("<div class='tooltip-container js__tooltipContainer'></div>");$tooltip_container.append("<div class='tooltip-close js__tooltipClose'>X</div>");var $tooltip_contents=$("<div class='tooltip-contents'></div>");if(htmlcontent){$tooltip_contents.append(htmlcontent);}else{var href=$elem.attr("href");var data=$(href).clone(true,true);$tooltip_contents.append(data);}
$tooltip_container.append($tooltip_contents);var rect=$elem.position();$tooltip_container.css("top",rect.top+10);if((rect.left+150)>$elem.offsetParent().outerWidth())
$tooltip_container.css("left",rect.left-200);else
$tooltip_container.css("left",rect.left+5);$tooltip_container.appendTo($elem.offsetParent());$tooltip_container.fadeIn("fast");}
function closeModal(e){closePopup();}
function closePopup(){$("html").removeClass("s-modal-open-imc");$("html").removeClass("s-modal-open-examPopup");min$(document).trigger('modal:hide');}
function openPopup(content,event){var $popup_container=$(".js__popupContainer");$popup_container.attr("class","g-modal js__popupContainer");var $popup_contents=$(".g-modal__content");$popup_contents.html(content);if(event){if($(event.currentTarget).data("viewClass")){for(var i=0;i<$(event.currentTarget).data("viewClass").split(" ").length;i++){$popup_container.addClass($(event.currentTarget).data("viewClass").split(" ")[i]);if($(event.currentTarget).data("viewClass").split(" ")[i].indexOf('g-modal--imc')>=0||$(event.currentTarget).data("viewClass").split(" ")[i].indexOf('g-modal--VAdo')>=0){$("html").addClass("s-modal-open-imc");}
if($(event.currentTarget).data("viewClass").split(" ")[i].indexOf('g-modal--examPopup')>=0){$("html").addClass("s-modal-open-examPopup");}}}
if($(event.currentTarget).data("viewType")){if($(event.currentTarget).data("viewType")=="layer"){$(body).addClass("no-scroll");$popup_container.addClass("modal");}}}
$(document).on("keydown",function(e){if(e.keyCode==27)
closePopup()});min$("[data-behavior='Dropdown ToolTip']").trigger("dropdown:close");min$(document).trigger('articleTools:subnav:close');min$(document).trigger('tooltip:hide');min$(document).trigger('modal:show');}
function openPopup_getAjaxContent(url,event){loading.start();var ajaxUrl;if(url.indexOf("?")>=0){ajaxUrl=url.concat('&viewType=Popup');}else{ajaxUrl=url.concat('?viewType=Popup')}
$.ajax({type:"GET",url:ajaxUrl,dataType:"html",success:function(data){openPopup(data,event);min$(document).trigger('page:updated');},error:function(xhr,desc,e){console.log("Failed to submit: "+desc+"xhr: "+xhr+"e:"+e);if(xhr.status==403||xhr.getResponseHeader('pageType')=='accessDenied'){if(ajaxUrl.indexOf('addTagWrapper')>-1){ajaxUrl=decodeURIComponent(getURLParameter(ajaxUrl,'annonymousUrl'))}else{ajaxUrl=ajaxUrl.split('?')[0];}
window.location.href=ajaxUrl;}},complete:function(){loading.stop();}});}
$(document).on('submit','form',function(e){var longPasswordMessage="Incorrect format (Password should be 6-20 characters long, no spaces)";var pswdDoesntMatchMessage="Your passwords do not match.  Please try again.";$(this).find("[data-required='true'].error").removeClass("error");$(this).find("dd.s-error").removeClass("s-error");$(this).find("em").addClass("s-hidden");$(this).find("[data-required='true']:visible").each(function(item,index){if($(this).val().trim()==''){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");$(this).closest("dd").addClass("s-error");$(this).closest("form").find(".a-error-msg").removeClass("hidden");}
if($(this).data("min-length")){var minLength=parseInt($(this).data("min-length"));if($(this).val().trim().length<minLength){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");$(this).closest("dd").addClass("s-error");$(this).closest("form").find(".a-error-msg").removeClass("hidden");}}
if($(this).data("match")){var val=$(this).val().trim();var match=$("#"+$(this).data("match")).val().trim();if(val!=match){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");var targetDd=$(this).closest("dd");targetDd.addClass("s-error");targetDd.find(".m-deflist__notes--error").text(pswdDoesntMatchMessage)
$(this).closest("form").find(".a-error-msg").removeClass("hidden");}}
if($(this).attr("type")=="email"){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!re.test($(this).val())){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");$(this).closest("dd").addClass("s-error");$(this).closest("form").find(".a-error-msg").removeClass("hidden");}}if($(this).attr("type")=="tel"){var re=/(\+|00|)(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{1,14}$/;if(!re.test($(this).val())){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");$(this).closest("dd").addClass("s-error");$(this).closest("form").find(".a-error-msg").removeClass("hidden");}}});$(this).find("[data-limit]:visible").each(function(item,index){var type=$(this).data("limit-type")||"characters";var limit=$(this).data("limit");if(type=="characters"){if($(this).val().trim().length>parseInt(limit)){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");$(this).closest("form").find(".a-error-msg").removeClass("hidden");}}else if(type=="password"&&$(this).val().trim().length>parseInt(limit)){e.preventDefault();e.stopImmediatePropagation()
$(this).closest("dd").addClass("s-error");$(this).closest("dd").find(".m-deflist__notes.m-deflist__notes--error").text(longPasswordMessage);}else{if($(this).val().trim().split(" ").length>parseInt(limit)){e.preventDefault();e.stopImmediatePropagation();$(this).addClass("error");$(this).closest("form").find(".a-error-msg").removeClass("hidden");var errorMessageId=$(this).attr('name')+'WordsError';$('#'+errorMessageId).removeClass('s-hidden');}}});var captcha=$(this).find('.g-recaptcha');if(captcha.length){var response=grecaptcha.getResponse();var ignoreCaptcha=captcha.closest("form").find('input[name="ignoreCaptcha"]').val();if(response.length==0&&ignoreCaptcha!='true'){e.preventDefault();e.stopImmediatePropagation();$(this).find(".a-error-msg").removeClass("hidden");$(this).find(".g-recaptcha").closest("dd").addClass("s-error");}
else{}}});function viewTab($a,href){var $tabModule=$a.closest(".tabs");$tabModule.children(".tab-nav").children().removeClass("active");$tabModule.children(".tab-content").children(".tab-pane").removeClass("active");$a.closest("li").addClass("active");$(href+'Content').addClass("active");}
$(document).on('submit','.js__commentForm',function(e){e.preventDefault();var submit=true;$(this).find("[data-required='true'].error").removeClass("error");$(this).find("[data-required='true']:visible").each(function(item,index){if($(this).val().trim()==''){e.preventDefault();$(this).addClass("error");submit=false;}});if(submit)
submitCommentForm($(this));});function submitCommentForm(theForm){loading.start();var action=theForm.attr("action");var formData=theForm.serialize();var submitValue=theForm.find("input[name='submit']").val();var isEmptyString=submitValue==" ";if(isEmptyString)submitValue="submit";var toPost=formData+"&submit="+submitValue+"&layerDisplay=inline";theForm.find("input[name='submit']").attr({'disabled':'true'});$.ajax({type:"POST",url:action,data:toPost,dataType:"html",success:function(data){if($(".m-comment-filters").length){$(".m-comment-filters").before(data)}else{$(".submitComment").append(data)}
var dE=document.documentElement;dE.classList.remove('s-comments-form-open');dE.classList.remove('s-disable-touchmove');min$(document).trigger('body:unlock',{breakpoints:'xsmall small'});min$(document).trigger('page:updated');$(".m-comment-form").hide();},error:function(xhr,desc,e){alert("Sorry, this discussion is not accepting comments at this time");},complete:function(){loading.stop();min$(document).trigger('trigger:decide')}});return false;}
function resetInstBannerWidget(){var elem="g-banner-institution";var bannerInstitutionWidget=document.getElementsByClassName(elem);$.ajax({url:$(this).attr("href"),type:"post",dataType:"html",success:function(html){$(bannerInstitutionWidget).html($(html).find("."+elem).html());},});}
$(document).on("click",".js__institutionMultiIpDelete",function(e){e.preventDefault();$(this).closest("dl").find("input[name=indexes]").attr('checked',true);var key=this.getAttribute('name'),value=this.getAttribute('value');var object={};object[key]=value;var self=this;loading.start();$(this).closest("form").ajaxSubmit({data:object,success:function(data){$(self).parents("div.institutionContentWidget").replaceWith(data);min$(document).trigger('page:updated');},complete:function(){loading.stop();}});});$(document).on("click",".js__Cancel",function(e){e.preventDefault?e.preventDefault():(e.returnValue=false);var elem=$(this).closest(".institutionContentWidget").attr("class");var institutionContentWidget=$(this).closest(".institutionContentWidget");$.ajax({url:$(this).attr("href"),data:{resetInstRecords:"true"},type:"post",dataType:"html",success:function(html){$(institutionContentWidget).html($(html).find("[class='"+elem+"']").html());min$(document).trigger('page:updated');},});});$(document).on('change','textarea#ipRangeDesc1, textarea#ipRangeAddress1',function(e){$(this).closest("dl").find("input[name=indexes]").attr('checked',true);});$(document).on('change','textarea#addedIpRanges, textarea#addedDescription',function(e){var index=$(this).closest("dl").attr('data-item');$(this).closest("dl").find("input[name=addedIndexes]").attr('checked',true);$(this).closest("dl").find("input[name=addedIndexes]").attr('value',index);$(this).closest("dl").find("input[name=addedIndexes]").attr('id','index'+index);});function charCount(elementID,counterSpanID,maxLimit){var limit=maxLimit;if($('#'+elementID).val().length<limit){$('#'+counterSpanID).html(limit-$('#'+elementID).val().length+" characters remaining")}else{$('#'+elementID).val($('#'+elementID).val().substr(0,1200))+$('#'+counterSpanID).html('0');}}
function whenAvailable(name,callback){var interval=10;window.setTimeout(function(){if(window[name]){callback(window[name]);}else{window.setTimeout(arguments.callee,interval);}},interval);}
var hashmap={};$(document).on('mouseenter','.browseDO a.DO_thumbnailImage',function(event){var sourceControl=$(this);var url="/action/showDoPub?format=full&requestType=viewabstract&doi="+$(this).attr('id');if(hashmap[url]!=null){updateToolTip(hashmap[url],sourceControl);return;}
$.ajax({url:url,success:function(result){if(result!=''){updateToolTip(result,sourceControl);hashmap[url]=result;}}});});$(document).on('mouseleave','a.DO_thumbnailImage',function(event){$('.tooltip').css('display','none');});function updateToolTip(result,sourceControl){$('.tooltip').css("top",sourceControl.offset().top+70);$('.tooltip').css("left",sourceControl.offset().left-65);$('.tooltip .body').html(result);$('.tooltip').fadeIn('fast');}
mmsRegisterEvents=function(context){context.find('#btnSignIn',context).click(function(){var type=getQuerystring("viewType");});context.find("a[rel=gotofulltext]").click(function(){$("a[rel=publicationTab]").click();var sectObj=$(this.hash);if(sectObj.length>0)$('body, html').scrollTop(sectObj.offset().top);return false;});if($('#searchFilterContent').length){context.find('ul.searchTypes a, .sortTypes ul a, .filterGroup a, a.m-search-filters__type-close-filter').click($.mmsFilterBanks.linkClick);context.find('ul.searchTypes input, .filterGroup input').change($.mmsFilterBanks.inputClick);context.find('a.filterOption').off('click').click($.mmsFilterBanks.inputClick);context.find('.sortTypes select').change($.mmsFilterBanks.inputClick);context.find('#dateFilter form, .dateFilter form').submit($.mmsFilterBanks.formSubmit);if(!$('body').hasClass('browse'))
context.find('form.searchWithin').submit($.mmsFilterBanks.formSubmit);}
context.find('#findIssueByDate').submit(function(e){var year=$('#findIssueByDate .year').val().length;if(year<4||year>4){$('#findIssueByDateMessage').html("Please specify a four-digit year.").addClass("errorMessage").css("font-size","1em");e.preventDefault();}});}
function getQuerystring(key,default_){if(default_==null)default_="";key=key.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+key+"=([^&#]*)");var qs=regex.exec(window.location.href);if(qs==null)
return default_;else
return qs[1];}
$(document).on("click",".rightslink",function(e){var winprops="location=no,toolbar=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=1000,height=650";PopUp=window.open($(this).attr('href'),'Rightslink',winprops);e.preventDefault();});$(document).on("click","#weekView",function(e){$(".month_interval").hide();$(".week_interval").show();e.preventDefault();});$(document).on("click","#monthView",function(e){$.ajax({url:'/action/showMostReadArticlesAjax?journalCode=nejm&topArticlesType=last1Month',success:function(html){$('.month_interval').html(html);},});$('.month_interval').show();$('.week_interval').hide();return false;});$(document).on("click","#recentView",function(e){$(".classic_interval").hide();$(".recent_interval").show();return false;});$(document).on("click","#classicView",function(e){$.ajax({url:'/action/showMostCitedArticlesAjax?journalCode=nejm&topArticlesType=sinceInception',success:function(html){$('.classic_interval').html(html);},});$('.classic_interval').show();$('.recent_interval').hide();return false;});function refreshAds(){if(typeof mmsAdtech!=='undefined'){mmsAdtech.refreshAdsImageChallenge();}}
function getURLParameter(url,name){return(RegExp(name+'='+'(.+?)(&|$)').exec(url)||[,null])[1];}
function imageChallengeAjax(startFrom,ajaxRequest,pageSize,page,selectedItem){$.ajax({url:'/action/showImageChallenge',type:'POST',data:$.param({startFrom:startFrom,ajaxRequest:ajaxRequest,pageSize:pageSize,page:page,selectedItem:selectedItem}),success:function(data){$("#ic-galleryContent").html(data);refreshAds();$('html,body').animate({scrollTop:$("#ic-galleryContent").offset().top-20});},error:function(){alert("Error")},beforeSend:function(){loading.start();},complete:function(){loading.stop();lazyLoad("[data-src]",$("#ic-galleryContent")[0]);}});}
$(document).on("click",".imageChallengeNext, .imageChallengePrevious",function(e){var href=$(this).attr('href');var startFrom=getURLParameter(href,'startFrom');var ajaxRequest=getURLParameter(href,'ajaxRequest');var page=getURLParameter(href,'page');var newValueForPage=replaceUrlParam(window.location.href,'page',page);history.pushState(page,'',newValueForPage);var pageSize=$("#pageSize").attr("value");var selectedItem=$("#selectedItem").attr("value");if(ajaxRequest!=''){imageChallengeAjax(startFrom,ajaxRequest,pageSize,page,selectedItem);return false;}else{return true;}});function replaceUrlParam(url,paramName,paramValue){if(paramValue==null)
paramValue='';var pattern=new RegExp('\\b('+paramName+'=).*?(&|$)')
if(url.search(pattern)>=0){return url.replace(pattern,'$1'+paramValue+'$2');}
return url;}
$(document).on("click",".imagesChallengeOther",function(e){e.preventDefault();loading.start();var href=$(this).attr("href");if($("input[name=answer]").is(":checked")&&href.indexOf('answerIdParam')<0){var answerIdParam="answerIdParam=poll_1_answer_".concat($("input[name='answer']:checked").val());href=href.concat("&".concat(answerIdParam))}
$.ajax({url:href,type:'POST',success:function(data){$("#challengeContent").html(data);refreshAds();if($("input[name=answer]:checked").length){$(".js__imageChallengeSubmit").removeClass("a-btn--disabled");var el=$(".js__imageChallengeSubmit")[0];var par=el.parentNode;var next=el.nextSibling;par.removeChild(el);setTimeout(function(){par.insertBefore(el,next);},0);}},complete:function(){loading.stop();}});});$(document).on("click",".poll_option",function(){var form=$(this).closest("form");var questionsCount=form.children("div").find(".m-poll__items").length
var radiosSelected=form.find("input:radio:checked").length;if(questionsCount==radiosSelected&&!form.find('button').hasClass('RO_disabled'))
form.find('.poll_submit').removeAttr("disabled");});$(document).on("click",".js__viewPollResponses",function(e){$('form.m-poll').addClass('s-results')
return false;});$(document).on("click",".js__viewPollQuestion",function(e){$('form.m-poll').removeClass('s-results')
return false;});$(document).on("click",".js__imageChallengeSubmit[type=submit]",function(e){e.preventDefault();loading.start();$(this).closest('form').ajaxSubmit({data:"ajaxRequest=question",success:function(data){if(document.location.pathname.indexOf('image-challenge',document.location.pathname.length-('image-challenge').length)!==-1){$("#challengeContent").html(data);}else{window.location="/image-challenge";}
loading.stop();refreshAds();}});});$(document).on("click",".js__imageChallengeTryAgain",function(e){var tryAgainUrl=$(this).attr("href");var ajaxUrl=tryAgainUrl.concat('&ajaxRequest=question&imageChallengeViewType=tryAgain');$.ajax({url:ajaxUrl,success:function(data){if($("#challengeContent").length){$("#challengeContent").html(data);}}});return false;});$(document).on("click","#creditSubmitId",function(e){var data={attemptCount:$('input[name="attemptCount"]').val(),doi:$('input[name="doi"]').val(),credit:$('input[name="credit"]').val(),accreditation:$('input[name="accreditation"]').val()};$(this).closest('form').ajaxSubmit({data:data,success:function(data){$("#examComplete").html(data);$('#relatedExamsBox').removeClass('hidden').addClass('shown');var examCompleteMsg=$('#examCompleteMsg').val();$('p.examMessage').replaceWith('<p class="examMessage">'+examCompleteMsg+'</p>');}});return false;});$(document).on('click','.challenge .answers, .challenge .showVotes',function(){var checked=0;if($('input:radio[name=answer]').length){$('input:radio[name=answer]').each(function(){if($(this).attr('checked'))
checked=1;});if(!($('input:radio[name=answer]').attr('disabled'))&&checked){$('.challenge input[type=button]').removeAttr('disabled');}}});var processCheckAnswer=function(element){var $checkAnswer=$("button[name='checkAnswer']");var allAnswered=$('.question').length==$('.question .answer input:radio').filter(':checked').length;if(!allAnswered){$checkAnswer.attr('disabled','disabled');}else{$checkAnswer.removeAttr('disabled');}};$(document).on('click','.printWindow',function(){window.open(this.href,'printWindow','menubar=1,width=800,height=600,scrollbars=1');return false;});var getUrlParameter=function getUrlParameter(sParam){var sPageURL=decodeURIComponent(window.location.search.substring(1)),sURLVariables=sPageURL.split('&'),sParameterName,i;for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split('=');if(sParameterName[0]===sParam){return sParameterName[1]===undefined?true:sParameterName[1];}}};mmsTriggerActions=function(){var triggerTool=getUrlParameter('triggerTool');var triggerCookie=Cookies.get('TOOL_TRIGGER');if(triggerTool&&triggerCookie!=null){var link=$('a#'+triggerTool);if(link.length>0){$('a#'+triggerTool).get(0).click();Cookies.set('TOOL_TRIGGER',null,{path:'/',expires:-1});}
if(triggerTool=="postComment"){var commentLink=$('a.scrollDirectly').eq(0);if(commentLink.length>0){if($("#article_comments"))$("#article_comments").get(0).scrollIntoView();Cookies.set('TOOL_TRIGGER',null,{path:'/',expires:-1});}}}}
function clk(u,r,a){var e=encodeURIComponent||escape,xmlhttp=0,x="";if(!c_url){return true;}
var cu=[c_url,u?"&url="+e(u):"",r?"&rk="+e(r):"",a?"&"+a:""].join("");if(typeof(XMLHttpRequest)!="undefined"){try{xmlhttp=new XMLHttpRequest();x="XHR";}catch(e){xmlhttp=0;}}
if(!xmlhttp&&typeof(window.ActiveXObject)!="undefined"){try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP");x="XO2";}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");x="XO1";}catch(E){xmlhttp=0;}}}
if(xmlhttp){xmlhttp.open("GET",cu+"&lot=xml&ourl="+x,true);xmlhttp.overrideMimeType("text/html");console.log(cu+"&lot=xml&ourl="+x)
xmlhttp.send(null);}
return true;}
$(document).on('click','.js__navLink li',function(){$(this).parent().find('li.active').removeClass('active');$(this).addClass('active');});$(document).on('click','.js__sliLearn',function(){clk($(this).attr('data-search-result-id'),$(this).attr('data-search-result-rank'));});$(document).on('click','.js__audioWindow',function(){var popup=window.open(this.href,'printWindow','menubar=0,width=800,height=630,scrollbars=1');if(popup==null||typeof(popup)=='undefined'){alert('A pop-up has been blocked by the browser. Please allow pop-ups from nejm.org and try again.');}
return false;});function commentSearchResultPage(i){var f=document.forms.commentSearch;f.startRow.value=i;f.submit();}
function newWindow(url){var new_window;var windowProperties;windowProperties="width=1000,height=700,top=30,left=230,toolbar=0,menubar=0,resizable=1,scrollbars=yes";if(new_window==null){new_window=window.open(url,null,windowProperties);}else{new_window.document.replace(url);}}
$(document).on('click','.js__discussionLink',function(){if(this.hash=='#article_comments'){$('a[rel=publicationTab]').click();}
return true;});function receiveMessage(e){var authorized_domains=["interactive-ad.nejm.org","interactive-review.nejm.org","interactive-dev.nejm.org","interactive-qa.nejm.org","interactive.nejm.org"];var iframe_domain=e.origin.replace(/.*?:\/\//g,"");if(authorized_domains.indexOf(iframe_domain)!==-1){window.mmsData=(window.mmsData||{});window.mmsData.object=e.data;if((e=="closeModal")||(e.data=="closeModal")){closePopup();}else if(e=="refreshMocMsg"||e.data=="refreshMocMsg"){mmsMoc.refreshMocMsg();}
if(typeof(sendCustomEvent)=="function"){sendCustomEvent('crossDomainDataPass');}}}
function sendCustomEvent(evt){if(document.createEvent&&document.body.dispatchEvent){var event=document.createEvent('Event');event.initEvent(evt,true,true);document.body.dispatchEvent(event);}else if(window.CustomEvent&&document.body.dispatchEvent){var event=new CustomEvent(evt,{bubbles:true,cancelable:true});document.body.dispatchEvent(event);}}
var loading={start:function(){$("html").addClass("s-ajaxPageLoadMask");},stop:function(){$("html").removeClass("s-ajaxPageLoadMask");}};$(document).on('dblclick','.js__preventDoubleClick',function(e){e.preventDefault();});$(document).on("click",".JS__goBack",function(e){window.history.back();});(function($){$.each(['show','hide'],function(i,ev){var el=$.fn[ev];$.fn[ev]=function(){this.trigger(ev);return el.apply(this,arguments);};});})(jQuery);function redoFigureViewerFunctions(){var $section=$('.figure-viewer');var $holder=$section.find('.figure-viewer__hold__fig');var $figureNav=$section.find('.figure-viewer__ctrl__next, .figure-viewer__ctrl__prev');var $browsebtn=$('.figure-viewer__ctrl__browse');var $returnbtn=$('.figure-viewer__ctrl__return');var $captionRegion=$section.find('.figure-viewer__cent__right');var $contentRegion=$section.find('.figure-viewer__cent__left');var $lister=$section.find('.figure-viewer__hold__list');var $hideList=$section.find('.zoomSlider, .figure-viewer__label__zoom');var figureViewer=UX.figureViewer;UX.figureViewer.replace=function(element){if($("[data-html-tables-available]").length){$(".figure-viewer__hold--html-toggle").removeClass("hidden");}
var $showHTML=$section.find('.figure-viewer__hold--html-toggle').find("input[name='format']:checked");var $captionHolder=$section.find('.figure-viewer__hold__figcap');var rid=element.find(".open-figure-link").data("rid")||element.data("rid");$section.data("selected-rid",rid);var dlLink=element.find("img").data("dl-url");var contentId=element.find("img").data("fv-download-contentid");var interactionType=element.find("img").data("fv-interactiontype");var dlType=element.find("img").data("fv-download-type");var $downloadElement=$section.find(".o-figures-modal__nav-link--download");if(dlLink!=null&&dlLink!=''){$downloadElement.removeClass("hidden");$downloadElement.attr("href",dlLink);$downloadElement.attr("data-download-contentid",contentId);$downloadElement.attr("data-interactionType",interactionType);$downloadElement.attr("data-download-type",dlType);}else if($downloadElement!=null){$downloadElement.addClass("hidden");}
var $figure;$holder.find("figure").empty();if(dlType!='Figure'&&$("#table-content-"+rid).length&&$showHTML.val()=='html'){$figure=$("#table-content-"+rid).html();$(".o-figures-modal__zoom").addClass("hidden");}else{$holder.addClass('loading-spinner');$figure=element.find('img').clone();$figure.css('display','none');$figure.attr("src",$figure.attr("data-lg-src")).prop("srcset","").prop("sizes","").prop("width","").prop("height","");$(".o-figures-modal__zoom").removeClass("hidden");$figureNav.removeClass('is-hidden');$browsebtn.removeClass('is-hidden');$captionRegion.removeClass('is-hidden');$hideList.each(function(){$(this).removeClass('is-hidden');});}
$holder.find('figure').append($figure);$figure.on('load',function(){$holder.removeClass("loading-spinner");$figure.css('display','block');});var $caption=element.find('figcaption, .figcaption').first().clone();var $title=$caption.find('strong').remove();$('.figure-viewer__title__text').text($title.text());$holder.removeClass('is-hidden');$captionHolder.empty();$captionHolder.append($caption);$('.figure-viewer__cent__right').scrollTop(0);min$(document).trigger('page:updated');UX.figureViewer.zoom.reset();};UX.figureViewer.browse=function(element){$holder.addClass('is-hidden');$figureNav.addClass('is-hidden');$browsebtn.addClass('is-hidden');$returnbtn.removeClass('is-hidden');$captionRegion.removeClass('js-open');$contentRegion.removeClass('js-open');$captionRegion.addClass('is-hidden');$hideList.each(function(){$(this).addClass('is-hidden');});$lister.removeClass('is-hidden');$('.figure-viewer__hold__list').empty();if(figureViewer.options.filter){figureViewer.$figuresToShow.each(function(){var $fig=$(this).clone(true);$('.figure-viewer__hold__list').append($fig);});}else{figureViewer.$figures.each(function(){if($(this).hasClass('article__tabFigure')){var $fig=$(this).clone(true);$('.figure-viewer__hold__list').append($fig);}});}
var selected=$section.data("selected-rid");$section.find(".open-figure-link[data-rid='"+selected+"']").closest(".figure").addClass("s-active");$(".figure-viewer__hold__list .figure").find(".open-figure-link").off("click");$(".figure-viewer__hold__list .figure").on("click",".open-figure-link",function(e){e.preventDefault();e.stopPropagation();var $this=$(this);var $figure=$this.parents(".figure");var $list=$figure.closest('.figure-viewer__hold__list');$this.closest(".figure-viewer").removeClass("s-menu-open");figureViewer.$currentIndex=$list.find('.figure').index($figure);UX.figureViewer.replace($figure);});};var $image=$section.find('figure');$image.on('panzoomchange',function(e,panzoom,transform){if(panzoom.scale==6){$section.find("[data-figures-modal-zoom-in]").prop("disabled",true)}else{$section.find("[data-figures-modal-zoom-in]").prop("disabled",false)}
if(panzoom.scale==1){$image.css('transform','matrix(1, 0, 0, 1, 0, 0)');$section.find("[data-figures-modal-zoom-out]").prop("disabled",true)}else{$section.find("[data-figures-modal-zoom-out]").prop("disabled",false)}});$(".js__figureDownload").off("click");$section.on("show",function(){min$(document).trigger('page:updated');$("html").addClass('s-figures-modal-open');if($("#article_figures").find(".figure").length===1){var nextBtn=$(this).find("[data-figures-modal-next]");var prefBtn=$(this).find("[data-figures-modal-prev]");!nextBtn.hasClass("disabled")&&nextBtn.addClass("disabled");!prefBtn.hasClass("disabled")&&prefBtn.addClass("disabled");}
window.setTimeout(function(){var $captionHolder=$('.figure-viewer__cent__right');$captionHolder.scrollTop(0);$('.figure-viewer').find('figure').panzoom("option",{"exponential":false});},10);});$section.on("hide",function(e){$(this).removeClass("s-menu-open");$(this).removeClass("s-figcaption-collapsed");$("html").removeClass('s-figures-modal-open');min$(document).trigger('page:updated');});$(".m-cta__figure-link.open-figure-link").on('click',function(){if($(this).closest(".m-letter").find(".figure").length===1){$section.find("[data-figures-modal-next]").addClass("disabled");$section.find("[data-figures-modal-prev]").addClass("disabled");}});$(".figure-viewer__ctrl__caption").off("click").on("click",function(e){$(this).closest(".figure-viewer").toggleClass("s-figcaption-collapsed");});$(".figure-viewer__ctrl__browse").off("click").on("click",function(e){$(this).closest(".figure-viewer").addClass("s-menu-open");UX.figureViewer.browse();});$(".figure-viewer__ctrl__return").on("click",function(e){$(this).closest(".o-figures-modal__menu").scrollTop(0);$(this).closest(".figure-viewer").removeClass("s-menu-open");});$(".figure-viewer__hold__fig figure").off("click");min$('a[href^="#"].js__showFigure').off("click");$(document).on("click",".js__showFigure",function(event){event.preventDefault();event.stopPropagation();var rid=$(this).data("figure-id");var $container=$(this).closest("section");var $figure=$container.find("[data-rid='"+rid+"']:not(.js__showFigure)").closest('.figure');if($figure.length<1){$container=$(this).closest(".o-article-body__content");$figure=$container.find("[data-rid='"+rid+"']").closest('.figure');}
UX.figureViewer.on.show($figure,$(".open-figure-link").index($figure));});$(".open-figure-link .js__showFigure").off("click").click(function(event){event.preventDefault();event.stopPropagation();var rid=$(this).data("figure-id");UX.figureViewer.on.show(UX.figureViewer.$figuresToShow.find("[data-rid='"+rid+"']:not(.js__showFigure)").closest('.figure'));});$(".figure-viewer__cent__right").off("click").on("click",".js__showFigure",function(event){event.preventDefault();event.stopPropagation();var rid=$(this).data("figure-id");UX.figureViewer.on.hide();window.setTimeout(function(){UX.figureViewer.on.show(UX.figureViewer.$figuresToShow.find("[data-rid='"+rid+"']:not(.js__showFigure)").closest('.figure'));},1);});if($(".js__articleShareTools").length){$(".js__articleShareToolsFV").html($(".js__articleShareTools").html());if(window.addthis){addthis.toolbox('.js__articleShareToolsFV');}}else{$(".js__articleShareToolsFV").closest("li").addClass("hidden");}
$(".figure-viewer__hold--html-toggle input").on("change",function(e){e.preventDefault();e.stopPropagation();var selected=$section.data("selected-rid");var $figure=$(document).find(".open-figure-link[data-rid='"+selected+"']").closest(".figure");UX.figureViewer.replace($figure);return false;});$(".figure-viewer__ctrl__prev").on("click",function(e){closeFiguresDropdown(e.target);});$(".figure-viewer__ctrl__next").on("click",function(e){closeFiguresDropdown(e.target);});function closeFiguresDropdown(target){var dropdown=$(".a-dropdown");if(dropdown.hasClass('s-active')){dropdown.removeClass("s-active");dropdown.trigger("dropdown:close");$(target).closest('li').attr('tabindex','-1');$(target).closest('li').focus();}}}
$('.js__articleShareToolsFV').on('click',function(e){var dropdown=$('[data-behavior="Dropdown ToolTip"]')[0];min$(dropdown).trigger("dropdown:close");A17.Functions.setFocusOnTarget(dropdown.parentNode)});$(document).on('click','.js__openerWindow',function(e){if(window.opener){window.opener.location.href=$(this).attr('href');window.close();}else{window.location.href=$(this).attr('href');}
return false;});function setNavLocation(){if(A17.currentMediaQuery.match(/(xsmall|small|medium)/)){$(".g-nav__primary").data("location","main_nav");}else{$(".g-nav__primary").data("location",$(".g-nav__primary").data("location-orig"));}}
$(window).on("load",function(){var classHidden="s-hidden";if(window.sessionStorage.getItem("flag")=="1"){$("#institutionsList").removeClass(classHidden);}
if($('.js__MMSJobsBox').length){var targetNode=$('#nejm_jobs')[0];var observerConfig={attributes:true,childList:true,subtree:true};var observer=new MutationObserver(observerCallback);observer.observe(targetNode,observerConfig);var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=$('.js__MMSJobsBox').attr('data-url');var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);}});$(document).on('click','.JS__selectFederation',function(){window.sessionStorage.setItem("flag","1");});$('.JS__selectFederation').change(function(){$("#login_service").submit();});$(document).on('submit','.js__contactUs',function(e){e.preventDefault();var submit=true;$(this).find("[data-required='true'].error").removeClass("error");$(this).find("[data-required='true']:visible").each(function(item,index){if($(this).val().trim()==''){e.preventDefault();$(this).addClass("error");submit=false;}});if(submit){var key='submit',value=this.getAttribute('value');var href=this.getAttribute('action');var object={};object[key]=value;var self=this;$(this).closest("form").ajaxSubmit({url:href,data:object,success:function(data){$('#js__contactUs_result').html(data);min$(document).trigger('page:updated');}});}});$(document).on('submit','#requestRapidReviewForm, #presubmissionInquiryForm',function(e){var id=this.getAttribute('id');e.preventDefault();var d=new Date();var curMonth=d.getMonth()+1;var curDay=d.getUTCDate();var curYear=d.getFullYear();var selectedMonth=$("#submission_MonthDropDown option:selected").text();var selectedDay=$("#submission_DayDropDown option:selected").text();var selectedYear=$("#submission_YearDropDown option:selected").text();if(selectedYear<=curYear&&(selectedDay<=curDay&&selectedMonth<=curMonth||selectedMonth<curMonth)&&id=='requestRapidReviewForm'){$('.m-deflist__multifield').addClass('s-error');return;}
loading.start();$(this).closest("form").ajaxSubmit({success:function(data){loading.stop();$('#'+id).html(data);min$(document).trigger('page:updated');}});});function scrollToHash(){var $target=document.getElementById(A17.windowHash);if($target){A17.Functions.setFocusOnTarget($target);min$(document).trigger('history:replacestate',{url:'#'+A17.windowHash});var budge=(A17.currentMediaQuery.indexOf('large')>-1)?79:10;var offsetTarget=A17.Helpers.getOffset($target).top-budge;window.scrollTo(0,offsetTarget);setTimeout(function(){window.scrollTo(0,offsetTarget);},16);}}
function loadRecaptcha(){if(!grecaptcha)return;$('.g-recaptcha').filter(function(){return!$(this).hasClass('explicit');}).each(function(){grecaptcha.render($(this)[0],$(this).data());});}
function clearCapcha(){if(grecaptcha)
grecaptcha.reset(0);}
function validateDateRange(){var fromMonth=$('#fromMonth').val();var toMonth=$('#toMonth').val();var fromYear=$('#fromYear').val();var toYear=$('#toYear').val();if(!(parseInt(fromYear)>parseInt(toYear)||(parseInt(fromYear)===parseInt(toYear)&&parseInt(fromMonth)>parseInt(toMonth)))){return true;}else{return false;}}
$(document).on('click','.g-nav__primary a',function(){updateURL($(this));return true;});$('.g-nav__primary a').mousedown(function(event){if(event.which==3){updateURL($(this));return true;}});function updateURL(_this){var href=_this.attr("href");var type=$('.g-nav__primary').attr("data-location");if(href.indexOf('query=')<0){if(type=='main_nav_large'&&$(window).width()>=1024){href=href+(href.indexOf('?')>=0?'':'?')+'query=main_nav_lg';}else if(type=='main_nav'||$(window).width()<1024){href=href+(href.indexOf('?')>=0?'':'?')+'query=main_nav_condensed';}}
_this.attr("href",href);}
function recaptchaCallback(){$('.js__sendEmailBtn').removeAttr('disabled');}
function roDisableLinks(){$('button.RO_disabled').wrap('<span class="RO_disabled"></span>');$('.RO_disabled').attr('data-tooltip','Site operates in read only mode, this functionality is disabled');$('.RO_disabled').attr('data-behavior','ToolTip');$('.RO_disabled').removeClass('js__getAjaxContent js__openPopup');$('.RO_disabled').click(function(e){e.preventDefault();});$('a, button','.ICDiv_RO_disabled').each(function(){var $this=$(this);if($this.is('button')){$this.attr('disabled','disabled');$this.removeClass('js__imageChallengeSubmit');}else{$this.addClass('RO_AJAX');$this.removeClass('imagesChallengeOther');}});}
$(document).on("click",".js_DeleteArticle",function(e){e.preventDefault();loading.start();$.ajax({url:$(this).attr("href"),dataType:"html",success:function(html){if(html.indexOf('Not Authenticated')!==-1){document.documentElement.scrollTop=0;location.reload();}else{$('#alertSettingsCitationsSection').html(html);}},complete:function(){loading.stop();}});});$(document).on("click",".js__anchorPagination a",function(e){e.preventDefault();loading.start();$.ajax({url:$(this).attr("href"),dataType:"html",success:function(html){if(html.indexOf('My Nejm Alerts - Not Authenticated')!==-1){document.documentElement.scrollTop=0;location.reload();}else{$('#alertSettingsCitationsSection').html(html);}},complete:function(){loading.stop();}});});function checkIgnoreCaptcha(){var submitButton=$('.js__sendEmailBtn');if(submitButton!=null&&submitButton!=undefined){var form=submitButton.closest('form');if(form.find('input[name="ignoreCaptcha"]').length)
$('.js__sendEmailBtn').removeAttr('disabled');}}
function bindEvents(){$('#sli_search_2').keydown(function(e){if(e.keyCode==9){this.blur();}});}
function checkCaptchaCodeField(){$("#captchaCode").on("input",function(){$('.js__sendEmailBtn').removeAttr('disabled');});}
$(document).on("click",".gateway_button_RO_disabled",function(e){e.preventDefault();return false;});$(document).on('click','.filterCmeOption',function(){$('#enableCmeCheckboxFilter').val('true');});$(document).on("mouseenter click touchstart",'.a-dropdown-prompt',function(e){$(".nejmGroupImg").each(function(){$(this).attr('src',$(this).attr('path'));});$('.g-nejm-group-dd__carousel').attr('data-behavior','NEJMGroupCarousel');min$(document).trigger('page:updated');});
if(_ready==undefined){var _ready=$(document).ready(function(){$('.disabled-link').removeClass('disabled-link');$('.disabled-button').removeAttr('disabled').removeClass('disabled-button');if($('.gateway_button_RO_disabled').length){var buttonInRoMode=$('.gateway_button_RO_disabled').wrap('<span class="RO_disabled"></span>');buttonInRoMode.css('cursor','default');}
roDisableLinks();checkIgnoreCaptcha();mmsRegisterEvents($('body'));bindEvents();lazyLoad("[data-src]");$("#lnkSignOut").click(function(){Cookies.set('redirectUri',null,{path:'/',domain:'.nejm.org'});});if($('#js_tocPage').length){var url=window.location.href;if(url.indexOf('#savePageId')>-1){var id=url.substring(url.lastIndexOf('#savePageId')+1);$('li#'+id+' button').trigger('click');}}
$('.hiddenChildrenFacets, #search-history-panel').removeClass('hidden');$(".hiddenChildrenFacets, #search-history-panel").css("display","none")
$("input.noJS").val("Submit");if($('.o-article-body__content').length){if($('input[name="hasFigureAndMedia"]').val()!='false'){$('.figuresMediaTab').removeClass('hide');}
var doi=$(".getDiscussion_ajax").closest("section").attr('data-doi');var body=$(".getDiscussion_ajax").closest("section").find('#discussionContent');if(body.html()!=null&&body.html().replace(/\s/g,'')==''){body.html($('#discussionContentTemp').html());$('#discussionContentTemp').remove();}
var url=((window.location.href.indexOf('/media/')>0)?'/media':'')+'/action/showSupplements';$.ajax({data:{doi:$('#article_supplementary_material').attr('data-doi')},type:"GET",url:url,dataType:"html",success:function(data){if(data!=''){$('#article_supplementary_material').find('.o-article-body__collapsible-content').html(data);}else{$('#article_supplementary_material').remove();}}});var contentList="ul.dynamicToolsList";if($(contentList+" li").length<1){$(contentList).closest("li").addClass("hidden");}
if($("ul.moreItems li").length<1){$("ul.moreItems").closest("li").addClass("hidden");}
$(".o-article-body__content .m-inline-tabs__tab").on('collapsible:open',function(e){min$(document).trigger('page:updated');if($(this).hasClass("figuresMediaTab")){$("[data-article-tools] li.js__ToolsContentLi").hide();}else{$("[data-article-tools] li.js__ToolsContentLi").show();}
min$(document).trigger('articleTools:subnav:close');});if(window.location.hash.indexOf("figures_media")>=0){$("[data-article-tools] li.js__ToolsContentLi").hide();}
$('#discussionInformationSwap').appendTo($('#discussionInformation')).removeClass('u-hide');$('#vcm_media').appendTo($('#vcmDOVideo')).removeClass('u-hide');if($("[data-quick-links]").length){if($("[data-quick-links]").html().length==0){$("[data-quick-links]").remove();}}
$(".moreItems a").on("click",function(){min$(document).trigger('articleTools:subnav:close');});}
if($('.js__advancedSearch').length){$('.daterange').click(function(){$('#date_range').prop("disabled",true);$('#customDate').prop("disabled",false);});if($("ul[data-daterange-custom]").is(":visible")){$(".daterange").trigger('click');}
$('.yearrange').click(function(){$('#date_range').prop("disabled",false);$('#customDate').prop("disabled",true);});}
if($('.js__MMSSearchResults').length){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src="https://b.sli-spark.com/sli-spark.js";var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);}
if($('nav.m-simple-tabs').length==0&&$('html').hasClass('s-compact-menu')){$('#search').addClass('g-search__gateway');}
if($('.js__MMSQuickSearch').length){if(getURLParameter(window.location.href,'q'))
$('html').addClass("s-search-active-init");}
if($('.js__literatumLoginWidget').length){if($('#loginViewJsp').val()=='loginFormRequal'){if($("#redirectUri").val().toLowerCase().indexOf($("#cdfRoot").val().toLowerCase())>-1&&$("#redirectUri").val().toLowerCase().indexOf($("#cdfRoot").val().toLowerCase())<10){$("form[action='/action/doLogin']").attr('action','/action/doLogin/'+encodeURI($("#redirectUri").val()));}
Cookies.set('redirectUri',$("#redirectUri").val(),{path:'/',domain:'.nejm.org'});if($('#loginViewType').val()=='Iframe'){$("form").attr("target","_top");$("#loginUri").val($("#loginUri").val().replace("viewType=Iframe",""));}
else if($('#loginViewType').val()!='Layer'){if($('#login').val().length==0)
$('#login').focus();else
$('#password').focus();}}
else if($('#loginViewJsp').val()=='loginForm'){if($(".errorMessage").length!=0&&$('#loginViewType').val()!='Layer'){if($('#login').val().length==0)
$('#login').focus();else
$('#password').focus();}}
if($('#loginViewType').val()=='Iframe'){var url=window.location.pathname;$(".moreLink a").addClass("event-cdfLyrForgotPwd");$("#savePassword").attr("id","cdfSavePassword");}
$('.createAccountFromSaveLayer').on("click",function(event){Cookies.set('TRIGGER_CREATE_ACCOUNT','y',{path:'/'});});}
if($('.js__accessDenialWidget')[0]){if($(".errorMessage").length!=0&&$('#loginViewType').val()!='Layer'){if($('#login').val().length==0)
$('#login').focus();else
$('#password').focus();}}
if($('#layout').val()=='Iframe'){var url=window.location.pathname;$(".moreLink a").addClass("event-cdfLyrForgotPwd");$("#savePassword").attr("id","cdfSavePassword");}
if($('.js__showExamWidget')[0]){if($('#creditClaim').length){$('#creditClaim input:first').attr('checked',true);}
if($('#creditSubmitted').length){$('#relatedExamsBox').removeClass('hidden').addClass('shown');}
$('.question').each(function(){var question=$(this);var id=question.attr('id');$('.answer input:radio[name='+id+']').click(function(){processCheckAnswer(this);})});processCheckAnswer();}
if($(".tabs-widget").length){$(".tabs-widget .tab-nav > li > a").on("click",function(e){var href=$(this).attr("href");if(href.indexOf("#")==0)
history.pushState(null,null,href)});}
if($('.js__imageChallengeQuestionWidget').length||$(".mostRecentImageChallengeWidget").length){$(".js__imageChallengeQuestionWidget").on("change","input[type='radio']",function(){$(this).closest("form").find("button[type='submit']").removeClass("a-btn--disabled");})}
if($('.js__literatumDigitalObjectContent').length||$('.m-media-launcher').length){if($(".ig").length!=0||$(".imc").length!=0||$('#article_about_imc').length){window.addEventListener("message",receiveMessage,false);}}
if($('.js__travelingHomepage').length){$(".js__travelingHomepage .m-simple-listing-item__img img").on("error",function(e){$(this).hide();$(this).parent().hide();$(this).closest("li").removeClass("m-simple-listing-item--img");});}
$(document).on("submit",".js__popUpAjaxSubmit",function(e){loading.start();e.stopImmediatePropagation();e.preventDefault();var disableSaveBtn=($(this).attr("name")=='editTagsForm');var $form=$(this);var preventDoubleClicksElements=$(this).find(".js__preventDoubleClick");if(preventDoubleClicksElements.length>0){preventDoubleClicksElements.attr("disabled",true);}
$(this).ajaxSubmit({success:function(data){loading.stop();openPopup(data,e);if(disableSaveBtn){$("[data-button-type='save']",$form).attr("disabled",true);}}});});$(".js__openPopupMove").off("click");$(document).on('click','.js__openPopupMove',function(e){e.preventDefault();var content=$(this).attr('href');$(content).removeClass('hide');$(document).on("keydown",function(e){if(e.keyCode==27)
$(content).addClass('hide');});});$(document).on('click','.js__popupCloseMove',function(e){e.preventDefault();$(this).closest('.popup-container').addClass('hide');});$(document).on("click",".js__popupClose",function(e){e.preventDefault();if($('div.msgBox.moc').length){mmsMoc.refreshMocMsg();}
if($(this).closest(".g-modal__content").length>0)
closePopup();else close();});$(document).on("change",".js__examEvaluationForm input",function(e){if($(this).closest("form").find("input:checked").length==4)
$(this).closest("form").find("input[type='submit']").prop("disabled",false);});$(".js__keywordSearch").on("submit",function(e){var submit=false;$(this).find("input[type='text']").each(function(item,index){if(!submit)
submit=$(this).val().trim()!='';});if(!submit){$(this).find(".error-msg").show();$(".js__keywordSearch fieldset li").first().addClass('s-error');$(this).closest("form").addClass('form-error');A17.Helpers.scrollToY({offset:$(this).closest("form").offset().top-30});}else{$(this).find(".error-msg").hide();$(".js__keywordSearch fieldset li").first().removeClass('s-error');}
if(!validateDateRange()&&$('#customDate').attr('disabled')==undefined){$(this).find(".date-error-msg").show();$(".js__keywordSearch .o-form-lg__date-range").addClass('s-error');$(this).closest("form").addClass('form-error');submit=false}
return submit;});$(".js__citationSearch").on("submit",function(e){var submit=false;$(this).find("input[type='text']").each(function(item,index){submit=$(this).val().trim()!='';});if(!submit){$(this).find(".error-msg").show();$(".js__citationSearch fieldset li").addClass('s-error');$(this).closest("form").addClass('form-error');A17.Helpers.scrollToY({offset:$(this).closest("form").offset().top-30});}
return submit;});$("[data-behavior='Mask']").on("click",function(e){var dE=document.documentElement;if(!dE.classList.contains('s-modal-open-imc'))
closePopup();});if($('.figure').length){UX.controller.init();UX.figureViewer.init();redoFigureViewerFunctions();}
min$('a.js__openPopup').off("click");$(document).on("click",".js__openPopup",function(e){e.stopPropagation();e.preventDefault();if($('.js__figureViewer-overlay').is(":visible")){UX.figureViewer.on.hide();}
if(A17.currentMediaQuery.indexOf('small')>-1){if($(this).data("mobileurl")&&$(this).data("mobileurl")!='media-not-supported'){window.open($(this).data("mobileurl"));return true;}}
var url=$(this).attr("href");if($(this).hasClass("js__getAjaxContent")){openPopup_getAjaxContent(url,e)}else{openPopup($(url).html(),e);}});min$(document).trigger('page:updated');min$(document).on('search:hide',function(){$('#sli_autocomplete').css('display','none');});min$(document).on('navPrimary:hide',function(){$('#sli_autocomplete').css('display','none');});if($(".js__authorAffiliation").length>1){$(".s-inactive .js__authorAffiliation").each(function(){$("[data-target-id='"+$(this).attr("id")+"']").hide();})}
if($(".js__month_interval").length){$.ajax({url:'/action/showMostReadArticlesAjax?journalCode=nejm&topArticlesType=last1Month',success:function(html){$('.js__month_interval').html(html);},});}
if($(".js__most_emailed").length){$.ajax({url:'/action/showMostEmailedArticles?journalCode=nejm&topArticlesType=last1Week',success:function(html){$('.js__most_emailed').html(html);},});}
if($(".js__recent_interval").length){$.ajax({url:'/action/showMostCitedArticlesAjax?journalCode=nejm&topArticlesType=recent',success:function(html){$('.js__recent_interval').html(html);},});}
if($(".js__classic_interval").length){$.ajax({url:'/action/showMostCitedArticlesAjax?journalCode=nejm&topArticlesType=sinceInception',success:function(html){$('.js__classic_interval').html(html);},});}
if($(".js__mostCitedInPress").length){$.ajax({url:'/action/showMostCitedInPressAction?journalCode=nejm&topArticlesType=last30Days',success:function(html){$('.js__mostCitedInPress').html(html);},});}
min$('[data-inline-tabs-link]',document).on('click',function(event){var container=$(event.target).closest("[data-behavior='InlineTabs']");container.find(".s-inactive .js__authorAffiliation").each(function(){$("[data-target-id='"+$(this).attr("id")+"']").hide();});container.find(".s-active .js__authorAffiliation").each(function(){$("[data-target-id='"+$(this).attr("id")+"']").show();})});if($("[data-print-page]").length){window.print();}
$(".js__customMenu").find("a[href='"+window.location.pathname+"']").first().parent().addClass('s-active');mmsTriggerActions();$(document).on("click","[data-admin-toggle]",function(e){e.preventDefault();var target=$(this).data("admin-toggle");$("[data-"+target+"]").toggleClass("hidden");});setNavLocation();document.addEventListener('mediaQueryUpdated',setNavLocation);$("[data-duplicate]").each(function(index,item){$("[data-duplicate-here]").after($(this).clone());});$(document).on("click",".js__institutionMultiIpChangeSubmit, .js__BannerUpdateSubmit, .js__linkResolverSubmit",function(e){e.preventDefault();e.stopPropagation();$("textarea#addedIpRanges").each(function(){var IpRangeField=$(this);if(!$.trim($(IpRangeField).val())){IpRangeField.val("emptyIpAddress");var index=IpRangeField.closest("dl").attr('data-item');IpRangeField.closest("dl").find("input[name=addedIndexes]").attr('checked',true);IpRangeField.closest("dl").find("input[name=addedIndexes]").attr('value',index);IpRangeField.closest("dl").find("input[name=addedIndexes]").attr('id','index'+index);}});$("textarea.emptyIpAddress").each(function(){var IpRangeField=$(this);if(!$.trim($(IpRangeField).val())){IpRangeField.val("emptyIpAddress");}});var key=this.getAttribute('name'),value=this.getAttribute('value');var object={};object[key]=value;var self=this;loading.start();$(this).closest("form").ajaxSubmit({data:object,success:function(data,textStatus,xhr){if(xhr.getResponseHeader('user-not-authenticated')!=null){window.location.reload();}else{$(self).parents("div.institutionContentWidget").replaceWith($(data).filter('div.institutionContentWidget')[0]);if($(self).hasClass("js__BannerUpdateSubmit")){resetInstBannerWidget();}
loading.stop();min$(document).trigger('page:updated');}}});});if($("[data-auto-select-radio]").length){$("[data-auto-select-radio] select").on("click, change",function(){$(this).closest("[data-auto-select-radio]").find("input[type='radio']").prop("checked",true);});}
var cmeErr=$('.selected.s-incorrect').length;var cmeSuccess=$('.a-alert-bar--success').length;var screenSize=$(window).width();if((cmeErr>=1||cmeSuccess>0)&&screenSize<=768){$('.m-article-meta').hide();}
min$(document).on('searchFilters:hide',min$(document).trigger('searchFilters:filterButton:show'));if($("#audioPageTitle").length){var audioPageTitle=$("#audioPageTitle").val();mmsData.page.title=audioPageTitle;mmsData.page.name=mmsData.page.type+" - "+audioPageTitle;}
if($('input#promptSave').length){$("#form1 input[type=checkbox], #form1 input[type=radio]").removeAttr('disabled');var $content=$('#contentAlertPopup').val();$('#form1 input').change(function(e){$('#promptSave').val('true');});$(document).on("click","a",function(e){var href=$(this).attr('href');if($('#promptSave').val()=='true'&&href.indexOf('mailto:')==-1&&$(this).attr('data-behavior')===undefined&&$(this).attr('target')!='_blank'&&!$(this).hasClass('js__scrollTop')){e.preventDefault();e.stopPropagation();$('#targetPageLink').val(href);openPopup($content,e);}});$(document).on("click","#saveChanges",function(){$('button.submitAlertBtn').trigger("click");});$(document).on("click","#discardAndContinue",function(){window.location.href=$('#targetPageLink').val();});$(document).on('modal:hide',function(){$('#promptSave').val('false');});}
alertOpensAnewTab();})}else{if($('.js__literatumDigitalObjectContent')[0]){if($(".ig").length!=0||$(".imc").length!=0){window.addEventListener("message",receiveMessage,false);}}}
$(document).on("click","[data-open-window]",function(event){window.open($(this).attr("href"),'_blank','width=900,height=700');event.preventDefault();});$("#article_citing_articles").on('collapsible:open',function(e){loading.start();var doi=$(this).attr('data-doi');var area=$(this).attr('data-area');var body=$(this).find('#citingContent');if(body.html().replace(/\s/g,'')==''){$.ajax({type:"GET",url:'/doi/citedby/'+doi+"?ajaxrequest=true&area="+area,dataType:"html",success:function(data){body.html(data);min$(document).trigger('page:updated');},complete:function(){loading.stop();}});}else{loading.stop();}});$("#article_letters").on('collapsible:open',function(e){loading.start();var doi=$(this).attr('data-doi');var body=$(this).find('#lettersContent');if(body.html().replace(/\s/g,'')==''){$.ajax({type:"GET",url:((window.location.href.indexOf('/media')>-1?'/media':'')+'/action/showLetters'),dataType:"html",success:function(data){body.html(data);min$(document).trigger('page:updated');UX.figureViewer.expand();redoFigureViewerFunctions();},data:{doi:doi},complete:function(){loading.stop();}})}else{loading.stop();}});$('#show-date ,#hide-date').keypress(function(e){var key=e.which;if(key==13)
{$(this).click();return false;}});$(document).on('click','.valid-date',function(event){var year=$('#issue_filter_year').val().length;var day=$('#issue_filter_day').val();if((year<4||year>4)||(day<0||day>31)){event.preventDefault();$('#findIssueByDate').find('.a-error-msg').remove();$('#findIssueByDate').find('.m-filter-form__fieldset').before("<span class='a-error-msg'><svg aria-hidden='true' class='icon--alert'> <use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='#icon--alert'></use> </svg>Please, enter a valid date. </span>");}});$(document).ajaxComplete(function(){$('.disabled-link').removeClass('disabled-link');roDisableLinks();checkIgnoreCaptcha();checkCaptchaCodeField();alertOpensAnewTab();if(typeof mmsData!='undefined'&&mmsData.search.manualFilter.CMEcheckbox==null&&$('#enableCmeCheckboxFilter').val()=='true'){mmsData.search.manualFilter.CMEcheckbox='false';}
min$(document).trigger('page:updated');});$(document).on('click','#filterCustomDateRangeButton',function(e){var submit=true;if(!validateDateRange()){$(".date-error-msg-hidden").removeClass("hidden");$(this).closest('ol').find('li:not(:last-child)').addClass("s-error");submit=false}
return submit;});$("img").on("error",function(){if($(this).attr("src")!=='//:0'){$(this).hide();}});(function(){function isIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');if(msie>0){return parseInt(ua.substring(msie+5,ua.indexOf('.',msie)),10);}
var trident=ua.indexOf('Trident/');if(trident>0){var rv=ua.indexOf('rv:');return parseInt(ua.substring(rv+3,ua.indexOf('.',rv)),10);}
var edge=ua.indexOf('Edge/');if(edge>0){return parseInt(ua.substring(edge+5,ua.indexOf('.',edge)),10);}
return false;}
function prepareDownloadLinks(){$('[data-download-filetype]').attr('target','_blank');}
if(isIE()){$(function(){prepareDownloadLinks();$(document).on('ajaxSuccess',function(){prepareDownloadLinks();});});}
function downloadURL(url){console.log('is IE',isIE()<12,isIE(),isIE()!==false);if(isIE()<12&&isIE()!==false){console.log('is IE < 12');var link=document.createElement("a");link.download="";link.href=url;link.target="_blank";link.click();}else{console.log('is not IE 11');window.location=url;}}
$(window).on("load",function(){var href=window.location.href;var download=getURLParameter(href,'downloadfile');var loaded=getURLParameter(href,'loaded');var audio=$('#playAudio')[0];if(download==='showAudioSummaryPlayer'&&audio){$(audio).click();}else if(download&&$('.o-article-body__content').length&&loaded==null){var doiSuffix=getURLParameter(href,'doi').substring(8);if($('a.js__audioWindow[href*='+doiSuffix+']').length&&(download==='showMediaPlayer'||download==='showAudioSummaryPlayer'))
$('a.js__audioWindow[href*='+doiSuffix+']')[0].click();else{var url=window.location.origin+'/action/'+download+window.location.search+'&loaded=true';downloadURL(url);}}});}());function isValidInput(){if(!validateDateRange()){$('#date-dl').addClass('s-error');return false;}
$('#date-dl').removeClass('s-error');return true};function alertOpensAnewTab(){$('[target="_blank"], [target="nejm-win"]').each(function(){if($(this).find('.sr-only').length===0)
$(this).append('<span class="sr-only">. opens in new tab</span>');});}
var observerCallback=function(mutationsList,observer){min$(document).trigger('page:updated');alertOpensAnewTab();observer.disconnect();}
$(document).on('click','.advanced-toggle',function(e){e.preventDefault();$("#refine-panel").toggleClass("full-overlay");$("#refine-panel").toggleClass('hidden');$(this).toggleClass('open');if(window.innerWidth<769){$("body, html").addClass("no-scroll");$("body").removeClass('topToDown');}
$("#refine-panel select").selectbox();});$('.newSearchFacets').on('click','.overlay-close',function(e){e.preventDefault();$("body").addClass('closeDataRangeXs');$(this).parents().removeClass("full-overlay sub-overlay openDataRangeXs");$("#refine-panel").addClass("hidden");$("body, html").removeClass("no-scroll");});
(function($){$.mmsLayers={config:{baseCookieDomain:location.hostname,rules:[],layouts:{}}};$.mmsLayers.processRules=function(data){var showLayers=$("#showLayers").val();if(showLayers=="true"){var counter=$.cookie('Layer Counter')||0;var sessionCookie="Layer Viewed";var firstAd=$("#firstAd").val();var secondAd=$("#secondAd").val();var interstitialAd=$("#DTM_Position_InterstitialBanner").length;var rulePassed=false;$.mmsLayers.setP3P();$.cookie('Layer Counter',++counter,{domain:data.baseCookieDomain,path:'/'});$.each(data.rules,function(i,rule){if(!($.mmsViews.currentLayer&&$.mmsViews.currentLayer.visible)&&!$.cookie(sessionCookie)&&rule.enabled&&!rulePassed){if(i==0&&$.mmsLayers.showOnPage(rule,counter)&&!$.cookie(rule.cookieName)&&firstAd.length>0){$.mmsLayers.showLayerAd(firstAd,rule.styleClass);$.mmsLayers.setCookie(rule);$.mmsLayers.setSessionCookie(sessionCookie);return false;}else if(i==1&&$.mmsLayers.showOnPage(rule,counter)&&!$.cookie(rule.cookieName)&&secondAd.length>0){$.mmsLayers.showLayerAd(secondAd,rule.styleClass);$.mmsLayers.setCookie(rule);$.mmsLayers.setSessionCookie(sessionCookie);return false;}else if(i==2&&(counter<=2)&&!$.cookie(rule.cookieName)&&interstitialAd){mmsAdtech.showInterstitial(function(){$.mmsLayers.setCookie(rule);$.mmsLayers.setSessionCookie(sessionCookie);},function(){if($.mmsLayers.showOnPage(data.rules[3],counter)){mmsDTM.mmsLayers.loadiPerception(rule);}});return false;}else if(i==3&&$.mmsLayers.showOnPage(rule,counter)){mmsDTM.mmsLayers.loadiPerception(rule);return false;}}});}};$.mmsLayers.showOnPage=function(rule,pageCount){return(rule&&(rule.showOnPage==undefined||rule.showOnPage==pageCount));}
$.mmsLayers.showLayerAd=function(adContent,styleClass){openPopup(adContent,null)};$.mmsLayers.setCookie=function(rule){$.mmsLayers.setP3P();$.cookie(rule.cookieName,'viewed',{path:'/',expires:rule.frequency,domain:$.mmsLayers.config.baseCookieDomain});}
$.mmsLayers.setSessionCookie=function(cookieName){$.mmsLayers.setP3P();$.cookie(cookieName,'viewed',{path:'/',expires:null,domain:$.mmsLayers.config.baseCookieDomain});}
$.mmsLayers.setP3P=function(){if($("head meta[http-equiv='P3P']").length===0)$('head').append("<meta http-equiv='P3P' content='CP=\"NOI DSP ADM OUR IND OTC\"'>");}
$(function(){$.mmsLayers.processRules($.mmsLayers.config);});})(jQuery);(function($){$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value===null||value===undefined)){options=$.extend({},options);if(value===null||value===undefined){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=String(value);return(document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||{};var decode=options.raw?function(s){return s;}:decodeURIComponent;var pairs=document.cookie.split('; ');for(var i=0,pair;pair=pairs[i]&&pairs[i].split('=');i++){if(decode(pair[0])===key)return decode(pair[1]||'');}
return null;};})(jQuery);