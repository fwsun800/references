<!DOCTYPE html>
<!--[if IE 8]><html lang="en" dir="ltr" class="ie8"><![endif]-->
<!--[if IE 9]><html lang="en" dir="ltr" class="ie9"><![endif]-->
<!--[if gt IE 9]><!-->
<html dir="ltr" class="js no-touch localstorage sessionstorage contenteditable use-opacity-transitions" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Disqus Comments</title>

    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <style>
        .alert--warning {
            border-radius: 3px;
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #FFE070;
            color: #A47703;
        }

        .alert--warning a,
        .alert--warning a:hover,
        .alert--warning strong {
            color: #A47703;
            font-weight: bold;
        }

        .alert--error p,
        .alert--warning p {
            margin-top: 5px;
            margin-bottom: 5px;
        }
        
        </style>
    
    <style>
        
        html {
            overflow: hidden;
        }
        

        #error {
            display: none;
        }

        .clearfix:after {
            content: "";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        
    </style>

<script src="a_data/cbgapi.loaded_0" async=""></script><script src="a_data/sdk_002.js" async="" crossorigin="anonymous"></script><script crossorigin="anonymous" id="bootstrap-script" data-app="lounge" src="a_data/lounge_002.js"></script><meta http-equiv="Content-Security-Policy" content="script-src https:;"><link rel="stylesheet" href="a_data/lounge.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="lounge/main" src="a_data/lounge.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="remote/config" src="a_data/config.js"></script><style id="css_1592256014330"></style><!-- base href="https://disqus.com/embed/comments/?base=default&f=harvard-nlp&t_u=http%3A%2F%2Fnlp.seas.harvard.edu%2F2018%2F04%2F03%2Fattention.html&t_d=The%20Annotated%20Transformer&t_t=The%20Annotated%20Transformer&s_o=default" --><link rel="stylesheet" href="a_data/recommendations.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="recommendations/main" src="a_data/recommendations.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="fb" src="a_data/sdk.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="gapi" src="a_data/api.js" gapi_processed="true"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}</style><link rel="stylesheet" href="a_data/highlight.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="common/vendor_extensions/highlight" src="a_data/highlight.js"></script></head>
<body>
    

    
    <div id="error" class="alert--error">
        <p>We were unable to load Disqus. If you are a moderator please see our <a href="https://docs.disqus.com/help/83/"> troubleshooting guide</a>. </p>
    </div>

    
    <script type="text/json" id="disqus-forumData">{"session":{"canModerate":false,"audienceSyncVerified":false,"mustVerify":false,"canReply":true,"mustVerifyEmail":false},"forum":{"aetBannerConfirmation":null,"founder":"213053281","twitterName":null,"commentsLinkOne":"1 Comment","guidelines":null,"favicon":{"permalink":"https://disqus.com/api/forums/favicons/harvard-nlp.jpg","cache":"//a.disquscdn.com/1587400073/images/favicon-default.png"},"commentsLinkZero":"0 Comments","disableDisqusBranding":false,"daysAlive":0,"createdAt":"2018-04-04T12:32:53.273776","category":"Tech","aetBannerEnabled":false,"aetBannerTitle":null,"raw_guidelines":null,"colorScheme":"auto","id":"harvard-nlp","installCompleted":false,"moderatorBadgeText":"","commentPolicyText":null,"aetEnabled":false,"channel":null,"sort":4,"description":null,"newPolicy":true,"raw_description":null,"language":"en","adsReviewStatus":1,"pk":"5460729","forumCategory":{"date_added":"2016-01-28T01:54:31","id":8,"name":"Tech"},"permissions":{},"commentPolicyLink":null,"aetBannerDescription":null,"name":"Harvard NLP","commentsLinkMultiple":"{num} Comments","settings":{"threadRatingsEnabled":false,"adsDRNativeEnabled":false,"behindClickEnabled":false,"disable3rdPartyTrackers":false,"adsVideoEnabled":false,"adsProductVideoEnabled":false,"adsPositionTopEnabled":false,"ssoRequired":false,"unapproveLinks":false,"adsPositionRecommendationsEnabled":false,"linkAffiliationEnabled":true,"adsProductLinksThumbnailsEnabled":false,"hasCustomAvatar":false,"organicDiscoveryEnabled":true,"adsProductDisplayEnabled":false,"adsProductLinksEnabled":false,"threadReactionsEnabled":false,"adsEnabled":false,"disableSocialShare":false,"allowAnonPost":false,"adsProductStoriesEnabled":false,"adultContent":false,"allowAnonVotes":false,"gifPickerEnabled":true,"mustVerify":true,"mustVerifyEmail":true,"audienceSyncEnabled":false,"mediaembedEnabled":true,"adsPositionBottomEnabled":false,"discoveryLocked":false,"validateAllPosts":false,"adsSettingsLocked":false,"isVIP":false,"adsPositionInthreadEnabled":false},"organizationId":4104443,"typeface":"auto","url":"http://nlp.seas.harvard.edu","daysThreadAlive":0,"avatar":{"small":{"permalink":"https://disqus.com/api/forums/avatars/harvard-nlp.jpg?size=32","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"large":{"permalink":"https://disqus.com/api/forums/avatars/harvard-nlp.jpg?size=92","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}},"signedUrl":"http://disq.us/?url=http%3A%2F%2Fnlp.seas.harvard.edu&key=7UAWL2vyUsMpGDRuYdM5yw"}}</script>

    <script type="text/json" id="disqus-threadData">{"cursor":{"hasPrev":false,"prev":null,"total":86,"hasNext":true,"next":"1:0:0"},"code":0,"response":{"lastModified":1591948071,"posts":[{"editableUntil":"2018-05-01T02:45:24","dislikes":0,"thread":"6595120245","numReports":0,"likes":5,"message":"\u003cp>Great post! Q: shouldn't there be a \"bias=False\" in this statement in Generator?\u003cbr>self.proj = nn.Linear(d_model, vocab)\u003c/p>","id":"3869074635","createdAt":"2018-04-24T02:45:24","author":{"username":"joost1123","about":"","name":"joost1123","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2011-06-22T14:33:01","profileUrl":"https://disqus.com/by/joost1123/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"12889728","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/joost1123.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/joost1123.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/joost1123.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Great post! Q: shouldn't there be a \"bias=False\" in this statement in Generator?\nself.proj = nn.Linear(d_model, vocab)","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":5,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-07-28T07:51:46","dislikes":0,"thread":"6595120245","numReports":0,"likes":3,"message":"\u003cp>For the `make_std_mask` method:\u003cbr>`tgt_mask` have the shape of (1, batches, length), and the `subsequent_mask` method should output shape of (1, length, length). How the two tensors have `&amp;` operator?\u003c/p>","id":"4547747695","createdAt":"2019-07-21T07:51:46","author":{"username":"disqus_8lgrEHvH9y","about":"","name":"Frank Wang","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-07-21T07:43:53","profileUrl":"https://disqus.com/by/disqus_8lgrEHvH9y/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"335232778","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_8lgrEHvH9y.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_8lgrEHvH9y.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_8lgrEHvH9y.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"For the `make_std_mask` method:\n`tgt_mask` have the shape of (1, batches, length), and the `subsequent_mask` method should output shape of (1, length, length). How the two tensors have `&` operator?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":3,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-03-27T14:14:18","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Have you found an answer?\u003c/p>","id":"4840517822","createdAt":"2020-03-20T14:14:18","author":{"username":"kenenbekarzymatov","about":"","name":"Kenenbek Arzymatov","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2015-03-17T01:45:41","profileUrl":"https://disqus.com/by/kenenbekarzymatov/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"149510443","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/kenenbekarzymatov.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/kenenbekarzymatov.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/kenenbekarzymatov.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4547747695,"isApproved":true,"isFlagged":false,"raw_message":"Have you found an answer?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-08-08T02:09:31","dislikes":0,"thread":"6595120245","numReports":0,"likes":3,"message":"\u003cp>Question: Why does MultiHeadAttention class create only 4 clones instead of 8?\u003cbr>        self.linears = clones(nn.Linear(d_model, d_model), 4)\u003c/p>\u003cp>Thanks for a great post !\u003c/p>","id":"4015929276","createdAt":"2018-08-01T02:09:31","author":{"username":"kaustubhkunte","about":"","name":"Kaustubh Kunte","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-05-25T03:45:56","profileUrl":"https://disqus.com/by/kaustubhkunte/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"252947050","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/kaustubhkunte.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/kaustubhkunte.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/kaustubhkunte.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Question: Why does MultiHeadAttention class create only 4 clones instead of 8?\n        self.linears = clones(nn.Linear(d_model, d_model), 4)\n\nThanks for a great post !","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":3,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-10-25T05:21:04","dislikes":0,"thread":"6595120245","numReports":0,"likes":9,"message":"\u003cp>I guess you misunderstand the zip function.\u003cbr>query, key, value = \\\u003cbr>            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)\u003cbr>             for l, x in zip(self.linears, (query, key, value))]\u003cbr>In this code, the first linear layer works on query, the second one works on key and the third one works on value. The fourth one is used in: return self.linears[-1](x)\u003cbr>So the total number of linear layers is four.\u003c/p>","id":"4150577140","createdAt":"2018-10-18T05:21:04","author":{"username":"disqus_5iwwxhLeGL","about":"","name":"Yu-Tao","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2018-10-18T04:43:54","profileUrl":"https://disqus.com/by/disqus_5iwwxhLeGL/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"323780185","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar32.jpg?1539937069"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar92.jpg?1539937069","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar92.jpg?1539937069"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4015929276,"isApproved":true,"isFlagged":false,"raw_message":"I guess you misunderstand the zip function.\nquery, key, value = \\\n            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)\n             for l, x in zip(self.linears, (query, key, value))]\nIn this code, the first linear layer works on query, the second one works on key and the third one works on value. The fourth one is used in: return self.linears[-1](x)\nSo the total number of linear layers is four.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":9,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-02-27T23:20:56","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>Hi \u003cbr>Why the linear layer has dimension (d_model, d_model) ? The  W^Q, W^K, and W^V have dimension (d_model, d_k), (d_model, d_k), and (d_model, d_v)? I do not see any layer corresponding to any of the three matrices.\u003c/p>","id":"4347070890","createdAt":"2019-02-20T23:20:56","author":{"username":"nimning","about":"","name":"nimning","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-02-20T23:20:25","profileUrl":"https://disqus.com/by/nimning/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"329113907","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/nimning.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/nimning.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/nimning.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4150577140,"isApproved":true,"isFlagged":false,"raw_message":"Hi \nWhy the linear layer has dimension (d_model, d_model) ? The  W^Q, W^K, and W^V have dimension (d_model, d_k), (d_model, d_k), and (d_model, d_v)? I do not see any layer corresponding to any of the three matrices.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":2,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-03-08T05:14:23","dislikes":0,"thread":"6595120245","numReports":0,"likes":2,"message":"\u003cp>This is my understanding,\u003cbr>see the code: \u003cbr>query, key, value = \\\u003c/p>\u003cp>            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2) for l, x in zip(self.linears, (query, key, value))]\u003cbr>this will let the query, key,value pass through the first three Linear layers in self.linears, \u003cbr>so the first three Linear layers will be the Wq,Wk and Wv as you mentioned.\u003cbr>after this the matrix of query,key and value will have the shape(num_batches, time_steps, d_model).\u003c/p>\u003cp>Now since d_k = d_model//h, by reshaping it to(num_batches, -1, h, d_k) will give you the same amount of data.(here, d_k = d_v = d_w)\u003cbr> You can think of this as taking the first d_v features from d_model as the first head, then d_v+1 to 2*d_v as the second head. So now we do have 8 heads just by splitting the features of size d_model that we learnt from the matrix.\u003c/p>\u003cp>Then by doing this: transpose(1, 2), you will get tensor of shape (n_batches, h, time steps, d_k), and by feeding query, key and value to self_attention function, you will get back a tensor of shape(n_batches, h, time_steps, d_k).\u003c/p>\u003cp>you can see now that by doing transpose(1,2) and reshaping it to (n_batches, -1, d_k*h)\u003cbr>will get you a tensor with the same shape as previous layer.\u003c/p>\u003cp>So the main idea is that instead of creating 8*3 matrices for all values, keys and queries,\u003cbr>we only create 3 bigger ones and then split it to get the smaller ones.\u003c/p>","id":"4359258506","createdAt":"2019-03-01T05:14:23","author":{"username":"yipuding","about":"","name":"Yipu Ding","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-03-01T05:13:55","profileUrl":"https://disqus.com/by/yipuding/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"329461722","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/yipuding.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/yipuding.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/yipuding.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4347070890,"isApproved":true,"isFlagged":false,"raw_message":"This is my understanding,\nsee the code: \nquery, key, value = \\\n\n            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2) for l, x in zip(self.linears, (query, key, value))]\nthis will let the query, key,value pass through the first three Linear layers in self.linears, \nso the first three Linear layers will be the Wq,Wk and Wv as you mentioned.\nafter this the matrix of query,key and value will have the shape(num_batches, time_steps, d_model). \n\nNow since d_k = d_model//h, by reshaping it to(num_batches, -1, h, d_k) will give you the same amount of data.(here, d_k = d_v = d_w)\n You can think of this as taking the first d_v features from d_model as the first head, then d_v+1 to 2*d_v as the second head. So now we do have 8 heads just by splitting the features of size d_model that we learnt from the matrix.\n\nThen by doing this: transpose(1, 2), you will get tensor of shape (n_batches, h, time steps, d_k), and by feeding query, key and value to self_attention function, you will get back a tensor of shape(n_batches, h, time_steps, d_k).\n\nyou can see now that by doing transpose(1,2) and reshaping it to (n_batches, -1, d_k*h)\nwill get you a tensor with the same shape as previous layer.\n\nSo the main idea is that instead of creating 8*3 matrices for all values, keys and queries,\nwe only create 3 bigger ones and then split it to get the smaller ones.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":3,"points":2,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-06-10T16:57:23","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Thanks for a great post! \u003cbr>It seems to me that instead of splitting the original matrix in 8 for the multi-head attention, we should be creating 8 independent learnt projections, so the code should be re-written accordingly - any thoughts?\u003c/p>","id":"4487791589","createdAt":"2019-06-03T16:57:23","author":{"username":"francoissteiner","about":"","name":"Francois Steiner","disable3rdPartyTrackers":true,"isPowerContributor":false,"joinedAt":"2019-06-03T16:56:22","profileUrl":"https://disqus.com/by/francoissteiner/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"333338486","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/francoissteiner.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/francoissteiner.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/francoissteiner.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4359258506,"isApproved":true,"isFlagged":false,"raw_message":"Thanks for a great post! \nIt seems to me that instead of splitting the original matrix in 8 for the multi-head attention, we should be creating 8 independent learnt projections, so the code should be re-written accordingly - any thoughts?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":4,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-10-02T15:39:44","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I also believed the input would be projected entirely in 8 new vectors when I read the paper. Question is: to create 8 independent learnt projections is really equivalent to splitting the original matrix in 8?\u003c/p>","id":"4628704871","createdAt":"2019-09-25T15:39:44","author":{"username":"disqus_KMuier91G9","about":"","name":"Sidney Melo","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-06-03T00:52:48","profileUrl":"https://disqus.com/by/disqus_KMuier91G9/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"210307358","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_KMuier91G9.jpg","cache":"https://c.disquscdn.com/uploads/users/21030/7358/avatar32.jpg?1569425986"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_KMuier91G9.jpg","cache":"https://c.disquscdn.com/uploads/users/21030/7358/avatar92.jpg?1569425986","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_KMuier91G9.jpg","cache":"https://c.disquscdn.com/uploads/users/21030/7358/avatar92.jpg?1569425986"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4487791589,"isApproved":true,"isFlagged":false,"raw_message":"I also believed the input would be projected entirely in 8 new vectors when I read the paper. Question is: to create 8 independent learnt projections is really equivalent to splitting the original matrix in 8?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":5,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-10-16T02:49:48","dislikes":0,"thread":"6595120245","numReports":0,"likes":3,"message":"\u003cp>it is equivalent\uff0c an example below\uff1a\u003cbr> \u003ca href=\"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg\" rel=\"nofollow noopener\" title=\"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg\">https://uploads.disquscdn.c...\u003c/a>\u003c/p>","id":"4645489194","createdAt":"2019-10-09T02:49:48","author":{"username":"chuankangwu","about":"","name":"chuankang wu","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-10-06T07:25:11","profileUrl":"https://disqus.com/by/chuankangwu/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"338843326","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/chuankangwu.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/chuankangwu.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/chuankangwu.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[{"providerName":"Disquscdn","resolvedUrl":"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","thumbnailUrl":"//uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","htmlHeight":null,"id":60198300,"thumbnailWidth":3000,"title":"","htmlWidth":null,"mediaType":"2","html":"","location":"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","type":"5","metadata":{"create_method":"preview","thumbnail":"//uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg"},"urlRedirect":"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","description":"","post":"4645489194","thumbnailURL":"//uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","thread":"6595120245","forum":"harvard-nlp","url":"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","resolvedUrlRedirect":"https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","thumbnailHeight":4000}],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4628704871,"isApproved":true,"isFlagged":false,"raw_message":"it is equivalent\uff0c an example below\uff1a\n https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":6,"points":3,"moderationLabels":["media"],"isEdited":false,"sb":false},{"editableUntil":"2018-11-10T22:56:30","dislikes":1,"thread":"6595120245","numReports":0,"likes":5,"message":"\u003cp>Thank you for a great piece.\u003c/p>\u003cp>I have a question about the positional encoding.  Here you seem to interleave sine and cosine curves over the dimensions for a given position.  The indexing in the original paper suggests the same, but the code at \u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensor2tensor%2Fblob%2Fmaster%2Ftensor2tensor%2Flayers%2Fcommon_attention.py%3ACTNdLeTn1cJXk0PU4IiBnjHRR2A&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/layers/common_attention.py\">https://github.com/tensorfl...\u003c/a> (and the discussion at \u003ca href=\"http://disq.us/url?url=http%3A%2F%2Fjalammar.github.io%2Fillustrated-transformer%2F%3AJ0pFreh0LdTMQXRXyIcFL5TyZUs&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"http://jalammar.github.io/illustrated-transformer/\">http://jalammar.github.io/i...\u003c/a> ) suggests a concatenation of sines on the left and cosines on the right.\u003c/p>\u003cp>I'm not sure it makes a substantive difference, but would you agree there's a difference in implementation here?\u003c/p>","id":"4177145673","createdAt":"2018-11-03T21:56:30","author":{"username":"free_variation","about":"","name":"free_variation","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2013-06-06T03:35:56","profileUrl":"https://disqus.com/by/free_variation/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"54958964","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/free_variation.jpg","cache":"https://c.disquscdn.com/uploads/users/5495/8964/avatar32.jpg?1589063129"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/free_variation.jpg","cache":"https://c.disquscdn.com/uploads/users/5495/8964/avatar92.jpg?1589063129","large":{"permalink":"https://disqus.com/api/users/avatars/free_variation.jpg","cache":"https://c.disquscdn.com/uploads/users/5495/8964/avatar92.jpg?1589063129"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thank you for a great piece.\n\nI have a question about the positional encoding.  Here you seem to interleave sine and cosine curves over the dimensions for a given position.  The indexing in the original paper suggests the same, but the code at https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/layers/common_attention.py (and the discussion at http://jalammar.github.io/illustrated-transformer/ ) suggests a concatenation of sines on the left and cosines on the right.\n\nI'm not sure it makes a substantive difference, but would you agree there's a difference in implementation here?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":4,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2018-08-02T10:24:08","dislikes":1,"thread":"6595120245","numReports":0,"likes":5,"message":"\u003cp>Thanks for great post!\u003cbr>Q: shouldn't it be mask.dim() &gt; 1 in LabelSmoothing#forward?\u003cbr>Because in your example with target [1] mask after nonzero([1] == 0) will be tensor([]) which has dimension 1 and it will throw error if we pass it as argument in index_fill_ as index.\u003c/p>","id":"4007049675","createdAt":"2018-07-26T10:24:08","author":{"username":"gaziev","about":"","name":"gaziev","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2012-03-24T01:49:52","profileUrl":"https://disqus.com/by/gaziev/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"23962751","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/gaziev.jpg","cache":"https://c.disquscdn.com/uploads/users/2396/2751/avatar32.jpg?1535563465"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/gaziev.jpg","cache":"https://c.disquscdn.com/uploads/users/2396/2751/avatar92.jpg?1535563465","large":{"permalink":"https://disqus.com/api/users/avatars/gaziev.jpg","cache":"https://c.disquscdn.com/uploads/users/2396/2751/avatar92.jpg?1535563465"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks for great post!\nQ: shouldn't it be mask.dim() > 1 in LabelSmoothing#forward?\nBecause in your example with target [1] mask after nonzero([1] == 0) will be tensor([]) which has dimension 1 and it will throw error if we pass it as argument in index_fill_ as index.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":4,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-11-24T07:27:22","dislikes":1,"thread":"6595120245","numReports":0,"likes":6,"message":"\u003cp>mask.sum() &gt; 0 \uff1f\u003c/p>","id":"4199309870","createdAt":"2018-11-17T07:27:22","author":{"username":"lipiji1986","about":"","name":"Piji Li","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2012-10-08T12:42:12","profileUrl":"https://disqus.com/by/lipiji1986/","url":"http://www.zhizhihu.com/","location":"","isPrivate":false,"signedUrl":"http://disq.us/?url=http%3A%2F%2Fwww.zhizhihu.com%2F&key=7HVkbiv6ekcyrtTRqE3juQ","isPrimary":true,"isAnonymous":false,"id":"34038110","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/lipiji1986.jpg","cache":"https://c.disquscdn.com/uploads/users/3403/8110/avatar32.jpg?1542439643"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/lipiji1986.jpg","cache":"https://c.disquscdn.com/uploads/users/3403/8110/avatar92.jpg?1542439643","large":{"permalink":"https://disqus.com/api/users/avatars/lipiji1986.jpg","cache":"https://c.disquscdn.com/uploads/users/3403/8110/avatar92.jpg?1542439643"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4007049675,"isApproved":true,"isFlagged":false,"raw_message":"mask.sum() > 0 \uff1f","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":5,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-11-27T03:02:18","dislikes":1,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>change it to \"mask.sum() &gt; 0 and len(mask) &gt; 0\", it works!\u003c/p>","id":"4203482166","createdAt":"2018-11-20T03:02:18","author":{"username":"disqus_W48rgB1BxP","about":"","name":"Ke Wang","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2018-11-20T03:01:41","profileUrl":"https://disqus.com/by/disqus_W48rgB1BxP/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"325338843","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_W48rgB1BxP.jpg","cache":"https://c.disquscdn.com/uploads/users/32533/8843/avatar32.jpg?1542682939"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_W48rgB1BxP.jpg","cache":"https://c.disquscdn.com/uploads/users/32533/8843/avatar92.jpg?1542682939","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_W48rgB1BxP.jpg","cache":"https://c.disquscdn.com/uploads/users/32533/8843/avatar92.jpg?1542682939"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4199309870,"isApproved":true,"isFlagged":false,"raw_message":"change it to \"mask.sum() > 0 and len(mask) > 0\", it works!","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":2,"points":-1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-10-26T08:17:48","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Same problem. I solve it by replace MyIterator with data.BucketIterator.\u003cbr>I'm not sure if it is related with the batch data.\u003c/p>","id":"4152328935","createdAt":"2018-10-19T08:17:48","author":{"username":"disqus_5iwwxhLeGL","about":"","name":"Yu-Tao","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2018-10-18T04:43:54","profileUrl":"https://disqus.com/by/disqus_5iwwxhLeGL/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"323780185","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar32.jpg?1539937069"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar92.jpg?1539937069","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar92.jpg?1539937069"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4007049675,"isApproved":true,"isFlagged":false,"raw_message":"Same problem. I solve it by replace MyIterator with data.BucketIterator.\nI'm not sure if it is related with the batch data.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-04-29T21:38:37","dislikes":0,"thread":"6595120245","numReports":0,"likes":2,"message":"\u003cp>The loss computation appears to be updating gradients during validation. \u003cbr>This appears to drive weight updates to fit the validation (test) data, which it should not.\u003c/p>\u003cp>A recommended way to run validation is apparently: \u003cbr>\u003ccode>model.eval()\u003cbr>torch.no_grad()\u003c/code>\u003cbr>[\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fdiscuss.pytorch.org%2Ft%2Fmodel-eval-vs-with-torch-no-grad%2F19615%3Ae_08I4EBqohG3_nIbsY1i9V_SvA&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://discuss.pytorch.org/t/model-eval-vs-with-torch-no-grad/19615\">https://discuss.pytorch.org...\u003c/a>](url)\u003cbr>\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fdiscuss.pytorch.org%2Ft%2Ftwo-small-questions-about-with-torch-no-grad%2F27571%3AzewGg_fpEMy6QbmM9X4Lh6ovyRk&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://discuss.pytorch.org/t/two-small-questions-about-with-torch-no-grad/27571\">https://discuss.pytorch.org...\u003c/a>\u003c/p>\u003cp>And indeed, the code that runs without error is the following, where loss.backward()\u003cbr>is pushed under the if statement:\u003c/p>\u003cp>\u003c/p>\u003cpre>\u003ccode>        \u003cbr>        model.eval()\u003cbr>        with torch.no_grad():\u003cbr>            test_loss = run_epoch(val_dataloader, model, \u003cbr>                  SimpleLossCompute(model.generator, criterion, None))\u003cbr>            print(\"test_loss\", test_loss)\u003cbr>\u003c/code>\u003c/pre>\u003cp>\u003cbr>and: \u003cbr>\u003c/p>\u003cpre>\u003ccode>\u003cbr>class SimpleLossCompute:\u003cbr>    \"A simple loss compute and train function.\"\u003cbr>    def __init__(self, generator, criterion, opt=None):\u003cbr>        self.generator = generator\u003cbr>        self.criterion = criterion\u003cbr>        self.opt = opt\u003cbr>        \u003cbr>    def __call__(self, x, y, norm):\u003cbr>        x = self.generator(x)\u003cbr>        loss = self.criterion(x.contiguous().view(-1, x.size(-1)), \u003cbr>                              y.contiguous().view(-1)) / norm\u003cbr>        #loss.backward()\u003cbr>        if self.opt is not None:\u003cbr>            loss.backward()\u003cbr>            self.opt.step()\u003cbr>            self.opt.optimizer.zero_grad()\u003cbr>        return loss.data * norm\u003c/code>\u003c/pre>\u003cp>\u003c/p>\u003cp>This was discovered in another forum.\u003c/p>","id":"4885888969","createdAt":"2020-04-22T21:38:37","author":{"username":"disqus_wGGAF5yQKM","about":"","name":"Gus Smith","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2015-10-05T17:03:42","profileUrl":"https://disqus.com/by/disqus_wGGAF5yQKM/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"177403162","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_wGGAF5yQKM.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_wGGAF5yQKM.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_wGGAF5yQKM.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"The loss computation appears to be updating gradients during validation. \nThis appears to drive weight updates to fit the validation (test) data, which it should not. \n\nA recommended way to run validation is apparently: \n\u003ccode>model.eval()\ntorch.no_grad()\u003c/code>\n[https://discuss.pytorch.org/t/model-eval-vs-with-torch-no-grad/19615](url)\nhttps://discuss.pytorch.org/t/two-small-questions-about-with-torch-no-grad/27571\n\nAnd indeed, the code that runs without error is the following, where loss.backward()\nis pushed under the if statement: \n\n\u003cpre>\n\u003ccode>        \n        model.eval()\n        with torch.no_grad():\n            test_loss = run_epoch(val_dataloader, model, \n                  SimpleLossCompute(model.generator, criterion, None))\n            print(\"test_loss\", test_loss)\n\u003c/code>\u003c/pre>\nand: \n\u003cpre>\u003ccode>\nclass SimpleLossCompute:\n    \"A simple loss compute and train function.\"\n    def __init__(self, generator, criterion, opt=None):\n        self.generator = generator\n        self.criterion = criterion\n        self.opt = opt\n        \n    def __call__(self, x, y, norm):\n        x = self.generator(x)\n        loss = self.criterion(x.contiguous().view(-1, x.size(-1)), \n                              y.contiguous().view(-1)) / norm\n        #loss.backward()\n        if self.opt is not None:\n            loss.backward()\n            self.opt.step()\n            self.opt.optimizer.zero_grad()\n        return loss.data * norm\u003c/code>\u003c/pre>\n\nThis was discovered in another forum.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":2,"moderationLabels":["links"],"isEdited":true,"sb":false},{"editableUntil":"2019-01-22T08:36:37","dislikes":0,"thread":"6595120245","numReports":0,"likes":2,"message":"\u003cp>Thanks a lot for such great post!\u003c/p>\u003cp>I guess there is a mistake in following part of code:\u003cbr>\u003ccode>\u003cbr>def clones(module, N):\u003cbr>         \"Produce N identical layers.\"\u003cbr>         return nn.ModuleList([copy.deepcopy(module) for _ in range(N)])\u003cbr>\u003c/code>\u003c/p>\u003cp>\"Deepcopy\" copies the entire layer with it's weights what is wrong because (Wq_1, Wq_2, Wq_3, ..., Wk_1, Wk_2, Wk_3, ..., etc) must be randomly initialized. In other words \"deepcopy\" copies the only instance of class nn.Linear but N instances must be created. So I suppose that it's better to replace it by something like that:\u003cbr>\u003ccode>\u003cbr>def clones(params, N):\u003cbr>     return nn.ModuleList([nn.Linear(params) for _ in range(N)])\u003cbr>\u003c/code>\u003c/p>\u003cp>Sincerely, \u003cbr>Ivan\u003c/p>","id":"4286765854","createdAt":"2019-01-15T08:36:37","author":{"username":"disqus_Wv15C2dVTm","about":"","name":"\u0418\u0432\u0430\u043d","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2014-02-10T21:55:14","profileUrl":"https://disqus.com/by/disqus_Wv15C2dVTm/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"94329578","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_Wv15C2dVTm.jpg","cache":"https://c.disquscdn.com/uploads/users/9432/9578/avatar32.jpg?1392121832"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_Wv15C2dVTm.jpg","cache":"https://c.disquscdn.com/uploads/users/9432/9578/avatar92.jpg?1392121832","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_Wv15C2dVTm.jpg","cache":"https://c.disquscdn.com/uploads/users/9432/9578/avatar92.jpg?1392121832"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks a lot for such great post!\n\nI guess there is a mistake in following part of code:\n\u003ccode>\ndef clones(module, N):\n         \"Produce N identical layers.\"\n         return nn.ModuleList([copy.deepcopy(module) for _ in range(N)])\n\u003c/code>\n\n\"Deepcopy\" copies the entire layer with it's weights what is wrong because (Wq_1, Wq_2, Wq_3, ..., Wk_1, Wk_2, Wk_3, ..., etc) must be randomly initialized. In other words \"deepcopy\" copies the only instance of class nn.Linear but N instances must be created. So I suppose that it's better to replace it by something like that:\n\u003ccode>\ndef clones(params, N):\n     return nn.ModuleList([nn.Linear(params) for _ in range(N)])\n\u003c/code>\n\nSincerely, \nIvan","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":2,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2019-03-01T12:33:48","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Later there is code for model initialization at line 20 in the notebook\u003c/p>","id":"4349244276","createdAt":"2019-02-22T12:33:48","author":{"username":"peixiangzhong","about":"","name":"Peixiang Zhong","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-04-03T03:35:07","profileUrl":"https://disqus.com/by/peixiangzhong/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"202886301","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/peixiangzhong.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/peixiangzhong.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/peixiangzhong.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4286765854,"isApproved":true,"isFlagged":false,"raw_message":"Later there is code for model initialization at line 20 in the notebook","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-03-01T08:16:26","dislikes":1,"thread":"6595120245","numReports":0,"likes":3,"message":"\u003cp>The output of each step in the decoder is fed to the bottom decoder in the next time step. So, based on thsi implementation, how can the decoder generate word one by one based on previous prediction? I do not see this logic in the code.\u003c/p>","id":"4349056928","createdAt":"2019-02-22T08:16:26","author":{"username":"disqus_pcWVloYWqZ","about":"","name":"Ning Ma","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2015-11-13T08:57:59","profileUrl":"https://disqus.com/by/disqus_pcWVloYWqZ/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"182623577","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_pcWVloYWqZ.jpg","cache":"https://c.disquscdn.com/uploads/users/18262/3577/avatar32.jpg?1550823388"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_pcWVloYWqZ.jpg","cache":"https://c.disquscdn.com/uploads/users/18262/3577/avatar92.jpg?1550823388","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_pcWVloYWqZ.jpg","cache":"https://c.disquscdn.com/uploads/users/18262/3577/avatar92.jpg?1550823388"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"The output of each step in the decoder is fed to the bottom decoder in the next time step. So, based on thsi implementation, how can the decoder generate word one by one based on previous prediction? I do not see this logic in the code.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":2,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-06-27T21:29:34","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>During training, we don't need to feed the predicted word to the bottom decoder. We use teacher forcing here and feed the true word in the next time step. During testing though, we have to feed the predicted word (till &lt;eos&gt;) to generate the sentence. Please take a look towards the end here: \u003ca href=\"https://disq.us/url?url=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-code-the-transformer-in-pytorch-24db27c8f9ec%3AbvDLL3adJKBQmU5c0DdyhSCRu2k&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://towardsdatascience.com/how-to-code-the-transformer-in-pytorch-24db27c8f9ec\">https://towardsdatascience....\u003c/a>\u003c/p>","id":"4510068543","createdAt":"2019-06-20T21:29:34","author":{"username":"disqus_yCoVzKJPyj","about":"","name":"Ishaan","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-06-20T21:25:58","profileUrl":"https://disqus.com/by/disqus_yCoVzKJPyj/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"334049366","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_yCoVzKJPyj.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_yCoVzKJPyj.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_yCoVzKJPyj.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4349056928,"isApproved":true,"isFlagged":false,"raw_message":"During training, we don't need to feed the predicted word to the bottom decoder. We use teacher forcing here and feed the true word in the next time step. During testing though, we have to feed the predicted word (till \u003ceos>) to generate the sentence. Please take a look towards the end here: https://towardsdatascience.com/how-to-code-the-transformer-in-pytorch-24db27c8f9ec","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":1,"moderationLabels":["links"],"isEdited":true,"sb":false},{"editableUntil":"2020-04-27T01:16:43","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>Thanks for the great post\u003c/p>\u003cp>I\u2019m using standard TRANSFORMER for NMT and I\u2019m going to train model Right to left. I have applied two ideas:\u003c/p>\u003cp>1. reversing the input text from left to Right, before feeding the data to \u003cbr> the encoder and decoder. (but the training process is still left to right)\u003c/p>\u003cp>2. reversing the embedding vector in the encoder and decoder. (Result is so boor, and the BLUE score is decreased by 15.6 points)\u003c/p>\u003cp>My question is what the optimal way to train model Right to Left?\u003c/p>\u003cp>Note: I have two versions of my model (RTL model) and (LTR model).\u003c/p>","id":"4881933302","createdAt":"2020-04-20T01:16:43","author":{"username":"aimanmutasembellh","about":"","name":"Aiman Mutasem-bellh","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2014-12-23T16:12:54","profileUrl":"https://disqus.com/by/aimanmutasembellh/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"136724852","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/aimanmutasembellh.jpg","cache":"https://c.disquscdn.com/uploads/users/13672/4852/avatar32.jpg?1589804941"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/aimanmutasembellh.jpg","cache":"https://c.disquscdn.com/uploads/users/13672/4852/avatar92.jpg?1589804941","large":{"permalink":"https://disqus.com/api/users/avatars/aimanmutasembellh.jpg","cache":"https://c.disquscdn.com/uploads/users/13672/4852/avatar92.jpg?1589804941"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks for the great post \n\nI\u2019m using standard TRANSFORMER for NMT and I\u2019m going to train model Right to left. I have applied two ideas:\n\n1. reversing the input text from left to Right, before feeding the data to \n the encoder and decoder. (but the training process is still left to right)\n\n2. reversing the embedding vector in the encoder and decoder. (Result is so boor, and the BLUE score is decreased by 15.6 points)\n\nMy question is what the optimal way to train model Right to Left?\n\nNote: I have two versions of my model (RTL model) and (LTR model).","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-04-15T10:46:35","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>Thank you for sharing so unselfishly. I have a question to ask you and I hope you can help me. About this tuple in Multihead attention:\u003c/p>\u003cp>\u003ccode>query, key, value = /\u003cbr> [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)  \u003cbr>for l, x in zip(self.linears, (query, key, value))]\u003c/code>\u003c/p>\u003cp>I've never seen a method that calls the element l(x) in a tuple like this, and I don't understand that very well.\u003c/p>\u003cp>For these three variables, \u201c\u201dquery, key, value\u201c\u201d\uff0c I didn't see the input values before in the forward of Class multihead attention, but I found that they had values during the run. Where did they get their values from?\u003c/p>\u003cp>In my understanding, I think the values of these three variables \u201c query, key, value\u201d are corresponding to the values of the first three self.linears, but it doesn't seem that way. I hope someone can give me some help to explain the details here. Thank you so much.\u003c/p>","id":"4865841600","createdAt":"2020-04-08T10:46:35","author":{"username":"disqus_W64TGqfzwI","about":"","name":"Salted Fish","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2020-04-08T04:10:23","profileUrl":"https://disqus.com/by/disqus_W64TGqfzwI/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"347313044","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_W64TGqfzwI.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_W64TGqfzwI.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_W64TGqfzwI.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thank you for sharing so unselfishly. I have a question to ask you and I hope you can help me. About this tuple in Multihead attention:\n\n\u003ccode>query, key, value = /\n [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)  \nfor l, x in zip(self.linears, (query, key, value))]\u003c/code>\n\nI've never seen a method that calls the element l(x) in a tuple like this, and I don't understand that very well.\n\nFor these three variables, \u201c\u201dquery, key, value\u201c\u201d\uff0c I didn't see the input values before in the forward of Class multihead attention, but I found that they had values during the run. Where did they get their values from? \n\nIn my understanding, I think the values of these three variables \u201c query, key, value\u201d are corresponding to the values of the first three self.linears, but it doesn't seem that way. I hope someone can give me some help to explain the details here. Thank you so much.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-11-17T01:26:33","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>Thanks for the awesome post!\u003cbr>I have a question: there seems to be a small issue in the SimpleLossCompute function. loss.backward() accumulates gradient during evaluation but, they won't be set to zero before the next step. Won't the next training step use gradients computed during evaluation ?\u003c/p>","id":"4683799335","createdAt":"2019-11-10T01:26:33","author":{"username":"disqus_jVxRqA9Gkm","about":"","name":"Anshul Shah","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-11-10T01:25:43","profileUrl":"https://disqus.com/by/disqus_jVxRqA9Gkm/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"340520918","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_jVxRqA9Gkm.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_jVxRqA9Gkm.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_jVxRqA9Gkm.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks for the awesome post!\nI have a question: there seems to be a small issue in the SimpleLossCompute function. loss.backward() accumulates gradient during evaluation but, they won't be set to zero before the next step. Won't the next training step use gradients computed during evaluation ?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-04-30T04:13:53","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Yes, it happens as you stated. Running validation does increase the performance on the validation set compare to if one does not run the validation. See my post here on the same topic.\u003c/p>","id":"4886246116","createdAt":"2020-04-23T04:13:53","author":{"username":"disqus_wGGAF5yQKM","about":"","name":"Gus Smith","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2015-10-05T17:03:42","profileUrl":"https://disqus.com/by/disqus_wGGAF5yQKM/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"177403162","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_wGGAF5yQKM.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_wGGAF5yQKM.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_wGGAF5yQKM.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4683799335,"isApproved":true,"isFlagged":false,"raw_message":"Yes, it happens as you stated. Running validation does increase the performance on the validation set compare to if one does not run the validation. See my post here on the same topic.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-04-16T18:51:59","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>In PositionalEncoding, there is a small fix discussed here: \u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F52922445%2Fruntimeerror-exp-not-implemented-for-torch-longtensor%3ABrNPJZE-73zYv0I0pJ8j2ZPvDEM&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://stackoverflow.com/questions/52922445/runtimeerror-exp-not-implemented-for-torch-longtensor\">https://stackoverflow.com/q...\u003c/a>\u003c/p>\u003cp>LU Jialin quote:\u003c/p>\u003cp>For me I just got the torch.arange to generate float type tensor\u003c/p>\u003cp>from\u003c/p>\u003cp>position = torch.arange(0, max_len).unsqueeze(1)\u003cbr>div_term = torch.exp(torch.arange(0, d_model, 2) * -(math.log(10000.0) / d_model))\u003cbr>to\u003c/p>\u003cp>position = torch.arange(\u003cb>0.\u003c/b>, max_len).unsqueeze(1)\u003cbr>div_term = torch.exp(torch.arange(\u003cb>0.\u003c/b>, d_model, 2) * -(math.log(10000.0) / d_model))\u003c/p>","id":"4416166916","createdAt":"2019-04-09T18:51:59","author":{"username":"disqus_T9X568BHlO","about":"","name":"Arthur Marques","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-08-01T03:15:21","profileUrl":"https://disqus.com/by/disqus_T9X568BHlO/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"260788705","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_T9X568BHlO.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_T9X568BHlO.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_T9X568BHlO.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"In PositionalEncoding, there is a small fix discussed here: https://stackoverflow.com/questions/52922445/runtimeerror-exp-not-implemented-for-torch-longtensor\n\nLU Jialin quote:\n\nFor me I just got the torch.arange to generate float type tensor\n\nfrom\n\nposition = torch.arange(0, max_len).unsqueeze(1)\ndiv_term = torch.exp(torch.arange(0, d_model, 2) * -(math.log(10000.0) / d_model))\nto\n\nposition = torch.arange(\u003cb>0.\u003c/b>, max_len).unsqueeze(1)\ndiv_term = torch.exp(torch.arange(\u003cb>0.\u003c/b>, d_model, 2) * -(math.log(10000.0) / d_model))","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":1,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2018-12-12T21:17:03","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>Hi, so I'm trying to train the model on the IWSLT en-de dataset on a 2 GPU machine each with 12G memory. But I am running out of GPU memory. Is this normal?\u003c/p>","id":"4227028789","createdAt":"2018-12-05T21:17:03","author":{"username":"farzadsharif","about":"","name":"Farzad Sharif","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-09-23T15:27:42","profileUrl":"https://disqus.com/by/farzadsharif/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"224156259","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/farzadsharif.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/farzadsharif.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/farzadsharif.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Hi, so I'm trying to train the model on the IWSLT en-de dataset on a 2 GPU machine each with 12G memory. But I am running out of GPU memory. Is this normal?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-05-25T12:28:59","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Hello Mr. Farzad. Kindlly, did you fix this issue? :)\u003c/p>","id":"4918157349","createdAt":"2020-05-18T12:28:59","author":{"username":"aimanmutasembellh","about":"","name":"Aiman Mutasem-bellh","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2014-12-23T16:12:54","profileUrl":"https://disqus.com/by/aimanmutasembellh/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"136724852","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/aimanmutasembellh.jpg","cache":"https://c.disquscdn.com/uploads/users/13672/4852/avatar32.jpg?1589804941"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/aimanmutasembellh.jpg","cache":"https://c.disquscdn.com/uploads/users/13672/4852/avatar92.jpg?1589804941","large":{"permalink":"https://disqus.com/api/users/avatars/aimanmutasembellh.jpg","cache":"https://c.disquscdn.com/uploads/users/13672/4852/avatar92.jpg?1589804941"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4227028789,"isApproved":true,"isFlagged":false,"raw_message":"Hello Mr. Farzad. Kindlly, did you fix this issue? :)","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-04-16T04:28:39","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>Thanks!\u003c/p>","id":"3845808761","createdAt":"2018-04-09T04:28:39","author":{"username":"disqus_htlIvpMsai","about":"","name":"\uc8fc\ub9d0\uc774\ub2e4","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-02-01T03:44:02","profileUrl":"https://disqus.com/by/disqus_htlIvpMsai/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"194386225","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_htlIvpMsai.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_htlIvpMsai.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_htlIvpMsai.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks!","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-05-03T14:09:08","dislikes":2,"thread":"6595120245","numReports":0,"likes":2,"message":"\u003cp>I have a question about class SublayerConnection.\u003cbr>the comment says \"for code simplicity the norm is first as opposed to last.\"\u003cbr>But the loss wont go down below 4~5 when the norm is applied after residual layer in the decoder, same as described in the paper.\u003cbr>Do you have any idea of this phenomenon?\u003c/p>","id":"3873740919","createdAt":"2018-04-26T14:09:08","author":{"username":"disqus_htlIvpMsai","about":"","name":"\uc8fc\ub9d0\uc774\ub2e4","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-02-01T03:44:02","profileUrl":"https://disqus.com/by/disqus_htlIvpMsai/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"194386225","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_htlIvpMsai.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_htlIvpMsai.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_htlIvpMsai.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"I have a question about class SublayerConnection.\nthe comment says \"for code simplicity the norm is first as opposed to last.\"\nBut the loss wont go down below 4~5 when the norm is applied after residual layer in the decoder, same as described in the paper.\nDo you have any idea of this phenomenon?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2018-10-25T04:44:16","dislikes":0,"thread":"6595120245","numReports":0,"likes":4,"message":"\u003cp>same question. \u003cbr>but why not change the code into \u003cbr>return self.norm(x + self.dropout(sublayer(x)))\u003cbr>this seems more like the original paper?\u003c/p>","id":"4150550608","createdAt":"2018-10-18T04:44:16","author":{"username":"disqus_5iwwxhLeGL","about":"","name":"Yu-Tao","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2018-10-18T04:43:54","profileUrl":"https://disqus.com/by/disqus_5iwwxhLeGL/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"323780185","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar32.jpg?1539937069"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar92.jpg?1539937069","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_5iwwxhLeGL.jpg","cache":"https://c.disquscdn.com/uploads/users/32378/185/avatar92.jpg?1539937069"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3873740919,"isApproved":true,"isFlagged":false,"raw_message":"same question. \nbut why not change the code into \nreturn self.norm(x + self.dropout(sublayer(x)))\nthis seems more like the original paper?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":4,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2018-11-26T11:22:09","dislikes":0,"thread":"6595120245","numReports":0,"likes":4,"message":"\u003cp>Yey, I have the same question. And  There new code in (\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FOpenNMT%2FOpenNMT-py%2Fblob%2Fcd29c1dbfb35f4a2701ff52a1bf4e5bdcf02802e%2Fonmt%2Fencoders%2Ftransformer.py%23L48%29%3AkPEDwJxosNkT2LbhtOQLR49t7Oo&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://github.com/OpenNMT/OpenNMT-py/blob/cd29c1dbfb35f4a2701ff52a1bf4e5bdcf02802e/onmt/encoders/transformer.py#L48)\">https://github.com/OpenNMT/...\u003c/a> still writing like that. Obviously, the formula they list does not match the code they have.\u003c/p>","id":"4202213577","createdAt":"2018-11-19T11:22:09","author":{"username":"disqus_akZ5ASHeyH","about":"","name":"Neo li","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-07-09T05:34:51","profileUrl":"https://disqus.com/by/disqus_akZ5ASHeyH/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"258332319","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_akZ5ASHeyH.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_akZ5ASHeyH.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_akZ5ASHeyH.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4150550608,"isApproved":true,"isFlagged":false,"raw_message":"Yey, I have the same question. And  There new code in (https://github.com/OpenNMT/OpenNMT-py/blob/cd29c1dbfb35f4a2701ff52a1bf4e5bdcf02802e/onmt/encoders/transformer.py#L48) still writing like that. Obviously, the formula they list does not match the code they have.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":2,"points":4,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2019-05-27T13:37:02","dislikes":0,"thread":"6595120245","numReports":0,"likes":1,"message":"\u003cp>It appears that the code provided by original the authors of the paper differs in this matter from what's stated in the paper.\u003cbr>Here, they seem to implement the original authors' code instead of the original paper.\u003c/p>\u003cp>Reference:\u003cbr>\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FOpenNMT%2FOpenNMT-py%2Fissues%2F770%23issuecomment-398299135%3A09ugKrHc-S2FOi-LYJRpzwGY2mA&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://github.com/OpenNMT/OpenNMT-py/issues/770#issuecomment-398299135\">https://github.com/OpenNMT/...\u003c/a>\u003c/p>","id":"4469709216","createdAt":"2019-05-20T13:37:02","author":{"username":"prashantserai","about":"Electronics Engineer","name":"Prashant serai","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2014-04-30T05:37:32","profileUrl":"https://disqus.com/by/prashantserai/","url":"","location":"Mumbai","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"105178679","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/prashantserai.jpg","cache":"https://c.disquscdn.com/uploads/users/10517/8679/avatar32.jpg?1558359423"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/prashantserai.jpg","cache":"https://c.disquscdn.com/uploads/users/10517/8679/avatar92.jpg?1558359423","large":{"permalink":"https://disqus.com/api/users/avatars/prashantserai.jpg","cache":"https://c.disquscdn.com/uploads/users/10517/8679/avatar92.jpg?1558359423"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4150550608,"isApproved":true,"isFlagged":false,"raw_message":"It appears that the code provided by original the authors of the paper differs in this matter from what's stated in the paper.\nHere, they seem to implement the original authors' code instead of the original paper.\n\nReference:\nhttps://github.com/OpenNMT/OpenNMT-py/issues/770#issuecomment-398299135","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":2,"points":1,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2019-08-14T14:02:37","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I too was confused about this, but it seems they are true to the implementation in T2T (\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensor2tensor%2Fblob%2F43be271c8a3fa06cb06b5147f044cbdc8bb77535%2Ftensor2tensor%2Fmodels%2Ftransformer.py%23L1799-L1800%3AlvQ3PVGJTkoDJWSy8faq-PLPCas&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://github.com/tensorflow/tensor2tensor/blob/43be271c8a3fa06cb06b5147f044cbdc8bb77535/tensor2tensor/models/transformer.py#L1799-L1800\">https://github.com/tensorfl...\u003c/a> specifies the hyperparameters for the pre and post layer transformations applied by \u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensor2tensor%2Fblob%2F43be271c8a3fa06cb06b5147f044cbdc8bb77535%2Ftensor2tensor%2Flayers%2Fcommon_layers.py%23L862%29%3APcLTR_7HqSnJa4tSB9Ba8KMyPHc&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://github.com/tensorflow/tensor2tensor/blob/43be271c8a3fa06cb06b5147f044cbdc8bb77535/tensor2tensor/layers/common_layers.py#L862)\">https://github.com/tensorfl...\u003c/a>. The description in the paper is inconsistent with the implementation.\u003c/p>","id":"4569337441","createdAt":"2019-08-07T14:02:37","author":{"username":"willprice94","about":"","name":"willprice94","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2012-01-21T12:40:38","profileUrl":"https://disqus.com/by/willprice94/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"21431364","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/willprice94.jpg","cache":"https://c.disquscdn.com/uploads/users/2143/1364/avatar32.jpg?1565186560"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/willprice94.jpg","cache":"https://c.disquscdn.com/uploads/users/2143/1364/avatar92.jpg?1565186560","large":{"permalink":"https://disqus.com/api/users/avatars/willprice94.jpg","cache":"https://c.disquscdn.com/uploads/users/2143/1364/avatar92.jpg?1565186560"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4150550608,"isApproved":true,"isFlagged":false,"raw_message":"I too was confused about this, but it seems they are true to the implementation in T2T (https://github.com/tensorflow/tensor2tensor/blob/43be271c8a3fa06cb06b5147f044cbdc8bb77535/tensor2tensor/models/transformer.py#L1799-L1800 specifies the hyperparameters for the pre and post layer transformations applied by https://github.com/tensorflow/tensor2tensor/blob/43be271c8a3fa06cb06b5147f044cbdc8bb77535/tensor2tensor/layers/common_layers.py#L862). The description in the paper is inconsistent with the implementation.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":2,"points":0,"moderationLabels":["links"],"isEdited":true,"sb":false},{"editableUntil":"2018-11-26T11:38:57","dislikes":1,"thread":"6595120245","numReports":0,"likes":2,"message":"\u003cp>\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FOpenNMT%2FOpenNMT-py%2Fissues%2F770%3AP4vM-d65dWitBlBZMRrqtd4pcFw&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"https://github.com/OpenNMT/OpenNMT-py/issues/770\">https://github.com/OpenNMT/...\u003c/a>\u003c/p>","id":"4202228717","createdAt":"2018-11-19T11:38:57","author":{"username":"disqus_akZ5ASHeyH","about":"","name":"Neo li","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-07-09T05:34:51","profileUrl":"https://disqus.com/by/disqus_akZ5ASHeyH/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"258332319","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_akZ5ASHeyH.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_akZ5ASHeyH.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_akZ5ASHeyH.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3873740919,"isApproved":true,"isFlagged":false,"raw_message":"https://github.com/OpenNMT/OpenNMT-py/issues/770","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":1,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2019-05-06T06:17:35","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I recon that the layernorm will eliminate the gradients if they are normalized together, just like adding softmax to end of a layer\u3002\u003c/p>","id":"4442197867","createdAt":"2019-04-29T06:17:35","author":{"username":"2014ion","about":"","name":"2014 ion","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-04-29T06:14:53","profileUrl":"https://disqus.com/by/2014ion/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"331927718","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/2014ion.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/2014ion.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/2014ion.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3873740919,"isApproved":true,"isFlagged":false,"raw_message":"I recon that the layernorm will eliminate the gradients if they are normalized together, just like adding softmax to end of a layer\u3002","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-05-03T17:14:11","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Can anyone explain what going on inside the code block below. Why are we slicing target tenser. What does the blocked line do\u003c/p>\u003cp>\u003ccode>\u003cbr>if trg is not None:\u003cbr>    self.trg = trg[:, :-1]\u003cbr>    self.trg_y = trg[:, 1:]\u003cbr>    self.trg_mask = self.make_std_mask(self.trg, pad)\u003cbr>    self.ntokens = (self.trg_y != pad).data.sum()\u003cbr>\u003cbr>    @staticmethod\u003cbr>    def make_std_mask(tgt, pad):\u003cbr>        \"Create a mask to hide padding and future words.\"\u003cbr>        tgt_mask = (tgt != pad).unsqueeze(-2)\u003cbr>        \u003cb>tgt_mask = tgt_mask &amp; Variable(subsequent_mask(tgt.size(-1)).type_as(\u003ca href=\"http://disq.us/url?url=http%3A%2F%2Ftgt_mask.data%3ABFqsU95Z7l2Xi5bBRrBB4I594mI&amp;cuid=5460729\" rel=\"nofollow noopener\" title=\"tgt_mask.data\">tgt_mask.data\u003c/a>))\u003c/b> #\u003cbr>        return tgt_mask\u003cbr>\u003c/code>\u003c/p>","id":"4890774308","createdAt":"2020-04-26T17:14:11","author":{"username":"disqus_ueScOToxjn","about":"","name":"Santhosh kumar.r","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2018-02-13T13:33:17","profileUrl":"https://disqus.com/by/disqus_ueScOToxjn/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"279990264","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_ueScOToxjn.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_ueScOToxjn.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_ueScOToxjn.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Can anyone explain what going on inside the code block below. Why are we slicing target tenser. What does the blocked line do\n\n\u003ccode>\nif trg is not None:\n    self.trg = trg[:, :-1]\n    self.trg_y = trg[:, 1:]\n    self.trg_mask = self.make_std_mask(self.trg, pad)\n    self.ntokens = (self.trg_y != pad).data.sum()\n\n    @staticmethod\n    def make_std_mask(tgt, pad):\n        \"Create a mask to hide padding and future words.\"\n        tgt_mask = (tgt != pad).unsqueeze(-2)\n        \u003cb>tgt_mask = tgt_mask & Variable(subsequent_mask(tgt.size(-1)).type_as(tgt_mask.data))\u003c/b> #\n        return tgt_mask\n\u003c/code>","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":["links"],"isEdited":true,"sb":false},{"editableUntil":"2020-04-08T11:12:47","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Thanks for this great post! I still have two questions remaining:\u003c/p>\u003cp>1. How are the query, key and value initialized? What are they based on?\u003c/p>\u003cp>2. What happens in the following lines?:\u003c/p>\u003cp>\u003ccode>query, key, value = \\\u003cbr>            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)\u003cbr>             for l, x in zip(self.linears, (query, key, value))]\u003c/code>\u003c/p>","id":"4856371343","createdAt":"2020-04-01T11:12:47","author":{"username":"emilrijcken","about":"","name":"Emil Rijcken","disable3rdPartyTrackers":true,"isPowerContributor":false,"joinedAt":"2013-09-02T11:09:47","profileUrl":"https://disqus.com/by/emilrijcken/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"71050492","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/emilrijcken.jpg","cache":"https://c.disquscdn.com/uploads/users/7105/492/avatar32.jpg?1585739568"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/emilrijcken.jpg","cache":"https://c.disquscdn.com/uploads/users/7105/492/avatar92.jpg?1585739568","large":{"permalink":"https://disqus.com/api/users/avatars/emilrijcken.jpg","cache":"https://c.disquscdn.com/uploads/users/7105/492/avatar92.jpg?1585739568"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks for this great post! I still have two questions remaining:\n\n1. How are the query, key and value initialized? What are they based on?\n\n2. What happens in the following lines?: \n\n\u003ccode>query, key, value = \\\n            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)\n             for l, x in zip(self.linears, (query, key, value))]\u003c/code>","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2020-04-15T04:11:17","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I have the same question as yours, do you figure it out?\u003c/p>","id":"4865585718","createdAt":"2020-04-08T04:11:17","author":{"username":"disqus_W64TGqfzwI","about":"","name":"Salted Fish","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2020-04-08T04:10:23","profileUrl":"https://disqus.com/by/disqus_W64TGqfzwI/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"347313044","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_W64TGqfzwI.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_W64TGqfzwI.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_W64TGqfzwI.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4856371343,"isApproved":true,"isFlagged":false,"raw_message":"I have the same question as yours, do you figure it out?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-03-18T23:09:07","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Excellent post. It is very interesting!\u003c/p>\u003cp>I tried running the code shown in the post to analyze the copy and translation examples, but it appears that I have something wrong when evaluating the loss function.\u003c/p>\u003cp>Every time I run my code, it appears the following message:\u003c/p>\u003cp>Variable(torch.LongTensor([1]))).data[0]\u003c/p>\u003cp>IndexError: invalid index of a 0-dim tensor. Use tensor.item() to convert a 0-dim tensor to a Python number\u003c/p>\u003cp>Does anyone know why I'm getting this error? I copied the functions as shown in the post, so I have no idea of what is wrong.\u003c/p>","id":"4829395282","createdAt":"2020-03-11T23:09:07","author":{"username":"disqus_ncDZfpFCvH","about":"","name":"German","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-11-08T02:33:05","profileUrl":"https://disqus.com/by/disqus_ncDZfpFCvH/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"229238841","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_ncDZfpFCvH.jpg","cache":"https://c.disquscdn.com/uploads/users/22923/8841/avatar32.jpg?1583968372"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_ncDZfpFCvH.jpg","cache":"https://c.disquscdn.com/uploads/users/22923/8841/avatar92.jpg?1583968372","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_ncDZfpFCvH.jpg","cache":"https://c.disquscdn.com/uploads/users/22923/8841/avatar92.jpg?1583968372"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Excellent post. It is very interesting!\n\nI tried running the code shown in the post to analyze the copy and translation examples, but it appears that I have something wrong when evaluating the loss function.\n\nEvery time I run my code, it appears the following message:\n\nVariable(torch.LongTensor([1]))).data[0]\n\nIndexError: invalid index of a 0-dim tensor. Use tensor.item() to convert a 0-dim tensor to a Python number\n\nDoes anyone know why I'm getting this error? I copied the functions as shown in the post, so I have no idea of what is wrong.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-03-18T23:12:51","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Never mind, it appears that my Pytorch version was the one generating the error.\u003c/p>","id":"4829399538","createdAt":"2020-03-11T23:12:51","author":{"username":"disqus_ncDZfpFCvH","about":"","name":"German","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-11-08T02:33:05","profileUrl":"https://disqus.com/by/disqus_ncDZfpFCvH/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"229238841","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_ncDZfpFCvH.jpg","cache":"https://c.disquscdn.com/uploads/users/22923/8841/avatar32.jpg?1583968372"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_ncDZfpFCvH.jpg","cache":"https://c.disquscdn.com/uploads/users/22923/8841/avatar92.jpg?1583968372","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_ncDZfpFCvH.jpg","cache":"https://c.disquscdn.com/uploads/users/22923/8841/avatar92.jpg?1583968372"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4829395282,"isApproved":true,"isFlagged":false,"raw_message":"Never mind, it appears that my Pytorch version was the one generating the error.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-04-15T03:00:52","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I found the same problem. \u003cbr>Change '''return crit(Variable(predict.log()),\u003cbr>                 Variable(torch.LongTensor([1]))).data[0]'''\u003cbr>to\u003cbr>'''return crit(Variable(predict.log()),\u003cbr>                 Variable(torch.LongTensor([1])))'''\u003cbr>works for me.\u003c/p>","id":"4865535850","createdAt":"2020-04-08T03:00:52","author":{"username":"paulmyeongchankim","about":"","name":"Paul Myeongchan Kim","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-12-08T05:06:03","profileUrl":"https://disqus.com/by/paulmyeongchankim/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"233898100","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/paulmyeongchankim.jpg","cache":"https://c.disquscdn.com/uploads/users/23389/8100/avatar32.jpg?1586314853"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/paulmyeongchankim.jpg","cache":"https://c.disquscdn.com/uploads/users/23389/8100/avatar92.jpg?1586314853","large":{"permalink":"https://disqus.com/api/users/avatars/paulmyeongchankim.jpg","cache":"https://c.disquscdn.com/uploads/users/23389/8100/avatar92.jpg?1586314853"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4829399538,"isApproved":true,"isFlagged":false,"raw_message":"I found the same problem. \nChange '''return crit(Variable(predict.log()),\n                 Variable(torch.LongTensor([1]))).data[0]'''\nto\n'''return crit(Variable(predict.log()),\n                 Variable(torch.LongTensor([1])))'''\nworks for me.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":2,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2020-02-23T06:46:07","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Great\u003c/p>","id":"4797788504","createdAt":"2020-02-16T06:46:07","author":{"username":"disqus_CJ2YxxoGsj","about":"","name":"\u738b\u5b97\u51b0","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-08-21T08:35:42","profileUrl":"https://disqus.com/by/disqus_CJ2YxxoGsj/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"262779450","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_CJ2YxxoGsj.jpg","cache":"https://c.disquscdn.com/uploads/users/26277/9450/avatar32.jpg?1581835568"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/disqus_CJ2YxxoGsj.jpg","cache":"https://c.disquscdn.com/uploads/users/26277/9450/avatar92.jpg?1581835568","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_CJ2YxxoGsj.jpg","cache":"https://c.disquscdn.com/uploads/users/26277/9450/avatar92.jpg?1581835568"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Great","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-02-06T23:34:24","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>The text towards the beginning of the encoder section states: \"That is, the output of each sub-layer is LayerNorm(X + Sublayer(X))\"\u003c/p>\u003cp>However in the code the following is called:  x + self.dropout(sublayer(self.norm(x)))\u003c/p>\u003cp>Which (ignoring dropout) I interpret in text as:\u003cbr> \"X + Sublayer(LayerNorm(x)) != \"LayerNorm(X + Sublayer(X))\"\u003c/p>\u003cp>Are these actually equivalent, whats going on here?\u003c/p>","id":"4777619610","createdAt":"2020-01-30T23:34:24","author":{"username":"danielclaborne","about":"","name":"Daniel Claborne","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2020-01-30T23:33:37","profileUrl":"https://disqus.com/by/danielclaborne/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"344074786","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/danielclaborne.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/danielclaborne.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/danielclaborne.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"The text towards the beginning of the encoder section states: \"That is, the output of each sub-layer is LayerNorm(X + Sublayer(X))\"\n\n\n\n\nHowever in the code the following is called:  x + self.dropout(sublayer(self.norm(x)))\n\n\n\n\nWhich (ignoring dropout) I interpret in text as:\n \"X + Sublayer(LayerNorm(x)) != \"LayerNorm(X + Sublayer(X))\"\n\n\n\n\nAre these actually equivalent, whats going on here?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-03-30T06:31:45","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>These are not equivalent but the differences are almost negligible. The paper writes it as LayerNorm(X + Sublayer(X))\", but apparently the authors' code implemented it as \"X + Dropout(Sublayer(LayerNorm(X)))\". The difference is that this implementation normalizes the output after the summation/matrix multiplication and the paper normalizes the output after the residual connection. I would have guessed that normalizing after the residual connection would have slightly better performance/convergence but either that's not true or it doesn't matter.\u003c/p>\u003cp>There's discussions about this earlier on this page: \u003ca href=\"http://disq.us/p/1s2bpmf\" rel=\"nofollow noopener\" title=\"http://disq.us/p/1s2bpmf\">http://disq.us/p/1s2bpmf\u003c/a>\u003c/p>","id":"4843991852","createdAt":"2020-03-23T06:31:45","author":{"username":"ajwildridge","about":"","name":"Aj Wildridge","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-12-12T21:22:52","profileUrl":"https://disqus.com/by/ajwildridge/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"341999572","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/ajwildridge.jpg","cache":"https://c.disquscdn.com/uploads/users/34199/9572/avatar32.jpg?1584945107"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/ajwildridge.jpg","cache":"https://c.disquscdn.com/uploads/users/34199/9572/avatar92.jpg?1584945107","large":{"permalink":"https://disqus.com/api/users/avatars/ajwildridge.jpg","cache":"https://c.disquscdn.com/uploads/users/34199/9572/avatar92.jpg?1584945107"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4777619610,"isApproved":true,"isFlagged":false,"raw_message":"These are not equivalent but the differences are almost negligible. The paper writes it as LayerNorm(X + Sublayer(X))\", but apparently the authors' code implemented it as \"X + Dropout(Sublayer(LayerNorm(X)))\". The difference is that this implementation normalizes the output after the summation/matrix multiplication and the paper normalizes the output after the residual connection. I would have guessed that normalizing after the residual connection would have slightly better performance/convergence but either that's not true or it doesn't matter.\n\n\n\n\n\n\n\n\nThere's discussions about this earlier on this page: http://disq.us/p/1s2bpmf","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2020-01-25T02:05:21","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Thanks for a great post!\u003c/p>","id":"4761321050","createdAt":"2020-01-18T02:05:21","author":{"username":"sruthikeshsurineni","about":"","name":"Sruthikesh Surineni","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2020-01-18T02:05:06","profileUrl":"https://disqus.com/by/sruthikeshsurineni/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"343506387","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/sruthikeshsurineni.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/sruthikeshsurineni.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/sruthikeshsurineni.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thanks for a great post!","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-10-20T07:53:53","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I have a question about LabelSmoothing()\uff1a\u003cbr>true_dist.fill_(self.smoothing / (self.size - 2))\u003cbr>why  is (self.size -2) ?\u003cbr>in the paper,  eps/K ,  so it should be (self.smoothing / self.size ), where is my misunderstanding?\u003c/p>","id":"4650467166","createdAt":"2019-10-13T07:53:53","author":{"username":"chuankangwu","about":"","name":"chuankang wu","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-10-06T07:25:11","profileUrl":"https://disqus.com/by/chuankangwu/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"338843326","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/chuankangwu.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/chuankangwu.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/chuankangwu.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"I have a question about LabelSmoothing()\uff1a\ntrue_dist.fill_(self.smoothing / (self.size - 2))\nwhy  is (self.size -2) ?\nin the paper,  eps/K ,  so it should be (self.smoothing / self.size ), where is my misunderstanding?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2020-01-28T07:25:13","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>I don't know whether it is right or not. In my opinion, the sentence include '&lt;sos&gt;' and '&lt;eos&gt;', so it should self.size - 2\u003c/p>","id":"4764931975","createdAt":"2020-01-21T07:25:13","author":{"username":"shijianxiao","about":"","name":"Shijian Xiao","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2020-01-21T07:24:58","profileUrl":"https://disqus.com/by/shijianxiao/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"343642456","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/shijianxiao.jpg","cache":"https://c.disquscdn.com/uploads/users/34364/2456/avatar32.jpg?1579591514"},"isCustom":true,"permalink":"https://disqus.com/api/users/avatars/shijianxiao.jpg","cache":"https://c.disquscdn.com/uploads/users/34364/2456/avatar92.jpg?1579591514","large":{"permalink":"https://disqus.com/api/users/avatars/shijianxiao.jpg","cache":"https://c.disquscdn.com/uploads/users/34364/2456/avatar92.jpg?1579591514"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4650467166,"isApproved":true,"isFlagged":false,"raw_message":"I don't know whether it is right or not. In my opinion, the sentence include '\u003csos>' and '\u003ceos>', so it should self.size - 2","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-09-28T21:59:32","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>such an instructive post!\u003c/p>","id":"4624106196","createdAt":"2019-09-21T21:59:32","author":{"username":"xiangyizhang","about":"","name":"XiangYi Zhang","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2018-11-08T21:40:03","profileUrl":"https://disqus.com/by/xiangyizhang/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"324863622","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/xiangyizhang.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/xiangyizhang.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/xiangyizhang.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"such an instructive post!","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2019-09-03T03:04:16","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Thank you for a great piece.\u003c/p>\u003cp>I have a question about the method foward in LabelSmoothing. I debug it by Pycharm and the excuting order is from \u003cbr>loss = self.criterion(x.contiguous().view(-1, x.size(-1)),  #[30, 9, 512] --&gt; [270, 512]\u003cbr>                              y.contiguous().view(-1)) / norm  #[30, 9] --&gt; [270]    (SimpleLossCompute's method  __call__)\u003cbr>to\u003cbr>method forward in LabelSmoothing\u003cbr>    def forward(self, x, target):  #x is the output of model, target is label\u003cbr>        assert x.size(1) == self.size\u003cbr>        true_dist = x.data.clone()\u003cbr>        ....\u003cbr>why the dim of x changes from [270, 512] to [270, 11]\u003c/p>","id":"4593053051","createdAt":"2019-08-27T03:04:16","author":{"username":"disqus_fNLJ4DtS27","about":"","name":"\u738b\u5803","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-08-27T02:58:53","profileUrl":"https://disqus.com/by/disqus_fNLJ4DtS27/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"336941994","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_fNLJ4DtS27.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_fNLJ4DtS27.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_fNLJ4DtS27.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isFlagged":false,"raw_message":"Thank you for a great piece.\n\nI have a question about the method foward in LabelSmoothing. I debug it by Pycharm and the excuting order is from \nloss = self.criterion(x.contiguous().view(-1, x.size(-1)),  #[30, 9, 512] --> [270, 512]\n                              y.contiguous().view(-1)) / norm  #[30, 9] --> [270]    (SimpleLossCompute's method  __call__)\nto\nmethod forward in LabelSmoothing\n    def forward(self, x, target):  #x is the output of model, target is label\n        assert x.size(1) == self.size\n        true_dist = x.data.clone()\n        ....\nwhy the dim of x changes from [270, 512] to [270, 11]","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2019-09-03T05:16:30","dislikes":0,"thread":"6595120245","numReports":0,"likes":0,"message":"\u003cp>Sorry, I made a mistake and I know the reason now.\u003c/p>","id":"4593126985","createdAt":"2019-08-27T05:16:30","author":{"username":"disqus_fNLJ4DtS27","about":"","name":"\u738b\u5803","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2019-08-27T02:58:53","profileUrl":"https://disqus.com/by/disqus_fNLJ4DtS27/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"336941994","avatar":{"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_fNLJ4DtS27.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar32.png"},"isCustom":false,"permalink":"https://disqus.com/api/users/avatars/disqus_fNLJ4DtS27.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_fNLJ4DtS27.jpg","cache":"//a.disquscdn.com/1587400073/images/noavatar92.png"}}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":4593053051,"isApproved":true,"isFlagged":false,"raw_message":"Sorry, I made a mistake and I know the reason now.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"harvard-nlp","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false}],"thread":{"feed":"https://harvard-nlp.disqus.com/harvardnlp_47/latest.rss","clean_title":"harvardnlp","dislikes":0,"likes":72,"message":"","ratingsEnabled":false,"isSpam":false,"isDeleted":false,"category":"7581793","adsDisabled":false,"author":"213053281","id":"6595120245","signedLink":"http://disq.us/?url=http%3A%2F%2Fnlp.seas.harvard.edu%2F2018%2F04%2F03%2Fattention.html&key=QXDYw8NbixHqzWxcbLJbfA","createdAt":"2018-04-04T16:38:21","hasStreaming":false,"raw_message":"","isClosed":false,"link":"http://nlp.seas.harvard.edu/2018/04/03/attention.html","slug":"harvardnlp_47","forum":"harvard-nlp","identifiers":[],"posts":86,"moderators":[213053281],"validateAllPosts":false,"title":"harvardnlp","highlightedPost":null}},"order":"popular"}</script>


    <div id="fixed-content"></div>


    
        
<script type="text/json" id="disqus-urls">{
    "root":"//disqus.com",
    "next":"https://c.disquscdn.com/next/current/embed"
}</script>

        
        <script>!function () {
            var d = document;
            var toH = d.head.appendChild.bind(d.head);

            var v = window.location.href.match(/[#&?]version=([0-9a-f]{32})/);
            var src = 'https://c.disquscdn.com/next/embed/lounge.load';
            if (v)
                src += '.' + v[1];
            src += '.js';

            var s = d.createElement('script');
            s.crossOrigin = 'anonymous';
            s.id = 'bootstrap-script';
            s.setAttribute('data-app', 'lounge');
            s.src = src;
            toH(s);

            var m = d.createElement('meta');
            m.setAttribute('http-equiv', 'Content-Security-Policy');
            m.setAttribute('content', "script-src https:;");
            toH(m);
        }();</script>
    


<script src="a_data/common.js"></script><div id="layout" data-tracking-area="layout"><div id="thread__container"><div><div id="thread__wrapper"><div id="placement-top" data-tracking-area="discovery-north"><div class="post-list" style="height: 0px; visibility: hidden;"></div></div><div id="survey__container"></div><div id="onboard" data-tracking-area="onboard"><div></div></div><div id="reactions__container"></div><div id="ratings__container"></div><div id="highlighted-post" data-tracking-area="highlighted" class="highlighted-post" style="display: none;"></div><div id="global-alert"></div><div id="tos__container"></div><header id="main-nav" data-tracking-area="main-nav"><nav class="nav nav-primary"><ul><li class="nav-tab nav-tab--primary tab-conversation active" data-role="post-count"><a class="publisher-nav-color"><span class="comment-count">86 comments</span><span class="comment-count-placeholder">Comments</span></a></li><li class="nav-tab nav-tab--primary tab-general"><a href="https://disqus.com/home/forums/harvard-nlp/" class="publisher-nav-color" data-action="community-sidebar" data-forum="harvard-nlp" id="community-tab" name="Harvard NLP"><span class="community-name"><strong>Harvard NLP</strong></span><strong class="community-name-placeholder">Community</strong></a></li><li class="nav-tab nav-tab--primary tab-general"><a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" rel="nofollow noopener noreferrer" target="_blank" class="publisher-nav-color privacy-policy" title="Disqus' Privacy Policy"><i aria-hidden="true" class="icon icon-lock"></i><span class="clip privacy-policy-full hidden-md">&nbsp;Disqus' Privacy Policy</span><span class="clip privacy-policy-short">&nbsp;Privacy Policy</span></a></li><li class="nav-tab nav-tab--primary dropdown user-menu" data-role="logout"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="menuitem" name="Login"><span class="dropdown-toggle-wrapper"><span>Login</span> </span> <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#" data-action="auth:disqus">Disqus</a></li><li><a href="#" data-action="auth:facebook">Facebook</a></li><li><a href="#" data-action="auth:twitter">Twitter</a></li><li><a href="#" data-action="auth:google">Google</a></li></ul></li><li class="nav-tab nav-tab--primary notification-menu unread" data-role="notification-menu" style="display: list-item;"><a href="https://disqus.com/home/inbox/" class="notification-container" data-action="home" data-home-path="home/inbox/"><span class="notification-icon icon-comment" aria-hidden="true"></span><span class="notification-count" data-role="notification-count">1</span></a></li></ul></nav></header><section id="conversation" data-role="main" data-tracking-area="main"><div class="nav nav-secondary" data-tracking-area="secondary-nav"><ul><li id="recommend-button" class="nav-tab nav-tab--secondary recommend dropdown"><div class="thread-likes"><div><a href="#" data-action="recommend" title="Recommend this discussion" class="dropdown-toggle "><span class="label label-default"><span class="recommend-icon icon-heart-empty"></span> Recommend</span><span class="label label-recommended"><span class="recommend-icon icon-heart"></span> Recommended</span> <span class="label label-count">72</span></a><ul class="dropdown-menu dropdown-menu--coachmark"><li><div><h2 class="coachmark__heading">Discussion Recommended!</h2><p class="coachmark__description">Recommending means this is a discussion worth sharing. It gets shared to your followers' Disqus feeds, and gives the creator kudos!</p></div> <a href="https://disqus.com/home/?utm_source=disqus_embed&amp;utm_content=recommend_btn" class="btn btn-primary coachmark__button" target="_blank">Find More Discussions</a></li></ul></div></div></li><li id="thread-share-bar" class="nav-tab nav-tab--secondary share-bar hidden-sm"><div class="thread-share-bar-buttons"><span class="thread-share__button share-twitter" data-action="share:twitter" tabindex="0"><span class="icon-twitter"></span><span class="share-text">Tweet</span></span><span class="thread-share__button share-facebook" data-action="share:facebook" tabindex="0"><span class="icon-facebook"></span><span class="share-text">Share</span></span></div></li><li data-role="post-sort" class="nav-tab nav-tab--secondary dropdown sorting pull-right"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Sort by Best<span class="caret"></span></a><ul class="dropdown-menu pull-right"><li class="selected"><a href="#" data-action="sort" data-sort="popular">Best<i aria-hidden="true" class="icon-checkmark"></i></a></li><li class=""><a href="#" data-action="sort" data-sort="desc">Newest<i aria-hidden="true" class="icon-checkmark"></i></a></li><li class=""><a href="#" data-action="sort" data-sort="asc">Oldest<i aria-hidden="true" class="icon-checkmark"></i></a></li></ul></li></ul></div><div id="posts"><div id="form" class="textarea-outer-wrapper--top-level"><form class="reply"><div class="postbox"><div role="alert"></div><div class="ratings-wrapper" data-role="ratings-container"></div><div class="compose-wrapper"><div class="avatar"><span class="user"><img data-role="user-avatar" src="a_data/noavatar92.png" alt="Avatar"></span></div><div class="textarea-outer-wrapper"><div class="textarea-wrapper" data-role="textarea" dir="auto"><div><span class="placeholder">Join the discussion…</span><div class="textarea" tabindex="0" role="textbox" aria-multiline="true" data-role="editable" style="overflow: auto; overflow-wrap: break-word; max-height: 350px;" aria-label="Join the discussion…" contenteditable="true"><p><br></p></div><div style="display: none;"><ul class="user-mention__list" id="user-mention-list"><li class="header user-mention__header"><h5>in this conversation</h5></li></ul></div></div><div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none;"><div class="drag-text">⬇ Drag and drop your images here to upload them.</div></div><div class="media-preview empty" data-role="media-preview"><ul data-role="media-progress-list"></ul>
<ul data-role="media-rich-list"></ul>
<div class="media-expanded empty" data-role="media-preview-expanded">
<img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-role="media-preview-expanded-image" alt="Media preview placeholder">
</div>
</div><div class="edit-alert" role="postbox-alert"></div><div class="text-editor-container"><div class="post-actions"><div class="wysiwyg"><div class="gif-picker"><div class="wysiwyg__item" data-role="gif-picker-toggle" title="GIF"><div class="wysiwyg__gif" title="GIF" role="img" aria-label="GIF"></div></div><div class="hidden gif-picker__popout-container" data-role="gif-picker-popout-container"></div><div class="new-feature-badge-star" title="New"><div class="wysiwyg__star-badge wysiwyg__star-badge-dims"></div></div></div><div class="media-uploader"><li class="wysiwyg__item" data-role="media-uploader"><a href="#" tabindex="-1" data-action="attach" class="attach" title="Upload Images">
<div class="wysiwyg__attach wysiwyg__attach-dims" role="img" aria-label="A"></div>
</a>
<input type="file" data-role="media-upload" tabindex="-1" accept="image/*">
</li></div><div class="vertical-separator"></div><div data-action="text-editor-buttons"><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="b"><div class="wysiwyg__bold" title="Bold" role="img" aria-label="B"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="i"><div class="wysiwyg__italic" title="Italic" role="img" aria-label="I"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="u"><div class="wysiwyg__underline" title="Underline" role="img" aria-label="U"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="s"><div class="wysiwyg__strikethrough" title="Strikethrough" role="img" aria-label="S"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="a"><div class="wysiwyg__link" title="Link" role="img" aria-label="L"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="spoiler"><div class="wysiwyg__spoiler" title="Spoiler" role="img" aria-label="Sp"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="code"><div class="wysiwyg__code" title="Code" role="img" aria-label="C"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="blockquote"><div class="wysiwyg__blockquote" title="Quote" role="img" aria-label="Q"></div></div></div></div><div class="logged-in"><section><div class="temp-post"><button class="btn post-action__button full-size-button hidden">Post as <span data-role="username"></span></button><button class="btn post-action__button small-size-button hidden">Post</button></div></section></div></div></div></div></div></div><div data-role="login-form"><div><div><section class="auth-section logged-out__display"><div class="connect"><h6>Log in with</h6><ul data-role="login-menu" class="services login-buttons"><li class="auth-disqus"><button type="button" data-action="auth:disqus" title="Disqus" class="connect__button"><i class="icon-disqus"></i></button></li><li class="auth-facebook"><button type="button" data-action="auth:facebook" title="Facebook" class="connect__button"><i class="icon-facebook-circle"></i></button></li><li class="auth-twitter"><button type="button" data-action="auth:twitter" title="Twitter" class="connect__button"><i class="icon-twitter-circle"></i></button></li><li class="auth-google"><button type="button" data-action="auth:google" title="Google" class="connect__button"><i class="icon-google-plus-circle"></i></button></li></ul></div><div class="guest"><h6 class="guest-form-title"><span class="register-text"> or sign up with Disqus </span><span class="guest-text"> or pick a name </span></h6> <div class="help-tooltip__wrapper help-icon" tabindex="0"><div id="rules" class="tooltip show help-tooltip"><h3 class="help-tooltip__heading">Disqus is a discussion network</h3><ul class="help-tooltip__list"><li><span>Disqus never moderates or censors. The rules on this community are its own.</span></li><li><span>Don't be a jerk or do anything illegal. Everything is easier that way.</span></li></ul><p class="clearfix"><a href="https://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small help-tooltip__button" target="_blank">Read full terms and conditions</a></p></div></div><p class="input-wrapper"><input dir="auto" type="text" placeholder="Name" name="display_name" id="view118_display_name" maxlength="30" class="input--text" aria-label="name"></p><div class="guest-details " data-role="guest-details"><p class="input-wrapper"><input dir="auto" type="email" placeholder="Email" name="email" id="view118_email" class="input--text" aria-label="email"></p><p class="input-wrapper"><input dir="auto" disabled="disabled" type="text" class="register-text input--text" placeholder="Password" name="password" aria-label="password" id="view118_password"></p><p><label><span>Please access our <a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
 to learn what personal data Disqus collects and your choices about how 
it is used.  All users of our service are also subject to our <a href="https://help.disqus.com/customer/portal/articles/466260-terms-of-service" target="_blank" rel="noopener noreferrer">Terms of Service</a>.</span></label></p><input type="checkbox" name="author-guest" style="display: none;"><div class="g-recaptcha" data-role="grecaptcha-container"></div><div class="proceed" data-role="submit-btn-container"><button type="submit" class="proceed__button btn submit" aria-label="Next"><span class="icon-proceed"></span><div class="spinner"></div></button></div></div></div></section></div></div></div></div></form></div><button class="alert alert--realtime" style="display: none;" data-role="realtime-notification"></button><div id="email-signup"></div><div id="no-posts" style="display: none;"></div><ul id="post-list" class="post-list"><li class="post" id="post-3869074635"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="3869074635"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/joost1123/" data-action="profile" data-username="joost1123" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="12889728" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/joost1123/" data-action="profile" data-username="joost1123" target="_blank" rel="noopener noreferrer">joost1123</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-3869074635" data-role="relative-time" class="time-ago" title="Monday, April 23, 2018 10:45 PM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Great post! Q: shouldn't there be a "bias=False" in this statement in Generator?<br>self.proj = nn.Linear(d_model, vocab)</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-5" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">5</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1rzjp3f" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1rzjp3f"></li></ul></li><li class="realtime" data-role="realtime-notification:3869074635"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3869074635-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4547747695"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4547747695"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_8lgrEHvH9y/" data-action="profile" data-username="disqus_8lgrEHvH9y" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="335232778" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_8lgrEHvH9y/" data-action="profile" data-username="disqus_8lgrEHvH9y" target="_blank" rel="noopener noreferrer">Frank Wang</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4547747695" data-role="relative-time" class="time-ago" title="Sunday, July 21, 2019 3:51 AM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>For the `make_std_mask` method:<br>`tgt_mask`
 have the shape of (1, batches, length), and the `subsequent_mask` 
method should output shape of (1, length, length). How the two tensors 
have `&amp;` operator?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-3" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">3</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/237m0kv" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/237m0kv"></li></ul></li><li class="realtime" data-role="realtime-notification:4547747695"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4840517822"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4840517822"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/kenenbekarzymatov/" data-action="profile" data-username="kenenbekarzymatov" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="149510443" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/kenenbekarzymatov/" data-action="profile" data-username="kenenbekarzymatov" target="_blank" rel="noopener noreferrer">Kenenbek Arzymatov</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4547747695" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Frank Wang</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4840517822" data-role="relative-time" class="time-ago" title="Friday, March 20, 2020 10:14 AM">3 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Have you found an answer?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/281x3ge" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/281x3ge"></li></ul></li><li class="realtime" data-role="realtime-notification:4840517822"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4840517822-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4547747695-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4015929276"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4015929276"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/kaustubhkunte/" data-action="profile" data-username="kaustubhkunte" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="252947050" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/kaustubhkunte/" data-action="profile" data-username="kaustubhkunte" target="_blank" rel="noopener noreferrer">Kaustubh Kunte</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4015929276" data-role="relative-time" class="time-ago" title="Tuesday, July 31, 2018 10:09 PM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Question: Why does MultiHeadAttention class create only 4 clones instead of 8?<br>        self.linears = clones(nn.Linear(d_model, d_model), 4)</p><p>Thanks for a great post !</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-3" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">3</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1uezav0" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1uezav0"></li></ul></li><li class="realtime" data-role="realtime-notification:4015929276"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4150577140"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4150577140"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_5iwwxhLeGL/" data-action="profile" data-username="disqus_5iwwxhLeGL" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="323780185" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_5iwwxhLeGL/" data-action="profile" data-username="disqus_5iwwxhLeGL" target="_blank" rel="noopener noreferrer">Yu-Tao</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4015929276" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Kaustubh Kunte</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4150577140" data-role="relative-time" class="time-ago" title="Thursday, October 18, 2018 1:21 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I guess you misunderstand the zip function.<br>query, key, value = \<br>            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)<br>             for l, x in zip(self.linears, (query, key, value))]<br>In
 this code, the first linear layer works on query, the second one works 
on key and the third one works on value. The fourth one is used in: 
return self.linears[-1](x)<br>So the total number of linear layers is four.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-9" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">9</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1wn59tg" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1wn59tg"></li></ul></li><li class="realtime" data-role="realtime-notification:4150577140"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4347070890"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4347070890"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/nimning/" data-action="profile" data-username="nimning" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="329113907" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/nimning/" data-action="profile" data-username="nimning" target="_blank" rel="noopener noreferrer">nimning</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4150577140" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Yu-Tao</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4347070890" data-role="relative-time" class="time-ago" title="Wednesday, February 20, 2019 6:20 PM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hi <br>Why
 the linear layer has dimension (d_model, d_model) ? The  W^Q, W^K, and 
W^V have dimension (d_model, d_k), (d_model, d_k), and (d_model, d_v)? I
 do not see any layer corresponding to any of the three matrices.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1zw4td6" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1zw4td6"></li></ul></li><li class="realtime" data-role="realtime-notification:4347070890"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4359258506"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4359258506"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/yipuding/" data-action="profile" data-username="yipuding" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="329461722" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/yipuding/" data-action="profile" data-username="yipuding" target="_blank" rel="noopener noreferrer">Yipu Ding</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4347070890" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> nimning</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4359258506" data-role="relative-time" class="time-ago" title="Friday, March 1, 2019 12:14 AM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>This is my understanding,<br>see the code: <br>query, key, value = \</p><p>            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2) for l, x in zip(self.linears, (query, key, value))]<br>this will let the query, key,value pass through the first three Linear layers in self.linears, <br>so the first three Linear layers will be the Wq,Wk and Wv as you mentioned.<br>after this the matrix of query,key and value will have the shape(num_batches, time_steps, d_model).</p><p>Now
 since d_k = d_model//h, by reshaping it to(num_batches, -1, h, d_k) 
will give you the same amount of data.(here, d_k = d_v = d_w)<br> You 
can think of this as taking the first d_v features from d_model as the 
first head, then d_v+1 to 2*d_v as the second head. So now we do have 8 
heads just by splitting the features of size d_model that we learnt from
 the matrix.</p><p>Then by doing this: transpose(1, 2), you will get 
tensor of shape (n_batches, h, time steps, d_k), and by feeding query, 
key and value to self_attention function, you will get back a tensor of 
shape(n_batches, h, time_steps, d_k).</p><p>you can see now that by doing transpose(1,2) and reshaping it to (n_batches, -1, d_k*h)<br>will get you a tensor with the same shape as previous layer.</p><p>So the main idea is that instead of creating 8*3 matrices for all values, keys and queries,<br>we only create 3 bigger ones and then split it to get the smaller ones.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-2" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">2</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/203e1e2" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/203e1e2"></li></ul></li><li class="realtime" data-role="realtime-notification:4359258506"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4487791589"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4487791589"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/francoissteiner/" data-action="profile" data-username="francoissteiner" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="333338486" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/francoissteiner/" data-action="profile" data-username="francoissteiner" target="_blank" rel="noopener noreferrer">Francois Steiner</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4359258506" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Yipu Ding</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4487791589" data-role="relative-time" class="time-ago" title="Monday, June 3, 2019 12:57 PM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for a great post! <br>It
 seems to me that instead of splitting the original matrix in 8 for the 
multi-head attention, we should be creating 8 independent learnt 
projections, so the code should be re-written accordingly - any 
thoughts?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/227wy5h" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/227wy5h"></li></ul></li><li class="realtime" data-role="realtime-notification:4487791589"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4628704871"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4628704871"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_KMuier91G9/" data-action="profile" data-username="disqus_KMuier91G9" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="210307358" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_KMuier91G9/" data-action="profile" data-username="disqus_KMuier91G9" target="_blank" rel="noopener noreferrer">Sidney Melo</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4487791589" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Francois Steiner</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4628704871" data-role="relative-time" class="time-ago" title="Wednesday, September 25, 2019 11:39 AM">9 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I
 also believed the input would be projected entirely in 8 new vectors 
when I read the paper. Question is: to create 8 independent learnt 
projections is really equivalent to splitting the original matrix in 8?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/24jt7jb" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/24jt7jb"></li></ul></li><li class="realtime" data-role="realtime-notification:4628704871"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4645489194"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4645489194"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/chuankangwu/" data-action="profile" data-username="chuankangwu" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="338843326" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/chuankangwu/" data-action="profile" data-username="chuankangwu" target="_blank" rel="noopener noreferrer">chuankang wu</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4628704871" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Sidney Melo</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4645489194" data-role="relative-time" class="time-ago" title="Tuesday, October 8, 2019 10:49 PM">8 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container" style="height: 374px;"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>it is equivalent， an example below：<br> <span></span><div class="media-container media-mode-deferred">
<a class="media-button media-button-expand publisher-color publisher-border-color" href="https://uploads.disquscdn.com/images/958f686f492ff60d3d74ff4f735fec3a7910508849569a4edf0457471237ea54.jpg" rel="nofollow" target="_blank" data-action="expand" title="">
<i class="icon-images publisher-background-color"></i>
View
</a>
<a class="media-button media-button-contract publisher-color publisher-border-color" href="#" target="_blank" data-action="contract">
<i class="icon-cancel publisher-background-color"></i> Hide
</a>
<div class="media-content-loader" data-role="content-loader"></div>
<div data-role="content-placeholder" class="media-content-placeholder media-Disquscdn " style="height: 768px;"><a href="#" class="media-force-load" data-action="force-load"><i class="icon-images"></i></a>
</div>
</div></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-3" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">3</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/24tsyei" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/24tsyei"></li></ul></li><li class="realtime" data-role="realtime-notification:4645489194"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4645489194-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4628704871-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4487791589-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4359258506-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4347070890-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4150577140-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4015929276-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4177145673"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4177145673"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/free_variation/" data-action="profile" data-username="free_variation" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="54958964" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/free_variation/" data-action="profile" data-username="free_variation" target="_blank" rel="noopener noreferrer">free_variation</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4177145673" data-role="relative-time" class="time-ago" title="Saturday, November 3, 2018 5:56 PM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thank you for a great piece.</p><p>I
 have a question about the positional encoding.  Here you seem to 
interleave sine and cosine curves over the dimensions for a given 
position.  The indexing in the original paper suggests the same, but the
 code at <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensor2tensor%2Fblob%2Fmaster%2Ftensor2tensor%2Flayers%2Fcommon_attention.py%3ACTNdLeTn1cJXk0PU4IiBnjHRR2A&amp;cuid=5460729" rel="nofollow noopener" title="https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/layers/common_attention.py">https://github.com/tensorfl...</a> (and the discussion at <a href="http://disq.us/url?url=http%3A%2F%2Fjalammar.github.io%2Fillustrated-transformer%2F%3AJ0pFreh0LdTMQXRXyIcFL5TyZUs&amp;cuid=5460729" rel="nofollow noopener" title="http://jalammar.github.io/illustrated-transformer/">http://jalammar.github.io/i...</a> ) suggests a concatenation of sines on the left and cosines on the right.</p><p>I'm not sure it makes a substantive difference, but would you agree there's a difference in implementation here?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-5" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">5</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-1" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">1</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1x2yq89" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1x2yq89"></li></ul></li><li class="realtime" data-role="realtime-notification:4177145673"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4177145673-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4007049675"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4007049675"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/gaziev/" data-action="profile" data-username="gaziev" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="23962751" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/gaziev/" data-action="profile" data-username="gaziev" target="_blank" rel="noopener noreferrer">gaziev</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4007049675" data-role="relative-time" class="time-ago" title="Thursday, July 26, 2018 6:24 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for great post!<br>Q: shouldn't it be mask.dim() &gt; 1 in LabelSmoothing#forward?<br>Because
 in your example with target [1] mask after nonzero([1] == 0) will be 
tensor([]) which has dimension 1 and it will throw error if we pass it 
as argument in index_fill_ as index.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-5" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">5</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-1" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">1</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1u9ozbf" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1u9ozbf"></li></ul></li><li class="realtime" data-role="realtime-notification:4007049675"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4199309870"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4199309870"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/lipiji1986/" data-action="profile" data-username="lipiji1986" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="34038110" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/lipiji1986/" data-action="profile" data-username="lipiji1986" target="_blank" rel="noopener noreferrer">Piji Li</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4007049675" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> gaziev</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4199309870" data-role="relative-time" class="time-ago" title="Saturday, November 17, 2018 2:27 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>mask.sum() &gt; 0 ？</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-6" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">6</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-1" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">1</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1xg5s8e" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1xg5s8e"></li></ul></li><li class="realtime" data-role="realtime-notification:4199309870"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4203482166"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4203482166"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_W48rgB1BxP/" data-action="profile" data-username="disqus_W48rgB1BxP" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="325338843" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_W48rgB1BxP/" data-action="profile" data-username="disqus_W48rgB1BxP" target="_blank" rel="noopener noreferrer">Ke Wang</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4199309870" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Piji Li</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4203482166" data-role="relative-time" class="time-ago" title="Monday, November 19, 2018 10:02 PM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>change it to "mask.sum() &gt; 0 and len(mask) &gt; 0", it works!</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-1" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">1</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1xin7li" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1xin7li"></li></ul></li><li class="realtime" data-role="realtime-notification:4203482166"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4203482166-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4199309870-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4152328935"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4152328935"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_5iwwxhLeGL/" data-action="profile" data-username="disqus_5iwwxhLeGL" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="323780185" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_5iwwxhLeGL/" data-action="profile" data-username="disqus_5iwwxhLeGL" target="_blank" rel="noopener noreferrer">Yu-Tao</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4007049675" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> gaziev</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4152328935" data-role="relative-time" class="time-ago" title="Friday, October 19, 2018 4:17 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Same problem. I solve it by replace MyIterator with data.BucketIterator.<br>I'm not sure if it is related with the batch data.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1wo6tif" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1wo6tif"></li></ul></li><li class="realtime" data-role="realtime-notification:4152328935"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4152328935-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4007049675-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4885888969"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4885888969"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_wGGAF5yQKM/" data-action="profile" data-username="disqus_wGGAF5yQKM" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="177403162" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_wGGAF5yQKM/" data-action="profile" data-username="disqus_wGGAF5yQKM" target="_blank" rel="noopener noreferrer">Gus Smith</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4885888969" data-role="relative-time" class="time-ago" title="Wednesday, April 22, 2020 5:38 PM">2 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container" style="height: 374px;"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>The loss computation appears to be updating gradients during validation. <br>This appears to drive weight updates to fit the validation (test) data, which it should not.</p><p>A recommended way to run validation is apparently: <br><code>model.eval()<br>torch.no_grad()</code><br>[<a href="https://disq.us/url?url=https%3A%2F%2Fdiscuss.pytorch.org%2Ft%2Fmodel-eval-vs-with-torch-no-grad%2F19615%3Ae_08I4EBqohG3_nIbsY1i9V_SvA&amp;cuid=5460729" rel="nofollow noopener" title="https://discuss.pytorch.org/t/model-eval-vs-with-torch-no-grad/19615">https://discuss.pytorch.org...</a>](url)<br><a href="https://disq.us/url?url=https%3A%2F%2Fdiscuss.pytorch.org%2Ft%2Ftwo-small-questions-about-with-torch-no-grad%2F27571%3AzewGg_fpEMy6QbmM9X4Lh6ovyRk&amp;cuid=5460729" rel="nofollow noopener" title="https://discuss.pytorch.org/t/two-small-questions-about-with-torch-no-grad/27571">https://discuss.pytorch.org...</a></p><p>And indeed, the code that runs without error is the following, where loss.backward()<br>is pushed under the if statement:</p><p></p><pre><code class="hljs python">        <br>        model.eval()<br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            test_loss = run_epoch(val_dataloader, model, <br>                  SimpleLossCompute(model.generator, criterion, <span class="hljs-keyword">None</span>))<br>            print(<span class="hljs-string">"test_loss"</span>, test_loss)<br></code></pre><p><br>and: <br></p><pre><code class="hljs rust">class SimpleLossCompute:<br>    <span class="hljs-string">"A simple loss compute and train function."</span><br>    def __init__(<span class="hljs-keyword">self</span>, generator, criterion, opt=<span class="hljs-literal">None</span>):<br>        <span class="hljs-keyword">self</span>.generator = generator<br>        <span class="hljs-keyword">self</span>.criterion = criterion<br>        <span class="hljs-keyword">self</span>.opt = opt<br>        <br>    def __call__(<span class="hljs-keyword">self</span>, x, y, norm):<br>        x = <span class="hljs-keyword">self</span>.generator(x)<br>        loss = <span class="hljs-keyword">self</span>.criterion(x.contiguous().view(-<span class="hljs-number">1</span>, x.size(-<span class="hljs-number">1</span>)), <br>                              y.contiguous().view(-<span class="hljs-number">1</span>)) / norm<br>        #loss.backward()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.opt is not <span class="hljs-literal">None</span>:<br>            loss.backward()<br>            <span class="hljs-keyword">self</span>.opt.step()<br>            <span class="hljs-keyword">self</span>.opt.optimizer.zero_grad()<br>        <span class="hljs-keyword">return</span> loss.data * norm</code></pre><p></p><p>This was discovered in another forum.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-2" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">2</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28sxk21" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28sxk21"></li></ul></li><li class="realtime" data-role="realtime-notification:4885888969"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4885888969-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4286765854"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4286765854"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_Wv15C2dVTm/" data-action="profile" data-username="disqus_Wv15C2dVTm" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="94329578" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_Wv15C2dVTm/" data-action="profile" data-username="disqus_Wv15C2dVTm" target="_blank" rel="noopener noreferrer">Иван</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4286765854" data-role="relative-time" class="time-ago" title="Tuesday, January 15, 2019 3:36 AM">a year ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks a lot for such great post!</p><p>I guess there is a mistake in following part of code:<br><code><br>def clones(module, N):<br>         "Produce N identical layers."<br>         return nn.ModuleList([copy.deepcopy(module) for _ in range(N)])<br></code></p><p>"Deepcopy"
 copies the entire layer with it's weights what is wrong because (Wq_1, 
Wq_2, Wq_3, ..., Wk_1, Wk_2, Wk_3, ..., etc) must be randomly 
initialized. In other words "deepcopy" copies the only instance of class
 nn.Linear but N instances must be created. So I suppose that it's 
better to replace it by something like that:<br><code><br>def clones(params, N):<br>     return nn.ModuleList([nn.Linear(params) for _ in range(N)])<br></code></p><p>Sincerely, <br>Ivan</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-2" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">2</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1yw89pa" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1yw89pa"></li></ul></li><li class="realtime" data-role="realtime-notification:4286765854"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4349244276"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4349244276"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/peixiangzhong/" data-action="profile" data-username="peixiangzhong" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="202886301" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/peixiangzhong/" data-action="profile" data-username="peixiangzhong" target="_blank" rel="noopener noreferrer">Peixiang Zhong</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4286765854" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Иван</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4349244276" data-role="relative-time" class="time-ago" title="Friday, February 22, 2019 7:33 AM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Later there is code for model initialization at line 20 in the notebook</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1zxfed0" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1zxfed0"></li></ul></li><li class="realtime" data-role="realtime-notification:4349244276"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4349244276-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4286765854-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4349056928"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4349056928"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_pcWVloYWqZ/" data-action="profile" data-username="disqus_pcWVloYWqZ" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="182623577" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_pcWVloYWqZ/" data-action="profile" data-username="disqus_pcWVloYWqZ" target="_blank" rel="noopener noreferrer">Ning Ma</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4349056928" data-role="relative-time" class="time-ago" title="Friday, February 22, 2019 3:16 AM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>The
 output of each step in the decoder is fed to the bottom decoder in the 
next time step. So, based on thsi implementation, how can the decoder 
generate word one by one based on previous prediction? I do not see this
 logic in the code.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-3" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">3</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-1" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">1</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1zxbdsw" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1zxbdsw"></li></ul></li><li class="realtime" data-role="realtime-notification:4349056928"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4510068543"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4510068543"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_yCoVzKJPyj/" data-action="profile" data-username="disqus_yCoVzKJPyj" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="334049366" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_yCoVzKJPyj/" data-action="profile" data-username="disqus_yCoVzKJPyj" target="_blank" rel="noopener noreferrer">Ishaan</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4349056928" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Ning Ma</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4510068543" data-role="relative-time" class="time-ago" title="Thursday, June 20, 2019 5:29 PM">a year ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>During
 training, we don't need to feed the predicted word to the bottom 
decoder. We use teacher forcing here and feed the true word in the next 
time step. During testing though, we have to feed the predicted word 
(till &lt;eos&gt;) to generate the sentence. Please take a look towards 
the end here: <a href="https://disq.us/url?url=https%3A%2F%2Ftowardsdatascience.com%2Fhow-to-code-the-transformer-in-pytorch-24db27c8f9ec%3AbvDLL3adJKBQmU5c0DdyhSCRu2k&amp;cuid=5460729" rel="nofollow noopener" title="https://towardsdatascience.com/how-to-code-the-transformer-in-pytorch-24db27c8f9ec">https://towardsdatascience....</a></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/22l6f5r" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/22l6f5r"></li></ul></li><li class="realtime" data-role="realtime-notification:4510068543"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4510068543-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4349056928-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4881933302"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4881933302"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/aimanmutasembellh/" data-action="profile" data-username="aimanmutasembellh" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="136724852" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/aimanmutasembellh/" data-action="profile" data-username="aimanmutasembellh" target="_blank" rel="noopener noreferrer">Aiman Mutasem-bellh</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4881933302" data-role="relative-time" class="time-ago" title="Sunday, April 19, 2020 9:16 PM">2 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for the great post</p><p>I’m using standard TRANSFORMER for NMT and I’m going to train model Right to left. I have applied two ideas:</p><p>1. reversing the input text from left to Right, before feeding the data to <br> the encoder and decoder. (but the training process is still left to right)</p><p>2.
 reversing the embedding vector in the encoder and decoder. (Result is 
so boor, and the BLUE score is decreased by 15.6 points)</p><p>My question is what the optimal way to train model Right to Left?</p><p>Note: I have two versions of my model (RTL model) and (LTR model).</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28qkrue" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28qkrue"></li></ul></li><li class="realtime" data-role="realtime-notification:4881933302"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4881933302-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4865841600"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4865841600"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_W64TGqfzwI/" data-action="profile" data-username="disqus_W64TGqfzwI" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="347313044" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_W64TGqfzwI/" data-action="profile" data-username="disqus_W64TGqfzwI" target="_blank" rel="noopener noreferrer">Salted Fish</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4865841600" data-role="relative-time" class="time-ago" title="Wednesday, April 8, 2020 6:46 AM">2 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thank
 you for sharing so unselfishly. I have a question to ask you and I hope
 you can help me. About this tuple in Multihead attention:</p><p><code>query, key, value = /<br> [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)  <br>for l, x in zip(self.linears, (query, key, value))]</code></p><p>I've never seen a method that calls the element l(x) in a tuple like this, and I don't understand that very well.</p><p>For
 these three variables, “”query, key, value“”， I didn't see the input 
values before in the forward of Class multihead attention, but I found 
that they had values during the run. Where did they get their values 
from?</p><p>In my understanding, I think the values of these three 
variables “ query, key, value” are corresponding to the values of the 
first three self.linears, but it doesn't seem that way. I hope someone 
can give me some help to explain the details here. Thank you so much.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28gzveo" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28gzveo"></li></ul></li><li class="realtime" data-role="realtime-notification:4865841600"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4865841600-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4683799335"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4683799335"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_jVxRqA9Gkm/" data-action="profile" data-username="disqus_jVxRqA9Gkm" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="340520918" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_jVxRqA9Gkm/" data-action="profile" data-username="disqus_jVxRqA9Gkm" target="_blank" rel="noopener noreferrer">Anshul Shah</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4683799335" data-role="relative-time" class="time-ago" title="Saturday, November 9, 2019 8:26 PM">7 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for the awesome post!<br>I
 have a question: there seems to be a small issue in the 
SimpleLossCompute function. loss.backward() accumulates gradient during 
evaluation but, they won't be set to zero before the next step. Won't 
the next training step use gradients computed during evaluation ?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/25gm2p3" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/25gm2p3"></li></ul></li><li class="realtime" data-role="realtime-notification:4683799335"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4886246116"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4886246116"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_wGGAF5yQKM/" data-action="profile" data-username="disqus_wGGAF5yQKM" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="177403162" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_wGGAF5yQKM/" data-action="profile" data-username="disqus_wGGAF5yQKM" target="_blank" rel="noopener noreferrer">Gus Smith</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4683799335" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Anshul Shah</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4886246116" data-role="relative-time" class="time-ago" title="Thursday, April 23, 2020 12:13 AM">2 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Yes,
 it happens as you stated. Running validation does increase the 
performance on the validation set compare to if one does not run the 
validation. See my post here on the same topic.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28t57ms" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28t57ms"></li></ul></li><li class="realtime" data-role="realtime-notification:4886246116"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4886246116-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4683799335-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4416166916"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4416166916"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_T9X568BHlO/" data-action="profile" data-username="disqus_T9X568BHlO" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="260788705" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_T9X568BHlO/" data-action="profile" data-username="disqus_T9X568BHlO" target="_blank" rel="noopener noreferrer">Arthur Marques</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4416166916" data-role="relative-time" class="time-ago" title="Tuesday, April 9, 2019 2:51 PM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>In PositionalEncoding, there is a small fix discussed here: <a href="https://disq.us/url?url=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F52922445%2Fruntimeerror-exp-not-implemented-for-torch-longtensor%3ABrNPJZE-73zYv0I0pJ8j2ZPvDEM&amp;cuid=5460729" rel="nofollow noopener" title="https://stackoverflow.com/questions/52922445/runtimeerror-exp-not-implemented-for-torch-longtensor">https://stackoverflow.com/q...</a></p><p>LU Jialin quote:</p><p>For me I just got the torch.arange to generate float type tensor</p><p>from</p><p>position = torch.arange(0, max_len).unsqueeze(1)<br>div_term = torch.exp(torch.arange(0, d_model, 2) * -(math.log(10000.0) / d_model))<br>to</p><p>position = torch.arange(<b>0.</b>, max_len).unsqueeze(1)<br>div_term = torch.exp(torch.arange(<b>0.</b>, d_model, 2) * -(math.log(10000.0) / d_model))</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/2119s78" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/2119s78"></li></ul></li><li class="realtime" data-role="realtime-notification:4416166916"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4416166916-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4227028789"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4227028789"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/farzadsharif/" data-action="profile" data-username="farzadsharif" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="224156259" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/farzadsharif/" data-action="profile" data-username="farzadsharif" target="_blank" rel="noopener noreferrer">Farzad Sharif</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4227028789" data-role="relative-time" class="time-ago" title="Wednesday, December 5, 2018 4:17 PM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hi,
 so I'm trying to train the model on the IWSLT en-de dataset on a 2 GPU 
machine each with 12G memory. But I am running out of GPU memory. Is 
this normal?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1xwnwad" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1xwnwad"></li></ul></li><li class="realtime" data-role="realtime-notification:4227028789"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4918157349"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4918157349"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/aimanmutasembellh/" data-action="profile" data-username="aimanmutasembellh" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="136724852" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/aimanmutasembellh/" data-action="profile" data-username="aimanmutasembellh" target="_blank" rel="noopener noreferrer">Aiman Mutasem-bellh</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4227028789" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Farzad Sharif</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4918157349" data-role="relative-time" class="time-ago" title="Monday, May 18, 2020 8:28 AM">a month ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hello Mr. Farzad. Kindlly, did you fix this issue? :)</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/29c56hx" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/29c56hx"></li></ul></li><li class="realtime" data-role="realtime-notification:4918157349"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4918157349-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4227028789-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3845808761"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="3845808761"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_htlIvpMsai/" data-action="profile" data-username="disqus_htlIvpMsai" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="194386225" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_htlIvpMsai/" data-action="profile" data-username="disqus_htlIvpMsai" target="_blank" rel="noopener noreferrer">주말이다</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-3845808761" data-role="relative-time" class="time-ago" title="Monday, April 9, 2018 12:28 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks!</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1rlp115" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1rlp115"></li></ul></li><li class="realtime" data-role="realtime-notification:3845808761"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3845808761-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3873740919"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="3873740919"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_htlIvpMsai/" data-action="profile" data-username="disqus_htlIvpMsai" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="194386225" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_htlIvpMsai/" data-action="profile" data-username="disqus_htlIvpMsai" target="_blank" rel="noopener noreferrer">주말이다</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-3873740919" data-role="relative-time" class="time-ago" title="Thursday, April 26, 2018 10:09 AM">2 years ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I have a question about class SublayerConnection.<br>the comment says "for code simplicity the norm is first as opposed to last."<br>But
 the loss wont go down below 4~5 when the norm is applied after residual
 layer in the decoder, same as described in the paper.<br>Do you have any idea of this phenomenon?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-2" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">2</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-2" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">2</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1s2bpmf" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1s2bpmf"></li></ul></li><li class="realtime" data-role="realtime-notification:3873740919"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4150550608"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4150550608"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_5iwwxhLeGL/" data-action="profile" data-username="disqus_5iwwxhLeGL" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="323780185" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_5iwwxhLeGL/" data-action="profile" data-username="disqus_5iwwxhLeGL" target="_blank" rel="noopener noreferrer">Yu-Tao</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-3873740919" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> 주말이다</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4150550608" data-role="relative-time" class="time-ago" title="Thursday, October 18, 2018 12:44 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>same question. <br>but why not change the code into <br>return self.norm(x + self.dropout(sublayer(x)))<br>this seems more like the original paper?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-4" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">4</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1wn4pcg" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1wn4pcg"></li></ul></li><li class="realtime" data-role="realtime-notification:4150550608"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4202213577"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4202213577"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_akZ5ASHeyH/" data-action="profile" data-username="disqus_akZ5ASHeyH" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="258332319" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_akZ5ASHeyH/" data-action="profile" data-username="disqus_akZ5ASHeyH" target="_blank" rel="noopener noreferrer">Neo li</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4150550608" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Yu-Tao</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4202213577" data-role="relative-time" class="time-ago" title="Monday, November 19, 2018 6:22 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Yey, I have the same question. And  There new code in (<a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FOpenNMT%2FOpenNMT-py%2Fblob%2Fcd29c1dbfb35f4a2701ff52a1bf4e5bdcf02802e%2Fonmt%2Fencoders%2Ftransformer.py%23L48%29%3AkPEDwJxosNkT2LbhtOQLR49t7Oo&amp;cuid=5460729" rel="nofollow noopener" title="https://github.com/OpenNMT/OpenNMT-py/blob/cd29c1dbfb35f4a2701ff52a1bf4e5bdcf02802e/onmt/encoders/transformer.py#L48)">https://github.com/OpenNMT/...</a> still writing like that. Obviously, the formula they list does not match the code they have.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-4" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">4</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1xhw0qx" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1xhw0qx"></li></ul></li><li class="realtime" data-role="realtime-notification:4202213577"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4202213577-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4469709216"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4469709216"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/prashantserai/" data-action="profile" data-username="prashantserai" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="105178679" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/prashantserai/" data-action="profile" data-username="prashantserai" target="_blank" rel="noopener noreferrer">Prashant serai</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4150550608" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Yu-Tao</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4469709216" data-role="relative-time" class="time-ago" title="Monday, May 20, 2019 9:37 AM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>It appears that the code provided by original the authors of the paper differs in this matter from what's stated in the paper.<br>Here, they seem to implement the original authors' code instead of the original paper.</p><p>Reference:<br><a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FOpenNMT%2FOpenNMT-py%2Fissues%2F770%23issuecomment-398299135%3A09ugKrHc-S2FOi-LYJRpzwGY2mA&amp;cuid=5460729" rel="nofollow noopener" title="https://github.com/OpenNMT/OpenNMT-py/issues/770#issuecomment-398299135">https://github.com/OpenNMT/...</a></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">1</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/21x5dpc" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/21x5dpc"></li></ul></li><li class="realtime" data-role="realtime-notification:4469709216"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4469709216-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4569337441"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4569337441"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/willprice94/" data-action="profile" data-username="willprice94" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="21431364" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/willprice94/" data-action="profile" data-username="willprice94" target="_blank" rel="noopener noreferrer">willprice94</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4150550608" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Yu-Tao</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4569337441" data-role="relative-time" class="time-ago" title="Wednesday, August 7, 2019 10:02 AM">10 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I too was confused about this, but it seems they are true to the implementation in T2T (<a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensor2tensor%2Fblob%2F43be271c8a3fa06cb06b5147f044cbdc8bb77535%2Ftensor2tensor%2Fmodels%2Ftransformer.py%23L1799-L1800%3AlvQ3PVGJTkoDJWSy8faq-PLPCas&amp;cuid=5460729" rel="nofollow noopener" title="https://github.com/tensorflow/tensor2tensor/blob/43be271c8a3fa06cb06b5147f044cbdc8bb77535/tensor2tensor/models/transformer.py#L1799-L1800">https://github.com/tensorfl...</a> specifies the hyperparameters for the pre and post layer transformations applied by <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensor2tensor%2Fblob%2F43be271c8a3fa06cb06b5147f044cbdc8bb77535%2Ftensor2tensor%2Flayers%2Fcommon_layers.py%23L862%29%3APcLTR_7HqSnJa4tSB9Ba8KMyPHc&amp;cuid=5460729" rel="nofollow noopener" title="https://github.com/tensorflow/tensor2tensor/blob/43be271c8a3fa06cb06b5147f044cbdc8bb77535/tensor2tensor/layers/common_layers.py#L862)">https://github.com/tensorfl...</a>. The description in the paper is inconsistent with the implementation.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/23kgrc1" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/23kgrc1"></li></ul></li><li class="realtime" data-role="realtime-notification:4569337441"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4569337441-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4150550608-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4202228717"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4202228717"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_akZ5ASHeyH/" data-action="profile" data-username="disqus_akZ5ASHeyH" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="258332319" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_akZ5ASHeyH/" data-action="profile" data-username="disqus_akZ5ASHeyH" target="_blank" rel="noopener noreferrer">Neo li</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-3873740919" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> 주말이다</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4202228717" data-role="relative-time" class="time-ago" title="Monday, November 19, 2018 6:38 AM">2 years ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p><a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2FOpenNMT%2FOpenNMT-py%2Fissues%2F770%3AP4vM-d65dWitBlBZMRrqtd4pcFw&amp;cuid=5460729" rel="nofollow noopener" title="https://github.com/OpenNMT/OpenNMT-py/issues/770">https://github.com/OpenNMT/...</a></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-2" data-action="upvote" title="" name="Vote up"><span class="updatable count" data-role="likes">2</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-1" data-action="downvote" title="" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">1</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/1xhwcfh" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1xhwcfh"></li></ul></li><li class="realtime" data-role="realtime-notification:4202228717"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4202228717-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4442197867"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4442197867"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/2014ion/" data-action="profile" data-username="2014ion" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="331927718" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/2014ion/" data-action="profile" data-username="2014ion" target="_blank" rel="noopener noreferrer">2014 ion</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-3873740919" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> 주말이다</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4442197867" data-role="relative-time" class="time-ago" title="Monday, April 29, 2019 2:17 AM">a year ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I
 recon that the layernorm will eliminate the gradients if they are 
normalized together, just like adding softmax to end of a layer。</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/21grpt7" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/21grpt7"></li></ul></li><li class="realtime" data-role="realtime-notification:4442197867"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4442197867-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3873740919-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4890774308"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4890774308"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_ueScOToxjn/" data-action="profile" data-username="disqus_ueScOToxjn" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="279990264" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_ueScOToxjn/" data-action="profile" data-username="disqus_ueScOToxjn" target="_blank" rel="noopener noreferrer">Santhosh kumar.r</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4890774308" data-role="relative-time" class="time-ago" title="Sunday, April 26, 2020 1:14 PM">2 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Can anyone explain what going on inside the code block below. Why are we slicing target tenser. What does the blocked line do</p><p><code><br>if trg is not None:<br>    self.trg = trg[:, :-1]<br>    self.trg_y = trg[:, 1:]<br>    self.trg_mask = self.make_std_mask(self.trg, pad)<br>    self.ntokens = (self.trg_y != pad).data.sum()<br><br>    @staticmethod<br>    def make_std_mask(tgt, pad):<br>        "Create a mask to hide padding and future words."<br>        tgt_mask = (tgt != pad).unsqueeze(-2)<br>        <b>tgt_mask = tgt_mask &amp; Variable(subsequent_mask(tgt.size(-1)).type_as(<a href="http://disq.us/url?url=http%3A%2F%2Ftgt_mask.data%3ABFqsU95Z7l2Xi5bBRrBB4I594mI&amp;cuid=5460729" rel="nofollow noopener" title="tgt_mask.data">tgt_mask.data</a>))</b> #<br>        return tgt_mask<br></code></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28vu9lw" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28vu9lw"></li></ul></li><li class="realtime" data-role="realtime-notification:4890774308"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4890774308-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4856371343"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4856371343"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/emilrijcken/" data-action="profile" data-username="emilrijcken" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="71050492" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/emilrijcken/" data-action="profile" data-username="emilrijcken" target="_blank" rel="noopener noreferrer">Emil Rijcken</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4856371343" data-role="relative-time" class="time-ago" title="Wednesday, April 1, 2020 7:12 AM">2 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for this great post! I still have two questions remaining:</p><p>1. How are the query, key and value initialized? What are they based on?</p><p>2. What happens in the following lines?:</p><p><code>query, key, value = \<br>            [l(x).view(nbatches, -1, self.h, self.d_k).transpose(1, 2)<br>             for l, x in zip(self.linears, (query, key, value))]</code></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28bcw3z" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28bcw3z"></li></ul></li><li class="realtime" data-role="realtime-notification:4856371343"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4865585718"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4865585718"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_W64TGqfzwI/" data-action="profile" data-username="disqus_W64TGqfzwI" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="347313044" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_W64TGqfzwI/" data-action="profile" data-username="disqus_W64TGqfzwI" target="_blank" rel="noopener noreferrer">Salted Fish</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4856371343" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Emil Rijcken</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4865585718" data-role="relative-time" class="time-ago" title="Wednesday, April 8, 2020 12:11 AM">2 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I have the same question as yours, do you figure it out?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28gudyu" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28gudyu"></li></ul></li><li class="realtime" data-role="realtime-notification:4865585718"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4865585718-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4856371343-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4829395282"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4829395282"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_ncDZfpFCvH/" data-action="profile" data-username="disqus_ncDZfpFCvH" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="229238841" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_ncDZfpFCvH/" data-action="profile" data-username="disqus_ncDZfpFCvH" target="_blank" rel="noopener noreferrer">German</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4829395282" data-role="relative-time" class="time-ago" title="Wednesday, March 11, 2020 7:09 PM">3 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Excellent post. It is very interesting!</p><p>I
 tried running the code shown in the post to analyze the copy and 
translation examples, but it appears that I have something wrong when 
evaluating the loss function.</p><p>Every time I run my code, it appears the following message:</p><p>Variable(torch.LongTensor([1]))).data[0]</p><p>IndexError: invalid index of a 0-dim tensor. Use tensor.item() to convert a 0-dim tensor to a Python number</p><p>Does anyone know why I'm getting this error? I copied the functions as shown in the post, so I have no idea of what is wrong.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/27vap8y" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/27vap8y"></li></ul></li><li class="realtime" data-role="realtime-notification:4829395282"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4829399538"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4829399538"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_ncDZfpFCvH/" data-action="profile" data-username="disqus_ncDZfpFCvH" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="229238841" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_ncDZfpFCvH/" data-action="profile" data-username="disqus_ncDZfpFCvH" target="_blank" rel="noopener noreferrer">German</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4829395282" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> German</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4829399538" data-role="relative-time" class="time-ago" title="Wednesday, March 11, 2020 7:12 PM">3 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Never mind, it appears that my Pytorch version was the one generating the error.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/27vasj6" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/27vasj6"></li></ul></li><li class="realtime" data-role="realtime-notification:4829399538"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4865535850"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4865535850"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/paulmyeongchankim/" data-action="profile" data-username="paulmyeongchankim" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="233898100" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/paulmyeongchankim/" data-action="profile" data-username="paulmyeongchankim" target="_blank" rel="noopener noreferrer">Paul Myeongchan Kim</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4829399538" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> German</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4865535850" data-role="relative-time" class="time-ago" title="Tuesday, April 7, 2020 11:00 PM">2 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I found the same problem. <br>Change '''return crit(Variable(predict.log()),<br>                 Variable(torch.LongTensor([1]))).data[0]'''<br>to<br>'''return crit(Variable(predict.log()),<br>                 Variable(torch.LongTensor([1])))'''<br>works for me.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/28gtbhm" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/28gtbhm"></li></ul></li><li class="realtime" data-role="realtime-notification:4865535850"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4865535850-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4829399538-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4829395282-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4797788504"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4797788504"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_CJ2YxxoGsj/" data-action="profile" data-username="disqus_CJ2YxxoGsj" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="262779450" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_CJ2YxxoGsj/" data-action="profile" data-username="disqus_CJ2YxxoGsj" target="_blank" rel="noopener noreferrer">王宗冰</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4797788504" data-role="relative-time" class="time-ago" title="Sunday, February 16, 2020 1:46 AM">4 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Great</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/27ch9aw" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/27ch9aw"></li></ul></li><li class="realtime" data-role="realtime-notification:4797788504"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4797788504-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4777619610"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4777619610"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/danielclaborne/" data-action="profile" data-username="danielclaborne" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="344074786" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/danielclaborne/" data-action="profile" data-username="danielclaborne" target="_blank" rel="noopener noreferrer">Daniel Claborne</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4777619610" data-role="relative-time" class="time-ago" title="Thursday, January 30, 2020 6:34 PM">5 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>The
 text towards the beginning of the encoder section states: "That is, the
 output of each sub-layer is LayerNorm(X + Sublayer(X))"</p><p>However in the code the following is called:  x + self.dropout(sublayer(self.norm(x)))</p><p>Which (ignoring dropout) I interpret in text as:<br> "X + Sublayer(LayerNorm(x)) != "LayerNorm(X + Sublayer(X))"</p><p>Are these actually equivalent, whats going on here?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/270gyvu" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/270gyvu"></li></ul></li><li class="realtime" data-role="realtime-notification:4777619610"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4843991852"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4843991852"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/ajwildridge/" data-action="profile" data-username="ajwildridge" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="341999572" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/ajwildridge/" data-action="profile" data-username="ajwildridge" target="_blank" rel="noopener noreferrer">Aj Wildridge</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4777619610" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Daniel Claborne</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4843991852" data-role="relative-time" class="time-ago" title="Monday, March 23, 2020 2:31 AM">3 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>These
 are not equivalent but the differences are almost negligible. The paper
 writes it as LayerNorm(X + Sublayer(X))", but apparently the authors' 
code implemented it as "X + Dropout(Sublayer(LayerNorm(X)))". The 
difference is that this implementation normalizes the output after the 
summation/matrix multiplication and the paper normalizes the output 
after the residual connection. I would have guessed that normalizing 
after the residual connection would have slightly better 
performance/convergence but either that's not true or it doesn't matter.</p><p>There's discussions about this earlier on this page: <a href="http://disq.us/p/1s2bpmf" rel="nofollow noopener" title="http://disq.us/p/1s2bpmf">http://disq.us/p/1s2bpmf</a></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/283zk18" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/283zk18"></li></ul></li><li class="realtime" data-role="realtime-notification:4843991852"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4843991852-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4777619610-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4761321050"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4761321050"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/sruthikeshsurineni/" data-action="profile" data-username="sruthikeshsurineni" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="343506387" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/sruthikeshsurineni/" data-action="profile" data-username="sruthikeshsurineni" target="_blank" rel="noopener noreferrer">Sruthikesh Surineni</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4761321050" data-role="relative-time" class="time-ago" title="Friday, January 17, 2020 9:05 PM">5 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thanks for a great post!</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/26qrmu2" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/26qrmu2"></li></ul></li><li class="realtime" data-role="realtime-notification:4761321050"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4761321050-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4650467166"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4650467166"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/chuankangwu/" data-action="profile" data-username="chuankangwu" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="338843326" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/chuankangwu/" data-action="profile" data-username="chuankangwu" target="_blank" rel="noopener noreferrer">chuankang wu</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4650467166" data-role="relative-time" class="time-ago" title="Sunday, October 13, 2019 3:53 AM">8 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I have a question about LabelSmoothing()：<br>true_dist.fill_(self.smoothing / (self.size - 2))<br>why  is (self.size -2) ?<br>in the paper,  eps/K ,  so it should be (self.smoothing / self.size ), where is my misunderstanding?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/24wrnfi" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/24wrnfi"></li></ul></li><li class="realtime" data-role="realtime-notification:4650467166"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4764931975"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4764931975"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/shijianxiao/" data-action="profile" data-username="shijianxiao" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="343642456" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/shijianxiao/" data-action="profile" data-username="shijianxiao" target="_blank" rel="noopener noreferrer">Shijian Xiao</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4650467166" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> chuankang wu</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4764931975" data-role="relative-time" class="time-ago" title="Tuesday, January 21, 2020 2:25 AM">5 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I
 don't know whether it is right or not. In my opinion, the sentence 
include '&lt;sos&gt;' and '&lt;eos&gt;', so it should self.size - 2</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/26sx11j" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/26sx11j"></li></ul></li><li class="realtime" data-role="realtime-notification:4764931975"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4764931975-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4650467166-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4624106196"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4624106196"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/xiangyizhang/" data-action="profile" data-username="xiangyizhang" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="324863622" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/xiangyizhang/" data-action="profile" data-username="xiangyizhang" target="_blank" rel="noopener noreferrer">XiangYi Zhang</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4624106196" data-role="relative-time" class="time-ago" title="Saturday, September 21, 2019 5:59 PM">9 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>such an instructive post!</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/24h2n6c" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/24h2n6c"></li></ul></li><li class="realtime" data-role="realtime-notification:4624106196"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4624106196-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4593053051"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4593053051"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_fNLJ4DtS27/" data-action="profile" data-username="disqus_fNLJ4DtS27" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="336941994" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_fNLJ4DtS27/" data-action="profile" data-username="disqus_fNLJ4DtS27" target="_blank" rel="noopener noreferrer">王堃</a></span> </span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4593053051" data-role="relative-time" class="time-ago" title="Monday, August 26, 2019 11:04 PM">10 months ago</a> <span><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <span class="has-edit" data-role="has-edit">edited</span></span></span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Thank you for a great piece.</p><p>I have a question about the method foward in LabelSmoothing. I debug it by Pycharm and the excuting order is from <br>loss = self.criterion(x.contiguous().view(-1, x.size(-1)),  #[30, 9, 512] --&gt; [270, 512]<br>                              y.contiguous().view(-1)) / norm  #[30, 9] --&gt; [270]    (SimpleLossCompute's method  __call__)<br>to<br>method forward in LabelSmoothing<br>    def forward(self, x, target):  #x is the output of model, target is label<br>        assert x.size(1) == self.size<br>        true_dist = x.data.clone()<br>        ....<br>why the dim of x changes from [270, 512] to [270, 11]</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/23yl2ez" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/23yl2ez"></li></ul></li><li class="realtime" data-role="realtime-notification:4593053051"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-4593126985"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><ul class="post-menu dropdown" data-role="menu" data-view-id="post-menu" data-post-id="4593126985"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_fNLJ4DtS27/" data-action="profile" data-username="disqus_fNLJ4DtS27" target="_blank" rel="noopener noreferrer" class="user"><img data-role="user-avatar" data-user="336941994" src="a_data/noavatar92.png" alt="Avatar"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_fNLJ4DtS27/" data-action="profile" data-username="disqus_fNLJ4DtS27" target="_blank" rel="noopener noreferrer">王堃</a></span> </span><span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4593053051" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> 王堃</a></span></span> <span class="post-meta"><span class="bullet time-ago-bullet" aria-hidden="true">•</span> <a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#comment-4593126985" data-role="relative-time" class="time-ago" title="Tuesday, August 27, 2019 1:16 AM">10 months ago</a> </span>  </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Sorry, I made a mistake and I know the reason now.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="updatable count" data-role="likes">0</span> <span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span></a><div class="post-votes__separator"></div><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="bullet" aria-hidden="true">•</li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li class="comment__share"><a class="toggle" tabindex="0"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter"><button class="share__button icon icon-twitter" data-action="share:twitter"></button></li><li class="facebook"><button class="share__button icon icon-facebook" data-action="share:facebook"></button></li></div><li class="link"><button class="share__button icon icon-link" value="http://disq.us/p/23ymngp" name="Link" title="Click to copy post link" data-action="copy-link"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/23ymngp"></li></ul></li><li class="realtime" data-role="realtime-notification:4593126985"><span style="display: none;" class="realtime-replies"></span><a style="display: none;" href="#" class="realtime-button"></a></li></menu></footer></div><div data-role="blacklist-form"></div><div data-role="flagging-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4593126985-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4593053051-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="load-more" data-role="more" style=""><a href="#" data-action="more-posts" class="btn load-more__button">Load more comments</a></div></div></section><div id="placement-bottom" data-tracking-area="discovery-south"></div><div id="footer" data-tracking-area="footer" class="disqus-footer__wrapper"><ul class="disqus-footer"><li class="disqus-footer__logo"><a href="https://disqus.com/" rel="nofollow" title="Powered by Disqus" class="disqus-footer__link">Powered by Disqus</a></li><li id="thread-subscribe-button" class="email disqus-footer__item"><div class="default"><a href="#" rel="nofollow" data-action="subscribe" title="Subscribe and get email updates from this discussion" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-mail"></i><span class="clip">Subscribe</span><i aria-hidden="true" class="icon icon-checkmark"></i></a></div></li><li class="install disqus-footer__item"><a href="https://publishers.disqus.com/engage?utm_source=harvard-nlp&amp;utm_medium=Disqus-Footer" rel="nofollow noopener noreferrer" target="_blank" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-disqus"></i><span class="clip hidden-md">Add Disqus to your site</span><span class="clip visible-md hidden-xs">Add Disqus</span><span class="clip visible-xs">Add</span></a></li><li class="do-not-sell disqus-footer__item"><a href="https://disqus.com/data-sharing-settings/" rel="nofollow noopener noreferrer" target="_blank" class="disqus-footer__link"><i aria-hidden="true" class="icon icon-warning"></i><span class="clip">Do Not Sell My Data</span></a></li></ul></div></div></div></div></div><div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div></div></div></div><iframe id="ssIFrame_google" sandbox="allow-scripts allow-same-origin" style="position: absolute; width: 1px; height: 1px; left: -9999px; top: -9999px; right: -9999px; bottom: -9999px; display: none;" aria-hidden="true" frame-border="0" src="a_data/iframe.html"></iframe><img style="display: none;" src="a_data/a.gif"><iframe style="display: none;" src="a_data/pixel.html"></iframe><img style="display: none;" src="a_data/getuid.png"><iframe style="display: none;" src="a_data/sync.html"></iframe></body></html>